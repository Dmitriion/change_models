<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>56 Моделей Управления Изменениями: От Классических к Современным (2025)</title>
    <style>
        :root {
  /* Primitive Color Tokens */
  --color-white: rgba(255, 255, 255, 1);
  --color-black: rgba(0, 0, 0, 1);
  --color-cream-50: rgba(252, 252, 249, 1);
  --color-cream-100: rgba(255, 255, 253, 1);
  --color-gray-200: rgba(245, 245, 245, 1);
  --color-gray-300: rgba(167, 169, 169, 1);
  --color-gray-400: rgba(119, 124, 124, 1);
  --color-slate-500: rgba(98, 108, 113, 1);
  --color-brown-600: rgba(94, 82, 64, 1);
  --color-charcoal-700: rgba(31, 33, 33, 1);
  --color-charcoal-800: rgba(38, 40, 40, 1);
  --color-slate-900: rgba(19, 52, 59, 1);
  --color-teal-300: rgba(50, 184, 198, 1);
  --color-teal-400: rgba(45, 166, 178, 1);
  --color-teal-500: rgba(33, 128, 141, 1);
  --color-teal-600: rgba(29, 116, 128, 1);
  --color-teal-700: rgba(26, 104, 115, 1);
  --color-teal-800: rgba(41, 150, 161, 1);
  --color-red-400: rgba(255, 84, 89, 1);
  --color-red-500: rgba(192, 21, 47, 1);
  --color-orange-400: rgba(230, 129, 97, 1);
  --color-orange-500: rgba(168, 75, 47, 1);

  --color-brown-600-rgb: 94, 82, 64;
  --color-teal-500-rgb: 33, 128, 141;
  --color-slate-900-rgb: 19, 52, 59;
  --color-slate-500-rgb: 98, 108, 113;
  --color-red-500-rgb: 192, 21, 47;
  --color-red-400-rgb: 255, 84, 89;
  --color-orange-500-rgb: 168, 75, 47;
  --color-orange-400-rgb: 230, 129, 97;

  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);

  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);

  --focus-ring: 0 0 0 3px var(--color-focus-ring);
  --focus-outline: 2px solid var(--color-primary);
  --status-bg-opacity: 0.15;
  --status-border-opacity: 0.25;

  --font-family-base: "FKGroteskNeue", "Geist", "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  --font-family-mono: "Berkeley Mono", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace;
  --font-size-xs: 11px;
  --font-size-sm: 12px;
  --font-size-base: 14px;
  --font-size-md: 14px;
  --font-size-lg: 16px;
  --font-size-xl: 18px;
  --font-size-2xl: 20px;
  --font-size-3xl: 24px;
  --font-size-4xl: 30px;
  --font-weight-normal: 400;
  --font-weight-medium: 500;
  --font-weight-semibold: 550;
  --font-weight-bold: 600;
  --line-height-tight: 1.2;
  --line-height-normal: 1.5;
  --letter-spacing-tight: -0.01em;

  --space-0: 0;
  --space-1: 1px;
  --space-2: 2px;
  --space-4: 4px;
  --space-6: 6px;
  --space-8: 8px;
  --space-10: 10px;
  --space-12: 12px;
  --space-16: 16px;
  --space-20: 20px;
  --space-24: 24px;
  --space-32: 32px;

  --radius-sm: 6px;
  --radius-base: 8px;
  --radius-md: 10px;
  --radius-lg: 12px;
  --radius-full: 9999px;

  --shadow-xs: 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.02);
  --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.04), 0 2px 4px -1px rgba(0, 0, 0, 0.02);
  --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.04), 0 4px 6px -2px rgba(0, 0, 0, 0.02);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);

  --duration-fast: 150ms;
  --duration-normal: 250ms;
  --ease-standard: cubic-bezier(0.16, 1, 0.3, 1);

  --container-sm: 640px;
  --container-md: 768px;
  --container-lg: 1024px;
  --container-xl: 1280px;

  /* Адаптивные размеры */
  --responsive-padding: clamp(1rem, 4vw, 2rem);
  --responsive-padding-lg: clamp(1.5rem, 6vw, 3rem);
  --responsive-text-sm: clamp(0.75rem, 2vw, 0.875rem);
  --responsive-text-base: clamp(0.875rem, 2.5vw, 1rem);
  --responsive-text-lg: clamp(1rem, 3vw, 1.25rem);
  --responsive-text-xl: clamp(1.25rem, 4vw, 1.5rem);
  --responsive-text-2xl: clamp(1.5rem, 5vw, 2rem);
  --responsive-text-3xl: clamp(1.75rem, 6vw, 2.5rem);
  --responsive-text-4xl: clamp(2rem, 8vw, 3rem);
  --responsive-gap-sm: clamp(0.5rem, 2vw, 0.75rem);
  --responsive-gap-md: clamp(0.75rem, 3vw, 1rem);
  --responsive-gap-lg: clamp(1rem, 4vw, 1.5rem);

  /* Новые брейкпоинты */
  --breakpoint-xs: 480px;
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;

  /* Presentation specific colors */
  --pres-primary: #1e3a8a;
  --pres-secondary: #0d9488;
  --pres-accent: #f59e0b;
  --pres-bg-light: #f3f4f6;
  --pres-text: #1f2937;
  --pres-contextual: #3b82f6;
  --pres-highlevel: #0d9488;
  --pres-actionable: #10b981;
  --pres-supporting: #f59e0b;

  /* Адаптивные размеры */
  --responsive-padding: clamp(1rem, 4vw, 2rem);
  --responsive-padding-lg: clamp(1.5rem, 6vw, 3rem);
  --responsive-text-sm: clamp(0.75rem, 2vw, 0.875rem);
  --responsive-text-base: clamp(0.875rem, 2.5vw, 1rem);
  --responsive-text-lg: clamp(1rem, 3vw, 1.25rem);
  --responsive-text-xl: clamp(1.25rem, 4vw, 1.5rem);
  --responsive-text-2xl: clamp(1.5rem, 5vw, 2rem);
  --responsive-text-3xl: clamp(1.75rem, 6vw, 2.5rem);
  --responsive-text-4xl: clamp(2rem, 8vw, 3rem);
  --responsive-gap-sm: clamp(0.5rem, 2vw, 0.75rem);
  --responsive-gap-md: clamp(0.75rem, 3vw, 1rem);
  --responsive-gap-lg: clamp(1rem, 4vw, 1.5rem);

  /* Новые брейкпоинты */
  --breakpoint-xs: 480px;
  --breakpoint-sm: 640px;
  --breakpoint-md: 768px;
  --breakpoint-lg: 1024px;
  --breakpoint-xl: 1280px;
}

@media (prefers-color-scheme: dark) {
  body:not(.theme-light) {
    --color-gray-400-rgb: 119, 124, 124;
    --color-teal-300-rgb: 50, 184, 198;
    --color-gray-300-rgb: 167, 169, 169;
    --color-gray-200-rgb: 245, 245, 245;
    --color-bg-1: rgba(29, 78, 216, 0.15);
    --color-bg-2: rgba(180, 83, 9, 0.15);
    --color-bg-3: rgba(21, 128, 61, 0.15);
    --color-bg-4: rgba(185, 28, 28, 0.15);
    --color-bg-5: rgba(107, 33, 168, 0.15);
    --color-bg-6: rgba(194, 65, 12, 0.15);
    --color-bg-7: rgba(190, 24, 93, 0.15);
    --color-bg-8: rgba(8, 145, 178, 0.15);
    --color-background: var(--color-charcoal-700);
    --color-surface: var(--color-charcoal-800);
    --color-text: var(--color-gray-200);
    --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
    --color-primary: var(--color-teal-300);
    --color-primary-hover: var(--color-teal-400);
    --color-primary-active: var(--color-teal-800);
    --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
    --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
    --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
    --color-border: rgba(var(--color-gray-400-rgb), 0.3);
    --color-error: var(--color-red-400);
    --color-success: var(--color-teal-300);
    --color-warning: var(--color-orange-400);
    --color-info: var(--color-gray-300);
    --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
    --color-btn-primary-text: var(--color-slate-900);
    --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
    --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
    --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
    --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
    --pres-text: #e5e7eb;
    --pres-bg-light: #374151;
  }
}

body.theme-dark {
  --color-gray-400-rgb: 119, 124, 124;
  --color-teal-300-rgb: 50, 184, 198;
  --color-gray-300-rgb: 167, 169, 169;
  --color-gray-200-rgb: 245, 245, 245;
  --color-bg-1: rgba(29, 78, 216, 0.15);
  --color-bg-2: rgba(180, 83, 9, 0.15);
  --color-bg-3: rgba(21, 128, 61, 0.15);
  --color-bg-4: rgba(185, 28, 28, 0.15);
  --color-bg-5: rgba(107, 33, 168, 0.15);
  --color-bg-6: rgba(194, 65, 12, 0.15);
  --color-bg-7: rgba(190, 24, 93, 0.15);
  --color-bg-8: rgba(8, 145, 178, 0.15);
  --color-background: var(--color-charcoal-700);
  --color-surface: var(--color-charcoal-800);
  --color-text: var(--color-gray-200);
  --color-text-secondary: rgba(var(--color-gray-300-rgb), 0.7);
  --color-primary: var(--color-teal-300);
  --color-primary-hover: var(--color-teal-400);
  --color-primary-active: var(--color-teal-800);
  --color-secondary: rgba(var(--color-gray-400-rgb), 0.15);
  --color-secondary-hover: rgba(var(--color-gray-400-rgb), 0.25);
  --color-secondary-active: rgba(var(--color-gray-400-rgb), 0.3);
  --color-border: rgba(var(--color-gray-400-rgb), 0.3);
  --color-error: var(--color-red-400);
  --color-success: var(--color-teal-300);
  --color-warning: var(--color-orange-400);
  --color-info: var(--color-gray-300);
  --color-focus-ring: rgba(var(--color-teal-300-rgb), 0.4);
  --color-btn-primary-text: var(--color-slate-900);
  --color-card-border: rgba(var(--color-gray-400-rgb), 0.2);
  --color-card-border-inner: rgba(var(--color-gray-400-rgb), 0.15);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.1), inset 0 -1px 0 rgba(0, 0, 0, 0.15);
  --color-select-caret: rgba(var(--color-gray-200-rgb), 0.8);
  --pres-text: #e5e7eb;
  --pres-bg-light: #374151;
}

body.theme-light {
  --color-gray-400-rgb: 119, 124, 124;
  --color-teal-300-rgb: 50, 184, 198;
  --color-gray-300-rgb: 167, 169, 169;
  --color-gray-200-rgb: 245, 245, 245;
  --color-bg-1: rgba(59, 130, 246, 0.08);
  --color-bg-2: rgba(245, 158, 11, 0.08);
  --color-bg-3: rgba(34, 197, 94, 0.08);
  --color-bg-4: rgba(239, 68, 68, 0.08);
  --color-bg-5: rgba(147, 51, 234, 0.08);
  --color-bg-6: rgba(249, 115, 22, 0.08);
  --color-bg-7: rgba(236, 72, 153, 0.08);
  --color-bg-8: rgba(6, 182, 212, 0.08);
  --color-background: var(--color-cream-50);
  --color-surface: var(--color-cream-100);
  --color-text: var(--color-slate-900);
  --color-text-secondary: var(--color-slate-500);
  --color-primary: var(--color-teal-500);
  --color-primary-hover: var(--color-teal-600);
  --color-primary-active: var(--color-teal-700);
  --color-secondary: rgba(var(--color-brown-600-rgb), 0.12);
  --color-secondary-hover: rgba(var(--color-brown-600-rgb), 0.2);
  --color-secondary-active: rgba(var(--color-brown-600-rgb), 0.25);
  --color-border: rgba(var(--color-brown-600-rgb), 0.2);
  --color-error: var(--color-red-500);
  --color-success: var(--color-teal-500);
  --color-warning: var(--color-orange-500);
  --color-info: var(--color-slate-500);
  --color-focus-ring: rgba(var(--color-teal-500-rgb), 0.4);
  --color-btn-primary-text: var(--color-cream-50);
  --color-card-border: rgba(var(--color-brown-600-rgb), 0.12);
  --color-card-border-inner: rgba(var(--color-brown-600-rgb), 0.12);
  --shadow-inset-sm: inset 0 1px 0 rgba(255, 255, 255, 0.15), inset 0 -1px 0 rgba(0, 0, 0, 0.03);
  --color-select-caret: rgba(var(--color-slate-900-rgb), 0.8);
  --pres-text: #1f2937;
  --pres-bg-light: #f3f4f6;
}

@font-face {
  font-family: 'FKGroteskNeue';
  src: url('https://r2cdn.perplexity.ai/fonts/FKGroteskNeue.woff2') format('woff2');
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: var(--font-family-base);
  background-color: var(--color-background);
  color: var(--color-text);
  overflow: hidden;
}

.presentation {
  width: 100vw;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.slide-container {
  flex: 1;
  overflow: hidden;
  position: relative;
  padding-bottom: 80px; /* Отступ для фиксированного тулбара */
  padding-top: 0; /* Будет установлен динамически на мобильных */
  /* Разрешаем вертикальный скролл, но не блокируем горизонтальные жесты для свайпов */
  touch-action: pan-y pan-x;
  /* Предотвращаем цепочку скролла */
  overscroll-behavior: contain;
}

/* Адаптивный отступ для тулбара с учетом safe-area */
@supports (padding: max(0px)) {
  .slide-container {
    padding-bottom: max(80px, calc(80px + env(safe-area-inset-bottom)));
    padding-top: max(0px, env(safe-area-inset-top));
  }
}

/* Мобильный padding-top для верхнего тулбара */
@media (max-width: 768px) {
  .slide-container {
    padding-top: 60px; /* Отступ для верхних элементов на мобильных */
  }
  
  @supports (padding: max(0px)) {
    .slide-container {
      padding-top: max(60px, calc(60px + env(safe-area-inset-top)));
    }
  }
}

.slide {
  display: none;
  width: 100%;
  height: 100%;
  padding: var(--responsive-padding);
  overflow-y: auto;
  opacity: 0;
  transform: translateY(24px);
  transition: opacity 0.45s var(--ease-standard), transform 0.6s var(--ease-standard);
  -webkit-overflow-scrolling: touch;
  /* Разрешаем вертикальный скролл и горизонтальные жесты для свайпов */
  touch-action: pan-y pan-x;
  /* Предотвращаем цепочку скролла и bounce-эффект на iOS */
  overscroll-behavior: contain;
  overscroll-behavior-y: contain;
  overscroll-behavior-x: none;
}

.slide.active {
  display: block;
  opacity: 1;
  transform: translateY(0);
  animation: slideFadeIn 0.6s var(--ease-standard);
}

@media (max-width: 640px) {
  .slide {
    padding: clamp(0.75rem, 3vw, 1rem);
  }

  .section-overview,
  .practice-tools {
    margin-top: var(--space-16);
    gap: var(--space-12);
  }

  .overview-card,
  .practice-tool-card {
    padding: var(--space-20);
  }
}

@media (max-width: 480px) {
  .slide {
    padding: clamp(0.5rem, 2vw, 0.75rem);
  }
}

@keyframes slideFadeIn {
  from {
    opacity: 0;
    transform: translateY(32px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.slide-header {
  text-align: center;
  margin-bottom: var(--space-32);
}

.slide-title {
  font-size: var(--responsive-text-4xl);
  font-weight: var(--font-weight-bold);
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  line-height: var(--line-height-tight);
}

.slide-subtitle {
  font-size: var(--responsive-text-xl);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-24);
}

@media (max-width: 480px) {
  .slide-title {
    font-size: clamp(1.5rem, 6vw, 2rem);
  }

  .slide-subtitle {
    font-size: clamp(1rem, 3vw, 1.25rem);
  }
}

.stats-box {
  background: var(--color-bg-1);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
  margin-top: var(--space-32);
}

.stats-box ul {
  list-style: none;
  font-size: var(--font-size-lg);
  line-height: 1.8;
}

.stats-box li::before {
  content: "•";
  color: var(--pres-secondary);
  font-weight: bold;
  margin-right: var(--space-8);
}

.grid-2 {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-24);
}

.grid-3 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-20);
}

.grid-4 {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--space-16);
}

@media (max-width: 640px) {
  .grid-2, .grid-3, .grid-4 {
    grid-template-columns: 1fr;
    gap: var(--responsive-gap-md);
  }
}

@media (min-width: 641px) and (max-width: 1024px) {
  .grid-3, .grid-4 {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--responsive-gap-lg);
  }
}

.card {
  position: relative;
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: transform 0.35s var(--ease-standard), box-shadow 0.35s var(--ease-standard), border-color 0.35s var(--ease-standard);
  overflow: hidden;
}

.card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(var(--color-teal-500-rgb), 0.08), rgba(var(--color-brown-600-rgb), 0.08));
  opacity: 0;
  transition: opacity 0.35s var(--ease-standard);
  pointer-events: none;
}

.card:hover {
  transform: translateY(-8px);
  box-shadow: 0 24px 40px rgba(var(--color-slate-900-rgb), 0.12);
  border-color: rgba(var(--color-teal-500-rgb), 0.35);
}

.card:hover::after {
  opacity: 1;
}

.card h3 {
  font-size: var(--font-size-xl);
  margin-bottom: var(--space-12);
  color: var(--pres-primary);
}

.card p {
  font-size: var(--font-size-base);
  line-height: 1.6;
  color: var(--color-text-secondary);
}

.card .icon {
  width: 48px;
  height: 48px;
  margin: 0 auto var(--space-16);
  color: var(--color-teal-500);
  display: flex;
  align-items: center;
  justify-content: center;
}

.card .icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

@media (max-width: 640px) {
  .card {
    padding: var(--responsive-padding);
  }

  .card h3 {
    font-size: var(--responsive-text-lg);
    margin-bottom: var(--space-8);
  }

  .card p {
    font-size: var(--responsive-text-sm);
  }

  .card .icon {
    width: 64px;
    height: 64px;
  }
}

@media (hover: none) and (pointer: coarse) {
  .card:hover {
    transform: none;
  }

  .card:active {
    transform: scale(0.98);
  }
}

/* ========== СТИЛИ ДЛЯ СЛАЙДА 2 - КЛАССИФИКАЦИЯ ========== */
/* Горизонтальная компоновка карточек: иконка слева, текст справа */
.classification-card {
  display: flex;
  align-items: flex-start;
  gap: var(--space-24);
  padding: var(--space-24);
}

.classification-card-icon {
  flex-shrink: 0;
  width: clamp(48px, 8vw, 64px);
  height: clamp(48px, 8vw, 64px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.15);
  color: var(--pres-primary);
  transition: all 0.35s var(--ease-standard);
}

.classification-card-icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.classification-card-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

.classification-card-content .type-badge {
  margin-bottom: var(--space-8);
}

.classification-card-content h3 {
  font-size: clamp(1.125rem, 2.5vw, 1.5rem);
  margin-bottom: var(--space-8);
  color: var(--pres-primary);
  line-height: 1.3;
}

.classification-card-content p {
  font-size: clamp(0.875rem, 2vw, 1rem);
  line-height: 1.6;
  color: var(--color-text-secondary);
  margin: 0;
}

.classification-models-list {
  list-style: none;
  padding: 0;
  margin: var(--space-12) 0 0 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.classification-models-list li {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  font-size: clamp(0.875rem, 2vw, 1rem);
  color: var(--color-text-secondary);
  line-height: 1.5;
}

.classification-models-list li::before {
  content: "";
  width: 6px;
  height: 6px;
  border-radius: 50%;
  background: var(--color-primary);
  flex-shrink: 0;
  transition: transform 0.3s var(--ease-standard);
}

.classification-card:hover .classification-card-icon {
  transform: scale(1.1);
  background: rgba(var(--color-teal-500-rgb), 0.12);
  border-color: var(--color-teal-300);
  box-shadow: 0 8px 20px rgba(var(--color-teal-500-rgb), 0.2);
}

.classification-card:hover .classification-models-list li::before {
  transform: scale(1.2);
}

.classification-highlight-box {
  background: linear-gradient(135deg, var(--color-surface) 0%, rgba(var(--color-teal-500-rgb), 0.05) 100%);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--color-primary);
  border-top: 1px solid var(--color-card-border);
  border-right: 1px solid var(--color-card-border);
  border-bottom: 1px solid var(--color-card-border);
  margin-top: var(--space-32);
  box-shadow: var(--shadow-sm);
}

.classification-highlight-box strong {
  font-size: clamp(1rem, 2.5vw, 1.125rem);
  color: var(--color-text);
  line-height: 1.6;
  display: block;
}

/* Адаптивность для слайда 2 */
@media (max-width: 767px) {
  .classification-card {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--space-16);
    padding: var(--space-20);
  }
  
  .classification-card-icon {
    width: 56px;
    height: 56px;
  }
  
  .classification-card-content {
    align-items: center;
    text-align: center;
    width: 100%;
  }
  
  .classification-models-list {
    align-items: center;
    width: 100%;
  }
  
  .classification-models-list li {
    justify-content: center;
  }
  
  .classification-highlight-box {
    margin-top: var(--space-24);
    padding: var(--space-20);
    text-align: center;
  }
}

@media (min-width: 768px) and (max-width: 1023px) {
  .classification-card {
    gap: var(--space-20);
    padding: var(--space-20);
  }
  
  .classification-card-icon {
    width: 56px;
    height: 56px;
  }
}

@media (hover: none) and (pointer: coarse) {
  .classification-card:hover {
    transform: none;
  }
  
  .classification-card:active {
    transform: scale(0.98);
  }
  
  .classification-card:hover .classification-card-icon {
    transform: none;
  }
  
  .classification-card:active .classification-card-icon {
    transform: scale(0.95);
  }
}

@media (prefers-reduced-motion: reduce) {
  .classification-card,
  .classification-card-icon,
  .classification-models-list li::before {
    transition-duration: 0.01ms !important;
  }
}
/* ========== КОНЕЦ СТИЛЕЙ ДЛЯ СЛАЙДА 2 ========== */

/* ========== СТИЛИ ДЛЯ СЛАЙДА 6 - 7 СТОЛПОВ ========== */
/* Горизонтальная компоновка карточек: иконка слева, текст справа */
.pillars-grid {
  max-width: 1200px;
  margin: 0 auto;
}

.pillar-card {
  display: flex;
  align-items: flex-start;
  gap: var(--space-20);
  padding: var(--space-24);
}

.pillar-icon {
  flex-shrink: 0;
  width: clamp(48px, 8vw, 64px);
  height: clamp(48px, 8vw, 64px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.15);
  color: var(--pres-primary);
  transition: all 0.35s var(--ease-standard);
}

.pillar-icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.pillar-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.pillar-content h3 {
  font-size: clamp(1.125rem, 2.5vw, 1.5rem);
  margin-bottom: var(--space-8);
  color: var(--pres-primary);
  line-height: 1.3;
  font-weight: var(--font-weight-semibold);
}

.pillar-content p {
  font-size: clamp(0.875rem, 2vw, 1rem);
  line-height: 1.6;
  color: var(--color-text-secondary);
  margin: 0;
}

.pillar-card:hover .pillar-icon {
  transform: scale(1.1);
  background: rgba(var(--color-teal-500-rgb), 0.12);
  border-color: var(--color-teal-300);
  box-shadow: 0 8px 20px rgba(var(--color-teal-500-rgb), 0.2);
}

/* Адаптивность для слайда 6 */
@media (min-width: 768px) and (max-width: 1023px) {
  .pillar-card {
    gap: var(--space-16);
    padding: var(--space-20);
  }
  
  .pillar-icon {
    width: 56px;
    height: 56px;
  }
}

@media (max-width: 767px) {
  .pillar-card {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--space-16);
    padding: var(--space-20);
  }
  
  .pillar-icon {
    width: 56px;
    height: 56px;
  }
  
  .pillar-content {
    align-items: center;
    text-align: center;
    width: 100%;
  }
}

@media (hover: none) and (pointer: coarse) {
  .pillar-card:hover {
    transform: none;
  }
  
  .pillar-card:active {
    transform: scale(0.98);
  }
  
  .pillar-card:hover .pillar-icon {
    transform: none;
  }
  
  .pillar-card:active .pillar-icon {
    transform: scale(0.95);
  }
}

@media (prefers-reduced-motion: reduce) {
  .pillar-card,
  .pillar-icon {
    transition-duration: 0.01ms !important;
  }
}
/* ========== КОНЕЦ СТИЛЕЙ ДЛЯ СЛАЙДА 6 ========== */

/* ========== СТИЛИ ДЛЯ СЛАЙДА 5 - ТРЕНДЫ УПРАВЛЕНИЯ ИЗМЕНЕНИЯМИ ========== */
/* Горизонтальная компоновка карточек: иконка слева, текст справа */
.trends-grid {
  max-width: 1200px;
  margin: 0 auto;
}

.trend-card {
  display: flex;
  align-items: flex-start;
  gap: var(--space-20);
  padding: var(--space-24);
}

.trend-icon {
  flex-shrink: 0;
  width: clamp(48px, 8vw, 64px);
  height: clamp(48px, 8vw, 64px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.15);
  color: var(--pres-primary);
  transition: all 0.35s var(--ease-standard);
}

.trend-icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.trend-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.trend-content h3 {
  font-size: clamp(1.125rem, 2.5vw, 1.5rem);
  margin-bottom: var(--space-8);
  color: var(--pres-primary);
  line-height: 1.3;
  font-weight: var(--font-weight-semibold);
}

.trend-content p {
  font-size: clamp(0.875rem, 2vw, 1rem);
  line-height: 1.6;
  color: var(--color-text-secondary);
  margin: 0;
}

.trend-card:hover .trend-icon {
  transform: scale(1.1);
  background: rgba(var(--color-teal-500-rgb), 0.12);
  border-color: var(--color-teal-300);
  box-shadow: 0 8px 20px rgba(var(--color-teal-500-rgb), 0.2);
}

/* Адаптивность для слайда 5 */
@media (min-width: 768px) and (max-width: 1023px) {
  .trend-card {
    gap: var(--space-16);
    padding: var(--space-20);
  }
  
  .trend-icon {
    width: 56px;
    height: 56px;
  }
}

@media (max-width: 767px) {
  .trend-card {
    flex-direction: column;
    align-items: center;
    text-align: center;
    gap: var(--space-16);
    padding: var(--space-20);
  }
  
  .trend-icon {
    width: 56px;
    height: 56px;
  }
  
  .trend-content {
    align-items: center;
    text-align: center;
    width: 100%;
  }
}

@media (hover: none) and (pointer: coarse) {
  .trend-card:hover {
    transform: none;
  }
  
  .trend-card:active {
    transform: scale(0.98);
  }
  
  .trend-card:hover .trend-icon {
    transform: none;
  }
  
  .trend-card:active .trend-icon {
    transform: scale(0.95);
  }
}

@media (prefers-reduced-motion: reduce) {
  .trend-card,
  .trend-icon {
    transition-duration: 0.01ms !important;
  }
}
/* ========== КОНЕЦ СТИЛЕЙ ДЛЯ СЛАЙДА 5 ========== */

/* Уважение настроек пользователя */
@media (prefers-reduced-motion: reduce) {
  *, *::before, *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/* Упрощенные анимации на мобильных */
@media (max-width: 640px) {
  .slide.active {
    animation-duration: 0.3s;
  }

  .card,
  .toolbar-btn,
  .filter-btn {
    transition-duration: 0.15s;
  }
}

.type-badge {
  display: inline-flex;
  align-items: center;
  gap: var(--space-6);
  padding: var(--space-4) var(--space-12);
  border-radius: var(--radius-full);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  margin-bottom: var(--space-12);
  color: #ffffff !important;
  transition: transform 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
}

.type-badge:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 20px rgba(0, 0, 0, 0.12);
}

.type-contextual {
  background: linear-gradient(135deg, #60a5fa, #2563eb) !important;
  color: #ffffff !important;
}

.type-highlevel {
  background: linear-gradient(135deg, #34d399, #059669) !important;
  color: #ffffff !important;
}

.type-actionable {
  background: linear-gradient(135deg, #f472b6, #ec4899) !important;
  color: #ffffff !important;
}

.type-supporting {
  background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
  color: #ffffff !important;
}

/* Русские названия типов моделей */
.type-контекстная {
  background: linear-gradient(135deg, #60a5fa, #2563eb) !important;
  color: #ffffff !important;
}

.type-высокоуровневая {
  background: linear-gradient(135deg, #34d399, #059669) !important;
  color: #ffffff !important;
}

.type-действенная {
  background: linear-gradient(135deg, #f472b6, #ec4899) !important;
  color: #ffffff !important;
}

.type-вспомогательная {
  background: linear-gradient(135deg, #fbbf24, #f59e0b) !important;
  color: #ffffff !important;
}

.timeline {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.timeline-item {
  display: flex;
  gap: var(--space-16);
  padding: var(--space-16);
  background: var(--color-surface);
  border-left: 4px solid var(--pres-secondary);
  border-radius: var(--radius-base);
}

.timeline-year {
  font-weight: var(--font-weight-bold);
  color: var(--pres-primary);
  min-width: 120px;
  font-size: var(--font-size-lg);
}

.timeline-content {
  flex: 1;
  font-size: var(--font-size-base);
  line-height: 1.6;
}

.interactive-timeline {
  display: grid;
  grid-template-columns: minmax(0, 1fr) minmax(0, 1.1fr);
  gap: var(--space-32);
  align-items: flex-start;
}

.timeline-track {
  position: relative;
  padding-left: var(--space-32);
  border-left: 2px dashed rgba(var(--color-teal-500-rgb), 0.35);
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.timeline-node {
  position: relative;
  padding: var(--space-16);
  border-radius: var(--radius-base);
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border: 1px solid transparent;
  text-align: left;
  cursor: pointer;
  transition: transform 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard), border-color 0.3s var(--ease-standard);
}

.timeline-node::before {
  content: "";
  position: absolute;
  left: -36px;
  top: 22px;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: var(--color-primary);
  box-shadow: 0 0 0 6px rgba(var(--color-teal-500-rgb), 0.2);
  transition: transform 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard);
}

.timeline-node:hover {
  transform: translateX(4px);
  box-shadow: 0 16px 28px rgba(var(--color-slate-900-rgb), 0.18);
  border-color: rgba(var(--color-teal-500-rgb), 0.4);
}

.timeline-node.active {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: rgba(var(--color-teal-500-rgb), 0.7);
  box-shadow: 0 20px 36px rgba(var(--color-teal-500-rgb), 0.28);
}

.timeline-node.active::before {
  transform: scale(1.15);
  box-shadow: 0 0 0 8px rgba(var(--color-teal-500-rgb), 0.3);
}

.timeline-period {
  display: block;
  font-weight: var(--font-weight-semibold);
  margin-bottom: var(--space-8);
  color: inherit;
}

.timeline-headline {
  font-size: var(--font-size-base);
  color: inherit;
}

.timeline-details-card {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  box-shadow: var(--shadow-md);
}

.timeline-details-card ul {
  margin-top: var(--space-16);
  padding-left: var(--space-16);
  color: var(--color-text-secondary);
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.timeline-details-card li {
  line-height: 1.6;
}

.model-slide {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-32);
}

.model-info h4 {
  font-size: var(--font-size-lg);
  color: var(--pres-primary);
  margin-bottom: var(--space-8);
  margin-top: var(--space-16);
}

.model-info ul {
  list-style: none;
  margin-left: var(--space-16);
}

.model-info li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
}

.model-info li::before {
  content: "→";
  color: var(--pres-secondary);
  margin-right: var(--space-8);
}

.best-for {
  background: var(--color-bg-3);
  padding: var(--space-16);
  border-radius: var(--radius-base);
  margin-top: var(--space-24);
  border: 1px solid var(--color-border);
}

.navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 16px;
  background: var(--color-surface);
  border-top: 1px solid var(--color-border);
  animation: fadeInUp 0.6s var(--ease-standard);
  animation-delay: 0.15s;
  animation-fill-mode: both;
  gap: var(--space-8);
  flex-wrap: wrap;
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  z-index: 100;
  box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
  height: auto;
  max-height: 60px;
  transition: transform 0.3s ease, opacity 0.3s ease;
  transform: translateY(0);
  opacity: 1;
}

/* Автоскрытие нижнего тулбара при прокрутке вниз */
.navigation.toolbar-hidden {
  transform: translateY(100%);
  opacity: 0;
  pointer-events: none;
}

/* Safe area для iPhone (notch) */
@supports (padding: max(0px)) {
  .navigation {
    padding-bottom: max(8px, env(safe-area-inset-bottom));
  }
}

.nav-buttons {
  display: flex;
  gap: var(--space-12);
}

.btn {
  padding: 6px 12px;
  border: none;
  border-radius: var(--radius-base);
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  transition: all var(--duration-fast) var(--ease-standard);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.15);
  min-height: 32px;
  min-width: 44px;
  transform: translateY(0);
}

.btn:hover {
  background: var(--color-primary-hover);
  transform: translateY(-2px);
  box-shadow: 0 12px 24px rgba(var(--color-teal-500-rgb), 0.25);
}

.btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.btn-secondary {
  background: var(--color-secondary);
  color: var(--color-text);
  box-shadow: 0 6px 16px rgba(var(--color-brown-600-rgb), 0.15);
}

.btn-secondary:hover {
  background: var(--color-secondary-hover);
  box-shadow: 0 12px 20px rgba(var(--color-brown-600-rgb), 0.12);
}

.slide-counter {
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  color: var(--color-text-secondary);
}

.model-selector {
  padding: 4px 8px;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background: var(--color-surface);
  color: var(--color-text);
  font-size: 11px;
  cursor: pointer;
  min-height: 28px;
}

.path-selector {
  padding: 4px 8px;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background: var(--color-surface);
  color: var(--color-text);
  font-size: 10px;
  cursor: pointer;
  transition: border-color var(--duration-fast) var(--ease-standard), box-shadow var(--duration-fast) var(--ease-standard);
  min-height: 28px;
}

.path-selector:focus {
  outline: none;
  border-color: rgba(var(--color-teal-500-rgb), 0.6);
  box-shadow: 0 0 0 3px rgba(var(--color-teal-500-rgb), 0.2);
}

.path-meta {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.icon {
  width: 52px;
  height: 52px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: linear-gradient(135deg, rgba(var(--color-teal-500-rgb), 0.18), rgba(var(--color-brown-600-rgb), 0.12));
  border-radius: var(--radius-lg);
  color: var(--color-primary);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
  margin-bottom: var(--space-12);
  transition: transform 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard);
}

.icon svg {
  width: 26px;
  height: 26px;
  fill: none;
}

.icon svg path,
.icon svg circle,
.icon svg line,
.icon svg polyline,
.icon svg rect {
  stroke: currentColor;
  stroke-width: 1.6;
  stroke-linecap: round;
  stroke-linejoin: round;
}

.card:hover .icon {
  transform: scale(1.05);
  box-shadow: 0 12px 20px rgba(var(--color-teal-500-rgb), 0.2);
}

/* Унифицированные стили для иконок (для карточек, которые не имеют специальных стилей) */
.card .icon,
.overview-card .icon,
.hero-value .value-card .icon {
  background: none;
  border: none;
  width: 48px;
  height: 48px;
  color: var(--color-teal-500);
  margin-bottom: var(--space-16);
}

.card .icon svg,
.overview-card .icon svg,
.hero-value .value-card .icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

/* Адаптивность для иконок */
@media (max-width: 640px) {
  .card .icon,
  .overview-card .icon,
  .hero-value .value-card .icon {
    width: 64px;
    height: 64px;
  }
}

.nav-center {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  flex-wrap: wrap;
  justify-content: center;
  flex-shrink: 1;
  min-width: 0;
}

.nav-actions {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  flex-wrap: wrap;
}

.toolbar-btn {
  padding: 4px 8px;
  border-radius: var(--radius-base);
  border: 1px solid transparent;
  background: var(--color-secondary);
  color: var(--color-text);
  font-size: 11px;
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  box-shadow: 0 2px 8px rgba(var(--color-brown-600-rgb), 0.12);
  transition: transform 0.2s var(--ease-standard), box-shadow 0.2s var(--ease-standard), background 0.2s var(--ease-standard), border-color 0.2s var(--ease-standard), color 0.2s var(--ease-standard);
  white-space: nowrap;
  min-height: 28px;
  min-width: 44px;
}

.toolbar-btn:hover {
  transform: translateY(-2px);
  background: rgba(var(--color-brown-600-rgb), 0.22);
  box-shadow: 0 12px 22px rgba(var(--color-brown-600-rgb), 0.2);
}

.toolbar-btn.active {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-color: rgba(var(--color-teal-500-rgb), 0.35);
  box-shadow: 0 16px 28px rgba(var(--color-teal-500-rgb), 0.25);
}

.nav-actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-16);
  align-items: flex-start;
  width: 100%;
}

.nav-actions-group {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-12);
  align-items: center;
  justify-content: flex-end;
  flex: 1 1 auto;
}

.search-container {
  position: relative;
  flex: 1 1 280px;
  min-width: 220px;
}

.search-container input {
  width: 100%;
  padding: var(--space-8) var(--space-12);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  transition: border-color var(--duration-fast) var(--ease-standard), box-shadow var(--duration-fast) var(--ease-standard);
  background: var(--color-surface);
  color: var(--color-text);
}

.search-container input::placeholder {
  color: rgba(var(--color-slate-500-rgb), 0.7);
}

.search-container input:focus {
  outline: none;
  border-color: rgba(var(--color-teal-500-rgb), 0.6);
  box-shadow: 0 0 0 3px rgba(var(--color-teal-500-rgb), 0.2);
}

.search-results {
  position: absolute;
  top: calc(100% + 6px);
  left: 0;
  right: 0;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: 0 24px 40px rgba(var(--color-slate-900-rgb), 0.16);
  list-style: none;
  margin: 0;
  padding: var(--space-8) 0;
  max-height: 280px;
  overflow-y: auto;
  display: none;
  z-index: 1600;
}

.search-results.active {
  display: block;
}

.search-result-item {
  padding: var(--space-8) var(--space-16);
  cursor: pointer;
  display: flex;
  flex-direction: column;
  gap: var(--space-4);
  font-size: var(--font-size-sm);
}

.search-result-item strong {
  color: var(--pres-primary);
  font-weight: var(--font-weight-semibold);
}

.search-result-item span {
  color: var(--color-text-secondary);
}

/* ========== МОБИЛЬНАЯ АДАПТАЦИЯ НАВИГАЦИОННОГО ТУЛБАРА ========== */

/* Медиа-запросы для экранов меньше 480px */
@media (max-width: 480px) {
  .navigation {
    padding: var(--space-12) var(--space-8);
    max-height: none;
    min-height: auto;
    flex-direction: column;
    gap: var(--space-8);
    align-items: stretch;
  }
  
  .nav-buttons {
    width: 100%;
    justify-content: space-between;
    gap: var(--space-8);
    order: 1;
  }
  
  .btn {
    flex: 1;
    min-height: 44px; /* Минимальный размер для касания */
    min-width: 44px;
    font-size: 14px;
    padding: var(--space-12) var(--space-16);
  }
  
  .nav-center {
    width: 100%;
    flex-direction: column;
    gap: var(--space-8);
    order: 2;
    align-items: stretch;
  }
  
  .slide-counter {
    font-size: 11px;
    text-align: center;
    order: 1;
  }
  
  .model-selector,
  .path-selector {
    width: 100%;
    min-height: 44px;
    font-size: 14px; /* Предотвращает зум на iOS */
    padding: var(--space-10) var(--space-12);
    order: 2;
  }
  
  .path-meta {
    font-size: 11px;
    text-align: center;
    order: 3;
  }
  
  .nav-actions {
    width: 100%;
    flex-direction: column;
    gap: var(--space-8);
    order: 3;
  }
  
  .search-container {
    width: 100%;
    min-width: auto;
    order: 1;
  }
  
  .search-container input {
    min-height: 44px;
    font-size: 16px; /* Предотвращает зум на iOS */
  }
  
  .nav-actions-group {
    width: 100%;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: var(--space-8);
    order: 2;
  }
  
  .toolbar-btn {
    flex: 1 1 calc(50% - var(--space-4));
    min-width: calc(50% - var(--space-4));
    min-height: 44px;
    font-size: 12px;
    padding: var(--space-10) var(--space-8);
  }
}

/* Для очень маленьких экранов (меньше 360px) */
@media (max-width: 360px) {
  .toolbar-btn {
    font-size: 11px;
    padding: var(--space-8) var(--space-6);
    flex: 1 1 100%;
    min-width: 100%;
  }
  
  .btn {
    font-size: 13px;
    padding: var(--space-10) var(--space-12);
  }
  
  .navigation {
    padding: var(--space-10) var(--space-6);
  }
}

/* Оптимизация для touch-устройств */
@media (hover: none) and (pointer: coarse) {
  .btn,
  .toolbar-btn,
  button {
    min-height: 44px;
    min-width: 44px;
  }
  
  /* Убираем hover-эффекты на touch-устройствах */
  .btn:hover,
  .toolbar-btn:hover {
    transform: none;
  }
  
  .btn:active,
  .toolbar-btn:active {
    transform: scale(0.95);
    opacity: 0.8;
  }
  
  /* Улучшаем визуальную обратную связь */
  .btn:active,
  .toolbar-btn:active {
    transition: transform 0.1s var(--ease-standard), opacity 0.1s var(--ease-standard);
  }
}

.search-result-item:hover,
.search-result-item.active {
  background: rgba(var(--color-teal-500-rgb), 0.12);
}

.linkedin-link {
  display: inline-flex;
  align-items: center;
  gap: var(--space-4);
  color: var(--color-primary);
  text-decoration: none;
  font-weight: var(--font-weight-medium);
  transition: color 0.2s ease;
}

.linkedin-link:hover {
  color: var(--color-primary-hover);
  text-decoration: underline;
}

.circular-progress {
  position: fixed;
  top: 18px;
  left: 20px;
  width: 72px;
  height: 72px;
  background: var(--color-surface);
  border-radius: 20px;
  box-shadow: 0 20px 40px rgba(var(--color-slate-900-rgb), 0.16);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1002;
  transition: transform 0.3s ease, opacity 0.3s ease;
  transform: translateY(0);
  opacity: 1;
}

/* Автоскрытие верхнего тулбара при прокрутке вниз */
.circular-progress.toolbar-hidden {
  transform: translateY(-100px);
  opacity: 0;
  pointer-events: none;
}

/* Компактный размер на мобильных */
@media (max-width: 768px) {
  .circular-progress {
    top: 12px;
    left: 12px;
    width: 56px;
    height: 56px;
    border-radius: 16px;
    box-shadow: 0 8px 24px rgba(var(--color-slate-900-rgb), 0.12);
  }
  
  .circular-progress svg {
    width: 48px;
    height: 48px;
  }
  
  .progress-count {
    font-size: 10px;
  }
  
  @supports (padding: max(0px)) {
    .circular-progress {
      top: max(12px, calc(12px + env(safe-area-inset-top)));
      left: max(12px, calc(12px + env(safe-area-inset-left)));
    }
  }
}

.circular-progress svg {
  width: 60px;
  height: 60px;
  transform: rotate(-90deg);
}

.progress-track {
  stroke: rgba(var(--color-slate-900-rgb), 0.12);
  stroke-width: 5;
  fill: none;
}

.progress-circle {
  stroke: var(--color-primary);
  stroke-width: 5;
  fill: none;
  stroke-linecap: round;
  stroke-dasharray: 157;
  stroke-dashoffset: 157;
  transition: stroke-dashoffset 0.4s var(--ease-standard);
}

.progress-count {
  position: absolute;
  font-size: 12px;
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.bookmark-panel,
.notes-panel,
.history-panel {
  position: fixed;
  right: 24px;
  width: 320px;
  max-width: calc(100vw - 48px);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: 0 24px 48px rgba(var(--color-slate-900-rgb), 0.18);
  padding: var(--space-24);
  transform: translateY(20px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s var(--ease-standard), transform 0.3s var(--ease-standard);
  z-index: 1500;
}

.bookmark-panel {
  top: 120px;
}

.notes-panel {
  bottom: 120px;
}

.history-panel {
  top: 200px;
}

.bookmark-panel.active,
.notes-panel.active,
.history-panel.active {
  opacity: 1;
  transform: translateY(0);
  pointer-events: auto;
}

.panel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-12);
  margin-bottom: var(--space-16);
}

.panel-header h4 {
  margin: 0;
  font-size: var(--font-size-lg);
  color: var(--pres-primary);
}

.panel-close {
  border: none;
  background: rgba(var(--color-slate-900-rgb), 0.05);
  color: var(--color-text);
  border-radius: var(--radius-full);
  width: 28px;
  height: 28px;
  cursor: pointer;
  font-size: 18px;
  line-height: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s var(--ease-standard), transform 0.2s var(--ease-standard);
}

.panel-close:hover {
  background: rgba(var(--color-slate-900-rgb), 0.12);
  transform: scale(1.05);
}

.panel-button {
  padding: 8px 16px;
  border-radius: var(--radius-base);
  border: none;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: transform 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard), background 0.3s var(--ease-standard);
  box-shadow: 0 12px 24px rgba(var(--color-teal-500-rgb), 0.25);
}

.panel-button:hover {
  transform: translateY(-1px);
  box-shadow: 0 16px 28px rgba(var(--color-teal-500-rgb), 0.3);
  background: var(--color-primary-hover);
}

.panel-button.secondary {
  background: rgba(var(--color-slate-900-rgb), 0.06);
  color: var(--color-text);
  box-shadow: none;
  border: 1px solid var(--color-border);
}

.panel-button.secondary:hover {
  background: rgba(var(--color-slate-900-rgb), 0.12);
  box-shadow: none;
}

.bookmark-empty {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-16);
}

.bookmark-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
  max-height: 260px;
  overflow-y: auto;
}

.bookmark-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-12);
  padding: var(--space-12);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  background: rgba(var(--color-brown-600-rgb), 0.05);
  transition: transform 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard), border-color 0.3s var(--ease-standard);
  cursor: pointer;
}

.bookmark-item:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 22px rgba(var(--color-slate-900-rgb), 0.15);
  border-color: rgba(var(--color-teal-500-rgb), 0.35);
}

.bookmark-item.active {
  border-color: rgba(var(--color-teal-500-rgb), 0.45);
  background: rgba(var(--color-teal-500-rgb), 0.18);
  color: var(--color-btn-primary-text);
  box-shadow: 0 16px 30px rgba(var(--color-teal-500-rgb), 0.25);
}

.search-highlight {
  background: rgba(var(--color-teal-500-rgb), 0.35);
  color: inherit;
  padding: 0 2px;
  border-radius: var(--radius-sm);
}

@media (prefers-color-scheme: dark) {
  body:not(.theme-light) .search-highlight {
    background: rgba(var(--color-teal-300-rgb), 0.4);
  }
}

body.theme-dark .search-highlight {
  background: rgba(var(--color-teal-300-rgb), 0.4);
}

.history-empty {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-bottom: var(--space-16);
}

.history-list {
  list-style: none;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
  max-height: 260px;
  overflow-y: auto;
}

.history-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-12);
  padding: var(--space-12);
  border-radius: var(--radius-base);
  border: 1px solid var(--color-border);
  background: rgba(var(--color-brown-600-rgb), 0.05);
  cursor: pointer;
  transition: transform 0.25s var(--ease-standard), box-shadow 0.25s var(--ease-standard), border-color 0.25s var(--ease-standard);
}

.history-item:hover {
  transform: translateY(-2px);
  border-color: rgba(var(--color-teal-500-rgb), 0.4);
  box-shadow: 0 12px 20px rgba(var(--color-slate-900-rgb), 0.15);
}

.history-item.active {
  border-color: rgba(var(--color-teal-500-rgb), 0.45);
  background: rgba(var(--color-teal-500-rgb), 0.18);
}

.bookmark-item span {
  display: block;
  font-size: 13px;
}

.bookmark-item strong {
  font-size: var(--font-size-sm);
  color: var(--pres-primary);
}

.notes-panel textarea {
  width: 100%;
  min-height: 160px;
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  padding: var(--space-12);
  font-family: var(--font-family-base);
  font-size: var(--font-size-base);
  resize: vertical;
  background: rgba(var(--color-brown-600-rgb), 0.04);
  transition: border-color 0.3s var(--ease-standard), box-shadow 0.3s var(--ease-standard);
}

.notes-panel textarea:focus {
  outline: none;
  border-color: rgba(var(--color-teal-500-rgb), 0.5);
  box-shadow: 0 0 0 3px rgba(var(--color-teal-500-rgb), 0.2);
}

.notes-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: var(--space-12);
}

.notes-status {
  font-size: 12px;
  color: var(--color-text-secondary);
}

.notes-actions {
  display: flex;
  gap: var(--space-8);
}

.achievement-modal {
  position: fixed;
  inset: 0;
  background: rgba(var(--color-slate-900-rgb), 0.55);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: var(--space-24);
  z-index: 2000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s var(--ease-standard);
}

.achievement-modal.active {
  opacity: 1;
  pointer-events: auto;
}

.achievement-content {
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  padding: 36px 42px;
  text-align: center;
  box-shadow: 0 30px 60px rgba(var(--color-slate-900-rgb), 0.25);
  max-width: 420px;
  width: 100%;
  animation: popIn 0.4s var(--ease-standard);
}

.achievement-icon {
  font-size: 52px;
  margin-bottom: var(--space-16);
}

.achievement-content h3 {
  margin-bottom: var(--space-10);
  color: var(--pres-primary);
}

.achievement-content p {
  margin-bottom: var(--space-20);
  color: var(--color-text-secondary);
}

@keyframes popIn {
  0% {
    transform: scale(0.9);
    opacity: 0;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.quiz-container {
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-md);
  padding: var(--space-24);
}

.quiz-header h3 {
  margin-bottom: var(--space-8);
  color: var(--pres-primary);
}

.quiz-header p {
  margin: 0;
  color: var(--color-text-secondary);
  font-size: var(--font-size-base);
}

.quiz-body {
  margin-top: var(--space-20);
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.quiz-step {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
}

.quiz-step-title {
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
}

.quiz-options {
  display: grid;
  gap: var(--space-12);
}

.quiz-option {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-12);
  padding: var(--space-16);
  border-radius: var(--radius-base);
  border: 1px solid var(--color-border);
  background: rgba(var(--color-teal-500-rgb), 0.06);
  cursor: pointer;
  transition: transform 0.25s var(--ease-standard), box-shadow 0.25s var(--ease-standard), border-color 0.25s var(--ease-standard), background 0.25s var(--ease-standard);
}

.quiz-option:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 22px rgba(var(--color-teal-500-rgb), 0.2);
  border-color: rgba(var(--color-teal-500-rgb), 0.45);
}

.quiz-option strong {
  font-size: var(--font-size-base);
  color: var(--pres-primary);
}

.quiz-option span {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.quiz-option.selected {
  background: var(--color-primary);
  border-color: rgba(var(--color-teal-500-rgb), 0.8);
  color: var(--color-btn-primary-text);
  box-shadow: 0 16px 30px rgba(var(--color-teal-500-rgb), 0.35);
}

.quiz-progress {
  margin-top: var(--space-16);
  font-size: 13px;
  color: var(--color-text-secondary);
}

.quiz-result {
  margin-top: var(--space-24);
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
  text-align: left;
}

.quiz-result h4 {
  margin-bottom: var(--space-12);
  color: var(--pres-primary);
}

.quiz-result p {
  margin-bottom: var(--space-16);
  color: var(--color-text-secondary);
}

.quiz-tags {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-8);
}

.quiz-tag {
  padding: 6px 12px;
  border-radius: var(--radius-full);
  background: rgba(var(--color-teal-500-rgb), 0.12);
  color: var(--pres-secondary);
  font-size: 12px;
  font-weight: var(--font-weight-medium);
}

.quiz-actions {
  margin-top: var(--space-20);
  display: flex;
  gap: var(--space-12);
  flex-wrap: wrap;
}

.quiz-actions .panel-button {
  background: var(--pres-primary);
  box-shadow: 0 16px 32px rgba(var(--color-slate-900-rgb), 0.2);
}


.chart-container {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
  margin: var(--space-24) 0;
}

.bubble-chart-wrapper {
  position: relative;
  min-height: 420px;
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
  background: var(--color-surface);
  padding: var(--space-16);
}

.chart-legend {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-16);
  justify-content: center;
  margin-top: var(--space-16);
}

.chart-legend-item {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.chart-legend-swatch {
  width: 14px;
  height: 14px;
  border-radius: var(--radius-full);
  border: 1px solid transparent;
  display: inline-block;
}

.chart-hint {
  margin-top: var(--space-12);
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  text-align: center;
}

.matrix-table {
  width: 100%;
  border-collapse: collapse;
  margin-top: var(--space-16);
}

.matrix-table th,
.matrix-table td {
  padding: var(--space-12);
  text-align: left;
  border-bottom: 1px solid var(--color-border);
}

.matrix-table th {
  background: var(--color-bg-1);
  font-weight: var(--font-weight-semibold);
  color: var(--pres-primary);
}

.highlight-box {
  background: var(--color-bg-2);
  padding: var(--space-20);
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--pres-accent);
  margin: var(--space-24) 0;
}

/* ========== Matrix Comparison Slide Styles ========== */
.matrix-comparison-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: var(--space-32);
}

.matrix-stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--space-24);
  margin-bottom: var(--space-40);
}

.matrix-stat-card {
  text-align: center;
  padding: var(--space-32);
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 180px;
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
  overflow: hidden;
  animation: fadeInUp 0.5s ease forwards;
  opacity: 0;
}

.matrix-stat-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(var(--color-teal-500-rgb), 0.08), rgba(var(--color-brown-600-rgb), 0.08));
  opacity: 0;
  transition: opacity 0.35s var(--ease-standard);
  pointer-events: none;
}

.matrix-stat-card:nth-child(1) {
  background: linear-gradient(135deg, var(--color-bg-1) 0%, rgba(59, 130, 246, 0.1) 100%);
  animation-delay: 0.1s;
}

.matrix-stat-card:nth-child(2) {
  background: linear-gradient(135deg, var(--color-bg-3) 0%, rgba(34, 197, 94, 0.1) 100%);
  animation-delay: 0.2s;
}

.matrix-stat-card:nth-child(3) {
  background: linear-gradient(135deg, var(--color-bg-5) 0%, rgba(147, 51, 234, 0.1) 100%);
  animation-delay: 0.3s;
}

.matrix-stat-card:nth-child(4) {
  background: linear-gradient(135deg, var(--color-bg-2) 0%, rgba(245, 158, 11, 0.1) 100%);
  animation-delay: 0.4s;
}

.matrix-stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.matrix-stat-card:hover::before {
  opacity: 1;
}

.matrix-stat-icon {
  width: 48px;
  height: 48px;
  margin-bottom: var(--space-16);
  color: var(--pres-primary);
  opacity: 0.8;
  flex-shrink: 0;
}

.matrix-stat-number {
  font-size: clamp(2rem, 5vw, 3rem);
  font-weight: var(--font-weight-bold);
  margin-bottom: var(--space-12);
  line-height: 1.2;
  color: var(--pres-primary);
}

.matrix-stat-label {
  font-size: clamp(0.875rem, 2vw, 1rem);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  margin: 0;
  line-height: 1.4;
}

.matrix-insights {
  background: linear-gradient(135deg, var(--color-surface) 0%, rgba(var(--color-teal-500-rgb), 0.05) 100%);
  padding: var(--space-32);
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--color-primary);
  box-shadow: var(--shadow-sm);
  margin-top: var(--space-40);
}

.matrix-insights h3 {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  margin-bottom: var(--space-24);
  color: var(--pres-primary);
  font-size: clamp(1.25rem, 3vw, 1.5rem);
}

.matrix-insights-icon {
  width: 24px;
  height: 24px;
  flex-shrink: 0;
  color: var(--color-primary);
}

.matrix-insights ul {
  list-style: none;
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
  margin: 0;
}

.matrix-insights li {
  display: flex;
  align-items: flex-start;
  gap: var(--space-12);
  line-height: 1.6;
  font-size: clamp(0.875rem, 2vw, 1rem);
}

.matrix-insights-item-icon {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  margin-top: 2px;
  color: var(--color-primary);
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ========== Matrix Comparison Responsive Styles ========== */
@media (min-width: 768px) and (max-width: 1023px) {
  .matrix-stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-20);
  }
  
  .matrix-comparison-container {
    padding: var(--space-24);
  }
}

@media (max-width: 767px) {
  .matrix-comparison-container {
    padding: var(--space-16);
  }
  
  .matrix-stats-grid {
    grid-template-columns: 1fr;
    gap: var(--space-16);
    margin-bottom: var(--space-32);
  }
  
  .matrix-stat-card {
    min-height: 140px;
    padding: var(--space-24);
  }
  
  .matrix-stat-icon {
    width: 40px;
    height: 40px;
    margin-bottom: var(--space-12);
  }
  
  .matrix-insights {
    padding: var(--space-24);
    margin-top: var(--space-32);
  }
  
  .matrix-insights h3 {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-8);
  }
}

@media (hover: none) and (pointer: coarse) {
  .matrix-stat-card:hover {
    transform: none;
  }
  
  .matrix-stat-card:active {
    transform: scale(0.98);
  }
}

@media (prefers-reduced-motion: reduce) {
  .matrix-stat-card {
    animation: none;
    opacity: 1;
  }
  
  .matrix-stat-card,
  .matrix-stat-card::before {
    transition-duration: 0.01ms !important;
  }
}

.cta-wrapper {
  display: flex;
  flex-direction: column;
  gap: var(--space-24);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
  padding: var(--space-24);
  box-shadow: var(--shadow-md);
}

.cta-header h3 {
  margin-bottom: var(--space-8);
  color: var(--pres-primary);
}

.cta-header p {
  margin: 0;
  color: var(--color-text-secondary);
}

.cta-metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: var(--space-16);
}

.cta-metric {
  padding: var(--space-16);
  border-radius: var(--radius-base);
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.25);
  text-align: center;
  box-shadow: var(--shadow-sm);
}

.cta-metric-value {
  display: block;
  font-size: 30px;
  font-weight: var(--font-weight-bold);
  color: var(--pres-primary);
}

.cta-metric-label {
  display: block;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  margin-top: var(--space-6);
}

.cta-quiz-status {
  margin: 0;
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
}

.cta-actions {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-12);
}

.cta-actions .panel-button,
.cta-actions .panel-button.secondary {
  flex: 1;
  min-width: 200px;
  text-align: center;
}

.cta-next-steps h4 {
  margin-bottom: var(--space-12);
  color: var(--pres-primary);
}

.cta-next-steps ul {
  margin: 0;
  padding-left: var(--space-16);
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
  color: var(--color-text-secondary);
}

.two-col {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-24);
}

.content-list {
  list-style: none;
}

.content-list li {
  padding: var(--space-12);
  margin-bottom: var(--space-8);
  background: var(--color-surface);
  border-radius: var(--radius-base);
  border: 1px solid var(--color-border);
}

/* Progress Bar */
.progress-bar-container {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: rgba(0, 0, 0, 0.1);
  z-index: 1001;
}

.progress-bar {
  height: 100%;
  background: var(--color-primary);
  transition: width 0.3s ease;
  width: 0%;
}

/* Fullscreen Button */
.fullscreen-btn {
  position: fixed;
  top: 20px;
  right: 20px;
  z-index: 1000;
  background: var(--color-surface);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-base);
  padding: 8px 12px;
  cursor: pointer;
  font-size: 18px;
  transition: transform 0.3s ease, opacity 0.3s ease, all 0.2s;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transform: translateY(0);
  opacity: 1;
}

.fullscreen-btn:hover {
  background: var(--color-secondary);
  transform: scale(1.05);
}

/* Автоскрытие при прокрутке */
.fullscreen-btn.toolbar-hidden {
  transform: translateY(-100px);
  opacity: 0;
  pointer-events: none;
}

/* Export PDF Button */
.export-btn {
  position: fixed;
  top: 20px;
  right: 80px;
  z-index: 1000;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
  border-radius: var(--radius-base);
  padding: 8px 16px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: transform 0.3s ease, opacity 0.3s ease, all 0.2s;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
  transform: translateY(0);
  opacity: 1;
}

.export-btn:hover {
  background: var(--color-primary-hover);
  transform: translateY(-1px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Автоскрытие при прокрутке */
.export-btn.toolbar-hidden {
  transform: translateY(-100px);
  opacity: 0;
  pointer-events: none;
}

/* Компактные размеры на мобильных */
@media (max-width: 768px) {
  .fullscreen-btn {
    top: 12px;
    right: 12px;
    padding: 6px 10px;
    font-size: 16px;
    border-radius: 12px;
  }
  
  .export-btn {
    top: 12px;
    right: 60px;
    padding: 6px 12px;
    font-size: 12px;
    border-radius: 12px;
  }
  
  @supports (padding: max(0px)) {
    .fullscreen-btn {
      top: max(12px, calc(12px + env(safe-area-inset-top)));
      right: max(12px, calc(12px + env(safe-area-inset-right)));
    }
    
    .export-btn {
      top: max(12px, calc(12px + env(safe-area-inset-top)));
      right: max(60px, calc(60px + env(safe-area-inset-right)));
    }
  }
}

/* Мобильный полноэкранный режим */
.mobile-fullscreen {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  overflow: hidden !important;
}

body.mobile-fullscreen,
html.mobile-fullscreen {
  overflow: hidden !important;
  position: fixed !important;
  width: 100% !important;
  height: 100% !important;
  height: -webkit-fill-available !important;
}

.presentation.mobile-fullscreen {
  height: 100vh !important;
  height: -webkit-fill-available !important;
  overflow: hidden !important;
}

/* Подсказка для мобильных устройств */
.mobile-fullscreen-hint {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  animation: fadeIn 0.3s ease;
}

.mobile-fullscreen-hint .hint-content {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  max-width: 90%;
  max-height: 80%;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  text-align: center;
  animation: slideUp 0.3s ease;
}

.mobile-fullscreen-hint .hint-content p {
  margin: var(--space-8) 0;
  font-size: clamp(0.9375rem, 2vw, 1.0625rem);
  color: var(--color-text);
  line-height: 1.5;
}

.mobile-fullscreen-hint .hint-content button {
  margin-top: var(--space-16);
  padding: var(--space-12) var(--space-24);
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
  border-radius: var(--radius-base);
  font-size: 1rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
}

.mobile-fullscreen-hint .hint-content button:hover {
  background: var(--color-primary-hover);
  transform: translateY(-1px);
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Interactive Matrix */
.matrix-row {
  cursor: pointer;
  transition: all 0.2s;
}

.matrix-row:hover {
  background: var(--color-secondary);
  transform: translateX(4px);
}

.matrix-row td {
  padding: 12px !important;
}

/* Адаптивная версия таблицы - карточки для мобильных */
.matrix-cards-mobile {
  display: none;
  flex-direction: column;
  gap: var(--space-16);
}

.matrix-card-mobile {
  cursor: pointer;
  transition: all 0.2s;
}

.matrix-card-mobile:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}

.matrix-card-mobile h4 {
  margin: 0 0 var(--space-12) 0;
  font-size: 1.125rem;
  color: var(--pres-primary);
}

.matrix-card-mobile p {
  margin: var(--space-8) 0;
  font-size: 0.9375rem;
}

@media (max-width: 640px) {
  .matrix-table {
    display: none;
  }
  
  .matrix-cards-mobile {
    display: flex;
  }
}

@media (min-width: 641px) and (max-width: 1024px) {
  .matrix-table {
    display: table;
    overflow-x: auto;
  }
  
  .matrix-cards-mobile {
    display: none;
  }
}

/* ========== PCT Tool Styles ========== */
.pct-tool {
  padding: var(--space-32);
  max-width: 1200px;
  margin: 0 auto;
}

.pct-intro {
  background: rgba(var(--color-teal-500-rgb), 0.08);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  margin-bottom: var(--space-32);
  line-height: 1.6;
  box-shadow: var(--shadow-sm);
}

.pct-intro p {
  margin: var(--space-8) 0;
}

.pct-progress {
  margin-bottom: var(--space-24);
}

.pct-progress #pctProgressText {
  display: block;
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  margin-bottom: var(--space-8);
}

.pct-progress-bar {
  height: 12px;
  background: var(--color-gray-200);
  border-radius: var(--radius-full);
  overflow: hidden;
  margin-top: var(--space-8);
}

.pct-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--color-teal-500), var(--color-teal-400));
  transition: width 0.3s ease;
  width: 0%;
  border-radius: var(--radius-full);
  box-shadow: 0 2px 8px rgba(var(--color-teal-500-rgb), 0.3);
}

.pct-tabs {
  display: flex;
  gap: var(--space-12);
  margin-bottom: var(--space-32);
  flex-wrap: wrap;
}

.pct-tab {
  position: relative;
  flex: 1;
  min-width: 140px;
  padding: var(--space-16) var(--space-20);
  border: 1px solid var(--color-card-border);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  display: flex;
  align-items: center;
  gap: var(--space-8);
  justify-content: center;
}

.pct-tab svg {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  stroke-width: 2;
}

.pct-tab:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.pct-tab.active {
  background: var(--color-primary);
  color: var(--color-white);
  border-color: var(--color-primary);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.3);
}

.pct-tab.active svg {
  color: var(--color-white);
}

.pct-tab-progress {
  position: absolute;
  top: -8px;
  right: -8px;
  background: var(--color-primary);
  color: white;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 11px;
  font-weight: var(--font-weight-bold);
  box-shadow: 0 2px 8px rgba(var(--color-teal-500-rgb), 0.3);
}

.pct-content {
  margin-bottom: var(--space-32);
}

.pct-category {
  animation: fadeIn 0.3s ease;
}

.pct-category h3 {
  margin-bottom: var(--space-12);
  color: var(--pres-primary);
}

.pct-category-desc {
  color: var(--color-text-muted);
  margin-bottom: var(--space-20);
  font-style: italic;
}

.pct-factors {
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

.pct-factor {
  position: relative;
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  margin-bottom: var(--space-16);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
}

.pct-factor:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.pct-factor.has-selection::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0 40px 40px 0;
  border-color: transparent var(--color-primary) transparent transparent;
  z-index: 1;
}

.pct-factor-text {
  margin-bottom: var(--space-12);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  line-height: 1.5;
}

.pct-rating {
  display: flex;
  gap: var(--space-16);
  flex-wrap: wrap;
  justify-content: flex-start;
}

.pct-rating label {
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: transform 0.2s ease;
  min-width: 100px;
  user-select: none;
}

.pct-rating input[type="radio"] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.pct-rating-option {
  width: 56px;
  height: 56px;
  border: 2px solid var(--color-border);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--font-weight-medium);
  font-size: var(--font-size-lg);
  transition: all 0.2s ease;
  margin-bottom: var(--space-8);
  background: var(--color-surface);
  color: var(--color-text);
}

.pct-rating label:hover .pct-rating-option {
  border-color: var(--color-primary);
  transform: scale(1.05);
}

.pct-rating input:checked + .pct-rating-option {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
  transform: scale(1.1);
}

.pct-rating-label-text {
  font-size: var(--font-size-sm);
  color: var(--color-text-muted);
  text-align: center;
  line-height: 1.3;
}

.pct-rating input:checked ~ .pct-rating-label-text {
  color: var(--color-primary);
  font-weight: var(--font-weight-semibold);
}

.pct-results {
  margin-top: var(--space-32);
  padding: var(--space-32);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
}

.pct-results h3 {
  margin-bottom: var(--space-24);
  color: var(--pres-primary);
  text-align: center;
}

.pct-scores {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: var(--space-24);
  margin-bottom: var(--space-32);
  max-width: 1000px;
  margin-left: auto;
  margin-right: auto;
}

.pct-score-item {
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  text-align: center;
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
}

.pct-score-item.clickable {
  cursor: pointer;
}

.pct-score-item.clickable:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-primary);
}

.pct-score-item.clickable:active {
  transform: translateY(0);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.pct-score-item.excellent {
  background: rgba(45, 182, 125, 0.1);
  border-color: #2DB67D;
}

.pct-score-item.moderate {
  background: rgba(244, 161, 0, 0.1);
  border-color: #F4A100;
}

.pct-score-item.risk {
  background: rgba(224, 30, 90, 0.1);
  border-color: #E01E5A;
}

.pct-score-label {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-8);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  color: var(--color-text-muted);
  margin-bottom: var(--space-12);
}

.pct-score-label svg {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  stroke-width: 2;
}

.pct-score-value {
  display: block;
  font-size: var(--font-size-3xl);
  font-weight: var(--font-weight-bold);
  margin-top: var(--space-8);
  color: var(--color-text);
}

.pct-visualization {
  margin: var(--space-32) 0;
  min-height: 300px;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(var(--color-slate-900-rgb), 0.02);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  padding: var(--space-24);
}

.pct-visualization svg {
  max-width: 100%;
  height: auto;
}

.pct-recommendations {
  margin-top: var(--space-32);
  padding: var(--space-24);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--color-primary);
  box-shadow: var(--shadow-sm);
}

.pct-recommendations h4 {
  margin-bottom: var(--space-12);
  color: var(--pres-primary);
}

.pct-recommendations ul {
  list-style: none;
  padding: 0;
}

.pct-recommendations li {
  padding: var(--space-8) 0;
  padding-left: var(--space-24);
  position: relative;
}

.pct-recommendations li::before {
  content: "→";
  position: absolute;
  left: 0;
  color: var(--color-primary);
  font-weight: bold;
}

.pct-actions {
  display: flex;
  gap: var(--space-16);
  margin-top: var(--space-32);
  justify-content: center;
  flex-wrap: wrap;
}

.pct-actions .panel-button {
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.pct-actions .panel-button svg {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
}

.pct-actions .panel-button.secondary {
  background: var(--color-border);
  color: var(--color-text);
}

.pct-actions .panel-button.secondary:hover {
  background: var(--color-gray-300);
}

/* ========== PCT Tool Responsive Styles ========== */
@media (min-width: 768px) and (max-width: 1023px) {
  .pct-scores {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-20);
  }
}

@media (hover: none) and (pointer: coarse) {
  .pct-tab:hover,
  .pct-factor:hover,
  .pct-rating label:hover {
    transform: none;
  }

  .pct-tab:active,
  .pct-rating label:active {
    transform: scale(0.98);
  }

  .pct-rating-option {
    width: 64px;
    height: 64px;
    font-size: var(--font-size-xl);
  }
}

@media (prefers-reduced-motion: reduce) {
  .pct-tab,
  .pct-factor,
  .pct-rating-option,
  .pct-score-item {
    transition-duration: 0.01ms !important;
  }
}

/* ========== Quiz Tool Styles ========== */
.quiz-tool {
  max-width: 800px;
  margin: 0 auto;
}

.quiz-intro {
  margin-bottom: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: 8px;
  border-left: 4px solid var(--color-primary);
}

.quiz-intro p {
  margin: 0;
  line-height: 1.6;
  color: var(--color-text);
}

.quiz-progress {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: var(--space-24);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: 8px;
  border: 1px solid var(--color-border);
}

.quiz-progress-bar {
  flex: 1;
  height: 8px;
  background: var(--color-gray-200);
  border-radius: 4px;
  margin: 0 var(--space-16);
  overflow: hidden;
}

.quiz-progress-fill {
  height: 100%;
  background: var(--color-primary);
  border-radius: 4px;
  width: 0%;
  transition: width 0.3s ease;
}

.quiz-progress-text {
  font-weight: var(--font-weight-medium);
  color: var(--color-text-secondary);
  min-width: 100px;
  text-align: right;
}

.quiz-question {
  margin-bottom: var(--space-24);
}

.question-content h3 {
  margin-bottom: var(--space-20);
  color: var(--color-text);
  line-height: 1.5;
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
  text-align: left;
  padding-bottom: var(--space-12);
  border-bottom: 2px solid var(--color-primary);
  margin-top: 0;
}

.question-options {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
  margin-bottom: var(--space-24);
}

.option-item {
  display: flex;
  align-items: flex-start;
  gap: var(--space-16);
  padding: var(--space-20);
  border: 2px solid var(--color-border);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s ease;
  background: var(--color-surface);
  margin-bottom: var(--space-8);
  min-height: 60px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.option-item:hover {
  border-color: var(--color-primary);
  background: rgba(var(--color-teal-500-rgb), 0.02);
}

.option-number {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-radius: 50%;
  font-weight: var(--font-weight-bold);
  font-size: 14px;
  margin-right: var(--space-12);
  flex-shrink: 0;
}

.option-item:has(input:checked) .option-number {
  background: var(--color-primary);
  transform: scale(1.1);
  box-shadow: 0 2px 8px rgba(var(--color-teal-500-rgb), 0.3);
}

.option-item input[type="radio"] {
  width: 20px;
  height: 20px;
  margin-top: 3px;
  cursor: pointer;
  accent-color: var(--color-primary);
  flex-shrink: 0;
}

.option-text {
  flex: 1;
  line-height: 1.6;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-normal);
}

.option-item {
  position: relative;
}

.option-item:has(input:checked) {
  border-color: var(--color-primary);
  background: rgba(var(--color-teal-500-rgb), 0.08);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.15);
  transform: translateY(-2px);
}

/* Адаптивность для мобильных устройств */
@media (max-width: 768px) {
  .question-options {
    gap: var(--space-12);
  }

  .option-item {
    padding: var(--space-16);
    min-height: 50px;
    gap: var(--space-12);
    margin-bottom: var(--space-6);
  }

  .option-text {
    font-size: 14px;
    line-height: 1.5;
  }

  .option-item input[type="radio"] {
    width: 18px;
    height: 18px;
    margin-top: 2px;
  }
}

@media (max-width: 640px) {
  .pct-tool, .roi-calculator, .quiz-tool {
    padding: var(--responsive-padding);
  }

  /* PCT вкладки */
  .pct-tool {
    padding: var(--space-16);
  }

  .pct-tabs {
    flex-direction: column;
    gap: var(--space-8);
  }

  .pct-tab {
    width: 100%;
    padding: var(--space-12) var(--space-16);
    font-size: 14px;
    min-height: 44px;
  }

  .pct-tab svg {
    width: 18px;
    height: 18px;
  }

  .pct-factor {
    padding: var(--space-20);
  }

  .pct-rating {
    flex-direction: column;
    gap: var(--space-12);
  }

  .pct-rating label {
    width: 100%;
    min-width: auto;
  }

  .pct-rating-option {
    width: 64px;
    height: 64px;
    font-size: var(--font-size-xl);
  }

  .pct-scores {
    grid-template-columns: 1fr;
    gap: var(--space-16);
  }

  .pct-actions {
    flex-direction: column;
    width: 100%;
  }

  .pct-actions .panel-button {
    width: 100%;
    justify-content: center;
  }

  /* ROI инпуты */
  .roi-input-group input {
    min-height: 44px;
    font-size: 16px; /* Предотвращает зум на iOS */
  }

  /* Quiz опции */
  .option-item {
    padding: var(--space-12);
    min-height: 60px;
    font-size: 14px;
  }

  /* Результаты в виде карточек */
  .pct-results-table,
  .roi-results-table {
    display: none;
  }

  .pct-results-cards,
  .roi-results-cards {
    display: flex;
    flex-direction: column;
    gap: var(--space-12);
  }

  .result-card {
    background: rgba(var(--color-teal-500-rgb), 0.05);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: var(--space-16);
  }

  .result-card-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: var(--space-8);
  }

  .result-card-title {
    font-weight: var(--font-weight-semibold);
    color: var(--color-text);
  }

  .result-card-value {
    font-size: var(--responsive-text-lg);
    color: var(--color-teal-700);
    font-weight: var(--font-weight-bold);
  }
}

/* ========== Readiness Assessment Responsive Styles ========== */
@media (max-width: 1024px) and (min-width: 768px) {
  .readiness-assessment {
    padding: var(--space-24);
  }

  .readiness-radar-container {
    max-width: 500px;
    max-height: 450px;
  }

  .readiness-radar-container canvas {
    max-height: 350px;
  }

  .readiness-categories {
    max-width: 700px;
    gap: var(--space-20);
  }

  .readiness-overall-score {
    font-size: 42px;
  }
}

@media (max-width: 767px) {
  .readiness-assessment {
    padding: var(--space-16);
  }

  .readiness-results {
    padding: 0;
  }

  .readiness-overall {
    padding: var(--space-24);
    margin-bottom: var(--space-32);
  }

  .readiness-overall-score {
    font-size: 36px;
  }

  .readiness-overall-level {
    font-size: 18px;
  }

  .readiness-radar-container {
    max-width: 100%;
    max-height: 300px;
    padding: var(--space-16);
    margin-bottom: var(--space-24);
  }

  .readiness-radar-container canvas {
    max-height: 250px;
  }

  .readiness-categories {
    grid-template-columns: 1fr;
    gap: var(--space-16);
    max-width: 100%;
    margin-bottom: var(--space-24);
  }

  .readiness-category-result {
    padding: var(--space-20);
  }

  .readiness-recommendation {
    padding: var(--space-20);
  }

  .readiness-recommendation-header {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-8);
  }

  .readiness-recommendation-meta {
    width: 100%;
    justify-content: flex-start;
  }

  .readiness-actions {
    flex-direction: column;
    width: 100%;
  }

  .readiness-actions .panel-button {
    width: 100%;
    justify-content: center;
  }
}

/* ========== СТИЛИ ДЛЯ ЭКСПЕРТНОГО СОДЕРЖИМОГО РЕЗУЛЬТАТОВ ========== */

/* Квиз - экспертная интерпретация */
.quiz-expert-insight {
  margin-top: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border-left: 4px solid var(--color-primary);
}

.quiz-expert-insight h5 {
  margin: 0 0 var(--space-16) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.quiz-expert-summary {
  font-size: 16px;
  line-height: 1.6;
  margin-bottom: var(--space-12);
  color: var(--color-text);
}

.quiz-expert-detailed {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: var(--space-16);
  color: var(--color-text-secondary);
}

.quiz-profile-strengths,
.quiz-profile-risks {
  margin-top: var(--space-16);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-md);
}

.quiz-profile-strengths h6,
.quiz-profile-risks h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.quiz-profile-strengths ul,
.quiz-profile-risks ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.quiz-profile-strengths li,
.quiz-profile-risks li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.quiz-model-expert-analysis {
  margin-top: var(--space-16);
  padding: var(--space-16);
  background: rgba(var(--color-teal-500-rgb), 0.03);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.quiz-model-expert-analysis h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--pres-primary);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.quiz-model-reason {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: var(--space-16);
  color: var(--color-text-secondary);
}

.quiz-model-fit-details {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-16);
  margin-top: var(--space-16);
}

.fit-criteria,
.fit-implementation,
.fit-alternatives {
  padding: var(--space-12);
  background: var(--color-surface);
  border-radius: var(--radius-sm);
}

.fit-criteria strong,
.fit-implementation strong,
.fit-alternatives strong {
  display: block;
  margin-bottom: var(--space-8);
  color: var(--color-text);
  font-size: 14px;
}

.fit-criteria ul,
.fit-implementation ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.fit-criteria li,
.fit-implementation li {
  margin-bottom: var(--space-4);
  line-height: 1.5;
  color: var(--color-text-secondary);
  font-size: 13px;
}

.fit-alternatives p {
  margin: 0;
  line-height: 1.5;
  color: var(--color-text-secondary);
  font-size: 13px;
}

.quiz-action-plan {
  margin-top: var(--space-32);
  padding: var(--space-24);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.quiz-action-plan h5 {
  margin: 0 0 var(--space-16) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.quiz-action-plan-intro {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: var(--space-20);
  color: var(--color-text-secondary);
}

.action-plan-phases {
  display: flex;
  flex-direction: column;
  gap: var(--space-20);
}

.action-plan-phase {
  padding: var(--space-20);
  background: var(--color-surface);
  border-radius: var(--radius-md);
  border-left: 4px solid var(--color-primary);
}

.phase-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-16);
  flex-wrap: wrap;
  gap: var(--space-8);
}

.phase-header h6 {
  margin: 0;
  color: var(--color-text);
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
}

.phase-timeframe {
  font-size: 13px;
  color: var(--color-text-muted);
  background: rgba(var(--color-teal-500-rgb), 0.1);
  padding: 4px 12px;
  border-radius: var(--radius-full);
}

.phase-actions {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.phase-actions li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.quiz-action-plan-note {
  margin-top: var(--space-20);
  padding: var(--space-16);
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-sm);
  border-left: 3px solid var(--color-primary);
}

.quiz-action-plan-note p {
  margin: 0;
  font-size: 13px;
  line-height: 1.6;
  color: var(--color-text-secondary);
}

/* ROI - экспертная интерпретация */
.roi-expert-analysis {
  margin-top: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border-left: 4px solid var(--color-primary);
}

.roi-expert-analysis h5 {
  margin: 0 0 var(--space-20) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.expert-metric-analysis {
  display: flex;
  flex-direction: column;
  gap: var(--space-20);
}

.metric-analysis-item {
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-sm);
  border: 1px solid var(--color-border);
}

.metric-analysis-item h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.metric-analysis-item p {
  margin: 0 0 var(--space-8) 0;
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.metric-analysis-item p:last-child {
  margin-bottom: 0;
}

.metric-analysis-item strong {
  color: var(--color-text);
  font-weight: var(--font-weight-semibold);
}

.roi-risk-analysis {
  margin-top: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.roi-risk-analysis h5 {
  margin: 0 0 var(--space-16) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.risk-analysis-intro {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: var(--space-20);
  color: var(--color-text-secondary);
}

.risk-scenarios {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-20);
}

.risk-scenario {
  padding: var(--space-16);
  border-radius: var(--radius-md);
  border-left: 4px solid;
}

.risk-scenario.optimistic {
  background: rgba(45, 182, 125, 0.08);
  border-left-color: #2DB67D;
}

.risk-scenario.realistic {
  background: rgba(59, 130, 246, 0.08);
  border-left-color: #3B82F6;
}

.risk-scenario.pessimistic {
  background: rgba(224, 30, 90, 0.08);
  border-left-color: #E01E5A;
}

.risk-scenario h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.scenario-metrics {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
  margin-bottom: var(--space-12);
}

.scenario-metric {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-8);
  background: var(--color-surface);
  border-radius: var(--radius-sm);
}

.metric-label {
  font-size: 13px;
  color: var(--color-text-muted);
}

.metric-value {
  font-size: 16px;
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

.risk-scenario p {
  margin: 0;
  font-size: 13px;
  line-height: 1.5;
  color: var(--color-text-secondary);
}

.risk-mitigation {
  margin-top: var(--space-20);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-sm);
}

.risk-mitigation h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.risk-mitigation ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.risk-mitigation li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

/* Readiness - экспертная интерпретация */
.readiness-expert-insight {
  margin-top: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border-left: 4px solid var(--color-primary);
}

.readiness-expert-insight h4 {
  margin: 0 0 var(--space-20) 0;
  color: var(--pres-primary);
  font-size: 20px;
  font-weight: var(--font-weight-semibold);
}

.expert-overall-analysis {
  margin-bottom: var(--space-24);
}

.expert-interpretation {
  font-size: 16px;
  line-height: 1.6;
  margin-bottom: var(--space-12);
  color: var(--color-text);
}

.expert-context {
  font-size: 14px;
  line-height: 1.6;
  color: var(--color-text-secondary);
}

.expert-strengths,
.expert-key-insights,
.expert-critical-gaps {
  margin-top: var(--space-20);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-md);
}

.expert-strengths h5,
.expert-key-insights h5,
.expert-critical-gaps h5 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.expert-strengths ul,
.expert-key-insights ul,
.expert-critical-gaps ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.expert-strengths li,
.expert-key-insights li,
.expert-critical-gaps li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.expert-category-analysis {
  margin-top: var(--space-24);
}

.expert-category-analysis h5 {
  margin: 0 0 var(--space-16) 0;
  color: var(--pres-primary);
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
}

.category-expert-analysis {
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-sm);
  margin-bottom: var(--space-12);
  border: 1px solid var(--color-border);
}

.category-expert-analysis h6 {
  margin: 0 0 var(--space-8) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.category-expert-analysis p {
  margin: 0 0 var(--space-8) 0;
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.category-expert-analysis p:last-child {
  margin-bottom: 0;
}

.category-expert-analysis strong {
  color: var(--color-text);
  font-weight: var(--font-weight-semibold);
}

.expert-action-plan {
  margin-top: var(--space-24);
}

.expert-action-plan h5 {
  margin: 0 0 var(--space-20) 0;
  color: var(--pres-primary);
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
}

.action-plan-phase.immediate,
.action-plan-phase.short-term,
.action-plan-phase.medium-term {
  margin-bottom: var(--space-20);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-md);
  border-left: 4px solid;
}

.action-plan-phase.immediate {
  border-left-color: #E01E5A;
  background: rgba(224, 30, 90, 0.05);
}

.action-plan-phase.short-term {
  border-left-color: #F4A100;
  background: rgba(244, 161, 0, 0.05);
}

.action-plan-phase.medium-term {
  border-left-color: #3B82F6;
  background: rgba(59, 130, 246, 0.05);
}

.action-plan-phase h6 {
  margin: 0 0 var(--space-16) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.action-plan-item {
  margin-bottom: var(--space-16);
  padding: var(--space-12);
  background: var(--color-surface);
  border-radius: var(--radius-sm);
}

.action-plan-item:last-child {
  margin-bottom: 0;
}

.action-plan-item strong {
  display: block;
  margin-bottom: var(--space-8);
  color: var(--color-text);
  font-size: 14px;
  font-weight: var(--font-weight-semibold);
}

.action-timeframe {
  display: inline-block;
  margin-left: var(--space-8);
  font-size: 12px;
  color: var(--color-text-muted);
  background: rgba(var(--color-teal-500-rgb), 0.1);
  padding: 2px 8px;
  border-radius: var(--radius-full);
}

.action-plan-item ul {
  margin: var(--space-8) 0 0 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.action-plan-item li {
  margin-bottom: var(--space-4);
  line-height: 1.5;
  color: var(--color-text-secondary);
  font-size: 13px;
}

/* ========== СТИЛИ ДЛЯ ЭКСПЕРТНОГО СОДЕРЖИМОГО ГИБРИДНОЙ МОДЕЛИ ========== */

.hybrid-expert-insight {
  margin-top: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border-left: 4px solid var(--color-primary);
}

.hybrid-expert-insight h5 {
  margin: 0 0 var(--space-20) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.expert-overall-assessment {
  margin-bottom: var(--space-24);
}

.expert-assessment-text {
  font-size: 16px;
  line-height: 1.6;
  margin-bottom: var(--space-12);
  color: var(--color-text);
}

.expert-combination-text,
.expert-base-model-text {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: var(--space-12);
  color: var(--color-text-secondary);
}

.expert-combination-text:last-child,
.expert-base-model-text:last-child {
  margin-bottom: 0;
}

.hybrid-expert-insight .expert-strengths,
.hybrid-expert-insight .expert-risks,
.hybrid-expert-insight .expert-recommendations {
  margin-top: var(--space-20);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-md);
}

.hybrid-expert-insight .expert-strengths h6,
.hybrid-expert-insight .expert-risks h6,
.hybrid-expert-insight .expert-recommendations h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.hybrid-expert-insight .expert-strengths ul,
.hybrid-expert-insight .expert-risks ul,
.hybrid-expert-insight .expert-recommendations ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.hybrid-expert-insight .expert-strengths li,
.hybrid-expert-insight .expert-risks li,
.hybrid-expert-insight .expert-recommendations li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

/* ========== СТИЛИ ДЛЯ ЭКСПЕРТНОГО СОДЕРЖИМОГО PCT ========== */

.pct-expert-insight {
  margin-top: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border-left: 4px solid var(--color-primary);
}

.pct-expert-insight h4 {
  margin: 0 0 var(--space-20) 0;
  color: var(--pres-primary);
  font-size: 20px;
  font-weight: var(--font-weight-semibold);
}

.pct-expert-insight .expert-overall-analysis {
  margin-bottom: var(--space-24);
}

.pct-expert-insight .expert-interpretation {
  font-size: 16px;
  line-height: 1.6;
  margin-bottom: var(--space-12);
  color: var(--color-text);
}

.pct-expert-insight .expert-context,
.pct-expert-insight .expert-balance {
  font-size: 14px;
  line-height: 1.6;
  margin-bottom: var(--space-12);
  color: var(--color-text-secondary);
}

.pct-expert-insight .expert-context:last-child,
.pct-expert-insight .expert-balance:last-child {
  margin-bottom: 0;
}

.pct-expert-insight .expert-strengths,
.pct-expert-insight .expert-critical-gaps {
  margin-top: var(--space-20);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-md);
}

.pct-expert-insight .expert-strengths h5,
.pct-expert-insight .expert-critical-gaps h5 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.pct-expert-insight .expert-strengths ul,
.pct-expert-insight .expert-critical-gaps ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.pct-expert-insight .expert-strengths li,
.pct-expert-insight .expert-critical-gaps li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.pct-expert-insight .expert-category-analysis {
  margin-top: var(--space-24);
}

.pct-expert-insight .expert-category-analysis h5 {
  margin: 0 0 var(--space-16) 0;
  color: var(--pres-primary);
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
}

.pct-expert-insight .category-expert-analysis {
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-sm);
  margin-bottom: var(--space-12);
  border: 1px solid var(--color-border);
}

.pct-expert-insight .category-expert-analysis h6 {
  margin: 0 0 var(--space-8) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.pct-expert-insight .category-expert-analysis p {
  margin: 0 0 var(--space-8) 0;
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.pct-expert-insight .category-expert-analysis p:last-child {
  margin-bottom: 0;
}

.pct-expert-insight .category-recommendations {
  margin-top: var(--space-12);
  padding: var(--space-12);
  background: rgba(var(--color-teal-500-rgb), 0.03);
  border-radius: var(--radius-sm);
}

.pct-expert-insight .category-recommendations strong {
  display: block;
  margin-bottom: var(--space-8);
  color: var(--color-text);
  font-size: 14px;
  font-weight: var(--font-weight-semibold);
}

.pct-expert-insight .category-recommendations ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.pct-expert-insight .category-recommendations li {
  margin-bottom: var(--space-4);
  line-height: 1.5;
  color: var(--color-text-secondary);
  font-size: 13px;
}

.pct-expert-insight .expert-priority-actions {
  margin-top: var(--space-24);
}

.pct-expert-insight .expert-priority-actions h5 {
  margin: 0 0 var(--space-20) 0;
  color: var(--pres-primary);
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
}

.pct-basic-recommendations {
  margin-top: var(--space-24);
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.pct-basic-recommendations h4 {
  margin: 0 0 var(--space-16) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.pct-basic-recommendations ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.pct-basic-recommendations li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

/* ========== ПРАКТИЧЕСКИЕ РЕКОМЕНДАЦИИ PCT ========== */

.pct-critical-actions {
  margin: var(--space-32) 0;
}

.pct-critical-actions h4 {
  margin: 0 0 var(--space-24) 0;
  color: #E01E5A;
  font-size: 20px;
  font-weight: var(--font-weight-bold);
}

.critical-action-card {
  background: rgba(224, 30, 90, 0.1);
  border: 2px solid #E01E5A;
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  margin-bottom: var(--space-24);
  box-shadow: var(--shadow-md);
}

.critical-action-card .action-header {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  margin-bottom: var(--space-16);
  gap: var(--space-16);
}

.critical-action-card .action-header h5 {
  margin: 0;
  color: #E01E5A;
  font-size: 18px;
  font-weight: var(--font-weight-bold);
  flex: 1;
}

.critical-action-card .action-priority {
  background: #E01E5A;
  color: white;
  padding: var(--space-4) var(--space-12);
  border-radius: var(--radius-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-bold);
  white-space: nowrap;
}

.critical-action-card .action-description {
  margin: 0 0 var(--space-16) 0;
  line-height: 1.6;
  color: var(--color-text);
  font-size: 15px;
}

.critical-action-card .action-timeframe {
  margin-bottom: var(--space-16);
  padding: var(--space-12);
  background: rgba(224, 30, 90, 0.1);
  border-radius: var(--radius-sm);
  font-size: 14px;
  color: var(--color-text);
}

.critical-action-card .action-steps {
  margin-top: var(--space-16);
}

.critical-action-card .action-steps h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
}

.critical-action-card .action-steps ol {
  margin: 0;
  padding-left: var(--space-24);
  list-style-type: decimal;
}

.critical-action-card .action-steps li {
  margin-bottom: var(--space-12);
  line-height: 1.7;
  color: var(--color-text);
  font-size: 14px;
}

.pct-practical-recommendations {
  margin: var(--space-32) 0;
}

.pct-practical-recommendations h4 {
  margin: 0 0 var(--space-24) 0;
  color: var(--pres-primary);
  font-size: 20px;
  font-weight: var(--font-weight-semibold);
}

.practical-recommendation-card {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  margin-bottom: var(--space-24);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
}

.practical-recommendation-card:hover {
  box-shadow: var(--shadow-md);
  transform: translateY(-2px);
}

.practical-recommendation-card h5 {
  margin: 0 0 var(--space-12) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.practical-recommendation-card .recommendation-timeframe {
  margin-bottom: var(--space-16);
  padding: var(--space-8) var(--space-12);
  background: rgba(var(--color-teal-500-rgb), 0.1);
  border-radius: var(--radius-sm);
  font-size: 14px;
  color: var(--color-text);
}

.practical-recommendation-card .recommendation-actions {
  margin-top: var(--space-16);
}

.practical-recommendation-card .recommendation-actions h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.practical-recommendation-card .recommendation-actions ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.practical-recommendation-card .recommendation-actions li {
  margin-bottom: var(--space-10);
  line-height: 1.7;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.pct-quick-wins {
  margin: var(--space-32) 0;
  background: rgba(45, 182, 125, 0.05);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  border: 1px solid rgba(45, 182, 125, 0.2);
}

.pct-quick-wins h4 {
  margin: 0 0 var(--space-12) 0;
  color: #2DB67D;
  font-size: 20px;
  font-weight: var(--font-weight-semibold);
}

.pct-quick-wins .quick-wins-intro {
  margin: 0 0 var(--space-20) 0;
  color: var(--color-text-secondary);
  font-size: 14px;
  line-height: 1.6;
}

.quick-win-card {
  background: white;
  border: 1px solid var(--color-primary);
  border-radius: var(--radius-md);
  padding: var(--space-20);
  margin-bottom: var(--space-16);
  box-shadow: var(--shadow-sm);
}

.quick-win-card:last-child {
  margin-bottom: 0;
}

.quick-win-card h5 {
  margin: 0 0 var(--space-12) 0;
  color: var(--pres-primary);
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
}

.quick-win-card p {
  margin: 0 0 var(--space-12) 0;
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.quick-win-card .quick-win-details {
  margin-top: var(--space-12);
  padding-top: var(--space-12);
  border-top: 1px solid var(--color-border);
}

.quick-win-card .quick-win-details > div {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text);
  font-size: 14px;
}

.quick-win-card .quick-win-details > div:last-child {
  margin-bottom: 0;
  font-size: 13px;
  color: var(--color-text-secondary);
}

.pct-interdependencies {
  margin: var(--space-32) 0;
}

.pct-interdependencies h4 {
  margin: 0 0 var(--space-24) 0;
  color: var(--pres-primary);
  font-size: 20px;
  font-weight: var(--font-weight-semibold);
}

.interdependency-card {
  background: rgba(74, 144, 226, 0.1);
  border: 1px solid #4A90E2;
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  margin-bottom: var(--space-24);
  box-shadow: var(--shadow-sm);
}

.interdependency-card:last-child {
  margin-bottom: 0;
}

.interdependency-card h5 {
  margin: 0 0 var(--space-12) 0;
  color: #4A90E2;
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.interdependency-card p {
  margin: 0 0 var(--space-12) 0;
  line-height: 1.6;
  color: var(--color-text);
  font-size: 14px;
}

.interdependency-card .interdependency-recommendation {
  margin: var(--space-16) 0;
  padding: var(--space-12);
  background: rgba(74, 144, 226, 0.1);
  border-radius: var(--radius-sm);
  border-left: 3px solid #4A90E2;
  font-size: 14px;
  line-height: 1.6;
  color: var(--color-text);
}

.interdependency-card .interdependency-actions {
  margin-top: var(--space-16);
}

.interdependency-card .interdependency-actions h6 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 15px;
  font-weight: var(--font-weight-semibold);
}

.interdependency-card .interdependency-actions ul {
  margin: 0;
  padding-left: var(--space-20);
  list-style-type: disc;
}

.interdependency-card .interdependency-actions li {
  margin-bottom: var(--space-8);
  line-height: 1.6;
  color: var(--color-text-secondary);
  font-size: 14px;
}

/* ========== МОБИЛЬНАЯ АДАПТАЦИЯ ПРАКТИЧЕСКИХ РЕКОМЕНДАЦИЙ PCT ========== */
@media (max-width: 480px) {
  .pct-critical-actions h4,
  .pct-practical-recommendations h4,
  .pct-quick-wins h4,
  .pct-interdependencies h4 {
    font-size: 18px;
  }

  .critical-action-card {
    padding: var(--space-16);
  }

  .critical-action-card .action-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .critical-action-card .action-header h5 {
    font-size: 16px;
  }

  .practical-recommendation-card {
    padding: var(--space-16);
  }

  .practical-recommendation-card h5 {
    font-size: 16px;
  }

  .quick-win-card {
    padding: var(--space-16);
  }

  .interdependency-card {
    padding: var(--space-16);
  }
}

/* ========== МОБИЛЬНАЯ АДАПТАЦИЯ РЕЗУЛЬТАТОВ (ЭКРАНЫ < 480px) ========== */
@media (max-width: 480px) {
  /* Квиз результаты */
  .quiz-result {
    padding: var(--space-16);
    margin-top: var(--space-16);
  }

  .quiz-result h4 {
    font-size: 18px;
    margin-bottom: var(--space-16);
  }

  .quiz-profile {
    padding: var(--space-16);
  }

  .quiz-profile-title {
    font-size: 16px;
    margin-bottom: var(--space-12);
  }

  .quiz-profile-description {
    font-size: 14px;
    line-height: 1.6;
  }

  .quiz-expert-insight {
    padding: var(--space-16);
    margin-top: var(--space-16);
  }

  .quiz-expert-insight h5 {
    font-size: 16px;
    margin-bottom: var(--space-12);
  }

  .quiz-expert-summary {
    font-size: 14px;
  }

  .quiz-expert-detailed {
    font-size: 13px;
  }

  .quiz-profile-strengths,
  .quiz-profile-risks {
    padding: var(--space-12);
    margin-top: var(--space-12);
  }

  .quiz-profile-strengths h6,
  .quiz-profile-risks h6 {
    font-size: 14px;
    margin-bottom: var(--space-8);
  }

  .quiz-profile-strengths li,
  .quiz-profile-risks li {
    font-size: 13px;
    margin-bottom: var(--space-6);
  }

  .quiz-model-item {
    padding: var(--space-12);
  }

  .quiz-model-header {
    flex-wrap: wrap;
    gap: var(--space-8);
  }

  .quiz-model-name {
    font-size: 14px;
  }

  .quiz-model-match {
    font-size: 14px;
  }

  .quiz-model-expert-analysis {
    padding: var(--space-12);
    margin-top: var(--space-12);
  }

  .quiz-model-expert-analysis h6 {
    font-size: 14px;
    margin-bottom: var(--space-8);
  }

  .quiz-model-reason {
    font-size: 13px;
  }

  .quiz-model-fit-details {
    grid-template-columns: 1fr;
    gap: var(--space-12);
  }

  .fit-criteria,
  .fit-implementation,
  .fit-alternatives {
    padding: var(--space-10);
  }

  .fit-criteria li,
  .fit-implementation li {
    font-size: 12px;
  }

  .fit-alternatives p {
    font-size: 12px;
  }

  .quiz-action-plan {
    padding: var(--space-16);
    margin-top: var(--space-20);
  }

  .quiz-action-plan h5 {
    font-size: 16px;
    margin-bottom: var(--space-12);
  }

  .quiz-action-plan-intro {
    font-size: 13px;
  }

  .action-plan-phase {
    padding: var(--space-12);
  }

  .phase-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .phase-header h6 {
    font-size: 14px;
  }

  .phase-timeframe {
    font-size: 12px;
  }

  .phase-actions li {
    font-size: 13px;
  }

  .quiz-actions {
    flex-direction: column;
  }

  .quiz-actions .panel-button {
    width: 100%;
    justify-content: center;
  }

  /* ROI результаты */
  .roi-results {
    margin-top: var(--space-20);
    padding-top: var(--space-16);
  }

  .roi-results h3 {
    font-size: 20px;
    margin-bottom: var(--space-16);
  }

  .roi-metrics {
    grid-template-columns: 1fr;
    gap: var(--space-12);
    margin-bottom: var(--space-20);
  }

  .roi-metric {
    padding: var(--space-16);
  }

  .roi-metric-value {
    font-size: 24px;
  }

  .roi-metric-label {
    font-size: 13px;
  }

  .roi-breakdown {
    margin: var(--space-12) 0;
  }

  .roi-breakdown-item {
    padding: var(--space-10) var(--space-12);
    flex-wrap: wrap;
    gap: var(--space-8);
  }

  .roi-breakdown-label {
    font-size: 13px;
  }

  .roi-breakdown-value {
    font-size: 14px;
  }

  .roi-expert-analysis {
    padding: var(--space-16);
    margin-top: var(--space-16);
  }

  .roi-expert-analysis h5 {
    font-size: 16px;
    margin-bottom: var(--space-16);
  }

  .expert-metric-analysis {
    gap: var(--space-16);
  }

  .metric-analysis-item {
    padding: var(--space-12);
  }

  .metric-analysis-item h6 {
    font-size: 14px;
    margin-bottom: var(--space-8);
  }

  .metric-analysis-item p {
    font-size: 13px;
  }

  .roi-risk-analysis {
    padding: var(--space-16);
    margin-top: var(--space-16);
  }

  .roi-risk-analysis h5 {
    font-size: 16px;
    margin-bottom: var(--space-12);
  }

  .risk-analysis-intro {
    font-size: 13px;
  }

  .risk-scenarios {
    grid-template-columns: 1fr;
    gap: var(--space-12);
  }

  .risk-scenario {
    padding: var(--space-12);
  }

  .risk-scenario h6 {
    font-size: 14px;
  }

  .scenario-metric {
    padding: var(--space-6);
  }

  .metric-label {
    font-size: 12px;
  }

  .metric-value {
    font-size: 14px;
  }

  .risk-scenario p {
    font-size: 12px;
  }

  .risk-mitigation {
    padding: var(--space-12);
  }

  .risk-mitigation h6 {
    font-size: 14px;
  }

  .risk-mitigation li {
    font-size: 13px;
  }

  .roi-actions {
    flex-direction: column;
  }

  .roi-actions .panel-button {
    width: 100%;
    justify-content: center;
  }

  /* Readiness результаты */
  .readiness-results {
    padding: 0;
  }

  .readiness-overall {
    padding: var(--space-20);
    margin-bottom: var(--space-24);
  }

  .readiness-overall-score {
    font-size: 32px;
  }

  .readiness-overall-level {
    font-size: 16px;
  }

  .readiness-overall-description {
    font-size: 13px;
  }

  .readiness-radar-container {
    padding: var(--space-12);
    margin-bottom: var(--space-20);
  }

  .readiness-categories {
    grid-template-columns: 1fr;
    gap: var(--space-12);
    margin-bottom: var(--space-20);
  }

  .readiness-category-result {
    padding: var(--space-16);
  }

  .readiness-category-name {
    font-size: 14px;
  }

  .readiness-category-score {
    font-size: 14px;
  }

  .readiness-expert-insight {
    padding: var(--space-16);
    margin-top: var(--space-16);
  }

  .readiness-expert-insight h4 {
    font-size: 18px;
    margin-bottom: var(--space-16);
  }

  .expert-interpretation {
    font-size: 14px;
  }

  .expert-context {
    font-size: 13px;
  }

  .expert-strengths,
  .expert-key-insights,
  .expert-critical-gaps {
    padding: var(--space-12);
    margin-top: var(--space-16);
  }

  .expert-strengths h5,
  .expert-key-insights h5,
  .expert-critical-gaps h5 {
    font-size: 14px;
    margin-bottom: var(--space-8);
  }

  .expert-strengths li,
  .expert-key-insights li,
  .expert-critical-gaps li {
    font-size: 13px;
    margin-bottom: var(--space-6);
  }

  .category-expert-analysis {
    padding: var(--space-12);
    margin-bottom: var(--space-10);
  }

  .category-expert-analysis h6 {
    font-size: 14px;
  }

  .category-expert-analysis p {
    font-size: 13px;
  }

  .action-plan-phase {
    padding: var(--space-12);
    margin-bottom: var(--space-16);
  }

  .action-plan-phase h6 {
    font-size: 14px;
    margin-bottom: var(--space-12);
  }

  .action-plan-item {
    padding: var(--space-10);
    margin-bottom: var(--space-12);
  }

  .action-plan-item strong {
    font-size: 13px;
  }

  .action-timeframe {
    font-size: 11px;
    display: block;
    margin-left: 0;
    margin-top: var(--space-4);
  }

  .action-plan-item li {
    font-size: 12px;
  }

  .readiness-recommendation {
    padding: var(--space-16);
    margin-bottom: var(--space-16);
  }

  .readiness-recommendation h5 {
    font-size: 15px;
    margin-bottom: var(--space-10);
  }

  .readiness-recommendation li {
    font-size: 13px;
  }

  .readiness-actions {
    flex-direction: column;
  }

  .readiness-actions .panel-button {
    width: 100%;
    justify-content: center;
  }
  
  /* Hybrid конструктор результаты */
  .hybrid-preview-header {
    padding: var(--space-16);
  }
  
  .hybrid-model-summary {
    flex-direction: column;
    gap: var(--space-12);
  }
  
  .hybrid-model-visualization {
    margin: var(--space-16) 0;
  }
  
  .hybrid-model-visualization svg {
    max-width: 100%;
    height: auto;
  }
  
  .hybrid-model-composition {
    padding: var(--space-16);
  }
  
  .hybrid-expert-insight {
    padding: var(--space-16);
    margin-top: var(--space-16);
  }
  
  .hybrid-expert-insight h5 {
    font-size: 16px;
    margin-bottom: var(--space-12);
  }
  
  .expert-assessment-text,
  .expert-combination-text,
  .expert-base-model-text {
    font-size: 13px;
    line-height: 1.6;
  }
  
  .expert-strengths,
  .expert-risks,
  .expert-recommendations {
    padding: var(--space-12);
    margin-top: var(--space-12);
  }
  
  .expert-strengths h6,
  .expert-risks h6,
  .expert-recommendations h6 {
    font-size: 14px;
    margin-bottom: var(--space-8);
  }
  
  .expert-strengths li,
  .expert-risks li,
  .expert-recommendations li {
    font-size: 13px;
    margin-bottom: var(--space-6);
  }
  
  .hybrid-plan-phases {
    gap: var(--space-16);
  }
  
  .hybrid-plan-phase {
    padding: var(--space-16);
  }
  
  .hybrid-plan-phase h6 {
    font-size: 14px;
  }
  
  .hybrid-plan-phase li {
    font-size: 13px;
  }
  
  /* PCT результаты */
  .pct-results {
    padding: var(--space-16);
  }
  
  .pct-results h3 {
    font-size: 18px;
    margin-bottom: var(--space-16);
  }
  
  .pct-scores {
    grid-template-columns: 1fr;
    gap: var(--space-12);
    margin-bottom: var(--space-20);
  }
  
  .pct-score-item {
    padding: var(--space-12);
  }
  
  .pct-visualization {
    margin: var(--space-16) 0;
  }
  
  .pct-visualization svg {
    max-width: 100%;
    height: auto;
  }
  
  .pct-expert-insight {
    padding: var(--space-16);
    margin-top: var(--space-16);
  }
  
  .pct-expert-insight h4 {
    font-size: 18px;
    margin-bottom: var(--space-16);
  }
  
  .expert-interpretation {
    font-size: 14px;
  }
  
  .expert-context,
  .expert-balance {
    font-size: 13px;
  }
  
  .expert-strengths,
  .expert-critical-gaps {
    padding: var(--space-12);
    margin-top: var(--space-16);
  }
  
  .expert-strengths h5,
  .expert-critical-gaps h5 {
    font-size: 14px;
    margin-bottom: var(--space-8);
  }
  
  .expert-strengths li,
  .expert-critical-gaps li {
    font-size: 13px;
    margin-bottom: var(--space-6);
  }
  
  .category-expert-analysis {
    padding: var(--space-12);
    margin-bottom: var(--space-10);
  }
  
  .category-expert-analysis h6 {
    font-size: 14px;
  }
  
  .category-expert-analysis p {
    font-size: 13px;
  }
  
  .category-recommendations {
    margin-top: var(--space-8);
  }
  
  .category-recommendations ul {
    margin-top: var(--space-8);
  }
  
  .category-recommendations li {
    font-size: 12px;
  }
  
  .expert-priority-actions {
    margin-top: var(--space-20);
  }
  
  .expert-priority-actions h5 {
    font-size: 15px;
    margin-bottom: var(--space-16);
  }
  
  .action-plan-phase {
    padding: var(--space-12);
    margin-bottom: var(--space-16);
  }
  
  .action-plan-phase h6 {
    font-size: 14px;
    margin-bottom: var(--space-12);
  }
  
  .action-plan-item {
    padding: var(--space-10);
    margin-bottom: var(--space-12);
  }
  
  .action-plan-item strong {
    font-size: 13px;
  }
  
  .action-plan-item li {
    font-size: 12px;
  }
  
  .pct-basic-recommendations {
    margin-top: var(--space-20);
    padding: var(--space-16);
    background: rgba(var(--color-teal-500-rgb), 0.05);
    border-radius: var(--radius-md);
  }
  
  .pct-basic-recommendations h4 {
    font-size: 16px;
    margin-bottom: var(--space-12);
  }
  
  .pct-basic-recommendations li {
    font-size: 13px;
    margin-bottom: var(--space-8);
  }
  
  .pct-actions {
    flex-direction: column;
    gap: var(--space-12);
  }
  
  .pct-actions .panel-button {
    width: 100%;
    justify-content: center;
  }
}

/* Анимация появления вариантов */
.question-options {
  animation: fadeInUp 0.6s ease-out;
}

.question-options .option-item {
  animation: slideInRight 0.4s ease-out;
  animation-fill-mode: both;
}

.question-options .option-item:nth-child(1) { animation-delay: 0.1s; }
.question-options .option-item:nth-child(2) { animation-delay: 0.2s; }
.question-options .option-item:nth-child(3) { animation-delay: 0.3s; }
.question-options .option-item:nth-child(4) { animation-delay: 0.4s; }
.question-options .option-item:nth-child(5) { animation-delay: 0.5s; }

@keyframes slideInRight {
  from {
    opacity: 0;
    transform: translateX(30px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.quiz-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: var(--space-16);
}

.quiz-nav-btn {
  padding: 10px 20px;
  border-radius: 6px;
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 120px;
}

.quiz-nav-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.quiz-nav-btn:not(.secondary) {
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border: none;
}

.quiz-nav-btn:not(.secondary):hover:not(:disabled) {
  background: var(--color-primary-hover);
  transform: translateY(-1px);
}

.quiz-nav-btn.secondary {
  background: var(--color-surface);
  color: var(--color-text);
  border: 1px solid var(--color-border);
}

.quiz-nav-btn.secondary:hover {
  background: var(--color-gray-200);
}

.quiz-results {
  margin-top: var(--space-32);
}

.quiz-profile-card {
  background: rgba(var(--color-teal-500-rgb), 0.08);
  padding: var(--space-24);
  border-radius: 8px;
  border-left: 4px solid var(--color-primary);
  margin-bottom: var(--space-24);
}

.quiz-profile-card h4 {
  margin: 0 0 var(--space-8) 0;
  color: var(--color-primary);
  font-size: 18px;
}

.quiz-profile-card p {
  margin: 0;
  line-height: 1.6;
  color: var(--color-text);
}

.recommended-models {
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

.model-recommendation {
  display: flex;
  align-items: flex-start;
  gap: var(--space-16);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: 6px;
  border: 1px solid var(--color-border);
}

.model-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-radius: 50%;
  font-weight: var(--font-weight-bold);
  font-size: 14px;
  flex-shrink: 0;
}

.model-info h5 {
  margin: 0 0 var(--space-4) 0;
  color: var(--color-text);
  font-size: 16px;
}

.model-info p {
  margin: 0;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.quiz-actions {
  display: flex;
  gap: var(--space-12);
  margin-top: var(--space-24);
  flex-wrap: wrap;
}

/* ========== Action Plan Modal Styles ========== */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  padding: 20px;
}

.modal-content {
  background: white;
  border-radius: 12px;
  max-width: 900px;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
}

.action-plan-modal {
  width: 100%;
}

.modal-header {
  padding: 24px 32px;
  border-bottom: 1px solid #e0e0e0;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.modal-header h2 {
  margin: 0;
  color: #2DB67D;
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: #666;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.modal-close:hover {
  color: #333;
}

.modal-body {
  padding: 32px;
  max-height: 70vh;
  overflow-y: auto;
}

.modal-footer {
  padding: 24px 32px;
  border-top: 1px solid #e0e0e0;
  display: flex;
  justify-content: flex-end;
  gap: 16px;
}

.action-plan-section {
  margin-bottom: 32px;
}

.action-plan-section h3 {
  color: #2DB67D;
  margin-bottom: 16px;
  font-size: 18px;
}

.scores-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 16px;
  margin: 20px 0;
}

.score-item {
  padding: 20px;
  border-radius: 8px;
  text-align: center;
  border: 2px solid;
}

.score-item.critical {
  background: rgba(224, 30, 90, 0.1);
  border-color: #E01E5A;
}

.score-item.warning {
  background: rgba(244, 161, 0, 0.1);
  border-color: #F4A100;
}

.score-item.good {
  background: rgba(45, 182, 125, 0.1);
  border-color: #2DB67D;
}

.score-label {
  font-weight: bold;
  margin-bottom: 8px;
  color: #333;
}

.score-value {
  font-size: 24px;
  font-weight: bold;
  color: #2DB67D;
  margin: 8px 0;
}

.score-status {
  font-size: 12px;
  color: #666;
}

.timeline-phase {
  margin: 24px 0;
}

.timeline-phase h4 {
  color: #F4A100;
  margin-bottom: 12px;
}

.phase-actions {
  margin-left: 20px;
}

.action-item {
  background: #f9f9f9;
  padding: 16px;
  margin: 12px 0;
  border-radius: 8px;
  border-left: 4px solid #2DB67D;
}

.action-item h5 {
  margin: 0 0 8px 0;
  color: #333;
}

.action-item p {
  margin: 8px 0;
  color: #666;
  line-height: 1.5;
}

.action-tools {
  font-size: 14px;
  color: #2DB67D;
  font-weight: 500;
}

.model-recommendation {
  background: #f0f8f0;
  padding: 16px;
  margin: 12px 0;
  border-radius: 8px;
  border-left: 4px solid #2DB67D;
}

.model-recommendation.high {
  border-left-color: #E01E5A;
  background: rgba(224, 30, 90, 0.05);
}

.model-name {
  font-weight: bold;
  color: #333;
  margin-bottom: 4px;
}

.model-reason {
  color: #666;
  font-size: 14px;
}

.checklist {
  margin: 20px 0;
}

.checklist-item {
  display: flex;
  align-items: flex-start;
  margin: 12px 0;
  cursor: pointer;
}

.checklist-item input[type="checkbox"] {
  display: none;
}

.checkmark {
  width: 20px;
  height: 20px;
  border: 2px solid #ddd;
  border-radius: 4px;
  margin-right: 12px;
  margin-top: 2px;
  position: relative;
  flex-shrink: 0;
}

.checklist-item input:checked + .checkmark {
  background: #2DB67D;
  border-color: #2DB67D;
}

.checklist-item input:checked + .checkmark::after {
  content: '✓';
  position: absolute;
  top: -2px;
  left: 2px;
  color: white;
  font-size: 14px;
  font-weight: bold;
}

.item-content {
  flex: 1;
}

.item-title {
  font-weight: 500;
  color: #333;
  margin-bottom: 4px;
}

.item-description {
  color: #666;
  font-size: 14px;
  line-height: 1.4;
  margin-bottom: 4px;
}

.item-phase {
  color: #F4A100;
  font-size: 12px;
  font-weight: 500;
}

.reminder {
  background: #fff3cd;
  border: 1px solid #f0c674;
  padding: 20px;
  border-radius: 8px;
  margin: 24px 0;
}

/* ========== FAQ Styles ========== */
.faq-container {
  padding: var(--space-24);
  max-width: 1400px;
  margin: 0 auto;
}

.faq-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-24);
  padding-bottom: var(--space-16);
  border-bottom: 1px solid var(--color-card-border);
  flex-wrap: wrap;
  gap: var(--space-16);
}

.faq-breadcrumb {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  font-size: var(--font-size-sm);
}

.faq-breadcrumb-item {
  color: var(--color-text-secondary);
  cursor: pointer;
  transition: color 0.2s var(--ease-standard);
}

.faq-breadcrumb-item:hover {
  color: var(--color-primary);
}

.faq-breadcrumb-item.active {
  color: var(--color-primary);
  font-weight: 600;
}

.faq-breadcrumb-separator {
  color: var(--color-text-secondary);
  margin: 0 var(--space-4);
}

.faq-header-controls {
  display: flex;
  align-items: center;
  gap: var(--space-16);
}

.faq-search-wrapper {
  position: relative;
  width: 300px;
}

.faq-search-input {
  width: 100%;
  padding: var(--space-12) var(--space-16) var(--space-12) var(--space-40);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  background: var(--color-surface);
  color: var(--color-text);
  transition: border-color 0.2s var(--ease-standard), box-shadow 0.2s var(--ease-standard);
}

.faq-search-input:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(var(--color-teal-500-rgb), 0.1);
}

.faq-search-icon {
  position: absolute;
  left: var(--space-12);
  top: 50%;
  transform: translateY(-50%);
  width: 18px;
  height: 18px;
  color: var(--color-text-secondary);
  pointer-events: none;
}

.faq-collapse-all-btn {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  padding: var(--space-12) var(--space-16);
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-md);
  color: var(--color-text);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s var(--ease-standard);
}

.faq-collapse-all-btn:hover {
  background: var(--color-primary);
  color: var(--color-white);
  border-color: var(--color-primary);
}

.faq-collapse-all-btn svg {
  width: 16px;
  height: 16px;
}

.faq-topics-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-24);
  margin-top: var(--space-24);
  transition: grid-template-columns 0.4s var(--ease-standard);
}

.faq-topics-grid.has-expanded {
  grid-template-columns: 1fr;
}

.faq-topic-card {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  transition: all 0.4s var(--ease-standard);
  overflow: hidden;
  position: relative;
}

.faq-topic-card:hover:not(.expanded) {
  transform: translateY(-4px);
  box-shadow: var(--shadow-md);
  border-color: rgba(var(--color-teal-500-rgb), 0.35);
}

.faq-topic-card.expanded {
  grid-column: 1 / -1;
  border-color: var(--color-primary);
  box-shadow: var(--shadow-lg);
  border-width: 2px;
  margin-bottom: var(--space-32);
  z-index: 10;
}

.faq-topics-grid.has-expanded .faq-topic-card:not(.expanded) {
  opacity: 0.4;
  transform: scale(0.95);
  pointer-events: none;
}

.faq-topic-card.hidden {
  display: none;
}

.faq-topic-header {
  display: flex;
  align-items: flex-start;
  gap: var(--space-16);
  padding: var(--space-24);
  cursor: pointer;
  user-select: none;
  position: relative;
}

.faq-topic-card.expanded .faq-topic-header {
  position: sticky;
  top: 0;
  background: var(--color-surface);
  z-index: 20;
  border-bottom: 1px solid var(--color-card-border);
  margin-bottom: var(--space-24);
  padding-bottom: var(--space-24);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
}

.faq-topic-icon {
  width: 48px;
  height: 48px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--color-primary);
}

.faq-topic-icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.faq-topic-icon span {
  font-size: 32px;
  line-height: 1;
}

.faq-topic-title-wrapper {
  flex: 1;
  min-width: 0;
}

.faq-topic-title {
  font-size: var(--font-size-xl);
  font-weight: 600;
  color: var(--pres-primary);
  margin: 0 0 var(--space-12) 0;
  line-height: 1.3;
}

.faq-topic-summary {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.faq-summary-item {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  line-height: 1.5;
}

.faq-topic-toggle {
  flex-shrink: 0;
  width: 24px;
  height: 24px;
  color: var(--color-text-secondary);
  transition: transform 0.3s var(--ease-standard), color 0.3s var(--ease-standard);
}

.faq-topic-card.expanded .faq-topic-toggle {
  transform: rotate(180deg);
  color: var(--color-primary);
}

.faq-topic-content {
  padding: 0 var(--space-24) var(--space-24) var(--space-24);
  animation: fadeIn 0.4s var(--ease-standard);
}

.faq-topic-nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-16) var(--space-24);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-top: 1px solid var(--color-card-border);
  margin-top: var(--space-24);
  gap: var(--space-16);
  flex-wrap: wrap;
}

.faq-topic-nav-left {
  display: flex;
  align-items: center;
  gap: var(--space-16);
  flex-wrap: wrap;
}

.faq-topic-progress {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: 500;
}

.faq-topic-related-links {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  flex-wrap: wrap;
}

.faq-topic-related-links-label {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  font-weight: 500;
}

.faq-topic-related-link {
  display: inline-flex;
  align-items: center;
  gap: var(--space-4);
  padding: var(--space-6) var(--space-12);
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-md);
  font-size: var(--font-size-xs);
  color: var(--color-text);
  text-decoration: none;
  transition: all 0.2s var(--ease-standard);
}

.faq-topic-related-link:hover {
  background: var(--color-primary);
  color: var(--color-white);
  border-color: var(--color-primary);
  transform: translateY(-2px);
}

.faq-topic-nav-right {
  display: flex;
  gap: var(--space-12);
}

.faq-back-btn,
.faq-close-btn {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  padding: var(--space-10) var(--space-16);
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-md);
  color: var(--color-text);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s var(--ease-standard);
}

.faq-back-btn:hover,
.faq-close-btn:hover {
  background: var(--color-primary);
  color: var(--color-white);
  border-color: var(--color-primary);
}

.faq-back-btn svg,
.faq-close-btn svg {
  width: 16px;
  height: 16px;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.faq-topic-details {
  margin-bottom: var(--space-24);
}

.faq-topic-details h4 {
  color: var(--pres-primary);
  font-size: var(--font-size-lg);
  margin: var(--space-24) 0 var(--space-12) 0;
  font-weight: 600;
}

.faq-topic-details h5 {
  color: var(--color-text);
  font-size: var(--font-size-base);
  margin: var(--space-16) 0 var(--space-8) 0;
  font-weight: 600;
}

.faq-topic-details p,
.faq-topic-details ul,
.faq-topic-details li {
  color: var(--color-text-secondary);
  line-height: 1.6;
  margin-bottom: var(--space-8);
}

.faq-topic-details ul {
  padding-left: var(--space-24);
  margin-bottom: var(--space-16);
}

.faq-role,
.faq-method,
.faq-principle {
  background: rgba(var(--color-teal-500-rgb), 0.05);
  padding: var(--space-16);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-16);
  border-left: 3px solid var(--color-primary);
}

.faq-case-study {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
  margin: var(--space-16) 0;
}

.case-success {
  background: rgba(45, 182, 125, 0.1);
  padding: var(--space-16);
  border-radius: var(--radius-md);
  border-left: 3px solid #2DB67D;
}

.case-failure {
  background: rgba(192, 21, 47, 0.1);
  padding: var(--space-16);
  border-radius: var(--radius-md);
  border-left: 3px solid var(--color-red-500);
}

.faq-related {
  margin-top: var(--space-24);
  padding: var(--space-16);
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-md);
}

.faq-link-btn,
.faq-model-btn {
  display: inline-block;
  margin: var(--space-8) var(--space-8) var(--space-8) 0;
  padding: var(--space-8) var(--space-16);
  background: var(--color-primary);
  color: var(--color-white);
  border: none;
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s var(--ease-standard), transform 0.2s var(--ease-standard);
}

.faq-link-btn:hover,
.faq-model-btn:hover {
  background: var(--color-primary-hover);
  transform: translateY(-2px);
}

.faq-related-models {
  margin-top: var(--space-24);
  padding: var(--space-16);
  background: rgba(var(--color-brown-600-rgb), 0.08);
  border-radius: var(--radius-md);
}

.faq-tools {
  margin-top: var(--space-24);
  padding-top: var(--space-24);
  border-top: 1px solid var(--color-card-border);
}

.faq-tools-section {
  margin-bottom: var(--space-24);
}

.faq-tools-section h4 {
  color: var(--pres-primary);
  font-size: var(--font-size-lg);
  margin-bottom: var(--space-16);
  font-weight: 600;
}

.faq-checklist-wrapper {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-md);
  padding: var(--space-20);
  margin-bottom: var(--space-20);
}

.faq-checklist-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-16);
  flex-wrap: wrap;
  gap: var(--space-12);
}

.faq-checklist-header h5 {
  color: var(--pres-primary);
  font-size: var(--font-size-base);
  font-weight: 600;
  margin: 0;
}

.faq-checklist-progress {
  display: flex;
  align-items: center;
  gap: var(--space-12);
}

.faq-checklist-progress span {
  font-size: var(--font-size-sm);
  font-weight: 600;
  color: var(--color-text-secondary);
  min-width: 50px;
}

.faq-progress-bar {
  width: 100px;
  height: 8px;
  background: rgba(var(--color-slate-500-rgb), 0.2);
  border-radius: var(--radius-full);
  overflow: hidden;
}

.faq-progress-fill {
  height: 100%;
  background: var(--color-primary);
  transition: width 0.3s var(--ease-standard);
  border-radius: var(--radius-full);
}

.faq-checklist {
  margin: var(--space-16) 0;
}

.faq-checklist-item {
  display: flex;
  align-items: flex-start;
  margin: var(--space-12) 0;
  cursor: pointer;
  padding: var(--space-12);
  border-radius: var(--radius-md);
  transition: background 0.2s var(--ease-standard);
}

.faq-checklist-item:hover {
  background: rgba(var(--color-teal-500-rgb), 0.05);
}

.faq-checklist-item input[type="checkbox"] {
  display: none;
}

.faq-checkmark {
  width: 20px;
  height: 20px;
  border: 2px solid var(--color-gray-400);
  border-radius: var(--radius-sm);
  margin-right: var(--space-12);
  margin-top: 2px;
  position: relative;
  flex-shrink: 0;
  transition: all 0.2s var(--ease-standard);
}

.faq-checklist-item input:checked + .faq-checkmark {
  background: var(--color-primary);
  border-color: var(--color-primary);
}

.faq-checklist-item input:checked + .faq-checkmark::after {
  content: '✓';
  position: absolute;
  top: -2px;
  left: 2px;
  color: var(--color-white);
  font-size: 14px;
  font-weight: bold;
}

.faq-item-content {
  flex: 1;
}

.faq-item-text {
  font-size: var(--font-size-base);
  color: var(--color-text);
  line-height: 1.5;
  margin-bottom: var(--space-4);
}

.faq-item-category {
  font-size: var(--font-size-xs);
  color: var(--color-text-secondary);
  font-weight: 500;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.faq-export-btn {
  width: 100%;
  padding: var(--space-12) var(--space-16);
  background: var(--color-primary);
  color: var(--color-white);
  border: none;
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  transition: background 0.2s var(--ease-standard);
  margin-top: var(--space-16);
}

.faq-export-btn:hover {
  background: var(--color-primary-hover);
}

.faq-template-card {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-md);
  padding: var(--space-20);
  margin-bottom: var(--space-20);
}

.faq-template-card h5 {
  color: var(--pres-primary);
  font-size: var(--font-size-base);
  font-weight: 600;
  margin: 0 0 var(--space-12) 0;
}

.faq-template-description {
  font-size: var(--font-size-sm);
  color: var(--color-text-secondary);
  line-height: 1.5;
  margin-bottom: var(--space-8);
}

.faq-template-structure {
  font-size: var(--font-size-sm);
  color: var(--color-text);
  margin-bottom: var(--space-16);
}

.faq-template-btn {
  width: 100%;
  padding: var(--space-12) var(--space-16);
  background: rgba(var(--color-teal-500-rgb), 0.1);
  color: var(--color-primary);
  border: 1px solid var(--color-primary);
  border-radius: var(--radius-md);
  font-size: var(--font-size-sm);
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s var(--ease-standard);
}

.faq-template-btn:hover {
  background: var(--color-primary);
  color: var(--color-white);
}

@media (max-width: 1024px) {
  .faq-topics-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .faq-topics-grid.has-expanded {
    grid-template-columns: 1fr;
  }

  .faq-search-wrapper {
    width: 250px;
  }
}

@media (max-width: 640px) {
  .faq-container {
    padding: var(--space-16);
  }

  .faq-header {
    flex-direction: column;
    align-items: stretch;
  }

  .faq-header-controls {
    flex-direction: column;
    width: 100%;
  }

  .faq-search-wrapper {
    width: 100%;
  }

  .faq-collapse-all-btn {
    width: 100%;
    justify-content: center;
  }

  .faq-topics-grid {
    grid-template-columns: 1fr;
    gap: var(--space-16);
  }

  .faq-topics-grid.has-expanded {
    grid-template-columns: 1fr;
  }

  .faq-topic-header {
    padding: var(--space-16);
    gap: var(--space-12);
  }

  .faq-topic-nav {
    flex-direction: column;
    align-items: stretch;
  }

  .faq-topic-nav-left,
  .faq-topic-nav-right {
    width: 100%;
    justify-content: center;
  }

  .faq-back-btn,
  .faq-close-btn {
    width: 100%;
    justify-content: center;
  }

  .faq-topic-icon {
    width: 40px;
    height: 40px;
  }

  .faq-topic-icon span {
    font-size: 24px;
  }

  .faq-topic-title {
    font-size: var(--font-size-lg);
  }

  .faq-topic-content {
    padding: 0 var(--space-16) var(--space-16) var(--space-16);
  }

  .faq-checklist-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .faq-checklist-progress {
    width: 100%;
  }

  .faq-progress-bar {
    flex: 1;
    max-width: 200px;
  }
}

/* ========== ROI Calculator Styles ========== */
.roi-calculator {
  padding: var(--space-16);
  max-width: 100%;
}

.roi-intro {
  background: rgba(var(--color-teal-500-rgb), 0.08);
  padding: var(--space-16);
  border-radius: 8px;
  margin-bottom: var(--space-24);
  line-height: 1.6;
}

.roi-intro strong {
  color: var(--color-primary);
}

.roi-form h3 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  text-align: center;
}

.roi-inputs {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-24);
}

.roi-input-group {
  display: flex;
  flex-direction: column;
}

.roi-input-group label {
  font-weight: var(--font-weight-medium);
  margin-bottom: var(--space-8);
  color: var(--color-text);
}

.roi-input-group input,
.roi-input-group select {
  padding: var(--space-12);
  border: 1px solid var(--color-border);
  border-radius: 6px;
  font-size: 16px;
  transition: border-color 0.2s ease;
}

.roi-input-group input:focus,
.roi-input-group select:focus {
  outline: none;
  border-color: var(--color-primary);
}

.roi-results {
  margin-top: var(--space-32);
  padding-top: var(--space-24);
  border-top: 2px solid var(--color-border);
}

.roi-results h3 {
  color: var(--pres-primary);
  margin-bottom: var(--space-24);
  text-align: center;
}

.roi-metrics {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-32);
}

.roi-summary {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-32);
}

.roi-metric {
  background: var(--color-surface);
  padding: var(--space-20);
  border-radius: 8px;
  text-align: center;
  border: 1px solid var(--color-border);
  transition: border-color 0.2s ease;
}

.roi-metric:hover {
  border-color: var(--color-primary);
}

.roi-metric-value {
  font-size: 28px;
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  margin-bottom: var(--space-8);
  display: block;
}

.roi-metric-label {
  color: var(--color-text-muted);
  font-size: 14px;
}

.roi-comparison h4,
.roi-details h4,
.roi-recommendations h4 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  text-align: center;
}

.roi-chart-container {
  background: rgba(var(--color-slate-900-rgb), 0.02);
  border-radius: 8px;
  padding: var(--space-16);
  margin: var(--space-16) 0;
  max-width: 500px;
  margin-left: auto;
  margin-right: auto;
}

.roi-breakdown {
  background: var(--color-surface);
  border-radius: 8px;
  overflow: hidden;
  margin: var(--space-16) 0;
}

.roi-breakdown-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-12) var(--space-16);
  border-bottom: 1px solid var(--color-border);
}

.roi-breakdown-item:last-child {
  border-bottom: none;
}

.roi-breakdown-label {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
}

.roi-breakdown-value {
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

.roi-recommendation {
  padding: var(--space-16);
  border-radius: 8px;
  margin: var(--space-16) 0;
  border-left: 4px solid;
}

.roi-recommendation.excellent {
  background: rgba(45, 182, 125, 0.1);
  border-left-color: #2DB67D;
}

.roi-recommendation.good {
  background: rgba(244, 161, 0, 0.1);
  border-left-color: #F4A100;
}

.roi-recommendation.moderate {
  background: rgba(255, 193, 7, 0.1);
  border-left-color: #FFC107;
}

.roi-recommendation.poor {
  background: rgba(224, 30, 90, 0.1);
  border-left-color: #E01E5A;
}

.roi-recommendation h5 {
  margin: 0 0 var(--space-8) 0;
  color: var(--color-text);
}

.roi-recommendation p {
  margin: 0;
  color: var(--color-text-muted);
  line-height: 1.5;
}

.roi-actions {
  display: flex;
  gap: var(--space-12);
  justify-content: center;
  margin-top: var(--space-24);
  flex-wrap: wrap;
}

/* Детализация расчетов */
.roi-breakdown-section {
  margin-bottom: var(--space-24);
  padding: var(--space-16);
  background: var(--color-surface);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.roi-breakdown-section h5 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
  font-size: 1.1em;
  font-weight: var(--font-weight-semibold);
}

.roi-breakdown-total {
  border-top: 2px solid var(--color-primary);
  margin-top: var(--space-8);
  padding-top: var(--space-12);
}

.roi-breakdown-total .roi-breakdown-label,
.roi-breakdown-total .roi-breakdown-value {
  font-size: 1.1em;
  font-weight: var(--font-weight-bold);
}

/* Таблица денежных потоков */
.roi-cashflows-table {
  overflow-x: auto;
  margin-top: var(--space-12);
}

.roi-cashflows-table table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.95em;
}

.roi-cashflows-table th {
  background: var(--color-surface);
  padding: var(--space-12);
  text-align: left;
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  border-bottom: 2px solid var(--color-border);
  position: sticky;
  top: 0;
}

.roi-cashflows-table td {
  padding: var(--space-12);
  border-bottom: 1px solid var(--color-border);
  color: var(--color-text);
}

.roi-cashflows-table tr:hover {
  background: rgba(var(--color-primary-rgb), 0.05);
}

.roi-investment-row {
  background: rgba(224, 30, 90, 0.05);
  font-weight: var(--font-weight-medium);
}

.roi-positive-row {
  background: rgba(45, 182, 125, 0.05);
}

/* Валидация */
.roi-validation-error,
.roi-validation-warning {
  padding: var(--space-16);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-16);
}

.roi-validation-error {
  background: rgba(224, 30, 90, 0.1);
  border: 2px solid #E01E5A;
  color: #E01E5A;
}

.roi-validation-error h4 {
  margin: 0 0 var(--space-8) 0;
  color: #E01E5A;
  font-size: 1em;
}

.roi-validation-error ul {
  margin: 0;
  padding-left: var(--space-20);
}

.roi-validation-error li {
  margin-bottom: var(--space-4);
}

.roi-validation-warning {
  background: rgba(244, 161, 0, 0.1);
  border: 2px solid #F4A100;
  color: #F4A100;
}

.roi-validation-warning h4 {
  margin: 0 0 var(--space-8) 0;
  color: #F4A100;
  font-size: 1em;
}

.roi-validation-warning ul {
  margin: 0;
  padding-left: var(--space-20);
}

.roi-validation-warning li {
  margin-bottom: var(--space-4);
}

.roi-field-error {
  color: #E01E5A;
  font-size: 0.875em;
  margin-top: var(--space-4);
  padding: var(--space-4) var(--space-8);
  background: rgba(224, 30, 90, 0.1);
  border-radius: var(--radius-sm);
}

/* Подсказки */
.roi-tooltip {
  display: inline-block;
  margin-left: var(--space-4);
  cursor: help;
  color: var(--color-primary);
  font-size: 0.9em;
  vertical-align: middle;
}

.roi-input-row label {
  display: flex;
  align-items: center;
  margin-bottom: var(--space-8);
}

/* Адаптивность для таблиц */
@media (max-width: 768px) {
  .roi-cashflows-table {
    font-size: 0.85em;
  }
  
  .roi-cashflows-table th,
  .roi-cashflows-table td {
    padding: var(--space-8);
  }
  
  .roi-breakdown-section {
    padding: var(--space-12);
  }
  
  .roi-breakdown-item {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-4);
  }
  
  .roi-breakdown-value {
    margin-top: var(--space-4);
  }
}

/* Сравнение сценариев */
.roi-scenario-toggle {
  margin: var(--space-16) 0;
  padding: var(--space-12);
  background: var(--color-surface);
  border-radius: var(--radius-md);
}

.roi-scenario-toggle label {
  display: flex;
  align-items: center;
  gap: var(--space-8);
  cursor: pointer;
  font-weight: var(--font-weight-medium);
}

.roi-scenario-toggle input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

.roi-comparison {
  margin: var(--space-24) 0;
  padding: var(--space-20);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 2px solid var(--color-primary);
}

.roi-comparison h4 {
  margin: 0 0 var(--space-16) 0;
  color: var(--color-text);
  font-size: 1.2em;
}

.roi-comparison-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
}

.roi-comparison-item {
  padding: var(--space-16);
  background: var(--color-background);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  text-align: center;
}

.roi-comparison-item.highlight {
  background: rgba(var(--color-primary-rgb), 0.1);
  border: 2px solid var(--color-primary);
}

.comparison-label {
  font-size: 0.9em;
  color: var(--color-text-muted);
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
}

.comparison-value {
  font-size: 1.5em;
  font-weight: var(--font-weight-bold);
  margin-bottom: var(--space-8);
}

.comparison-value.positive {
  color: #2DB67D;
}

.comparison-value.negative {
  color: #E01E5A;
}

.comparison-value.highlight {
  color: var(--color-primary);
}

.comparison-detail {
  font-size: 0.85em;
  color: var(--color-text-muted);
  line-height: 1.4;
}

/* Анализ чувствительности */
.roi-sensitivity {
  margin: var(--space-24) 0;
  padding: var(--space-20);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
}

.roi-sensitivity-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-16);
}

.roi-sensitivity-header h4 {
  margin: 0;
  color: var(--color-text);
  font-size: 1.2em;
}

.roi-sensitivity-toggle {
  background: var(--color-primary);
  color: white;
  border: none;
  padding: var(--space-8) var(--space-16);
  border-radius: var(--radius-md);
  cursor: pointer;
  font-size: 0.9em;
  transition: background 0.2s ease;
}

.roi-sensitivity-toggle:hover {
  background: var(--color-primary-dark);
}

.roi-sensitivity-intro {
  color: var(--color-text-muted);
  margin-bottom: var(--space-16);
  font-size: 0.95em;
}

.roi-sensitivity-controls {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
  margin-bottom: var(--space-20);
}

.sensitivity-slider-group {
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
}

.sensitivity-slider-group label {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.sensitivity-slider-group input[type="range"] {
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: var(--color-border);
  outline: none;
  -webkit-appearance: none;
}

.sensitivity-slider-group input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--color-primary);
  cursor: pointer;
}

.sensitivity-slider-group input[type="range"]::-moz-range-thumb {
  width: 20px;
  height: 20px;
  border-radius: 50%;
  background: var(--color-primary);
  cursor: pointer;
  border: none;
}

.sensitivity-results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
  margin-top: var(--space-16);
}

.sensitivity-result-item {
  padding: var(--space-16);
  background: var(--color-background);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  text-align: center;
}

.sensitivity-result-label {
  font-size: 0.9em;
  color: var(--color-text-muted);
  margin-bottom: var(--space-8);
  font-weight: var(--font-weight-medium);
}

.sensitivity-result-value {
  font-size: 1.3em;
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
}

.sensitivity-result-value.positive {
  color: #2DB67D;
}

.sensitivity-result-value.negative {
  color: #E01E5A;
}

.sensitivity-delta {
  display: block;
  font-size: 0.7em;
  font-weight: var(--font-weight-normal);
  margin-top: var(--space-4);
  opacity: 0.8;
}

/* Адаптивность для сравнения и анализа чувствительности */
@media (max-width: 768px) {
  .roi-comparison-grid {
    grid-template-columns: 1fr;
  }
  
  .roi-summary {
    grid-template-columns: repeat(2, 1fr) !important;
  }
  
  .sensitivity-results-grid {
    grid-template-columns: 1fr;
  }
  
  .roi-sensitivity-controls {
    gap: var(--space-12);
  }
}

/* Список сценариев */
.roi-scenarios-list {
  margin: var(--space-24) 0;
  padding: var(--space-20);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-border);
}

.roi-scenarios-list h5 {
  margin: 0 0 var(--space-16) 0;
  color: var(--color-text);
  font-size: 1.1em;
}

.scenarios-list {
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
}

.scenario-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-16);
  background: var(--color-background);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
}

.scenario-info {
  flex: 1;
}

.scenario-name {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.scenario-metrics {
  font-size: 0.9em;
  color: var(--color-text-muted);
  margin-bottom: var(--space-4);
}

.scenario-date {
  font-size: 0.85em;
  color: var(--color-text-muted);
}

.scenario-actions {
  display: flex;
  gap: var(--space-8);
}

.scenario-btn {
  padding: var(--space-8) var(--space-16);
  border: 1px solid var(--color-border);
  border-radius: var(--radius-md);
  background: var(--color-background);
  color: var(--color-text);
  cursor: pointer;
  font-size: 0.9em;
  transition: all 0.2s ease;
}

.scenario-btn:hover {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
}

.scenario-btn.secondary {
  background: transparent;
}

.scenario-btn.secondary:hover {
  background: rgba(224, 30, 90, 0.1);
  color: #E01E5A;
  border-color: #E01E5A;
}

@media (max-width: 768px) {
  .scenario-item {
    flex-direction: column;
    align-items: flex-start;
    gap: var(--space-12);
  }
  
  .scenario-actions {
    width: 100%;
  }
  
  .scenario-btn {
    flex: 1;
  }
}

/* Стили для печати */
@media print {
  .roi-form,
  .roi-actions,
  .roi-validation-error,
  .roi-validation-warning,
  .roi-tooltip,
  .roi-scenario-toggle {
    display: none !important;
  }
  
  .roi-results {
    display: block !important;
  }
  
  .roi-breakdown-section {
    page-break-inside: avoid;
    border: 1px solid #ddd;
    margin-bottom: var(--space-16);
  }
  
  .roi-cashflows-table {
    page-break-inside: avoid;
  }
  
  .roi-cashflows-table table {
    border: 1px solid #ddd;
  }
  
  .roi-cashflows-table th,
  .roi-cashflows-table td {
    border: 1px solid #ddd;
    padding: var(--space-8);
  }
  
  .roi-metric {
    page-break-inside: avoid;
    border: 1px solid #ddd;
  }
  
  .roi-comparison {
    page-break-inside: avoid;
    border: 1px solid #ddd;
  }
}

/* ========== Readiness Assessment Styles ========== */
.readiness-assessment {
  padding: var(--space-32);
  max-width: 1200px;
  margin: 0 auto;
}

.readiness-intro {
  background: rgba(var(--color-teal-500-rgb), 0.08);
  padding: var(--space-16);
  border-radius: 8px;
  margin-bottom: var(--space-24);
  line-height: 1.6;
}

.readiness-intro strong {
  color: var(--color-primary);
}

.readiness-progress {
  margin-bottom: var(--space-24);
}

.readiness-progress-bar {
  width: 100%;
  height: 8px;
  background: var(--color-border);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: var(--space-8);
}

.readiness-progress-fill {
  height: 100%;
  background: var(--color-primary);
  border-radius: 4px;
  transition: width 0.3s ease;
}

.readiness-progress-text {
  text-align: center;
  font-size: 14px;
  color: var(--color-text-muted);
}

.readiness-question {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: 8px;
  border: 1px solid var(--color-border);
}

.readiness-category {
  display: inline-block;
  background: var(--color-primary);
  color: white;
  padding: 4px 12px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  margin-bottom: var(--space-16);
}

.readiness-question-text {
  margin: 0 0 var(--space-24) 0;
  color: var(--color-text);
  line-height: 1.6;
  font-size: 16px;
  font-weight: var(--font-weight-medium);
}

.readiness-scale {
  margin-bottom: var(--space-32);
}

.readiness-scale-labels {
  display: flex;
  justify-content: space-between;
  margin-bottom: var(--space-12);
  font-size: 13px;
  color: var(--color-text-muted);
  text-align: center;
}

.readiness-scale-labels span {
  flex: 1;
}

.readiness-scale-inputs {
  display: flex;
  justify-content: space-between;
  gap: var(--space-16);
  padding: 0 var(--space-8);
}

.readiness-option {
  display: flex;
  flex-direction: column;
  align-items: center;
  cursor: pointer;
  transition: transform 0.2s ease;
}

.readiness-option:hover {
  transform: translateY(-2px);
}

.readiness-radio:hover {
  border-color: var(--color-primary);
  transform: scale(1.05);
}

.readiness-radio {
  width: 48px;
  height: 48px;
  border: 2px solid var(--color-border);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: var(--font-weight-medium);
  font-size: 16px;
  transition: all 0.2s ease;
  margin-bottom: var(--space-12);
  cursor: pointer;
}

.readiness-option input:checked + .readiness-radio {
  background: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

.readiness-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.readiness-results {
  max-width: 1000px;
  margin: 0 auto;
}

.readiness-results h3 {
  color: var(--pres-primary);
  margin-bottom: var(--space-24);
  text-align: center;
}

.readiness-overall {
  background: linear-gradient(135deg, var(--color-surface) 0%, rgba(var(--color-teal-500-rgb), 0.05) 100%);
  padding: var(--space-32);
  border-radius: 16px;
  text-align: center;
  margin-bottom: var(--space-40);
  border: 1px solid var(--color-card-border);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.readiness-overall-score {
  font-size: 48px;
  font-weight: var(--font-weight-bold);
  color: var(--color-teal-600);
  margin-bottom: var(--space-12);
  display: block;
}

.readiness-overall-level {
  font-size: 20px;
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-12);
}

.readiness-overall-description {
  color: var(--color-text-muted);
  line-height: 1.5;
}

.readiness-radar-container {
  max-width: 600px;
  max-height: 500px;
  margin: 0 auto var(--space-32);
  position: relative;
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: 16px;
  border: 1px solid var(--color-card-border);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.readiness-radar-container h4 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  text-align: center;
}

.readiness-radar-container canvas {
  max-width: 100%;
  max-height: 400px;
  width: 100% !important;
  height: auto !important;
}

.readiness-details h4,
.readiness-recommendations h4 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  text-align: center;
}

.readiness-categories {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-24);
  max-width: 800px;
  margin: 0 auto var(--space-32);
}

.readiness-category-result {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: 16px;
  border: 1px solid var(--color-card-border);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
  transition: all 0.3s ease;
}

.readiness-category-result:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.readiness-category-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-12);
}

.readiness-category-name {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
}

.readiness-category-score {
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

.readiness-category-bar {
  width: 100%;
  height: 8px;
  background: var(--color-border);
  border-radius: 4px;
  overflow: hidden;
}

.readiness-category-fill {
  height: 100%;
  background: var(--color-primary);
  border-radius: 4px;
  transition: width 0.5s ease;
}

.readiness-recommendation {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: 12px;
  margin-bottom: var(--space-20);
  border-left: 4px solid #2DB67D;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.readiness-recommendation.high {
  background: rgba(224, 30, 90, 0.05);
  border-left-color: #E01E5A;
}

.readiness-recommendation h5 {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text);
}

.readiness-recommendation ul {
  margin: 0;
  padding-left: var(--space-20);
}

.readiness-recommendation li {
  color: var(--color-text-muted);
  margin-bottom: var(--space-4);
  line-height: 1.4;
}

.readiness-recommendation li:last-child {
  margin-bottom: 0;
}

.readiness-actions {
  display: flex;
  gap: var(--space-12);
  justify-content: center;
  margin-top: var(--space-24);
  flex-wrap: wrap;
}

.readiness-actions .panel-button {
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.readiness-actions .panel-button svg {
  flex-shrink: 0;
}

/* ========== Enhanced Readiness Recommendations Styles ========== */

.readiness-recommendation-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-12);
  flex-wrap: wrap;
  gap: var(--space-12);
}

.readiness-recommendation-meta {
  display: flex;
  gap: var(--space-12);
  flex-wrap: wrap;
  align-items: center;
}

.readiness-urgency-badge {
  padding: 2px 8px;
  border-radius: 12px;
  font-size: 10px;
  font-weight: var(--font-weight-medium);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.readiness-urgency-badge.critical {
  background: #DC2626;
  color: white;
}

.readiness-urgency-badge.high {
  background: #EA580C;
  color: white;
}

.readiness-urgency-badge.medium {
  background: #CA8A04;
  color: white;
}

.readiness-urgency-badge.low {
  background: #16A34A;
  color: white;
}

.readiness-complexity-icon,
.readiness-impact-icon {
  display: none; /* Скрываем избыточные иконки для упрощения UI */
}

.readiness-complexity-icon.easy {
  background: #DCFCE7;
  color: #16A34A;
}

.readiness-complexity-icon.medium {
  background: #FEF3C7;
  color: #CA8A04;
}

.readiness-complexity-icon.hard {
  background: #FEE2E2;
  color: #DC2626;
}

.readiness-impact-icon.high {
  background: #DBEAFE;
  color: #2563EB;
}

.readiness-impact-icon.medium {
  background: #F3E8FF;
  color: #7C3AED;
}

.readiness-impact-icon.low {
  background: #F1F5F9;
  color: #64748B;
}

.readiness-timeframe {
  background: #F8FAFC;
  padding: 4px 8px;
  border-radius: 6px;
  font-size: 11px;
  color: #475569;
  border: 1px solid #E2E8F0;
}

.readiness-recommendation-content {
  margin-top: var(--space-16);
}

.readiness-recommendation-actions {
  margin-top: var(--space-16);
}

.readiness-recommendation-actions h6 {
  margin: 0 0 var(--space-8) 0;
  font-size: 14px;
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
}

.readiness-recommendation-actions ul {
  margin: 0;
  padding-left: var(--space-16);
}

.readiness-recommendation-actions li {
  margin-bottom: var(--space-6);
  line-height: 1.4;
  color: var(--color-text-muted);
  position: relative;
}

.readiness-recommendation-actions li:before {
  content: "•";
  color: var(--color-primary);
  font-weight: bold;
  position: absolute;
  left: -12px;
}

/* Updated recommendation priority colors */
.readiness-recommendation.critical {
  background: rgba(220, 38, 38, 0.05);
  border-left-color: #DC2626;
}

.readiness-recommendation.high {
  background: rgba(234, 88, 12, 0.05);
  border-left-color: #EA580C;
}

.readiness-recommendation.medium {
  background: rgba(202, 138, 4, 0.05);
  border-left-color: #CA8A04;
}

.readiness-recommendation.low {
  background: rgba(22, 163, 74, 0.05);
  border-left-color: #16A34A;
}

/* ========== Hero Intro Slide Styles ========== */

.hero-intro-slide {
  display: flex;
  flex-direction: column;
  gap: var(--space-32);
  max-width: 1400px;
  margin: 0 auto;
  padding: 0 var(--space-32);
}

/* ========== СТИЛИ ДЛЯ СЛАЙДА 1 - ПРОБЛЕМА ========== */
.hero-hook {
  background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(var(--color-teal-500-rgb), 0.03) 100%);
  padding: var(--space-32);
  border-radius: var(--radius-lg);
  border-left: 4px solid #DC2626;
  border-top: 1px solid var(--color-card-border);
  border-right: 1px solid var(--color-card-border);
  border-bottom: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  text-align: center;
}

.hero-hook .hook-question {
  font-size: clamp(1.5rem, 4vw, 2rem);
  font-weight: var(--font-weight-bold);
  color: var(--pres-primary);
  margin-bottom: var(--space-32);
  line-height: 1.3;
}

.hero-hook .hook-problems {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-24);
  max-width: 1200px;
  margin: 0 auto;
}

.hero-hook .problem-item {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  display: flex;
  align-items: flex-start;
  gap: var(--space-20);
  transition: all 0.35s var(--ease-standard);
  position: relative;
  overflow: hidden;
  min-height: auto;
}

.hero-hook .problem-item::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(var(--color-teal-500-rgb), 0.05), rgba(239, 68, 68, 0.05));
  opacity: 0;
  transition: opacity 0.35s var(--ease-standard);
  pointer-events: none;
}

.hero-hook .problem-item:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.hero-hook .problem-item:hover::after {
  opacity: 1;
}

.hero-hook .problem-item .icon {
  flex-shrink: 0;
  width: clamp(48px, 8vw, 64px);
  height: clamp(48px, 8vw, 64px);
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: var(--radius-lg);
  border: 1px solid;
  transition: all 0.35s var(--ease-standard);
}

.hero-hook .problem-item .icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.hero-hook .problem-item .icon.danger {
  background: rgba(239, 68, 68, 0.1);
  border-color: rgba(239, 68, 68, 0.25);
  color: #DC2626;
}

.hero-hook .problem-item .icon.warning {
  background: rgba(245, 158, 11, 0.1);
  border-color: rgba(245, 158, 11, 0.25);
  color: #D97706;
}

.hero-hook .problem-item .icon.neutral {
  background: rgba(100, 116, 139, 0.1);
  border-color: rgba(100, 116, 139, 0.25);
  color: #475569;
}

.hero-hook .problem-item:hover .icon {
  transform: scale(1.1);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.hero-hook .problem-item p {
  margin: 0;
  font-size: clamp(0.875rem, 2vw, 1rem);
  line-height: 1.6;
  color: var(--color-text);
  font-weight: var(--font-weight-medium);
  flex: 1;
  font-style: normal;
  text-align: left;
}

.hero-hook-source {
  margin-top: var(--space-32);
  padding-top: var(--space-20);
  border-top: 1px solid var(--color-card-border);
  text-align: center;
}

.hero-hook-source .source-text {
  font-size: clamp(0.75rem, 1.5vw, 0.8125rem);
  color: var(--color-text-secondary);
  font-style: normal;
  margin: 0;
  font-weight: var(--font-weight-normal);
}

/* Адаптивность для слайда 1 */
@media (min-width: 768px) and (max-width: 1023px) {
  .hero-hook .hook-problems {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-20);
  }
  
  .hero-hook .problem-item {
    padding: var(--space-20);
    gap: var(--space-16);
  }
  
  .hero-hook .problem-item .icon {
    width: 56px;
    height: 56px;
  }
}

@media (max-width: 767px) {
  .hero-hook {
    padding: var(--space-24);
  }
  
  .hero-hook .hook-problems {
    grid-template-columns: 1fr;
    gap: var(--space-16);
  }
  
  .hero-hook .problem-item {
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: var(--space-20);
    gap: var(--space-16);
  }
  
  .hero-hook .problem-item p {
    text-align: center;
  }
  
  .hero-hook .problem-item .icon {
    width: 56px;
    height: 56px;
  }
  
  .hero-hook-source {
    margin-top: var(--space-24);
    padding-top: var(--space-16);
  }
}

@media (hover: none) and (pointer: coarse) {
  .hero-hook .problem-item:hover {
    transform: none;
  }
  
  .hero-hook .problem-item:active {
    transform: scale(0.98);
  }
  
  .hero-hook .problem-item:hover .icon {
    transform: none;
  }
  
  .hero-hook .problem-item:active .icon {
    transform: scale(0.95);
  }
}

@media (prefers-reduced-motion: reduce) {
  .hero-hook .problem-item,
  .hero-hook .problem-item .icon {
    transition-duration: 0.01ms !important;
  }
}
/* ========== КОНЕЦ СТИЛЕЙ ДЛЯ СЛАЙДА 1 ========== */

.hero-value {
  background: rgba(34, 197, 94, 0.05);
  padding: var(--space-24);
  border-radius: 12px;
  border-left: 4px solid #22C55E;
  text-align: center;
}

.hero-value h2 {
  font-size: 24px;
  color: #16A34A;
  margin-bottom: var(--space-20);
}

.hero-value .value-cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-20);
}

.hero-value .value-card {
  background: white;
  padding: var(--space-20);
  border-radius: 8px;
  text-align: center;
  box-shadow: var(--shadow-sm);
  transition: transform 0.3s ease;
}

.hero-value .value-card:hover {
  transform: translateY(-2px);
}

.hero-value .value-card .icon {
  width: 48px;
  height: 48px;
  margin: 0 auto var(--space-16);
  color: var(--color-teal-500);
  display: flex;
  align-items: center;
  justify-content: center;
}

.hero-value .value-card .icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.hero-value .value-card h3 {
  margin: 0 0 var(--space-8) 0;
  font-size: 18px;
  color: var(--color-text);
  font-weight: var(--font-weight-semibold);
}

.hero-value .value-card p {
  margin: 0;
  font-size: 14px;
  color: var(--color-text-secondary);
}

.hero-proof {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
}

.hero-proof .stat-card-hero {
  background: var(--color-surface);
  padding: var(--space-20);
  border-radius: 8px;
  text-align: center;
  border: 2px solid var(--color-border);
  box-shadow: var(--shadow-sm);
  transition: transform 0.3s ease;
}

.hero-proof .stat-card-hero:hover {
  transform: translateY(-2px);
}

.hero-proof .stat-card-hero.highlight {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
  box-shadow: 0 4px 12px rgba(33, 128, 141, 0.3);
}

.hero-proof .stat-card-hero .stat-number {
  display: block;
  font-size: 36px;
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  margin-bottom: var(--space-8);
}

.hero-proof .stat-card-hero.highlight .stat-number {
  color: white;
}

.hero-proof .stat-card-hero p {
  margin: 0;
  font-size: 14px;
  line-height: 1.4;
}

.hero-proof .stat-card-hero.highlight p {
  color: rgba(255, 255, 255, 0.9);
}

.hero-cta-section {
  text-align: center;
  padding: var(--space-24) 0;
}

.hero-cta-section .cta-primary-hero {
  background: var(--color-primary);
  color: white;
  border: none;
  padding: 16px 48px;
  font-size: 20px;
  font-weight: var(--font-weight-bold);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(33, 128, 141, 0.3);
  display: block;
  margin: 0 auto var(--space-16) auto;
  max-width: 300px;
}

.hero-cta-section .cta-primary-hero:hover {
  background: var(--color-primary-hover);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(33, 128, 141, 0.4);
}

.hero-cta-section .cta-secondary-hero {
  background: rgba(59, 130, 246, 0.1);
  color: #3B82F6;
  border: 2px solid #3B82F6;
  padding: 12px 32px;
  font-size: 16px;
  font-weight: var(--font-weight-medium);
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  display: block;
  margin: 0 auto;
  max-width: 250px;
}

.hero-cta-section .cta-secondary-hero:hover {
  background: rgba(59, 130, 246, 0.2);
  transform: translateY(-2px);
}

.hero-cta-section .cta-hint-text {
  margin-top: var(--space-12);
  font-size: 14px;
  color: var(--color-text-secondary);
}

/* Mobile adaptations for hero slide (остальные элементы) */
@media (max-width: 768px) {
  .hero-intro-slide {
    gap: var(--space-24);
    padding: 0 var(--space-8);
  }

  .hero-value .value-cards {
    grid-template-columns: 1fr;
  }

  .hero-proof {
    grid-template-columns: 1fr;
  }

  .hero-cta-section .cta-primary-hero,
  .hero-cta-section .cta-secondary-hero {
    width: 100%;
    max-width: none;
  }

  .hero-value .value-card .icon {
    width: 48px;
    height: 48px;
  }
}

/* ========== Hybrid Model Constructor Styles ========== */
.hybrid-constructor {
  padding: var(--space-32);
  max-width: 1200px;
  margin: 0 auto;
}

.hybrid-intro {
  background: rgba(var(--color-teal-500-rgb), 0.08);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  margin-bottom: var(--space-32);
  line-height: 1.6;
}

.hybrid-intro strong {
  color: var(--color-primary);
}

.hybrid-step {
  margin-bottom: var(--space-32);
}

.hybrid-step h3 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  text-align: center;
}

.hybrid-base-models {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-24);
  max-width: 1200px;
  margin: 0 auto;
}

.hybrid-base-model {
  position: relative;
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: transform 0.35s var(--ease-standard), 
              box-shadow 0.35s var(--ease-standard), 
              border-color 0.35s var(--ease-standard);
  overflow: hidden;
}

.hybrid-base-model::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, 
    rgba(var(--color-teal-500-rgb), 0.08), 
    rgba(var(--color-brown-600-rgb), 0.08));
  opacity: 0;
  transition: opacity 0.35s var(--ease-standard);
  pointer-events: none;
}

.hybrid-base-model:hover {
  transform: translateY(-8px);
  box-shadow: 0 24px 40px rgba(var(--color-slate-900-rgb), 0.12);
  border-color: rgba(var(--color-teal-500-rgb), 0.35);
}

.hybrid-base-model:hover::after {
  opacity: 1;
}

.hybrid-base-model.selected {
  border-color: var(--color-primary);
  background: rgba(var(--color-teal-500-rgb), 0.05);
}

.hybrid-base-model.selected::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0 40px 40px 0;
  border-color: transparent var(--color-primary) transparent transparent;
  z-index: 1;
}

.hybrid-base-model.selected::after {
  opacity: 0.3;
}

.hybrid-model-header {
  display: flex;
  align-items: center;
  margin-bottom: var(--space-12);
}

.hybrid-model-icon {
  width: 48px;
  height: 48px;
  margin-right: var(--space-12);
  color: var(--color-teal-500);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.hybrid-model-icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.hybrid-model-header h4 {
  margin: 0;
  color: var(--color-text);
}

.hybrid-model-description {
  color: var(--color-text-muted);
  margin-bottom: var(--space-12);
  line-height: 1.5;
}

.hybrid-model-elements {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-8);
  margin-bottom: var(--space-12);
}

.hybrid-element-tag {
  background: rgba(var(--color-primary-rgb), 0.1);
  color: var(--color-primary);
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: var(--font-weight-medium);
}

.hybrid-model-pros {
  font-size: 14px;
  color: var(--color-text-muted);
  line-height: 1.4;
}

.hybrid-selected-base {
  background: linear-gradient(135deg, 
    var(--color-surface) 0%, 
    rgba(var(--color-teal-500-rgb), 0.05) 100%);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  margin-bottom: var(--space-32);
  border-left: 4px solid var(--color-primary);
  box-shadow: var(--shadow-sm);
}

.hybrid-selected-base h4 {
  color: var(--color-primary);
  margin: 0 0 var(--space-8) 0;
}

.hybrid-elements-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-24);
  max-width: 1000px;
  margin: 0 auto;
}

.hybrid-element-option {
  position: relative;
  display: block;
  cursor: pointer;
}

.hybrid-element-option input[type="checkbox"] {
  position: absolute;
  opacity: 0;
  width: 0;
  height: 0;
}

.hybrid-element-card {
  position: relative;
  display: block;
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
  overflow: hidden;
}

.hybrid-element-card::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0 0 40px 40px;
  border-color: transparent transparent var(--color-primary) transparent;
  opacity: 0;
  transition: opacity 0.3s ease;
  z-index: 1;
}

.hybrid-element-card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, 
    rgba(var(--color-teal-500-rgb), 0.08), 
    rgba(var(--color-brown-600-rgb), 0.08));
  opacity: 0;
  transition: opacity 0.35s var(--ease-standard);
  pointer-events: none;
}

.hybrid-element-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.hybrid-element-card:hover::after {
  opacity: 1;
}

.hybrid-element-option input:checked + .hybrid-element-card {
  border-color: var(--color-primary);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.hybrid-element-option input:checked + .hybrid-element-card::before {
  opacity: 1;
}

.hybrid-element-option input:checked + .hybrid-element-card::after {
  opacity: 0.3;
}

.hybrid-element-card h5 {
  margin: 0 0 var(--space-8) 0;
  color: var(--color-text);
}

.hybrid-element-card p {
  margin: 0 0 var(--space-8) 0;
  color: var(--color-text-muted);
  font-size: 14px;
  line-height: 1.4;
}

.hybrid-element-source {
  color: var(--color-primary);
  font-size: 12px;
  font-weight: var(--font-weight-medium);
}

.hybrid-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: var(--space-32);
  gap: var(--space-16);
}

.hybrid-navigation .panel-button {
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.hybrid-navigation .panel-button svg {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
}

.hybrid-preview-header {
  margin-bottom: var(--space-24);
}

.hybrid-preview-header h4 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  text-align: center;
}

.hybrid-model-summary {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
  margin-bottom: var(--space-32);
}

.hybrid-summary-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--color-surface);
  padding: var(--space-20);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
}

.hybrid-summary-label {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
}

.hybrid-summary-value {
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
}

.hybrid-model-visualization {
  background: rgba(var(--color-slate-900-rgb), 0.02);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  margin: var(--space-32) 0;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 300px;
  border: 1px solid var(--color-card-border);
}

.hybrid-model-composition {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
}

.hybrid-model-composition h5 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
}

.hybrid-composition-base,
.hybrid-composition-added {
  margin-bottom: var(--space-16);
}

.hybrid-composition-base ul,
.hybrid-composition-added ul {
  margin: var(--space-8) 0 0 0;
  padding-left: var(--space-20);
}

.hybrid-composition-base li,
.hybrid-composition-added li {
  color: var(--color-text-muted);
  margin-bottom: var(--space-4);
  line-height: 1.4;
}

.hybrid-plan h5 {
  color: var(--pres-primary);
  margin-bottom: var(--space-20);
  text-align: center;
}

.hybrid-plan-phases {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: var(--space-24);
  margin-bottom: var(--space-32);
}

.hybrid-plan-phase {
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
}

.hybrid-plan-phase:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.hybrid-plan-phase h6 {
  color: var(--pres-primary);
  margin: 0 0 var(--space-12) 0;
  font-size: var(--font-size-lg);
  font-weight: var(--font-weight-semibold);
}

.hybrid-plan-phase ul {
  margin: 0;
  padding-left: var(--space-16);
}

.hybrid-plan-phase li {
  color: var(--color-text);
  margin-bottom: var(--space-6);
  line-height: 1.4;
}

.hybrid-plan-notes {
  background: rgba(var(--color-slate-900-rgb), 0.05);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border-left: 4px solid var(--color-primary);
  box-shadow: var(--shadow-sm);
}

.hybrid-plan-notes h6 {
  color: var(--pres-primary);
  margin: 0 0 var(--space-12) 0;
}

.hybrid-plan-notes ul {
  margin: 0;
  padding-left: var(--space-20);
}

.hybrid-plan-notes li {
  color: var(--color-text-muted);
  margin-bottom: var(--space-6);
  line-height: 1.4;
}

.hybrid-actions {
  display: flex;
  gap: var(--space-12);
  justify-content: center;
  margin-top: var(--space-24);
  flex-wrap: wrap;
}

.hybrid-actions .panel-button {
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.hybrid-actions .panel-button svg {
  flex-shrink: 0;
  width: 18px;
  height: 18px;
}

/* ========== Hybrid Constructor Responsive Styles ========== */
@media (min-width: 1024px) {
  .hybrid-base-models {
    grid-template-columns: repeat(3, 1fr);
  }

  .hybrid-elements-grid {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 768px) and (max-width: 1023px) {
  .hybrid-base-models {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-20);
  }

  .hybrid-elements-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-20);
  }
}

@media (max-width: 767px) {
  .hybrid-constructor {
    padding: var(--space-16);
  }

  .hybrid-base-models {
    grid-template-columns: 1fr;
    gap: var(--space-16);
  }

  .hybrid-elements-grid {
    grid-template-columns: 1fr;
    gap: var(--space-16);
  }

  .hybrid-base-model,
  .hybrid-element-card {
    padding: var(--space-20);
  }

  .hybrid-model-icon {
    width: 40px;
    height: 40px;
  }

  .hybrid-navigation {
    flex-direction: column;
    width: 100%;
  }

  .hybrid-navigation .panel-button {
    width: 100%;
    justify-content: center;
  }

  .hybrid-actions {
    flex-direction: column;
    width: 100%;
  }

  .hybrid-actions .panel-button {
    width: 100%;
    justify-content: center;
  }
}

@media (hover: none) and (pointer: coarse) {
  .hybrid-base-model:hover,
  .hybrid-element-card:hover,
  .hybrid-plan-phase:hover {
    transform: none;
  }

  .hybrid-base-model:active,
  .hybrid-element-card:active {
    transform: scale(0.98);
  }
}

@media (prefers-reduced-motion: reduce) {
  .hybrid-base-model,
  .hybrid-element-card,
  .hybrid-plan-phase {
    transition-duration: 0.01ms !important;
  }
}

/* ========== Model Slide Styles ========== */

.model-slide {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: var(--space-24);
  margin-bottom: var(--space-24);
}

.model-info {
  background: var(--color-surface);
  padding: var(--space-20);
  border-radius: 8px;
  border: 1px solid var(--color-border);
}

.model-navigation {
  margin-top: var(--space-24);
  text-align: center;
}

/* ========== Model Selector Tool Styles ========== */

.model-selector-tool {
  padding: var(--space-32);
  max-width: 1200px;
  margin: 0 auto;
}

.selector-mode-tabs {
  display: flex;
  justify-content: center;
  margin-bottom: var(--space-32);
  gap: var(--space-12);
  background: transparent;
  border: none;
  border-radius: 0;
  overflow: visible;
}

.mode-tab {
  flex: 1;
  max-width: 300px;
  padding: var(--space-16) var(--space-24);
  border: 1px solid var(--color-card-border);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  color: var(--color-text);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  position: relative;
  display: flex;
  align-items: center;
  gap: var(--space-8);
  justify-content: center;
}

.mode-tab svg {
  width: 20px;
  height: 20px;
  flex-shrink: 0;
  stroke-width: 2;
}

.mode-tab:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.mode-tab.active {
  background: var(--color-primary);
  color: var(--color-white);
  border-color: var(--color-primary);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.3);
  font-weight: var(--font-weight-semibold);
}

.mode-tab.active svg {
  color: var(--color-white);
}

.selector-mode-content {
  animation: fadeIn 0.3s ease;
}

/* ========== Table Mode Styles ========== */

.table-filters {
  display: flex;
  flex-wrap: wrap;
  gap: var(--space-16);
  margin-bottom: var(--space-32);
  padding: var(--space-24);
  background: var(--color-surface);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
}

.table-filters input[type="search"] {
  flex: 1;
  min-width: 200px;
  padding: var(--space-12) var(--space-16);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-base);
  font-size: var(--font-size-base);
  background: var(--color-surface);
  transition: all 0.2s ease;
}

.table-filters input[type="search"]:focus {
  outline: none;
  border-color: var(--color-primary);
  box-shadow: 0 0 0 3px rgba(var(--color-teal-500-rgb), 0.1);
}

.filter-group {
  display: flex;
  gap: var(--space-8);
}

.filter-btn {
  padding: var(--space-10) var(--space-16);
  border: 1px solid var(--color-card-border);
  background: var(--color-surface);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
}

.filter-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
  background: rgba(var(--color-teal-500-rgb), 0.08);
}

.filter-btn.active {
  background: var(--color-primary);
  color: white;
  border-color: var(--color-primary);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.3);
}

.reset-filters-btn {
  padding: var(--space-10) var(--space-16);
  border: 1px solid var(--color-red-300);
  background: var(--color-red-50);
  color: var(--color-red-700);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.reset-filters-btn svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

.reset-filters-btn:hover {
  background: var(--color-red-100);
  border-color: var(--color-red-400);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
}

.comparison-table-wrapper {
  max-height: 600px;
  overflow-y: auto;
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  background: var(--color-surface);
  margin-bottom: var(--space-32);
}

.model-comparison-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 14px;
}

.model-comparison-table thead th {
  position: sticky;
  top: 0;
  background: var(--color-surface);
  padding: var(--space-12);
  text-align: left;
  border-bottom: 2px solid var(--color-border);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  cursor: pointer;
  transition: background-color 0.2s ease;
  z-index: 10;
}

.model-comparison-table thead th:hover {
  background: rgba(var(--color-teal-500-rgb), 0.05);
}

.model-comparison-table thead th.sort-asc::after {
  content: '';
  display: inline-block;
  width: 16px;
  height: 16px;
  margin-left: var(--space-4);
  vertical-align: middle;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2314b8a6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='18 15 12 9 6 15'%3E%3C/polyline%3E%3C/svg%3E");
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}

.model-comparison-table thead th.sort-desc::after {
  content: '';
  display: inline-block;
  width: 16px;
  height: 16px;
  margin-left: var(--space-4);
  vertical-align: middle;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%2314b8a6' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
}

.model-comparison-table tbody td {
  padding: var(--space-12);
  border-bottom: 1px solid var(--color-border);
  vertical-align: top;
}

.model-comparison-table tbody tr:hover {
  background: rgba(var(--color-teal-500-rgb), 0.05);
  transform: scale(1.01);
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.model-comparison-table tbody tr.selected {
  background: rgba(var(--color-teal-500-rgb), 0.1);
  border-left: 3px solid var(--color-teal-500);
}

.model-name {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.model-type {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  text-transform: uppercase;
}

.model-type.Контекстные {
  background: rgba(99, 102, 241, 0.1);
  color: #4338CA;
}

.model-type.Высокоуровневые {
  background: rgba(14, 165, 233, 0.1);
  color: #0EA5E9;
}

.model-type.Действенные {
  background: rgba(16, 185, 129, 0.1);
  color: #059669;
}

.model-type.Вспомогательные {
  background: rgba(249, 115, 22, 0.1);
  color: #EA580C;
}

.complexity-badge, .scale-badge, .duration-badge {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  margin-right: var(--space-4);
}

.complexity-badge.Низкая {
  background: rgba(16, 185, 129, 0.1);
  color: #059669;
}

.complexity-badge.Средняя {
  background: rgba(245, 158, 11, 0.1);
  color: #D97706;
}

.complexity-badge.Высокая {
  background: rgba(239, 68, 68, 0.1);
  color: #DC2626;
}

.scale-badge.Малый {
  background: rgba(16, 185, 129, 0.1);
  color: #059669;
}

.scale-badge.Средний {
  background: rgba(245, 158, 11, 0.1);
  color: #D97706;
}

.scale-badge.Крупный {
  background: rgba(239, 68, 68, 0.1);
  color: #DC2626;
}

.duration-badge {
  background: rgba(99, 102, 241, 0.1);
  color: #4338CA;
}

.focus-badge {
  display: inline-block;
  padding: 2px 6px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: var(--font-weight-medium);
  margin-right: var(--space-4);
}

.focus-badge.Люди {
  background: rgba(236, 72, 153, 0.1);
  color: #DB2777;
}

.focus-badge.Процессы {
  background: rgba(99, 102, 241, 0.1);
  color: #4338CA;
}

.focus-badge.Стратегия {
  background: rgba(14, 165, 233, 0.1);
  color: #0EA5E9;
}

.focus-badge.Культура {
  background: rgba(16, 185, 129, 0.1);
  color: #059669;
}

.model-select-checkbox {
  width: 18px;
  height: 18px;
  cursor: pointer;
}

/* ========== Selected Models Panel Styles ========== */

.selected-models-panel {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  padding: var(--space-24);
  margin-bottom: var(--space-32);
  display: none;
}

.selected-models-panel.show {
  display: block;
  animation: slideDown 0.3s ease;
}

.selected-models-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-12);
  padding-bottom: var(--space-8);
  border-bottom: 1px solid var(--color-border);
}

.selected-models-header h4 {
  margin: 0;
  color: var(--color-text);
}

.clear-selection-btn {
  padding: var(--space-8) var(--space-16);
  border: 1px solid var(--color-red-300);
  background: var(--color-red-50);
  color: var(--color-red-700);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.clear-selection-btn svg {
  width: 16px;
  height: 16px;
  flex-shrink: 0;
}

.clear-selection-btn:hover {
  background: var(--color-red-100);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(239, 68, 68, 0.2);
}

.selected-model-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-12);
  margin-bottom: var(--space-12);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-base);
  border-left: 4px solid var(--color-primary);
  box-shadow: var(--shadow-sm);
  transition: all 0.2s ease;
}

.selected-model-item:hover {
  background: rgba(var(--color-teal-500-rgb), 0.08);
  transform: translateX(4px);
}

.selected-model-name {
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
  flex: 1;
}

.remove-model-btn {
  padding: 4px;
  border: none;
  background: transparent;
  color: var(--color-red-500);
  cursor: pointer;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.2s ease;
}

.remove-model-btn:hover {
  background: rgba(239, 68, 68, 0.1);
}

.compare-models-btn {
  display: block;
  width: 100%;
  padding: var(--space-12) var(--space-20);
  background: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  margin-top: var(--space-16);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-8);
}

.compare-models-btn svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.compare-models-btn:hover {
  background: var(--color-teal-600);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(var(--color-teal-500-rgb), 0.3);
}

/* ========== Matrix Mode Styles ========== */

.selection-matrix {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  padding: var(--space-32);
  margin-bottom: var(--space-32);
}

.matrix-step {
  margin-bottom: var(--space-32);
}

.matrix-step:last-child {
  margin-bottom: 0;
}

.matrix-step h4 {
  color: var(--color-text);
  margin-bottom: var(--space-8);
  text-align: center;
  font-size: 1.1rem;
}

.matrix-step-description {
  color: var(--color-text-muted);
  text-align: center;
  margin-bottom: var(--space-16);
  font-size: 0.95rem;
  line-height: 1.5;
}

.matrix-parameters {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-16);
}

.matrix-parameter {
  padding: var(--space-24);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  background: var(--color-surface);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  text-align: center;
  position: relative;
  display: flex;
  flex-direction: column;
  align-items: center;
}

.matrix-parameter:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.matrix-parameter:hover .matrix-parameter-icon {
  transform: scale(1.1);
  transition: transform 0.35s var(--ease-standard);
}

.matrix-parameter.selected {
  border-color: var(--color-primary);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
}

.matrix-parameter.selected::before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0 40px 40px 0;
  border-color: transparent var(--color-primary) transparent transparent;
  z-index: 1;
}

.matrix-parameter-icon {
  width: 48px;
  height: 48px;
  margin-bottom: var(--space-16);
  color: var(--pres-primary);
  flex-shrink: 0;
  transition: transform 0.35s var(--ease-standard);
}

.matrix-parameter-icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.matrix-parameter-title {
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.matrix-parameter-description {
  color: var(--color-text-secondary);
  font-size: 14px;
  line-height: 1.4;
}

/* ========== Recommendations Panel Styles ========== */

.recommendations-panel {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  padding: var(--space-32);
}

.recommendations-header {
  text-align: center;
  margin-bottom: var(--space-32);
}

.recommendations-header h3 {
  color: var(--pres-primary);
  margin-bottom: var(--space-12);
  font-size: clamp(1.25rem, 3vw, 1.5rem);
}

.recommendations-header p {
  color: var(--color-text-secondary);
  font-size: var(--font-size-base);
}

.recommended-models {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-24);
  margin-bottom: var(--space-32);
}

.recommended-model {
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-sm);
  padding: var(--space-24);
  transition: all 0.35s var(--ease-standard);
}

.recommended-model:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.recommended-model h5 {
  color: var(--color-teal-700);
  margin: 0 0 var(--space-8) 0;
  font-size: 1rem;
}

.recommended-model p {
  color: var(--color-text-secondary);
  font-size: 14px;
  line-height: 1.4;
  margin: 0 0 var(--space-12) 0;
}

.recommended-model .model-type {
  margin-bottom: var(--space-8);
}

.goto-model-btn {
  display: block;
  width: 100%;
  padding: var(--space-12) var(--space-16);
  background: var(--color-primary);
  color: white;
  border: none;
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-sm);
  font-size: var(--font-size-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  text-align: center;
}

.goto-model-btn:hover {
  background: var(--color-teal-600);
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(var(--color-teal-500-rgb), 0.3);
}

.recommendations-actions {
  display: flex;
  gap: var(--space-16);
  justify-content: center;
  flex-wrap: wrap;
}

.recommendations-actions .panel-button {
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.recommendations-actions .panel-button svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.restart-matrix-btn {
  padding: var(--space-12) var(--space-20);
  border: 1px solid var(--color-card-border);
  background: var(--color-surface);
  color: var(--color-text);
  border-radius: var(--radius-base);
  box-shadow: var(--shadow-sm);
  font-weight: var(--font-weight-medium);
  cursor: pointer;
  transition: all 0.35s var(--ease-standard);
  display: flex;
  align-items: center;
  gap: var(--space-8);
}

.restart-matrix-btn svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.restart-matrix-btn:hover {
  background: var(--color-gray-100);
  border-color: var(--color-gray-400);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* ========== Animations ========== */

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ========== Model Selector Tool Responsive & Accessibility ========== */
@media (hover: none) and (pointer: coarse) {
  .mode-tab:hover,
  .filter-btn:hover,
  .matrix-parameter:hover,
  .recommended-model:hover {
    transform: none;
  }
  
  .mode-tab:active,
  .filter-btn:active,
  .matrix-parameter:active {
    transform: scale(0.98);
  }
  
  .filter-btn,
  .reset-filters-btn,
  .clear-selection-btn {
    min-height: 44px;
  }
}

@media (prefers-reduced-motion: reduce) {
  .mode-tab,
  .filter-btn,
  .matrix-parameter,
  .recommended-model,
  .selected-model-item,
  .compare-models-btn {
    transition-duration: 0.01ms !important;
  }
  
  .selector-mode-content {
    animation: none;
  }
}

/* ========== Responsive Design ========== */

@media (min-width: 768px) and (max-width: 1023px) {
  .model-selector-tool {
    padding: var(--space-24);
  }
  
  .selector-mode-tabs {
    gap: var(--space-8);
  }
  
  .mode-tab {
    padding: var(--space-14) var(--space-20);
    font-size: var(--font-size-sm);
  }
  
  .matrix-parameters {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 767px) {
  .model-selector-tool {
    padding: var(--space-16);
  }
  
  .selector-mode-tabs {
    flex-direction: column;
    gap: var(--space-8);
  }
  
  .mode-tab {
    max-width: 100%;
    min-height: 44px;
  }
  
  .table-filters {
    flex-direction: column;
    padding: var(--space-20);
  }

  .table-filters input[type="search"] {
    min-width: auto;
    width: 100%;
  }

  .filter-group {
    justify-content: center;
    flex-wrap: wrap;
    width: 100%;
  }
  
  .filter-btn {
    flex: 1;
    min-width: 100px;
  }

  .comparison-table-wrapper {
    max-height: 400px;
  }

  .model-comparison-table {
    font-size: 12px;
  }

  .model-comparison-table thead th,
  .model-comparison-table tbody td {
    padding: var(--space-8);
  }

  .matrix-parameters {
    grid-template-columns: 1fr;
    gap: var(--space-12);
  }
  
  .matrix-parameter {
    padding: var(--space-20);
  }
  
  .matrix-parameter-icon {
    width: 40px;
    height: 40px;
  }

  .recommended-models {
    grid-template-columns: 1fr;
    gap: var(--space-16);
  }

  .recommendations-actions {
    flex-direction: column;
    width: 100%;
  }
  
  .recommendations-actions .panel-button,
  .restart-matrix-btn {
    width: 100%;
    justify-content: center;
  }
  
  .selected-models-panel {
    padding: var(--space-20);
  }
}

/* ========== Mobile Cards for Model Selector ========== */

@media (max-width: 640px) {
  /* Скрыть таблицу */
  .comparison-table-wrapper {
    display: none;
  }

  /* Показать карточную версию */
  .comparison-cards-mobile {
    display: block;
  }

  .mobile-model-card {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 8px;
    padding: var(--space-16);
    margin-bottom: var(--space-12);
  }

  .mobile-model-card h4 {
    font-size: var(--responsive-text-lg);
    margin-bottom: var(--space-8);
    color: var(--color-teal-700);
  }

  .mobile-model-card-row {
    display: flex;
    justify-content: space-between;
    padding: var(--space-8) 0;
    border-bottom: 1px solid var(--color-border);
  }

  .mobile-model-card-row:last-child {
    border-bottom: none;
  }

  .mobile-model-card-label {
    font-weight: var(--font-weight-medium);
    color: var(--color-text-secondary);
    font-size: 12px;
  }

  .mobile-model-card-value {
    font-size: 12px;
    color: var(--color-text);
    text-align: right;
  }
}

@media (min-width: 641px) and (max-width: 1024px) {
  /* Таблицы с горизонтальной прокруткой на планшетах */
  .comparison-table-wrapper {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  .model-comparison-table {
    min-width: 700px;
  }
}

/* ========== Modal Styles ========== */

.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  animation: fadeIn 0.3s ease;
}

.modal-content {
  background: var(--color-surface);
  border-radius: 12px;
  max-width: 90vw;
  max-height: 90vh;
  overflow-y: auto;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
  animation: slideDown 0.3s ease;
}

.detailed-comparison-modal {
  width: 100%;
  max-width: 1200px;
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: var(--space-20);
  border-bottom: 1px solid var(--color-border);
}

.modal-header h3 {
  margin: 0;
  color: var(--color-text);
}

.modal-close {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: var(--space-4);
  border-radius: 50%;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-red-500);
}

.modal-body {
  padding: var(--space-24);
}

.comparison-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: var(--space-20);
}

.comparison-card {
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border: 1px solid var(--color-teal-200);
  border-radius: 8px;
  padding: var(--space-16);
  transition: all 0.3s ease;
}

.comparison-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.1);
  border-color: var(--color-teal-300);
}

.comparison-card h4 {
  color: var(--color-teal-700);
  margin: 0 0 var(--space-12) 0;
  font-size: 1.2rem;
}

.model-meta {
  display: flex;
  gap: var(--space-8);
  margin-bottom: var(--space-16);
  flex-wrap: wrap;
}

.model-details p {
  margin: var(--space-6) 0;
  font-size: 14px;
  line-height: 1.4;
}

.model-details p strong {
  color: var(--color-text);
}

/* ========== Quiz Recommendations Banner ========== */

.quiz-recommendations-banner {
  background: linear-gradient(135deg, rgba(var(--color-teal-500-rgb), 0.1), rgba(var(--color-blue-500-rgb), 0.1));
  border: 1px solid var(--color-teal-300);
  border-radius: 12px;
  padding: var(--space-16);
  margin-bottom: var(--space-24);
  position: relative;
  animation: slideDown 0.3s ease;
}

.banner-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-12);
}

.banner-header h4 {
  margin: 0;
  color: var(--color-teal-700);
  font-size: 1.1rem;
}

.banner-close {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: var(--color-text-secondary);
  padding: 4px;
  border-radius: 50%;
  width: 28px;
  height: 28px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
}

.banner-close:hover {
  background: rgba(239, 68, 68, 0.1);
  color: var(--color-red-500);
}

.banner-content p {
  margin: 0 0 var(--space-12) 0;
  color: var(--color-text-secondary);
  font-size: 14px;
}

.quiz-recommended-models {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: var(--space-8);
  margin-bottom: var(--space-12);
}

.quiz-recommended-model {
  background: var(--color-surface);
  border: 1px solid var(--color-teal-200);
  border-radius: 8px;
  padding: var(--space-12);
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
}

.quiz-recommended-model:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.2);
  border-color: var(--color-teal-400);
}

.quiz-recommended-model .model-name {
  font-weight: var(--font-weight-semibold);
  color: var(--color-teal-700);
  display: block;
  margin-bottom: var(--space-4);
}

.quiz-recommended-model .model-sources {
  font-size: 12px;
  color: var(--color-text-secondary);
  background: rgba(var(--color-teal-500-rgb), 0.1);
  padding: 2px 6px;
  border-radius: 10px;
}

/* ========== Responsive Modal ========== */

@media (max-width: 768px) {
  .modal-content {
    margin: var(--space-16);
    max-width: none;
    width: calc(100vw - 32px);
  }

  .comparison-grid {
    grid-template-columns: 1fr;
  }

  .modal-header {
    padding: var(--space-16);
  }

  .modal-body {
    padding: var(--space-16);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Print Styles */
@media print {
  @page {
    size: A4 landscape;
    margin: 10mm;
    /* Попытка скрыть стандартные колонтитулы браузера */
    margin-header: 0;
    margin-footer: 0;
  }
  
  /* Скрыть URL в некоторых браузерах */
  @page :first {
    margin-top: 0;
  }
  
  .navigation,
  .slide-counter,
  .fullscreen-btn,
  .export-btn,
  .progress-bar-container {
    display: none !important;
  }
  
  html, body {
    background: white !important;
    margin: 0 !important;
    padding: 0 !important;
    width: 100% !important;
    height: auto !important;
  }
  
  .presentation {
    padding: 0 !important;
    width: 100% !important;
    height: auto !important;
    display: block !important;
  }
  
  .slide-container {
    overflow: visible !important;
    position: static !important;
    height: auto !important;
    width: 100% !important;
  }
  
  .slide {
    page-break-after: always !important;
    page-break-inside: auto !important; /* Изменено с avoid */
    display: block !important;
    position: static !important;
    opacity: 1 !important;
    width: 100% !important;
    max-width: 277mm !important;
    height: auto !important;
    max-height: none !important; /* Убрано ограничение */
    padding: 12mm !important; /* Уменьшен padding */
    margin: 0 auto !important;
    overflow: visible !important; /* Изменено с hidden */
    box-sizing: border-box !important;
  }
  
  .slide:last-child {
    page-break-after: auto !important;
  }

  /* Умное масштабирование для длинных слайдов */
  .slide.model-slide {
    transform: scale(0.95);
    transform-origin: top center;
  }

  /* Улучшенная адаптация элементов */
  .card {
    page-break-inside: avoid !important;
    margin-bottom: 8px !important;
  }

  .grid-2, .grid-3, .grid-4 {
    display: block !important;
  }

  .grid-2 > *, .grid-3 > *, .grid-4 > * {
    page-break-inside: avoid !important;
    margin-bottom: 10px !important;
  }

  /* Компактные списки */
  .slide ul, .slide ol {
    margin: 8px 0 !important;
    padding-left: 20px !important;
  }

  .slide li {
    margin-bottom: 4px !important;
  }

  /* Scale down content if needed */
  .slide-header {
    margin-bottom: 15px !important;
  }
  
  .slide-title {
    font-size: 24px !important;
    margin-bottom: 10px !important;
  }
  
  .slide-subtitle {
    font-size: 16px !important;
    margin-bottom: 15px !important;
  }
  
  .card, .grid-2, .chart-container {
    page-break-inside: avoid !important;
  }
  
  /* Adjust font sizes for better fit */
  .slide p, .slide li {
    font-size: 12px !important;
    line-height: 1.4 !important;
  }
  
  .slide h3 {
    font-size: 16px !important;
    margin-bottom: 8px !important;
  }
  
  .slide h4 {
    font-size: 14px !important;
    margin-bottom: 6px !important;
  }
  
  /* Compact spacing */
  .card {
    padding: 12px !important;
    margin-bottom: 10px !important;
  }
  
  .grid-2 {
    gap: 10px !important;
  }
  
  ul, ol {
    margin: 8px 0 !important;
    padding-left: 20px !important;
  }
  
  li {
    margin-bottom: 4px !important;
  }
}

/* Mobile Swipe Indicator */
@media (max-width: 768px) {
  .swipe-hint {
    position: fixed;
    bottom: 80px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.7);
    color: white;
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    z-index: 999;
    animation: fadeInOut 3s ease-in-out;
    pointer-events: none;
  }
  
  @keyframes fadeInOut {
    0%, 100% { opacity: 0; }
    10%, 90% { opacity: 1; }
  }
}
/* PDF Export Loading Overlay */
.pdf-loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.8);
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  color: white;
}

.pdf-loading-spinner {
  width: 50px;
  height: 50px;
  border: 5px solid rgba(255, 255, 255, 0.3);
  border-top-color: var(--color-primary);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

.pdf-loading-text {
  margin-top: 20px;
  font-size: 18px;
  font-weight: 500;
}

.pdf-loading-progress {
  margin-top: 10px;
  font-size: 14px;
  color: rgba(255, 255, 255, 0.7);
}

/* ========== Final Slide Elegant Styles ========== */

.final-slide-elegant {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 100%;
  max-width: 1000px;
  margin: 0 auto;
  padding: 80px var(--space-32);
}

.final-message {
  text-align: center;
  margin-bottom: 60px;
}

.final-main-text {
  font-size: 40px;
  font-weight: var(--font-weight-bold);
  color: var(--color-text);
  line-height: 1.3;
  margin: 0;
}

.final-linkedin-cta {
  text-align: center;
  margin-bottom: 60px;
}

.final-subtitle {
  font-size: 20px;
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-20) 0;
  font-weight: var(--font-weight-normal);
}

.linkedin-button-primary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-12);
  background: var(--color-teal-500);
  color: white;
  padding: 18px 48px;
  font-size: 20px;
  font-weight: var(--font-weight-semibold);
  border-radius: 12px;
  text-decoration: none;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(33, 128, 141, 0.3);
  min-height: 64px;
  border: none;
  cursor: pointer;
}

.linkedin-button-primary:hover {
  background: var(--color-teal-600);
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(33, 128, 141, 0.4);
}

.linkedin-button-primary svg {
  width: 20px;
  height: 20px;
  stroke-width: 2;
}

.final-author {
  font-size: 14px;
  color: rgba(100, 116, 139, 0.6);
  margin: 40px 0 0 0;
  font-weight: var(--font-weight-normal);
  letter-spacing: 0.5px;
}

.final-actions {
  display: flex;
  justify-content: center;
  gap: var(--space-16);
  padding: 0;
}

.action-secondary {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-8);
  background: transparent;
  color: var(--color-text-secondary);
  border: 1px solid var(--color-border);
  padding: 10px 20px;
  font-size: 14px;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: var(--font-weight-normal);
}

.action-secondary:hover {
  background: var(--color-surface);
  color: var(--color-text);
  border-color: var(--color-text-secondary);
}

.action-secondary svg {
  width: 16px;
  height: 16px;
  stroke-width: 2;
}

/* Адаптивность для финального слайда */
@media (max-width: 768px) {
  .final-slide-elegant {
    padding: var(--space-48) var(--space-16);
  }

  .final-message {
    margin-bottom: 40px;
  }

  .final-main-text {
    font-size: 28px;
  }

  .final-linkedin-cta {
    margin-bottom: 40px;
  }

  .final-subtitle {
    font-size: 18px;
    margin-bottom: var(--space-16);
  }

  .linkedin-button-primary {
    padding: 16px 32px;
    font-size: 18px;
    min-height: 56px;
  }

  .final-author {
    font-size: 13px;
    margin-top: var(--space-24);
  }

  .final-actions {
    flex-direction: column;
    gap: var(--space-12);
    width: 100%;
    max-width: 300px;
  }

  .action-secondary {
    width: 100%;
    padding: 12px 20px;
  }
}

/* ========== Enhanced Quiz Styles ========== */
.quiz-profile {
  padding: var(--space-20);
  background: rgba(var(--color-teal-500-rgb), 0.05);
  border-radius: var(--radius-md);
  margin-bottom: var(--space-24);
  border: 1px solid var(--color-border);
}

.quiz-profile-title {
  font-weight: var(--font-weight-semibold);
  color: var(--pres-primary);
  margin-bottom: var(--space-12);
  font-size: 16px;
}

.quiz-profile-description {
  font-size: 14px;
  line-height: 1.6;
  color: var(--color-text);
  margin-bottom: var(--space-16);
}

.quiz-recommendations {
  margin-top: var(--space-24);
}

.quiz-recommendations h5 {
  margin: 0 0 var(--space-20) 0;
  color: var(--pres-primary);
  font-size: 18px;
  font-weight: var(--font-weight-semibold);
}

.quiz-model-item {
  padding: var(--space-20);
  background: var(--color-surface);
  border-radius: var(--radius-md);
  border: 1px solid var(--color-border);
  margin-bottom: var(--space-16);
  transition: all 0.2s ease;
}

.quiz-model-item:hover {
  border-color: var(--color-primary);
  box-shadow: 0 4px 12px rgba(var(--color-teal-500-rgb), 0.1);
}

.quiz-model-header {
  display: flex;
  align-items: center;
  gap: var(--space-12);
  margin-bottom: var(--space-12);
  flex-wrap: wrap;
}

.quiz-model-number {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  background: var(--color-primary);
  color: var(--color-btn-primary-text);
  border-radius: 50%;
  font-weight: var(--font-weight-bold);
  font-size: 14px;
  flex-shrink: 0;
}

.quiz-model-name {
  flex: 1;
  font-size: 16px;
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  min-width: 0;
}

.quiz-model-match {
  font-size: 16px;
  font-weight: var(--font-weight-bold);
  color: var(--color-primary);
  white-space: nowrap;
}

.quiz-model-sources {
  font-size: 13px;
  color: var(--color-text-muted);
  line-height: 1.5;
  padding: var(--space-8) 0;
}

.quiz-profile-chart {
  margin: var(--space-24) 0;
  display: flex;
  justify-content: center;
  align-items: center;
  background: rgba(var(--color-slate-900-rgb), 0.02);
  border-radius: 8px;
  padding: var(--space-16);
}

.quiz-recommendations h5 {
  color: var(--pres-primary);
  margin-bottom: var(--space-16);
  text-align: center;
}

.quiz-model-item {
  background: var(--color-surface);
  padding: var(--space-16);
  border-radius: 8px;
  margin-bottom: var(--space-12);
  border: 1px solid var(--color-border);
  transition: border-color 0.2s ease;
}

.quiz-model-item:hover {
  border-color: var(--color-primary);
}

.quiz-model-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-8);
}

.quiz-model-number {
  background: var(--color-primary);
  color: white;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
  font-weight: bold;
}

.quiz-model-name {
  flex: 1;
  margin-left: var(--space-12);
  font-weight: var(--font-weight-medium);
  color: var(--color-text);
}

.quiz-model-match {
  background: rgba(var(--color-teal-500-rgb), 0.1);
  color: var(--color-primary);
  padding: 4px 8px;
  border-radius: 12px;
  font-weight: var(--font-weight-bold);
  font-size: 14px;
}

.quiz-model-sources {
  font-size: 12px;
  color: var(--color-text-muted);
  margin-top: var(--space-4);
}

.quiz-actions {
  display: flex;
  gap: var(--space-8);
  margin-top: var(--space-24);
  flex-wrap: wrap;
  justify-content: center;
}

.quiz-actions .panel-button {
  flex: 1;
  min-width: 140px;
}

/* Футер для печати - скрыт на экране */
.print-footer {
  display: none;
}

/* Показать футер только при печати */
@media print {
  .print-footer {
    display: block !important;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    text-align: center;
    font-size: 9pt;
    color: #555;
    padding: 8px;
    border-top: 1px solid #ccc;
    background: white;
    z-index: 9999;
  }
  
  /* Добавить отступ снизу для каждого слайда под футер */
  .slide {
    padding-bottom: 25mm !important;
  }
}

/* === СТИЛИ ДЛЯ РАЗДЕЛИТЕЛЬНЫХ СЛАЙДОВ === */

/* Основной контейнер разделителя */
.section-separator {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  min-height: 80vh;
  text-align: center;
  padding: var(--space-32);
  background: linear-gradient(135deg, var(--color-background) 0%, rgba(var(--color-teal-500-rgb), 0.05) 100%);
}

/* Героическая секция */
.separator-hero {
  margin-bottom: var(--space-48);
}

.hero-icon {
  width: 80px;
  height: 80px;
  margin: 0 auto var(--space-24);
  color: var(--color-teal-500);
  opacity: 0.8;
}

.hero-icon svg {
  width: 100%;
  height: 100%;
  fill: currentColor;
}

.separator-title {
  font-size: 3.5rem;
  font-weight: 700;
  color: var(--color-text);
  margin: var(--space-16) 0;
  line-height: 1.1;
}

.separator-subtitle {
  font-size: 1.5rem;
  color: var(--color-text-secondary);
  margin: 0;
  max-width: 600px;
  margin: 0 auto;
}

/* Обзорная секция */
.section-overview {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: var(--space-24);
  margin: var(--space-48) auto var(--space-48);
  max-width: 900px;
  width: 100%;
}

.overview-card {
  background: var(--color-surface);
  padding: var(--space-32);
  border-radius: 16px;
  border: 1px solid var(--color-card-border);
  transition: all 0.3s ease;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.overview-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.overview-icon,
.overview-card .icon {
  width: 48px;
  height: 48px;
  margin: 0 auto var(--space-16);
  color: var(--color-teal-500);
  display: flex;
  align-items: center;
  justify-content: center;
}

.overview-icon svg,
.overview-card .icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.overview-card h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
  margin: var(--space-8) 0;
}

.overview-card p {
  color: var(--color-text-secondary);
  margin: 0;
  font-size: 0.95rem;
  line-height: 1.5;
}

/* Навигационная секция */
.separator-navigation {
  max-width: 600px;
  width: 100%;
  margin-top: var(--space-32);
}

.nav-hint {
  margin-bottom: var(--space-24);
}

.nav-hint p {
  margin: var(--space-4) 0;
  color: var(--color-text-secondary);
  font-size: 0.9rem;
}

.separator-cta {
  background: var(--color-teal-500);
  color: white;
  border: none;
  padding: var(--space-16) var(--space-32);
  border-radius: 12px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  width: 100%;
  max-width: 300px;
}

.separator-cta:hover {
  background: var(--color-teal-600);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(var(--color-teal-500-rgb), 0.3);
}

.nav-actions {
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: var(--space-8);
  flex-wrap: wrap;
  justify-content: center;
}

.navigation {
  max-height: 80px;
  padding: 6px 12px;
}

/* Адаптивность для очень маленьких экранов */
@media (max-width: 640px) {
  .navigation {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
  }

  .navigation::-webkit-scrollbar {
    display: none;
  }

  .navigation {
    padding: 6px 8px;
    gap: var(--space-6);
  }

  .toolbar-btn {
    min-height: 44px; /* Минимум для комфортного тапа */
    padding: 8px 12px;
    font-size: 12px;
  }

  .slide-counter {
    font-size: 11px;
    white-space: nowrap;
  }

  /* Визуальный индикатор прокрутки */
  .navigation::after {
    content: '→';
    position: sticky;
    right: 0;
    padding: 4px 8px;
    background: linear-gradient(to left, var(--color-surface) 70%, transparent);
    color: var(--color-text-secondary);
    font-size: 16px;
    pointer-events: none;
  }

  .nav-center {
    flex-shrink: 0;
    min-width: auto;
  }

  .nav-actions-group {
    flex-shrink: 0;
  }
}

@media (max-width: 480px) {
  .navigation {
    padding: 4px 6px;
  }

  .toolbar-btn {
    padding: 6px 10px;
    font-size: 11px;
  }

  .model-selector, .path-selector {
    max-width: 120px;
    font-size: 11px;
  }
}

.nav-shortcuts {
  text-align: center;
}

.nav-shortcut-btn {
  padding: var(--space-6) var(--space-12);
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid var(--color-teal-300);
  background: var(--color-teal-50);
  color: var(--color-teal-700);
}

.nav-shortcut-btn:hover {
  background: var(--color-teal-100);
  transform: translateY(-1px);
  box-shadow: 0 3px 8px rgba(var(--color-teal-500-rgb), 0.2);
}

/* === СТИЛИ ДЛЯ РАЗДЕЛИТЕЛЯ "МОДЕЛИ УПРАВЛЕНИЯ ИЗМЕНЕНИЯМИ" === */

.models-overview {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-24);
  margin: var(--space-48) auto 60px;
  max-width: 1200px;
  width: 100%;
}

.model-category-card {
  background: var(--color-surface);
  padding: var(--space-32);
  border-radius: 16px;
  border: 1px solid var(--color-card-border);
  transition: all 0.3s ease;
  min-height: 180px;
  display: flex;
  flex-direction: column;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
}

.model-category-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.model-category-card .type-badge {
  display: inline-block;
  padding: var(--space-6) var(--space-12);
  border-radius: 20px;
  font-size: 0.8rem;
  font-weight: 600;
  margin-bottom: var(--space-12);
}

.model-category-card h4 {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
  margin: var(--space-8) 0;
}

.model-category-card p {
  color: var(--color-text-secondary);
  margin: 0;
  font-size: 0.95rem;
  line-height: 1.6;
}

.model-count {
  display: inline-block;
  background: var(--color-teal-100);
  color: var(--color-teal-700);
  padding: var(--space-4) var(--space-8);
  border-radius: 12px;
  font-size: 0.75rem;
  font-weight: 600;
  margin-top: auto;
  align-self: flex-start;
}

/* CTA контейнер и кнопка для слайда моделей */
.models-cta-container {
  max-width: 1000px;
  margin: 20px auto var(--space-48);
  width: 100%;
}

.models-cta-full {
  width: 100%;
  background: var(--color-teal-500);
  color: white;
  border: none;
  padding: var(--space-18) var(--space-32);
  font-size: 1.1rem;
  font-weight: 600;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(33, 128, 141, 0.2);
}

.models-cta-full:hover {
  background: var(--color-teal-600);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(33, 128, 141, 0.3);
}

/* Подсказка про категории */
.models-hint {
  max-width: 1000px;
  margin: var(--space-24) auto 0;
  text-align: center;
}

.models-hint p {
  color: var(--color-text-secondary);
  font-size: 0.9rem;
  margin: 0;
  line-height: 1.5;
}

/* === СТИЛИ ДЛЯ РАЗДЕЛИТЕЛЯ "ПРАКТИКА: ОЦЕНИТЕ СВОЙ ПРОЕКТ" === */

.practice-separator .section-separator {
  background: linear-gradient(135deg, var(--color-background) 0%, rgba(var(--color-orange-500-rgb), 0.05) 100%);
}

.practice-path {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: var(--space-40);
  max-width: 800px;
  width: 100%;
  position: relative;
}

.path-step {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  position: relative;
  flex: 1;
}

.path-step:not(:last-child)::after {
  content: '';
  position: absolute;
  top: 20px;
  left: 60%;
  right: -40%;
  height: 2px;
  background: linear-gradient(90deg, var(--color-teal-300), var(--color-orange-400));
  z-index: 1;
}

.path-icon {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: var(--space-12);
  position: relative;
  z-index: 2;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

.path-step:nth-child(1) .path-icon {
  background: linear-gradient(135deg, var(--color-teal-400), var(--color-teal-600));
  color: white;
}

.path-step:nth-child(2) .path-icon {
  background: linear-gradient(135deg, var(--color-orange-400), var(--color-orange-600));
  color: white;
}

.path-step:nth-child(3) .path-icon {
  background: linear-gradient(135deg, var(--color-red-400), var(--color-red-600));
  color: white;
}

.path-step:nth-child(4) .path-icon {
  background: linear-gradient(135deg, var(--color-teal-400), var(--color-teal-600));
  color: white;
}

.path-step:nth-child(5) .path-icon {
  background: linear-gradient(135deg, var(--color-brown-600), var(--color-brown-600));
  color: white;
}

.path-icon svg {
  width: 24px;
  height: 24px;
  fill: currentColor;
}

.path-label {
  font-size: 0.9rem;
  font-weight: 600;
  color: var(--color-text);
  margin-bottom: var(--space-4);
}

.path-desc {
  font-size: 0.75rem;
  color: var(--color-text-secondary);
  line-height: 1.3;
}

.practice-tools {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-24);
  margin: var(--space-48) auto var(--space-40);
  max-width: 1000px;
  width: 100%;
}

.practice-tool-card {
  display: flex;
  align-items: flex-start;
  gap: var(--space-20);
  background: var(--color-surface);
  padding: var(--space-24);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
  position: relative;
  overflow: hidden;
  text-align: left;
}

.practice-tool-card::after {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(var(--color-teal-500-rgb), 0.05), rgba(var(--color-orange-500-rgb), 0.05));
  opacity: 0;
  transition: opacity 0.35s var(--ease-standard);
  pointer-events: none;
}

.practice-tool-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.1);
  border-color: var(--color-teal-300);
}

.practice-tool-card:hover::after {
  opacity: 1;
}

.practice-tool-card-content {
  flex: 1;
  min-width: 0;
  display: flex;
  flex-direction: column;
  gap: var(--space-8);
  text-align: left;
  align-items: flex-start;
}

/* CTA карточка - выделенная зеленая кнопка */
.practice-tool-card-cta {
  display: flex;
  align-items: center;
  gap: var(--space-20);
  background: linear-gradient(135deg, var(--color-teal-500), var(--color-teal-600));
  border: 2px solid var(--color-teal-400);
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.practice-tool-card-cta::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.practice-tool-card-cta:hover::before {
  left: 100%;
}

.practice-tool-card-cta .practice-tool-card-content {
  flex: 1;
  min-width: 0;
  text-align: left;
  align-items: flex-start;
}

.practice-tool-card-cta .practice-tool-card-content h4 {
  color: white !important;
  position: relative;
  z-index: 1;
  font-size: clamp(1.125rem, 2.5vw, 1.25rem);
  font-weight: 700;
  margin-bottom: var(--space-8);
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  letter-spacing: 0.3px;
}

.practice-tool-card-cta .practice-tool-card-content p {
  color: white !important;
  position: relative;
  z-index: 1;
  text-shadow: 0 1px 4px rgba(0, 0, 0, 0.15);
  line-height: 1.6;
  margin: 0;
}

.practice-tool-card-cta .icon {
  flex-shrink: 0;
  color: white;
  position: relative;
  z-index: 1;
  width: clamp(48px, 8vw, 64px);
  height: clamp(48px, 8vw, 64px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.15);
  border-radius: var(--radius-lg);
  backdrop-filter: blur(4px);
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.25));
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.35s var(--ease-standard);
}

.practice-tool-card-cta .icon-cta svg {
  width: 32px;
  height: 32px;
  stroke: white;
  stroke-width: 2.5;
  filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.8)) drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
}

.practice-tool-card-cta:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 35px rgba(33, 128, 141, 0.4);
  border-color: var(--color-teal-300);
}

.practice-tool-card-cta:hover .icon {
  background: rgba(255, 255, 255, 0.25);
  transform: scale(1.1);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
}

.practice-tool-card-content h4 {
  font-size: clamp(1rem, 2.5vw, 1.25rem);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin: 0 0 var(--space-8) 0;
  line-height: 1.3;
  text-align: left;
}

.practice-tool-card-content p {
  font-size: clamp(0.875rem, 2vw, 1rem);
  line-height: 1.6;
  color: var(--color-text-secondary);
  margin: 0 0 var(--space-12) 0;
  text-align: left;
}

.practice-tool-card .icon {
  flex-shrink: 0;
  width: clamp(48px, 8vw, 64px);
  height: clamp(48px, 8vw, 64px);
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.15);
  color: var(--pres-primary);
  transition: all 0.35s var(--ease-standard);
}

.practice-tool-card .icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.practice-tool-card:hover .icon {
  transform: scale(1.1);
  background: rgba(var(--color-teal-500-rgb), 0.12);
  border-color: var(--color-teal-300);
  box-shadow: 0 8px 20px rgba(var(--color-teal-500-rgb), 0.2);
}

.practice-tool-card-content .tool-duration {
  display: inline-block;
  background: rgba(var(--color-orange-500-rgb), 0.1);
  color: var(--color-orange-700);
  padding: var(--space-4) var(--space-12);
  border-radius: var(--radius-base);
  font-size: clamp(0.75rem, 1.5vw, 0.875rem);
  font-weight: var(--font-weight-medium);
  align-self: flex-start;
  margin-top: auto;
}

/* === СТИЛИ ДЛЯ ИНДИКАТОРА ПУТИ ПРОЕКТА === */

.practice-path-indicator {
  background: var(--color-surface);
  border: 1px solid var(--color-card-border);
  border-radius: var(--radius-lg);
  padding: var(--space-24);
  margin-bottom: var(--space-32);
  box-shadow: var(--shadow-sm);
}

.path-indicator-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: var(--space-16);
  padding-bottom: var(--space-12);
  border-bottom: 1px solid var(--color-border);
}

.path-indicator-header h4 {
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--color-text);
  margin: 0;
}

.current-step {
  font-size: 0.85rem;
  color: var(--color-teal-600);
  font-weight: 600;
  background: var(--color-teal-50);
  padding: var(--space-4) var(--space-8);
  border-radius: 12px;
}

.path-indicator {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: var(--space-20);
  position: relative;
}

.path-step-indicator {
  display: flex;
  flex-direction: column;
  align-items: center;
  text-align: center;
  position: relative;
  opacity: 0.4;
  transition: all 0.3s ease;
  padding: var(--space-4);
  border-radius: 8px;
}

.path-step-indicator:hover {
  opacity: 0.7;
  transform: translateY(-1px);
  background: rgba(var(--color-teal-500-rgb), 0.05);
}

.path-step-indicator.active {
  opacity: 1;
}

.path-step-indicator.completed {
  opacity: 0.8;
}

.path-step-indicator.completed .step-icon {
  background: linear-gradient(135deg, var(--color-green-400), var(--color-green-600));
  border-color: var(--color-green-500);
  color: white;
}

.path-step-indicator.completed .step-label {
  color: var(--color-green-600);
}

.path-connector.completed::after {
  width: 100%;
}

.path-step-indicator .step-icon {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-bottom: var(--space-8);
  background: var(--color-gray-200);
  border: 2px solid var(--color-border);
  transition: all 0.3s ease;
}

.path-step-indicator.active .step-icon {
  background: linear-gradient(135deg, var(--color-teal-400), var(--color-teal-600));
  border-color: var(--color-teal-500);
  color: white;
}

.path-step-indicator .step-icon svg {
  width: 20px;
  height: 20px;
  fill: currentColor;
}

.path-step-indicator .step-label {
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--color-text-secondary);
  white-space: nowrap;
}

.path-step-indicator.active .step-label {
  color: var(--color-teal-600);
}

.path-connector {
  width: 40px;
  height: 2px;
  background: var(--color-border);
  margin: 0 var(--space-8);
  position: relative;
}

.path-connector::after {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  height: 100%;
  width: 0%;
  background: linear-gradient(90deg, var(--color-teal-300), var(--color-teal-600));
  transition: width 0.5s ease;
}

.path-step-indicator.active + .path-connector::after {
  width: 100%;
}

.path-navigation {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: var(--space-16);
  border-top: 1px solid var(--color-border);
}

.path-nav-btn {
  padding: var(--space-8) var(--space-16);
  border-radius: 8px;
  font-size: 0.9rem;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.3s ease;
  border: 1px solid var(--color-teal-300);
  background: var(--color-teal-50);
  color: var(--color-teal-700);
}

.path-nav-btn:hover {
  background: var(--color-teal-100);
  transform: translateY(-1px);
}

.path-nav-btn.secondary {
  border-color: var(--color-gray-300);
  background: var(--color-gray-50);
  color: var(--color-text-secondary);
}

.path-nav-btn.secondary:hover {
  background: var(--color-gray-100);
}

/* Responsive design */
@media (max-width: 1024px) and (min-width: 769px) {
  .practice-tools {
    grid-template-columns: repeat(2, 1fr);
  }
  
  .practice-tool-card {
    gap: var(--space-16);
    padding: var(--space-20);
    text-align: left;
  }
  
  .practice-tool-card-content {
    text-align: left;
    align-items: flex-start;
  }
  
  .practice-tool-card .icon {
    width: 56px;
    height: 56px;
  }

  .models-overview {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-20);
    max-width: 100%;
    padding: 0 var(--space-16);
    margin-bottom: 48px;
  }

  .model-category-card {
    padding: var(--space-24);
    min-height: 160px;
  }

  .models-cta-container {
    max-width: 100%;
    padding: 0 var(--space-16);
    margin: 20px auto var(--space-40);
  }
}

@media (max-width: 768px) {
  .section-overview,
  .practice-tools {
    grid-template-columns: 1fr;
    gap: var(--space-16);
    margin-top: var(--space-24);
  }
  
  .practice-tool-card {
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
    gap: var(--space-16);
    padding: var(--space-20);
  }
  
  .practice-tool-card-content {
    align-items: flex-start;
    text-align: left;
    width: 100%;
  }
  
  .practice-tool-card .icon {
    width: 56px;
    height: 56px;
  }
  
  .practice-tool-card-content .tool-duration {
    align-self: flex-start;
  }
  
  .practice-tool-card-cta {
    flex-direction: column;
    align-items: flex-start;
    text-align: left;
    gap: var(--space-16);
  }
  
  .practice-tool-card-cta .icon {
    width: 56px;
    height: 56px;
  }
  
  .practice-tool-card-cta .practice-tool-card-content {
    align-items: flex-start;
    text-align: left;
  }

  .models-overview {
    grid-template-columns: 1fr;
    gap: var(--space-16);
    margin-top: var(--space-24);
    margin-bottom: 40px;
    max-width: 100%;
    padding: 0 var(--space-16);
  }

  .model-category-card {
    padding: var(--space-20);
    min-height: auto;
  }

  .model-category-card h4 {
    font-size: 1.1rem;
  }

  .model-category-card p {
    font-size: 0.9rem;
  }

  .models-cta-container {
    max-width: 100%;
    padding: 0 var(--space-16);
    margin: 20px auto var(--space-32);
  }

  .models-hint {
    margin-top: var(--space-20);
  }

  .models-cta-full {
    padding: var(--space-16) var(--space-24);
    font-size: 1rem;
  }

  .models-hint {
    max-width: 100%;
    padding: 0 var(--space-16);
  }

  .models-hint p {
    font-size: 0.85rem;
  }

  .practice-tool-card-cta .icon {
    width: 56px;
    height: 56px;
  }

  .practice-tool-card-cta .icon-cta svg {
    width: 28px;
    height: 28px;
  }

  .practice-tool-card-cta .practice-tool-card-content h4 {
    font-size: 1.1rem;
    margin-bottom: var(--space-8);
    color: white !important;
  }

  .practice-tool-card-cta .practice-tool-card-content p {
    font-size: 0.9rem;
    color: white !important;
  }

  .separator-title {
    font-size: 2.5rem;
  }
}

/* Адаптивность для practice-tool-card - touch устройства */
@media (hover: none) and (pointer: coarse) {
  .practice-tool-card:hover {
    transform: none;
  }
  
  .practice-tool-card:active {
    transform: scale(0.98);
  }
  
  .practice-tool-card:hover .icon {
    transform: none;
  }
  
  .practice-tool-card:active .icon {
    transform: scale(0.95);
  }
  
  .practice-tool-card-cta:hover {
    transform: none;
  }
  
  .practice-tool-card-cta:active {
    transform: scale(0.98);
  }
  
  .practice-tool-card-cta:hover .icon {
    transform: none;
  }
  
  .practice-tool-card-cta:active .icon {
    transform: scale(0.95);
  }
}

/* === СТИЛИ ДЛЯ СЛАЙДА "ВЫБЕРИТЕ ТО, ЧТО ПОЛЕЗНО ДЛЯ ВАС" === */

.useful-options-container {
  width: 100%;
  max-width: 1400px;
  margin: 0 auto;
  padding: var(--space-32) var(--space-24);
}

.useful-options-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: var(--space-24);
  width: 100%;
}

.useful-option-card {
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  gap: var(--space-20);
  background: var(--color-surface);
  padding: var(--space-32);
  border-radius: var(--radius-lg);
  border: 1px solid var(--color-card-border);
  box-shadow: var(--shadow-sm);
  transition: all 0.35s var(--ease-standard);
  cursor: pointer;
  position: relative;
  overflow: visible;
  text-align: left;
}

.useful-option-card::before {
  content: "";
  position: absolute;
  inset: 0;
  background: linear-gradient(135deg, rgba(var(--color-teal-500-rgb), 0.03), rgba(var(--color-orange-500-rgb), 0.03));
  opacity: 0;
  transition: opacity 0.35s var(--ease-standard);
  pointer-events: none;
}

.useful-option-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
  border-color: var(--color-teal-300);
}

.useful-option-card:hover::before {
  opacity: 1;
}

.useful-option-icon {
  flex-shrink: 0;
  width: 64px;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(var(--color-teal-500-rgb), 0.08);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(var(--color-teal-500-rgb), 0.15);
  color: var(--color-primary);
  transition: all 0.35s var(--ease-standard);
}

.useful-option-icon svg {
  width: 32px;
  height: 32px;
  stroke-width: 2;
}

.useful-option-card:hover .useful-option-icon {
  transform: scale(1.1);
  background: rgba(var(--color-teal-500-rgb), 0.12);
  border-color: var(--color-teal-300);
  box-shadow: 0 8px 20px rgba(var(--color-teal-500-rgb), 0.2);
}

.useful-option-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: var(--space-12);
  width: 100%;
}

.useful-option-content h3 {
  font-size: clamp(1.25rem, 3vw, 1.5rem);
  font-weight: var(--font-weight-semibold);
  color: var(--color-text);
  margin: 0;
  line-height: 1.3;
  text-align: left;
}

.useful-option-content p {
  font-size: clamp(0.9375rem, 2vw, 1.0625rem);
  line-height: 1.6;
  color: var(--color-text-secondary);
  margin: 0;
  text-align: left;
}

/* Индикатор touch/click для кликабельных карточек */
.useful-option-touch-indicator {
  position: absolute;
  top: var(--space-16);
  right: var(--space-16);
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(var(--color-teal-500-rgb), 0.1);
  border: 1.5px solid rgba(var(--color-teal-500-rgb), 0.3);
  border-radius: 50%;
  color: var(--color-primary);
  opacity: 0.7;
  transition: all 0.3s var(--ease-standard);
  pointer-events: none;
  z-index: 1;
}

.useful-option-touch-indicator svg {
  width: 18px;
  height: 18px;
  stroke-width: 2;
}

.useful-option-card:hover .useful-option-touch-indicator {
  opacity: 1;
  background: rgba(var(--color-teal-500-rgb), 0.15);
  border-color: var(--color-teal-400);
  transform: scale(1.1);
}

/* Адаптивность для useful-options-grid */
@media (max-width: 768px) {
  .useful-options-container {
    padding: var(--space-24) var(--space-16);
  }

  .useful-options-grid {
    grid-template-columns: 1fr;
    gap: var(--space-20);
  }

  .useful-option-card {
    padding: var(--space-24);
    gap: var(--space-16);
  }

  .useful-option-icon {
    width: 56px;
    height: 56px;
  }

  .useful-option-icon svg {
    width: 28px;
    height: 28px;
  }
}

@media (max-width: 480px) {
  .useful-options-container {
    padding: var(--space-20) var(--space-12);
  }

  .useful-option-card {
    padding: var(--space-20);
    gap: var(--space-12);
  }

  .useful-option-icon {
    width: 48px;
    height: 48px;
  }

  .useful-option-icon svg {
    width: 24px;
    height: 24px;
  }

  .useful-option-touch-indicator {
    width: 28px;
    height: 28px;
    top: var(--space-12);
    right: var(--space-12);
  }

  .useful-option-touch-indicator svg {
    width: 16px;
    height: 16px;
  }
}

/* Touch устройства */
@media (hover: none) and (pointer: coarse) {
  .useful-option-card:hover {
    transform: none;
  }

  .useful-option-card:active {
    transform: scale(0.98);
  }

  .useful-option-card:hover .useful-option-icon {
    transform: none;
  }

  .useful-option-card:active .useful-option-icon {
    transform: scale(0.95);
  }
}

/* Уважение настроек пользователя */
@media (prefers-reduced-motion: reduce) {
  .useful-option-card,
  .useful-option-icon {
    transition-duration: 0.01ms !important;
  }
}

/* Уважение настроек пользователя для practice-tool-card */
@media (prefers-reduced-motion: reduce) {
  .practice-tool-card,
  .practice-tool-card .icon,
  .practice-tool-card-cta,
  .practice-tool-card-cta .icon {
    transition-duration: 0.01ms !important;
  }

  .separator-subtitle {
    font-size: 1.2rem;
  }

  .practice-path {
    flex-direction: column;
    gap: var(--space-16);
  }

  .path-step:not(:last-child)::after {
    display: none;
  }

  .path-indicator {
    flex-direction: column;
    gap: var(--space-12);
  }

  .path-connector {
    width: 2px;
    height: 20px;
    margin: var(--space-8) 0;
  }

  .path-step-indicator {
    flex-direction: row;
    width: 100%;
    justify-content: flex-start;
  }

  .path-step-indicator .step-icon {
    margin-bottom: 0;
    margin-right: var(--space-12);
  }

  .path-step-indicator .step-label {
    text-align: left;
  }

  .path-navigation {
    flex-direction: column;
    gap: var(--space-8);
  }

  .path-nav-btn {
    width: 100%;
  }
}

/* === СТИЛИ ДЛЯ СЛАЙДА "ПРАКТИЧЕСКИЕ ИНСТРУМЕНТЫ" === */

/* Современный контейнер инструментов */
.tools-slide-modern {
  display: flex;
  flex-direction: column;
  gap: var(--space-48);
  padding: var(--space-48) var(--space-64);
  max-width: 1200px;
  margin: 0 auto;
  min-height: 85vh;
  justify-content: center;
  text-align: left;
}

/* Заголовочная секция */
.tools-header {
  margin-bottom: var(--space-32);
}

.tools-header-content {
  max-width: 600px;
}

.tools-badge {
  display: inline-block;
  padding: var(--space-8) var(--space-16);
  background: rgba(var(--color-teal-500-rgb), 0.1);
  color: var(--color-teal-600);
  border-radius: 20px;
  font-size: 0.875rem;
  font-weight: 600;
  margin-bottom: var(--space-16);
}

.tools-title {
  font-size: clamp(2rem, 4vw, 3rem);
  font-weight: 700;
  color: var(--color-text);
  margin: 0 0 var(--space-16) 0;
  line-height: 1.2;
}

.tools-description {
  font-size: 1.125rem;
  color: var(--color-text-secondary);
  line-height: 1.6;
  margin: 0;
}

/* Сетка карточек 3x2 */
.tools-grid-3x2 {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: var(--space-24);
  max-width: 1200px;
  margin: 0 auto;
  width: 100%;
}

.tools-grid-3x2 .card {
  min-height: 180px;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Содержимое карточки инструмента */
.tool-card-content {
  display: flex;
  flex-direction: column;
  gap: var(--space-16);
  text-align: center;
  align-items: center;
}

.tool-card-content .tool-icon {
  width: 48px;
  height: 48px;
  color: var(--color-teal-500);
  display: flex;
  align-items: center;
  justify-content: center;
}

.tool-card-content .tool-icon svg {
  width: 100%;
  height: 100%;
  stroke-width: 2;
}

.tool-card-content h3 {
  font-size: 1.25rem;
  font-weight: 600;
  color: var(--color-text);
  margin: 0;
  line-height: 1.3;
}

.tool-time {
  display: inline-block;
  padding: var(--space-4) var(--space-12);
  background: rgba(var(--color-teal-500-rgb), 0.1);
  color: var(--color-teal-600);
  border-radius: 12px;
  font-size: 0.875rem;
  font-weight: 500;
  margin-top: var(--space-8);
}

/* CTA карточка для слайда инструментов */
.tool-card-cta {
  background: linear-gradient(135deg, var(--color-teal-500), var(--color-teal-600)) !important;
  border: 2px solid var(--color-teal-400) !important;
  cursor: pointer;
  position: relative;
  overflow: hidden;
}

.tool-card-cta::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
  transition: left 0.5s ease;
}

.tool-card-cta:hover::before {
  left: 100%;
}

.tool-card-cta .tool-card-content h3 {
  color: white !important;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
}

.tool-card-cta .tool-icon {
  color: white !important;
  width: 64px;
  height: 64px;
  background: rgba(255, 255, 255, 0.15);
  border-radius: 50%;
  backdrop-filter: blur(4px);
  filter: drop-shadow(0 4px 12px rgba(0, 0, 0, 0.25));
}

.tool-card-cta .icon-cta svg {
  width: 32px;
  height: 32px;
  stroke: white;
  stroke-width: 2.5;
  filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.8)) drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
}

.tool-card-cta:hover {
  transform: translateY(-6px);
  box-shadow: 0 12px 35px rgba(33, 128, 141, 0.4);
  border-color: var(--color-teal-300);
}

.tool-card-cta:hover .tool-icon {
  background: rgba(255, 255, 255, 0.25);
  transform: scale(1.1);
  transition: all 0.3s ease;
}

/* Адаптивность */
@media (max-width: 1024px) and (min-width: 769px) {
  .tools-grid-3x2 {
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-20);
  }
}

@media (max-width: 768px) {
  .tools-slide-modern {
    padding: var(--responsive-padding-lg);
    gap: var(--space-32);
  }

  .tools-grid-3x2 {
    grid-template-columns: 1fr;
    gap: var(--responsive-gap-md);
  }

  .tool-card-cta .tool-icon {
    width: 56px;
    height: 56px;
  }

  .tool-card-cta .icon-cta svg {
    width: 28px;
    height: 28px;
  }

  .tool-card-cta .tool-card-content h3 {
    font-size: 1.1rem;
  }

  .tools-title {
    font-size: clamp(1.75rem, 6vw, 2.5rem);
  }

  .tools-description {
    font-size: 1rem;
  }

  .tool-card-content h3 {
    font-size: 1.125rem;
  }

  .tool-card-content .tool-icon {
    width: 40px;
    height: 40px;
  }

  .tools-grid-3x2 .card {
    min-height: auto;
  }
}

@media (max-width: 640px) {
  .tools-slide-modern {
    padding: var(--responsive-padding);
    gap: var(--space-24);
  }

  .tools-header-content {
    max-width: 100%;
  }

  .tools-badge {
    font-size: 0.8125rem;
    padding: var(--space-6) var(--space-12);
  }
}
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- Progress Bar -->
    <div class="progress-bar-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- Circular Progress Indicator -->
    <div class="circular-progress" id="progressIndicator">
        <svg viewBox="0 0 60 60" aria-hidden="true">
            <circle class="progress-track" cx="30" cy="30" r="25"></circle>
            <circle class="progress-circle" id="progressCircle" cx="30" cy="30" r="25"></circle>
        </svg>
        <span class="progress-count" id="progressCount">1 / --</span>
    </div>
    
    <!-- Control Buttons -->
    <button class="export-btn" onclick="exportToPDF()" title="Экспорт в PDF (все слайды)">📄 PDF</button>
    <button class="fullscreen-btn" onclick="toggleFullscreen()" title="Полноэкранный режим">⛶</button>
    
    <div class="presentation">
        <div class="slide-container" id="slideContainer">
            <!-- Slides will be dynamically generated -->
        </div>
        
        <div class="navigation">
            <div class="nav-buttons">
                <button class="btn btn-secondary" id="prevBtn" onclick="changeSlide(-1)">← Назад</button>
                <button class="btn" id="nextBtn" onclick="changeSlide(1)">Далее →</button>
            </div>
            
            <div class="nav-center">
                <div class="slide-counter" id="slideCounter">1 / --</div>
                <select class="model-selector" id="modelSelector" onchange="jumpToSlide(this.value)">
                    <option value="">Перейти к слайду...</option>
                </select>
                <select class="path-selector" id="pathSelector" title="Выберите глубину погружения">
                    <option value="quick">Быстрый</option>
                    <option value="standard">Стандартный</option>
                    <option value="expert" selected>Экспертный</option>
                </select>
                <div class="path-meta" id="pathMeta">Экспертный путь • все слайды</div>
            </div>

            <div class="nav-actions">
                <div class="search-container" id="searchContainer">
                    <input type="search" id="searchInput" placeholder="Поиск по слайдам (Ctrl+K)" autocomplete="off" aria-label="Поиск по слайдам">
                    <ul class="search-results" id="searchResults"></ul>
                </div>
                <div class="nav-actions-group">
                    <button class="toolbar-btn" id="bookmarkToggle" type="button" title="Добавить текущий слайд в избранное">☆ Избранное</button>
                    <button class="toolbar-btn" id="bookmarkPanelToggle" type="button" title="Открыть список избранных слайдов">Список ⭐</button>
                    <button class="toolbar-btn" id="historyToggle" type="button" title="История просмотра">🕘 История</button>
                    <button class="toolbar-btn" id="notesToggle" type="button" title="Открыть заметки по слайду">📝 Заметки</button>
                    <button class="toolbar-btn" id="themeToggle" type="button" title="Переключить тему">🌞 Тема</button>
                    <a class="toolbar-btn linkedin-link" href="https://www.linkedin.com/in/dmitry-vladimirov-cdto" target="_blank" rel="noopener noreferrer" title="Мой профиль LinkedIn">in LinkedIn</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Панель избранного -->
    <div class="bookmark-panel" id="bookmarkPanel">
        <div class="panel-header">
            <h4>Избранные слайды</h4>
            <button class="panel-close" id="bookmarkPanelClose" aria-label="Закрыть список избранных">×</button>
        </div>
        <div class="bookmark-empty" id="bookmarkEmpty">Пока нет избранных. Добавьте слайды, которые хотите быстро находить.</div>
        <ul class="bookmark-list" id="bookmarkList"></ul>
    </div>

    <!-- Панель заметок -->
    <div class="notes-panel" id="notesPanel">
        <div class="panel-header">
            <h4>Заметки по слайду</h4>
            <button class="panel-close" id="notesClose" aria-label="Скрыть панель заметок">×</button>
        </div>
        <textarea id="notesTextarea" placeholder="Запишите ключевые инсайты, идеи или договоренности по текущему слайду..."></textarea>
        <div class="notes-footer">
            <span class="notes-status" id="notesStatus">Изменения не сохранены</span>
            <div class="notes-actions">
                <button class="panel-button" id="notesClear">Очистить</button>
            </div>
        </div>
    </div>

    <!-- Панель истории -->
    <div class="history-panel" id="historyPanel">
        <div class="panel-header">
            <h4>История просмотра</h4>
            <button class="panel-close" id="historyClose" aria-label="Закрыть историю">×</button>
        </div>
        <div class="history-empty" id="historyEmpty">Просмотрите несколько слайдов — и они появятся здесь для быстрого возврата.</div>
        <ul class="history-list" id="historyList"></ul>
    </div>

    <!-- Модальное окно достижений -->
    <div class="achievement-modal" id="achievementModal" aria-live="polite">
        <div class="achievement-content">
            <div class="achievement-icon">🏆</div>
            <h3 id="achievementTitle">Отличная работа!</h3>
            <p id="achievementMessage">Вы прошли 10 слайдов и открыли новое достижение.</p>
            <button class="panel-button achievement-close" id="achievementClose">Продолжить</button>
        </div>
    </div>

    <!-- Футер для печати -->
    <div class="print-footer">
        Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto
    </div>

    <script>
        let currentSlide = 0;
        let totalSlides = 0;
        let fullSlidesCount = 0;
        let visibleSlides = [];
        let visibleSlidesSet = new Set();
        let activeLearningPath = 'expert';
        let baseSlidesCount = 0;
        let classicalStartIndex = 0;
        let newModelsStartIndex = 0;
        let closingSlidesStartIndex = 0;
        let closingSlidesCount = 0;
        let quizCompleted = false;
        const slidesVisited = new Set([0]);
        const startTime = Date.now();
        let modelsChartInstance = null;
        let modelsChartSlideIndex = -1;
        let finalSlideIndex = -1;
        const searchIndex = [];
        let searchResults = [];
        let searchTerms = [];
        let activeSearchResultIndex = -1;
        let currentSearchTerm = '';
        const historyItems = [];
        const HISTORY_LIMIT = 12;
        const THEME_STORAGE_KEY = 'change_presentation_theme';
        const themeOrder = ['auto', 'dark', 'light'];
        let currentTheme = localStorage.getItem(THEME_STORAGE_KEY) || 'auto';

        // initializeTheme(); // ПЕРЕНЕСЕНО в конец инициализации после объявления всех переменных
        
        const PROGRESS_CIRCUMFERENCE = 2 * Math.PI * 25;
        
        // ===== ФУНКЦИИ НАВИГАЦИИ (перемещены в начало для доступности из HTML) =====
        
        // Функция для отображения сообщений об ошибках пользователю
        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: var(--color-error, #dc3545);
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                max-width: 400px;
                font-family: var(--font-family-base);
            `;
            errorDiv.innerHTML = `<strong>Ошибка:</strong> ${message}`;
            document.body.appendChild(errorDiv);

            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }

        window.changeSlide = function(direction) {
            const slides = document.querySelectorAll('.slide');
            if (slides.length === 0) {
                console.warn('Слайды ещё не созданы, changeSlide отменён');
                return;
            }
            if (!slides[currentSlide]) {
                console.error('Текущий слайд не найден:', currentSlide);
                return;
            }
            
            slides[currentSlide].classList.remove('active');
            const nextSlide = findNextVisibleSlide(currentSlide, direction);
            currentSlide = nextSlide;
            
            if (slides[currentSlide]) {
                slides[currentSlide].classList.add('active');
                slides[currentSlide].scrollTop = 0;
            }
            updateNavigation();
        }
        
        function jumpToSlide(index) {
            if (index === '') return;
            const slideIndex = parseInt(index, 10);
            if (Number.isNaN(slideIndex)) return;
            if (slideIndex >= 0 && slideIndex < fullSlidesCount) {
                // Переключаемся на экспертный путь только если текущий путь не экспертный
                // и если целевой слайд недоступен в текущем пути
                if (activeLearningPath !== 'expert' && !visibleSlidesSet.has(slideIndex)) {
                    setLearningPath('expert');
                }

                const slides = document.querySelectorAll('.slide');
                if (slides[currentSlide]) {
                    slides[currentSlide].classList.remove('active');
                }
                currentSlide = slideIndex;
                if (slides[currentSlide]) {
                    slides[currentSlide].classList.add('active');
                    slides[currentSlide].scrollTop = 0;
                }
                updateNavigation();
            }
        }
        
        function activateSlide(index) {
            const slides = document.querySelectorAll('.slide');
            if (slides.length === 0) {
                console.warn('Слайды ещё не созданы');
                return;
            }
            
            // Убрать active со всех слайдов
            slides.forEach(slide => slide.classList.remove('active'));
            
            // Добавить active к текущему слайду
            if (slides[index]) {
                slides[index].classList.add('active');
                slides[index].scrollTop = 0;
                console.log('Активирован слайд:', index);
            } else {
                console.error('Слайд с индексом', index, 'не найден. Всего слайдов:', slides.length);
            }
        }
        
        function updateNavigation() {
            const position = getVisiblePosition(currentSlide);
            const totalVisible = visibleSlides.length || 1;
            
            if (slideCounterEl) {
                slideCounterEl.textContent = `${position + 1} / ${totalVisible}`;
            }
            if (prevBtnEl) {
                prevBtnEl.disabled = position <= 0;
            }
            if (nextBtnEl) {
                nextBtnEl.disabled = position >= totalVisible - 1;
            }
            if (modelSelectorEl) {
                modelSelectorEl.value = visibleSlidesSet.has(currentSlide) ? String(currentSlide) : '';
            }
            
            const progressRatio = totalVisible > 1 && position >= 0 ? position / (totalVisible - 1) : 1;
            if (progressBarEl) {
                progressBarEl.style.width = `${Math.min(Math.max(progressRatio * 100, 0), 100)}%`;
            }
            updateCircularProgress(progressRatio);
            slidesVisited.add(currentSlide);
            updateHistory(currentSlide);
            updateBookmarkUI();
            highlightActiveBookmark();
            syncNotesPanel();
            clearSearchHighlight();
            if (currentSearchTerm && searchTerms.length) {
                applySearchHighlight();
            }
            checkAchievements(currentSlide);
            if (modelsChartSlideIndex === currentSlide) {
                renderModelsBubbleChart();
            }
            if (currentSlide === finalSlideIndex) {
                updateFinalStats();
            }
            
            // Инициализация FAQ для слайда 69
            const faqSlideIndex = slidesData.findIndex(slide => slide.title && (slide.title.includes('FAQ') || slide.title.includes('Ключевые вопросы')));
            if (faqSlideIndex >= 0 && currentSlide === faqSlideIndex) {
                setTimeout(() => {
                    if (typeof initFAQ === 'function') {
                        initFAQ();
                    }
                }, 100);
            }
            
            activateSlide(currentSlide);
        }
        
        // ===== КОНЕЦ ФУНКЦИЙ НАВИГАЦИИ =====
        
        const progressBarEl = document.getElementById('progressBar');
        const progressCircleEl = document.getElementById('progressCircle');
        const progressCountEl = document.getElementById('progressCount');
        const slideCounterEl = document.getElementById('slideCounter');
        const prevBtnEl = document.getElementById('prevBtn');
        const nextBtnEl = document.getElementById('nextBtn');
        const modelSelectorEl = document.getElementById('modelSelector');
        const bookmarkToggleBtn = document.getElementById('bookmarkToggle');
        const bookmarkPanelToggleBtn = document.getElementById('bookmarkPanelToggle');
        const bookmarkPanelEl = document.getElementById('bookmarkPanel');
        const bookmarkPanelCloseBtn = document.getElementById('bookmarkPanelClose');
        const bookmarkListEl = document.getElementById('bookmarkList');
        const bookmarkEmptyEl = document.getElementById('bookmarkEmpty');
        const pathSelectorEl = document.getElementById('pathSelector');
        const pathMetaEl = document.getElementById('pathMeta');
        const notesToggleBtn = document.getElementById('notesToggle');
        const notesPanelEl = document.getElementById('notesPanel');
        const notesCloseBtn = document.getElementById('notesClose');
        const notesTextareaEl = document.getElementById('notesTextarea');
        const notesClearBtn = document.getElementById('notesClear');
        const notesStatusEl = document.getElementById('notesStatus');
        const achievementModalEl = document.getElementById('achievementModal');
        const achievementTitleEl = document.getElementById('achievementTitle');
        const achievementMessageEl = document.getElementById('achievementMessage');
        const achievementCloseBtn = document.getElementById('achievementClose');
        const searchInputEl = document.getElementById('searchInput');
        const searchResultsEl = document.getElementById('searchResults');
        const historyPanelEl = document.getElementById('historyPanel');
        const historyCloseBtn = document.getElementById('historyClose');
        const historyListEl = document.getElementById('historyList');
        const historyEmptyEl = document.getElementById('historyEmpty');
        const historyToggleBtn = document.getElementById('historyToggle');
        const themeToggleBtn = document.getElementById('themeToggle');
        const searchContainerEl = document.getElementById('searchContainer');
        
        if (progressCircleEl) {
            progressCircleEl.style.strokeDasharray = PROGRESS_CIRCUMFERENCE;
            progressCircleEl.style.strokeDashoffset = PROGRESS_CIRCUMFERENCE;
        }
        
        const BOOKMARK_STORAGE_KEY = 'change_presentation_bookmarks_v1';
        const NOTES_STORAGE_KEY = 'change_presentation_notes_v1';
        const ACHIEVEMENT_STORAGE_KEY = 'change_presentation_achievements_v2';
        
        const achievementThresholds = [
            {
                id: 'slide-10-complete',
                slidesCount: 10,
                title: '10 слайдов позади!',
                message: 'Отличный старт! Вы уже прошли 10 разных слайдов и готовы к углублению.'
            },
            {
                id: 'slide-25-complete',
                slidesCount: 25,
                title: 'Четверть пути!',
                message: 'Вы просмотрели 25 слайдов! Сделайте паузу на чашку кофе ☕ и продолжайте!'
            },
            {
                id: 'slide-50-complete',
                slidesCount: 50,
                title: '50 слайдов — вы эксперт!',
                message: 'Вы просмотрели 50 уникальных слайдов. Впечатляющий прогресс!'
            },
            {
                id: 'slide-final',
                slidesCount: null,
                title: 'Полное прохождение!',
                message: 'Вы просмотрели все слайды презентации и знакомы с 56 моделями управления изменениями!'
            }
        ];

        const quizSteps = [
            {
                id: 'scope',
                question: 'Каков масштаб предстоящих изменений?',
                options: [
                    { value: 'small', label: 'Локальные (команда/процесс)', hint: 'Пилоты, Kaizen, быстрая адаптация' },
                    { value: 'medium', label: 'Кросс-функциональные (департамент)', hint: 'Нужно синхронизировать несколько команд' },
                    { value: 'large', label: 'Вся организация или холдинг', hint: 'Комплексная трансформация с множеством стейкхолдеров' }
                ]
            },
            {
                id: 'resistance',
                question: 'Какой уровень сопротивления вы ожидаете?',
                options: [
                    { value: 'low', label: 'Низкий — люди ждут изменений', hint: 'Достаточно хорошей коммуникации и обучения' },
                    { value: 'mixed', label: 'Смешанный — есть энтузиазм и сомнения', hint: 'Нужно сочетать эмпатию и быстрые победы' },
                    { value: 'high', label: 'Высокий — серьёзные опасения и недоверие', hint: 'Требуется психологическая работа и спонсорство' }
                ]
            },
            {
                id: 'pace',
                question: 'Какой темп внедрения необходим?',
                options: [
                    { value: 'rapid', label: 'Очень быстрый', hint: 'Рынок или руководство требует быстрых результатов' },
                    { value: 'iterative', label: 'Итеративный', hint: 'Нужны волны внедрения и постоянная обратная связь' },
                    { value: 'strategic', label: 'Пошагово и стратегически', hint: 'Важно соотнести изменения с архитектурой организации' }
                ]
            },
            {
                id: 'culture',
                question: 'Как бы вы описали культуру вашей организации?',
                options: [
                    { value: 'conservative', label: 'Консервативная', hint: 'Стабильность, традиции, проверенные методы' },
                    { value: 'hybrid', label: 'Гибридная', hint: 'Сочетание традиций и инноваций' },
                    { value: 'innovative', label: 'Инновационная', hint: 'Готовность к рискам, экспериментам' }
                ]
            },
            {
                id: 'resources',
                question: 'Как бы вы оценили доступные ресурсы?',
                options: [
                    { value: 'limited', label: 'Ограничены', hint: 'Недостаточно бюджета и времени' },
                    { value: 'adequate', label: 'Достаточно', hint: 'Есть необходимые ресурсы для реализации' },
                    { value: 'abundant', label: 'Избыточны', hint: 'Много ресурсов, можно экспериментировать' }
                ]
            }
        ];

        const quizScopeMap = {
            small: {
                title: 'Локальные изменения',
                description: 'Используйте короткие циклы экспериментов и микровлияние на поведение.',
                recommendations: [
                    { label: 'PDCA Цикл', keyword: 'pdca', baseMatch: 90 },
                    { label: 'Теория подталкивания', keyword: 'подталкивания', baseMatch: 85 },
                    { label: 'R2P2', keyword: 'r2p2', baseMatch: 80 }
                ]
            },
            medium: {
                title: 'Кросс-функциональные изменения',
                description: 'Согласуйте несколько команд и обеспечьте поддержку спонсоров.',
                recommendations: [
                    { label: 'АДКАР', keyword: 'адкар', baseMatch: 88 },
                    { label: 'Модель Коттера', keyword: 'коттер', baseMatch: 85 },
                    { label: 'Модель Сатир', keyword: 'сатир', baseMatch: 82 }
                ]
            },
            large: {
                title: 'Организационная трансформация',
                description: 'Комплексная трансформация требует структурированного подхода и управления сопротивлением.',
                recommendations: [
                    { label: 'Гибридная модель', keyword: 'гибридная', baseMatch: 90 },
                    { label: 'Маур 3 уровня', keyword: 'маур', baseMatch: 87 },
                    { label: 'Стандарт ACMP', keyword: 'acmp', baseMatch: 85 }
                ]
            }
        };

        const quizResistanceMap = {
            low: {
                title: 'Низкое сопротивление',
                description: 'Фокус на коммуникации и вовлечении.',
                recommendations: [
                    { label: 'Теория подталкивания', keyword: 'подталкивания', baseMatch: 88 },
                    { label: 'PDCA Цикл', keyword: 'pdca', baseMatch: 85 },
                    { label: 'R2P2', keyword: 'r2p2', baseMatch: 80 }
                ]
            },
            mixed: {
                title: 'Смешанное сопротивление',
                description: 'Комбинация эмпатии, обучения и быстрого получения результатов.',
                recommendations: [
                    { label: 'АДКАР', keyword: 'адкар', baseMatch: 90 },
                    { label: 'Модель Коттера', keyword: 'коттер', baseMatch: 87 },
                    { label: 'Модель Сатир', keyword: 'сатир', baseMatch: 85 }
                ]
            },
            high: {
                title: 'Высокое сопротивление',
                description: 'Необходимы глубокая работа с сопротивлением и спонсорство.',
                recommendations: [
                    { label: 'Маур 3 уровня', keyword: 'маур', baseMatch: 92 },
                    { label: 'Гибридная модель', keyword: 'гибридная', baseMatch: 88 },
                    { label: 'Стандарт ACMP', keyword: 'acmp', baseMatch: 85 }
                ]
            }
        };

        const quizPaceMap = {
            rapid: {
                title: 'Быстрое внедрение',
                description: 'Акцент на скорость и быстрые результаты.',
                recommendations: [
                    { label: 'PDCA Цикл', keyword: 'pdca', baseMatch: 90 },
                    { label: 'Теория подталкивания', keyword: 'подталкивания', baseMatch: 85 },
                    { label: 'Гибридная модель', keyword: 'гибридная', baseMatch: 80 }
                ]
            },
            iterative: {
                title: 'Итеративное внедрение',
                description: 'Постоянная обратная связь и корректировка.',
                recommendations: [
                    { label: 'АДКАР', keyword: 'адкар', baseMatch: 88 },
                    { label: 'PDCA Цикл', keyword: 'pdca', baseMatch: 85 },
                    { label: 'R2P2', keyword: 'r2p2', baseMatch: 82 }
                ]
            },
            strategic: {
                title: 'Стратегическое внедрение',
                description: 'Глубокая интеграция с архитектурой организации.',
                recommendations: [
                    { label: 'Модель Коттера', keyword: 'коттер', baseMatch: 90 },
                    { label: 'Стандарт ACMP', keyword: 'acmp', baseMatch: 87 },
                    { label: 'Маур 3 уровня', keyword: 'маур', baseMatch: 85 }
                ]
            }
        };

        const quizCultureMap = {
            conservative: {
                title: 'Консервативная культура',
                description: 'Подходят проверенные и структурированные методы.',
                recommendations: [
                    { label: 'Модель Коттера', keyword: 'коттер', baseMatch: 90 },
                    { label: 'Стандарт ACMP', keyword: 'acmp', baseMatch: 88 },
                    { label: 'АДКАР', keyword: 'адкар', baseMatch: 85 }
                ]
            },
            hybrid: {
                title: 'Гибридная культура',
                description: 'Комбинация проверенных методов и инноваций.',
                recommendations: [
                    { label: 'Гибридная модель', keyword: 'гибридная', baseMatch: 90 },
                    { label: 'Модель Сатир', keyword: 'сатир', baseMatch: 87 },
                    { label: 'PDCA Цикл', keyword: 'pdca', baseMatch: 85 }
                ]
            },
            innovative: {
                title: 'Инновационная культура',
                description: 'Подходят экспериментальные и гибкие подходы.',
                recommendations: [
                    { label: 'Теория подталкивания', keyword: 'подталкивания', baseMatch: 88 },
                    { label: 'R2P2', keyword: 'r2p2', baseMatch: 85 },
                    { label: 'PDCA Цикл', keyword: 'pdca', baseMatch: 82 }
                ]
            }
        };

        const quizResourcesMap = {
            limited: {
                title: 'Ограниченные ресурсы',
                description: 'Эффективные и простые в реализации методы.',
                recommendations: [
                    { label: 'PDCA Цикл', keyword: 'pdca', baseMatch: 90 },
                    { label: 'Теория подталкивания', keyword: 'подталкивания', baseMatch: 88 },
                    { label: 'АДКАР', keyword: 'адкар', baseMatch: 85 }
                ]
            },
            adequate: {
                title: 'Достаточные ресурсы',
                description: 'Можно использовать комплексные подходы.',
                recommendations: [
                    { label: 'Модель Коттера', keyword: 'коттер', baseMatch: 88 },
                    { label: 'Гибридная модель', keyword: 'гибридная', baseMatch: 85 },
                    { label: 'Маур 3 уровня', keyword: 'маур', baseMatch: 83 }
                ]
            },
            abundant: {
                title: 'Избыточные ресурсы',
                description: 'Можно экспериментировать и использовать сложные методы.',
                recommendations: [
                    { label: 'Стандарт ACMP', keyword: 'acmp', baseMatch: 90 },
                    { label: 'Маур 3 уровня', keyword: 'маур', baseMatch: 87 },
                    { label: 'Модель Сатир', keyword: 'сатир', baseMatch: 85 }
                ]
            }
        };
        
        const learningPaths = {
            quick: {
                id: 'quick',
                label: 'Быстрый',
                description: '≈15 минут • Основы и ключевые модели',
                slides: [0] // Безопасное значение по умолчанию
            },
            standard: {
                id: 'standard',
                label: 'Стандартный',
                description: '≈45 минут • Углублённое изучение',
                slides: [0] // Безопасное значение по умолчанию
            },
            expert: {
                id: 'expert',
                label: 'Экспертный',
                description: 'Полная версия • Все материалы',
                slides: [0] // Безопасное значение по умолчанию
            }
        };
        
        const timelineData = [
            {
                period: '1950–1980',
                headline: 'Эпоха научного управления',
                summary: 'Мир восстанавливался после войны, экономика набирала обороты, и организации столкнулись с необходимостью управлять масштабными трансформациями. Научный менеджмент Тейлора и Файоля, только что доказавший свою эффективность в производстве, начал проникать в сферу организационных изменений. Курт Левин, беженец из нацистской Германии, принес в Америку идеи социальной психологии и создал первую научную модель изменений. Это было время, когда изменения воспринимались как линейный процесс: разморозить, изменить, заморозить — словно работа с куском льда.',
                highlights: [
                    'Исторический фон: Послевоенный экономический бум, рост промышленных корпораций, эра массового производства. Научный менеджмент становится доминирующей парадигмой',
                    'Интеллектуальная революция: Курт Левин (1947) вводит Action Research и трёхэтапную модель. Дэвид Бекхард (1969) формулирует математическую формулу успеха изменений: D × V × F > R',
                    'Влияние на управление проектами: Появление PERT и CPM в 1950-х — первые инструменты планирования сложных проектов. Линейные модели жизненного цикла становятся стандартом',
                    'Организационная реальность: Иерархические структуры, централизованное принятие решений, долгосрочное стратегическое планирование. Изменения — редкое событие, требующее тщательной подготовки',
                    'Ключевые модели: Трёхэтапная модель Левина (Unfreeze-Change-Refreeze), Формула Бекхарда-Харриса, первые модели организационного развития',
                    'Философия эпохи: Изменения как управляемый процесс, требующий структуры, плана и контроля. Воспроизводимость и предсказуемость — главные ценности'
                ],
                tone: 'context'
            },
            {
                period: '1980–2000',
                headline: 'Стратегический фокус',
                summary: 'Мир стал глобальным. Границы между рынками стирались, персональные компьютеры появились на каждом столе, интернет связал континенты. Японские компании, вооруженные Kaizen и TQM, захватывали мировые рынки. Западные корпорации ответили реинжинирингом бизнес-процессов — радикальным переосмыслением того, как работают организации. В этот момент Джон Коттер из Гарварда опубликовал "Leading Change" и предложил миру 8 шагов трансформации. Изменения перестали быть операционным вопросом — они стали стратегическим императивом.',
                highlights: [
                    'Глобальные сдвиги: Дерегулирование рынков открыло эру глобальной конкуренции. Технологическая революция (ПК, интернет) изменила скорость бизнеса. Японское чудо заставило переосмыслить управление',
                    'Стратегический поворот: Изменения интегрируются в корпоративную стратегию. McKinsey создает 7-S Framework, показывая системность организаций. GE под руководством Джека Уэлча становится лабораторией трансформаций',
                    'Профессионализация: PMI (1984) и PRINCE2 (1989) стандартизируют управление проектами. Матричные структуры позволяют управлять сложными программами. Портфельный подход становится нормой',
                    'Интеллектуальные лидеры: Джон Коттер формулирует 8 шагов лидерства изменениями. Майкл Хаммер провозглашает реинжиниринг. Консалтинговые гиганты создают методологии трансформаций',
                    'Ключевые модели: 8 шагов Коттера (1996), McKinsey 7-S Framework, GE Change Acceleration Process, модели стратегической трансформации',
                    'Организационная реальность: Эпоха слияний и поглощений, глобальная экспансия, цифровизация бизнеса. Акционерная стоимость становится главным мерилом успеха. Изменения — постоянный спутник роста'
                ],
                tone: 'strategy'
            },
            {
                period: '2000–2015',
                headline: 'Люди и культура в центре',
                summary: 'Два кризиса — доткомов в 2000-м и финансовый в 2008-м — обнажили правду: технологии и процессы бессильны, если люди не готовы меняться. Prosci провел масштабные исследования и обнаружил шокирующий факт: 70% выгод проектов зависят не от технологий, а от того, примут ли изменения сотрудники. В это же время Даниэль Канеман получил Нобелевскую премию за исследования в поведенческой экономике, показав, что люди принимают решения не рационально, а эмоционально. Социальные сети превратили каждого сотрудника в коммуникатора. Управление изменениями открыло для себя человеческую природу.',
                highlights: [
                    'Пробуждение: Кризисы обнажили ограниченность технических подходов. Нейронауки и поведенческая экономика (Канеман, 2002) открыли эмоциональную природу решений. Социальные сети демократизировали коммуникацию',
                    'Парадигмальный сдвиг: Фокус смещается с "что изменить" на "как помочь людям изменить". Сопротивление перестает быть проблемой — оно становится данностью, с которой нужно работать. Культура и доверие становятся ключевыми факторами',
                    'Agile-революция: Agile Manifesto (2001) меняет управление проектами. Scrum и Kanban ставят команды в центр. PMI признает важность стейкхолдеров. Самоорганизация заменяет контроль',
                    'Научное обоснование: Prosci Best Practices (с 1994) выявляют: слабое спонсорство — причина №1 провалов. 70% выгод зависят от принятия изменений людьми. Эмоциональный путь важнее логического',
                    'Новые модели: ADKAR (Prosci, 1998) фокусируется на индивидуальной готовности. Уильям Бриджес описывает эмоциональный переход. Модель Сатир показывает психологию изменений. Change Curve объясняет горе от потерь',
                    'Организационная реальность: Корпоративная культура становится конкурентным преимуществом. Employer branding привлекает таланты. Быстрая адаптация требует вовлеченных сотрудников. Люди — главный актив'
                ],
                tone: 'people'
            },
            {
                period: '2015–2023',
                headline: 'Гибкость и скорость',
                summary: 'Мир стал VUCA — волатильным, неопределенным, сложным и неоднозначным. Цифровая трансформация перестала быть выбором — она стала необходимостью. А потом пришла пандемия COVID-19 и за недели изменила то, на что раньше уходили годы. Организации, которые умели быстро адаптироваться, выжили. Те, кто цеплялся за старые модели, проиграли. Agile и DevOps, рожденные в IT, захватили весь бизнес. Большие проекты уступили место непрерывным итерациям. Продуктовое мышление заменило проектный подход. Изменения перестали быть событием — они стали образом жизни.',
                highlights: [
                    'Великое ускорение: Цифровая трансформация становится императивом. Пандемия COVID-19 (2020) ускоряет изменения в 10 раз. Удаленная работа стирает границы. Платформенная экономика меняет правила игры',
                    'Новая философия: Непрерывные изменения заменяют проектный подход. Экспериментирование важнее планирования. Быстрые циклы обратной связи позволяют корректировать курс. Fail-fast становится добродетелью',
                    'Методологическая революция: Agile и Scrum доминируют в управлении проектами. DevOps объединяет разработку и операции. SAFe, LeSS, Nexus масштабируют Agile. Управление продуктами вытесняет управление проектами',
                    'Практики нового времени: Agile Change Management, PDCA циклы, Design Thinking, Lean Startup, MVP подходы. Непрерывное обучение становится нормой. Data-driven решения заменяют интуицию',
                    'Технологический фундамент: Cloud computing делает инфраструктуру гибкой. Мобильные приложения связывают команды. Автоматизация освобождает время для творчества. Аналитика данных открывает новые возможности',
                    'Организационная реальность: Инновации — основа конкуренции. Скорость выхода на рынок критична. Клиентоцентричность определяет успех. Экосистемное мышление создает новые формы сотрудничества. Адаптивность — главная компетенция'
                ],
                tone: 'agile'
            },
            {
                period: '2024–2025',
                headline: 'ИИ, персонализация и психологическая безопасность',
                summary: 'ChatGPT взорвал мир в 2022 году, и внезапно стало ясно: искусственный интеллект может не только выполнять задачи, но и понимать контекст, адаптироваться, учиться. В управлении изменениями это открыло эру гиперперсонализации — каждый сотрудник получает индивидуальную траекторию адаптации, созданную AI на основе его профиля, стиля обучения и эмоционального состояния. Гибридная работа стала нормой, но принесла новые вызовы: как поддерживать вовлеченность на расстоянии? Ответ — психологическая безопасность, концепция Эми Эдмондсон из Гарварда. Wellbeing сотрудников перестал быть "nice to have" — он стал конкурентным преимуществом. Изменения стали не просто управляемыми, а поддерживающими человека.',
                highlights: [
                    'Технологический прорыв: Генеративный ИИ (ChatGPT, 2022) меняет правила игры. Large Language Models понимают контекст и создают персонализированный контент. AI становится партнером, а не инструментом',
                    'Социальные сдвиги: Great Resignation заставил переосмыслить отношения с сотрудниками. Гибридная работа требует новых подходов к вовлечению. Wellbeing становится приоритетом. ESG определяет стратегию',
                    'Новая парадигма управления изменениями: AI-усиленные подходы создают индивидуальные траектории адаптации. Предиктивная аналитика предсказывает сопротивление. Персонализированные коммуникации повышают эффективность',
                    'Эволюция управления проектами: AI автоматизирует рутинные задачи, освобождая время для стратегии. Предиктивная аналитика улучшает планирование. Гибридные методологии сочетают гибкость и структуру. Фокус на результатах, а не процессах',
                    'Технологический арсенал: Генеративный ИИ создает персонализированные коммуникации. Анализ настроений в реальном времени выявляет проблемы. Виртуальные ассистенты поддерживают сотрудников. Персонализированные платформы обучения адаптируются к стилю',
                    'Ключевые модели: Модель Сатир описывает эмоциональный путь. R2P2 обеспечивает быстрое вовлечение. AI-усиленные подходы создают индивидуальные ADKAR траектории. Модели психологической безопасности строят доверие',
                    'Организационная реальность: Конкуренция за таланты требует нового подхода. Быстрая адаптация к технологиям — необходимость. Устойчивое развитие — обязательство. Этичное использование AI — вопрос репутации. Баланс эффективности и человечности определяет успех'
                ],
                tone: 'future'
            }
        ];
        
        const bubbleChartConfig = {
            categories: {
                Контекстные: { backgroundColor: 'rgba(99, 102, 241, 0.55)', borderColor: '#4338CA' },
                'Высокоуровневые': { backgroundColor: 'rgba(14, 165, 233, 0.55)', borderColor: '#0EA5E9' },
                Действенные: { backgroundColor: 'rgba(16, 185, 129, 0.55)', borderColor: '#059669' },
                Вспомогательные: { backgroundColor: 'rgba(249, 115, 22, 0.55)', borderColor: '#EA580C' }
            },
            points: [
                { category: 'Контекстные', label: 'Burke-Litwin', x: 8.5, y: 8, r: 18 },
                { category: 'Контекстные', label: 'McKinsey 7-S', x: 7.2, y: 7, r: 15 },
                { category: 'Контекстные', label: 'Теория U', x: 8, y: 6.5, r: 16 },
                { category: 'Высокоуровневые', label: 'Модель Коттера', x: 6, y: 6.5, r: 14 },
                { category: 'Высокоуровневые', label: 'Переход Бриджеса', x: 4.8, y: 5.2, r: 12 },
                { category: 'Высокоуровневые', label: 'Стандарт ACMP', x: 6.4, y: 5.8, r: 13 },
                { category: 'Действенные', label: 'ADKAR', x: 5.5, y: 5.6, r: 14 },
                { category: 'Действенные', label: 'PDCA', x: 3.4, y: 3.2, r: 11 },
                { category: 'Действенные', label: 'Гибридное управление', x: 7.1, y: 5.4, r: 17 },
                { category: 'Действенные', label: 'Change Delta', x: 6.6, y: 6, r: 14 },
                { category: 'Действенные', label: 'Маур 3 уровня', x: 5.2, y: 7, r: 13 },
                { category: 'Вспомогательные', label: 'R2P2', x: 2.6, y: 2.5, r: 10 },
                { category: 'Вспомогательные', label: 'Теория подталкивания', x: 2.2, y: 3.1, r: 9 },
                { category: 'Вспомогательные', label: 'AI-усиленный подход', x: 6.8, y: 6.2, r: 15 }
            ]
        };
        
        const safeParseStorage = (key, fallback) => {
            try {
                const raw = localStorage.getItem(key);
                return raw ? JSON.parse(raw) : fallback;
            } catch (error) {
                console.warn(`Не удалось прочитать данные ${key}:`, error);
                return fallback;
            }
        };
        
        let bookmarks = new Set(
            safeParseStorage(BOOKMARK_STORAGE_KEY, [])
                .map(Number)
                .filter(Number.isFinite)
        );
        let notesStore = safeParseStorage(NOTES_STORAGE_KEY, {});
        let unlockedAchievements = new Set(safeParseStorage(ACHIEVEMENT_STORAGE_KEY, []));
        let notesSaveTimeout = null;
        
        const slidesData = [
            // СЛАЙД 1 - РАЗДЕЛИТЕЛЬ: ДОБРО ПОЖАЛОВАТЬ
            {
                title: "Добро пожаловать в мир управления изменениями",
                subtitle: "Интерактивное путешествие по 56 моделям",
                content: `
                    <div class="section-separator">
                        <div class="section-overview">
                            <div class="overview-card">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                                    </svg>
                                </div>
                                <h3>56 Моделей</h3>
                                <p>Полный каталог от классических до современных подходов</p>
                            </div>

                            <div class="overview-card">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="16" y1="2" x2="16" y2="6"></line>
                                        <line x1="8" y1="2" x2="8" y2="6"></line>
                                        <line x1="3" y1="10" x2="21" y2="10"></line>
                                    </svg>
                                </div>
                                <h3>Интерактивные Инструменты</h3>
                                <p>Практические инструменты для оценки и планирования ваших проектов</p>
                            </div>

                            <div class="overview-card">
                                <div class="icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                </div>
                                <h3>Экспорт и Аналитика</h3>
                                <p>Сохраните результаты и поделитесь инсайтами в формате PDF</p>
                            </div>
                        </div>

                        <div class="separator-navigation">
                            <button class="separator-cta" onclick="changeSlide(1)">Начать путешествие →</button>
                        </div>
                    </div>
                `
            },

            // СЛАЙД 1 - ПРОБЛЕМА
            {
                title: "Проекты изменений часто под угрозой",
                subtitle: "",
                content: `
                    <div class="hero-intro-slide">
                        <!-- HOOK: Эмоциональный якорь через проблему -->
                        <div class="hero-hook">
                            <h2 class="hook-question">Статистика проектов изменений показывает</h2>
                            <div class="hook-problems">
                                <div class="problem-item">
                                    <div class="icon danger">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path>
                                            <path d="M12 9v4"></path>
                                            <path d="M12 17h.01"></path>
                                        </svg>
                                    </div>
                                    <p>>60% проектов изменений проваливаются</p>
                                </div>
                                <div class="problem-item">
                                    <div class="icon warning">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
                                            <polyline points="16 17 22 17 22 11"></polyline>
                                        </svg>
                                    </div>
                                    <p>Миллионы рублей теряются из-за отсутствия правильной методологии</p>
                                </div>
                                <div class="problem-item">
                                    <div class="icon neutral">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                            <path d="M12 17h.01"></path>
                                        </svg>
                                    </div>
                                    <p>Сложно выбрать подходящую модель управления изменениями</p>
                                </div>
                                <div class="problem-item">
                                    <div class="icon danger">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                            <circle cx="9" cy="7" r="4"></circle>
                                            <line x1="17" y1="8" x2="17" y2="14"></line>
                                            <line x1="21" y1="8" x2="21" y2="14"></line>
                                            <line x1="17" y1="11" x2="21" y2="11"></line>
                                        </svg>
                                    </div>
                                    <p>Сопротивление сотрудников — основная причина провала изменений</p>
                                </div>
                                <div class="problem-item">
                                    <div class="icon danger">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <polyline points="22 17 13.5 8.5 8.5 13.5 2 7"></polyline>
                                            <polyline points="16 17 22 17 22 11"></polyline>
                                        </svg>
                                    </div>
                                    <p>Слабое спонсорство руководства снижает успех проектов</p>
                                </div>
                                <div class="problem-item">
                                    <div class="icon warning">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                                            <path d="M12 9v6"></path>
                                            <path d="M12 17h.01"></path>
                                        </svg>
                                    </div>
                                    <p>Изменения без оценки готовности организации часто проваливаются</p>
                                </div>
                            </div>
                            
                            <div class="hero-hook-source">
                                <p class="source-text">Источник: Исследование PROSCI, 2023</p>
                            </div>
                        </div>
                    </div>
                `
            },
            
            // СЛАЙД 2 - ЭВОЛЮЦИЯ
            {
                title: "История развития: 75 лет эволюции",
                subtitle: "От научного управления до ИИ-усиленных подходов",
                content: `
                    <div class="interactive-timeline" id="timelineContainer">
                        <div class="timeline-track" id="timelineTrack"></div>
                        <div class="timeline-details-card" id="timelineDetails">
                            <h3 id="timelineTitle">История управления изменениями</h3>
                            <p id="timelineSummary">Выберите период на временной шкале, чтобы увидеть ключевые акценты эпохи и используемые модели.</p>
                            <ul id="timelineHighlights"></ul>
                        </div>
                    </div>
                `
            },

            // СЛАЙД 4 - КЛЮЧЕВЫЕ ТРЕНДЫ 2025
            {
                title: "Тренды управления изменениями",
                subtitle: "Что формирует будущее управления изменениями",
                content: `
                    <div class="grid-2 trends-grid">
                        <div class="card trend-card">
                            <div class="trend-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="7" width="18" height="10" rx="3"></rect>
                                    <circle cx="9" cy="12" r="1.5"></circle>
                                    <circle cx="15" cy="12" r="1.5"></circle>
                                    <line x1="7" y1="5" x2="7" y2="7.5"></line>
                                    <line x1="17" y1="5" x2="17" y2="7.5"></line>
                                    <line x1="7" y1="16.5" x2="7" y2="19"></line>
                                    <line x1="17" y1="16.5" x2="17" y2="19"></line>
                                    <line x1="3" y1="12" x2="1.5" y2="12"></line>
                                    <line x1="22.5" y1="12" x2="21" y2="12"></line>
                                </svg>
                            </div>
                            <div class="trend-content">
                                <h3>1. ИСКУССТВЕННЫЙ ИНТЕЛЛЕКТ КАК ИНСТРУМЕНТ</h3>
                                <p>ИИ - это не только предмет изменений, но и инструмент для управления ими. Применение: Анализ настроений, прогнозная аналитика, адаптивная коммуникация. Компании с ИИ видят на 25-30% выше успешность внедрения.</p>
                            </div>
                        </div>
                        <div class="card trend-card">
                            <div class="trend-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"></path>
                                </svg>
                            </div>
                            <div class="trend-content">
                                <h3>2. ЧЕЛОВЕК В ЦЕНТРЕ (Несмотря на Технологию)</h3>
                                <p>Эмоции, психология и психологическая безопасность остаются решающими. Люди - это главный фактор успеха или неудачи изменений. Подход: Модели Сатир, R2P2, Мауэра.</p>
                            </div>
                        </div>
                        <div class="card trend-card">
                            <div class="trend-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="11 2 5 13 11 13 9 22 19 9 13 9 15 2"></polyline>
                                </svg>
                            </div>
                            <div class="trend-content">
                                <h3>3. СКОРОСТЬ И ГИБКОСТЬ КАК НОВЫЙ СТАНДАРТ</h3>
                                <p>Гибридные модели (Waterfall + Agile) становятся нормой. Рынки меняются быстро, нужна адаптивность. Результат: Большие планы + быстрая реализация + коррекции.</p>
                            </div>
                        </div>
                        <div class="card trend-card">
                            <div class="trend-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                </svg>
                            </div>
                            <div class="trend-content">
                                <h3>4. ГЛУБОКОЕ ПОНИМАНИЕ ТИПОВ СОПРОТИВЛЕНИЯ</h3>
                                <p>Не всё сопротивление одинаково - 3 различных уровня. Уровень 1: "Я не понимаю", Уровень 2: "Мне это не нравится", Уровень 3: "Я вам не доверяю". Решение: Диагностика перед действием.</p>
                            </div>
                        </div>
                        <div class="card trend-card">
                            <div class="trend-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </div>
                            <div class="trend-content">
                                <h3>5. ПЕРСОНАЛИЗАЦИЯ И ИНДИВИДУАЛЬНОСТЬ</h3>
                                <p>Каждый сотрудник - уникальный путь, не один размер для всех. Модель R2P2: Роль, Причина, Путь, Партнер для каждого человека. Технология: AI помогает масштабировать персонализацию.</p>
                            </div>
                        </div>
                        <div class="card trend-card">
                            <div class="trend-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                </svg>
                            </div>
                            <div class="trend-content">
                                <h3>6. ГИБРИДНАЯ РАБОТА ТРЕБУЕТ НОВЫХ ПОДХОДОВ</h3>
                                <p>Удалённые команды нуждаются в структурированной виртуальной поддержке. Вызов: Меньше личных контактов, больше цифровых инструментов. Решение: Асинхронная коммуникация, виртуальные коучи.</p>
                            </div>
                        </div>
                        <div class="card trend-card">
                            <div class="trend-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path>
                                </svg>
                            </div>
                            <div class="trend-content">
                                <h3>7. НЕПРЕРЫВНОЕ ОБУЧЕНИЕ И АДАПТАЦИЯ</h3>
                                <p>Изменение - это спираль, а не конечная точка. Культура: PDCA циклы, "быстро ошибаться - быстро учиться". Результат: Организационная способность &gt; отдельные проекты.</p>
                            </div>
                        </div>
                    </div>
                `
            },

            // СЛАЙД 5 - ЧТО ТРЕБУЕТСЯ ДЛЯ УСПЕХА
            {
                title: "7 столпов успешного управления изменениями",
                subtitle: "Основные элементы для эффективного лидерства",
                content: `
                    <div class="grid-2 pillars-grid">
                        <div class="card pillar-card">
                            <div class="pillar-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19.439 7.85c-.049-.177-.177-.304-.304-.353l-4.83-2.065a1 1 0 0 0-.608-.048l-5.492 1.106a1 1 0 0 1-.608-.048l-4.83-2.065a1.089 1.089 0 0 0-.304-.049 1 1 0 0 0-.304.049l-4.83 2.065a1 1 0 0 0-.608.804l-.088 4.83a1 1 0 0 0 .255.804l3.83 3.83a1 1 0 0 0 .804.255l4.83-.088a1 1 0 0 0 .804-.608l2.065-4.83a1 1 0 0 1 .048-.608l1.106-5.492a1.048 1.048 0 0 1 .048-.608l2.065-4.83c.049-.127.049-.255 0-.353z"></path>
                                </svg>
                            </div>
                            <div class="pillar-content">
                                <h3>1. Комбинированный Подход к Моделям</h3>
                                <p>Выберите правильный микс моделей для вашей конкретной ситуации. Ни одна модель не подходит для всех сценариев.</p>
                            </div>
                        </div>
                        <div class="card pillar-card">
                            <div class="pillar-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"></path>
                                </svg>
                            </div>
                            <div class="pillar-content">
                                <h3>2. Понимание Человеческой Психологии</h3>
                                <p>Признайте эмоциональное путешествие, которое люди переживают во время изменений. Работайте со страхами, сопротивлением и опасениями с эмпатией.</p>
                            </div>
                        </div>
                        <div class="card pillar-card">
                            <div class="pillar-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                    <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                    <path d="m9 12 3 3L22 4"></path>
                                </svg>
                            </div>
                            <div class="pillar-content">
                                <h3>3. Гибкость и Адаптивность</h3>
                                <p>Будьте готовы быстро менять курс, когда обстоятельства изменяются. Встраивайте циклы обратной связи и механизмы корректировки.</p>
                            </div>
                        </div>
                        <div class="card pillar-card">
                            <div class="pillar-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="4" y="2" width="16" height="20" rx="2"></rect>
                                    <path d="M9 22v-4h6v4"></path>
                                    <path d="M8 6h.01"></path>
                                    <path d="M16 6h.01"></path>
                                    <path d="M12 6h.01"></path>
                                    <path d="M12 10h.01"></path>
                                    <path d="M12 14h.01"></path>
                                    <path d="M12 18h.01"></path>
                                </svg>
                            </div>
                            <div class="pillar-content">
                                <h3>4. Технология как Инструмент</h3>
                                <p>Используйте AI и цифровые инструменты для улучшения принятия решений, но не заменяйте человеческое суждение и эмпатию.</p>
                            </div>
                        </div>
                        <div class="card pillar-card">
                            <div class="pillar-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path>
                                </svg>
                            </div>
                            <div class="pillar-content">
                                <h3>5. Непрерывное Обучение</h3>
                                <p>Установите циклы обратной связи на каждом этапе. Учитесь на неудачах и успехах для постоянного улучшения.</p>
                            </div>
                        </div>
                        <div class="card pillar-card">
                            <div class="pillar-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z"></path>
                                </svg>
                            </div>
                            <div class="pillar-content">
                                <h3>6. Доверие и Психологическая Безопасность</h3>
                                <p>Создайте среду, в которой люди чувствуют себя в безопасности, чтобы выражать опасения, задавать вопросы и рисковать.</p>
                            </div>
                        </div>
                        <div class="card pillar-card">
                            <div class="pillar-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                    <circle cx="9" cy="7" r="4"></circle>
                                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                </svg>
                            </div>
                            <div class="pillar-content">
                                <h3>7. Структурированная Личная Поддержка</h3>
                                <p>Обеспечьте каждого человека ясностью относительно их Роли, Причины изменения, Пути вперед и Партнера для поддержки (R2P2).</p>
                            </div>
                        </div>
                    </div>
                `
            },

            // СЛАЙД - РАЗДЕЛИТЕЛЬ: ПРАКТИКА - ОЦЕНИТЕ СВОЙ ПРОЕКТ
            {
                title: "Выберите то, что полезно для вас",
                subtitle: "",
                content: `
                    <div class="useful-options-container">
                        <div class="useful-options-grid">
                            <div class="useful-option-card" onclick="goToClassification()">
                                <div class="useful-option-touch-indicator">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <circle cx="12" cy="12" r="4"></circle>
                                    </svg>
                                </div>
                                <div class="useful-option-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                        <line x1="3" y1="9" x2="21" y2="9"></line>
                                        <line x1="9" y1="21" x2="9" y2="9"></line>
                                    </svg>
                                </div>
                                <div class="useful-option-content">
                                    <h3>Изучить модели</h3>
                                    <p>Познакомьтесь с 56 моделями управления изменениями от классических до современных подходов</p>
                                </div>
                            </div>

                            <div class="useful-option-card" onclick="goToPracticalTools()">
                                <div class="useful-option-touch-indicator">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <circle cx="12" cy="12" r="4"></circle>
                                    </svg>
                                </div>
                                <div class="useful-option-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path>
                                        <polyline points="14 2 14 8 20 8"></polyline>
                                        <line x1="16" y1="13" x2="8" y2="13"></line>
                                        <line x1="16" y1="17" x2="8" y2="17"></line>
                                        <polyline points="10 9 9 9 8 9"></polyline>
                                    </svg>
                                </div>
                                <div class="useful-option-content">
                                    <h3>Практические инструменты</h3>
                                    <p>Используйте интерактивные инструменты для оценки и планирования ваших проектов изменений</p>
                                </div>
                            </div>

                            <div class="useful-option-card" onclick="goToFAQ()">
                                <div class="useful-option-touch-indicator">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <circle cx="12" cy="12" r="4"></circle>
                                    </svg>
                                </div>
                                <div class="useful-option-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                        <path d="M12 17h.01"></path>
                                    </svg>
                                </div>
                                <div class="useful-option-content">
                                    <h3>FAQ</h3>
                                    <p>Найдите ответы на ключевые вопросы управления изменениями и получите практические инструменты</p>
                                </div>
                            </div>

                            <div class="useful-option-card" onclick="goToModelSelector()">
                                <div class="useful-option-touch-indicator">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <circle cx="12" cy="12" r="4"></circle>
                                    </svg>
                                </div>
                                <div class="useful-option-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="3" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="3" width="7" height="7"></rect>
                                        <rect x="14" y="14" width="7" height="7"></rect>
                                        <rect x="3" y="14" width="7" height="7"></rect>
                                    </svg>
                                </div>
                                <div class="useful-option-content">
                                    <h3>Интерактивный инструмент выбора модели</h3>
                                    <p>Найдите подходящую модель для вашего проекта с помощью интерактивного селектора</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `

            }
        ];

        baseSlidesCount = slidesData.length;

        // Classical Models Data (Models 1-47)
        const classicalModels = [
            {
                name: "Модель АИМ (Методология ускоренной реализации)",
                type: "Действенная",
                developer: "ARMOUR, 1990-е годы",
                description: "Процесс реализации стратегического изменения для управления рисками в организации",
                phases: [
                    "1. Определить изменение",
                    "2. Оценить климат организации",
                    "3. Сгенерировать спонсорство",
                    "4. Построить план коммуникации",
                    "5. Определить подход к изменению",
                    "6. Приоритизировать действия",
                    "7. Построить агентов изменения",
                    "8. Развить целевую готовность",
                    "9. Реализовать",
                    "10. Мониторить и развить подкрепление"
                ],
                whenToUse: "Быстрая реализация стратегических проектов, высокие риски требующие управления, внедрение критичных инициатив",
                bestFor: "Крупные корпорации, критичные изменения, высокие риски",
                complexity: "Высокая",
                scale: "Крупный",
                duration: "6-12 мес",
                focus: "Стратегия"
            },
            {
                name: "Стандарт ACMP (Управление изменениями)",
                type: "Вспомогательная",
                developer: "Институт ACMP, 2014 год",
                description: "Глобальный стандарт лучших практик в управлении организационными изменениями",
                phases: [
                    "1. Оценка влияния и готовности организации",
                    "2. Формулирование стратегии управления",
                    "3. Разработка планов управления",
                    "4. Исполнение планов управления",
                    "5. Закрытие усилий управления"
                ],
                whenToUse: "Стандартизация процессов, профессионализм команды, измеримость результатов, соответствие глобальным практикам",
                bestFor: "Многонациональные корпорации, сертификация, стандартизация"
            },
            {
                name: "Фреймворк Change Delta",
                type: "Действенная",
                developer: "ARMOUR, 2000-е годы",
                description: "Комплексный целостный подход к управлению изменениями, концентрирующий ресурсы на наиболее важных элементах",
                phases: [
                    "1. ИСПОЛНЕНИЕ - Портфельный подход, прозрачность статуса, раннее действие",
                    "2. СПОНСОРСТВО И УПРАВЛЕНИЕ - Четкая структура управления, явные роли",
                    "3. РАСШИРЕНИЕ ВОЗМОЖНОСТЕЙ ЛИДЕРОВ - Инструменты и ответственность",
                    "4. ВОВЛЕЧЁННАЯ ОРГАНИЗАЦИЯ - Готовые, желающие, способные сотрудники"
                ],
                whenToUse: "Крупные программы трансформации, управление несколькими проектами, требуется уверенность в реализации",
                bestFor: "Крупные корпоративные трансформации, портфельное управление"
            },
            {
                name: "Формула Бекхарда и Харриса",
                type: "Вспомогательная",
                developer: "Дэвид Бекхард, Рубен Харрис, 1987 год",
                description: "Лаконичная формула для определения факторов успеха организационных изменений: Изменение = (A × B × C) > D, где A=Неудовлетворенность, B=Практичность, C=Видение, D=Затраты",
                phases: [
                    "A = Уровень неудовлетворенности текущим состоянием",
                    "B = Практичность решения и минимальный риск",
                    "C = Четкое видение желаемого будущего",
                    "D = Воспринимаемые затраты на реализацию",
                    "Произведение A, B и C должно быть больше D для успеха"
                ],
                whenToUse: "Диагностика готовности к изменениям, определение сопротивления, быстрая оценка потенциала успеха",
                bestFor: "Быстрая диагностика, планирование коммуникации"
            },
            {
                name: "Процесс Бекхарда и Харриса",
                type: "Высокоуровневая",
                developer: "Дэвид Бекхард, Рубен Харрис, 1987 год",
                description: "Пятиэтапный процесс управления организационными изменениями",
                phases: [
                    "1. АНАЛИЗ ОРГАНИЗАЦИИ - Выявление сил за и против, оценка ситуации",
                    "2. ОПРЕДЕЛЕНИЕ ПОЧЕМУ ИЗМЕНЕНИЯ - Необходимость, выбор, видение",
                    "3. АНАЛИЗ РАЗРЫВА - Текущее vs желаемое, выявление пробелов",
                    "4. ПЛАНИРОВАНИЕ ДЕЙСТВИЙ - Определение работы, ответственности, временной шкалы",
                    "5. УПРАВЛЕНИЕ ПЕРЕХОДОМ - Реализация, коммуникация, мониторинг"
                ],
                whenToUse: "Комплексный анализ перед большими изменениями, организационные трансформации, учет людской стороны",
                bestFor: "Системный подход, большие организационные изменения"
            },
            {
                name: "Модель переходного состояния Бекхарда",
                type: "Контекстная",
                developer: "Дэвид Бекхард, 1987 год",
                description: "Модель трёх состояний организации при переходе через изменение",
                phases: [
                    "1. ТЕКУЩЕЕ СОСТОЯНИЕ - Знакомое и комфортное, процессы понятны, роли ясны",
                    "2. СОСТОЯНИЕ ПЕРЕХОДА - Максимальная неопределённость, риск падения производительности, требует интенсивной поддержки",
                    "3. БУДУЩЕЕ СОСТОЯНИЕ - Новый порядок установлен, роли переопределены, новые возможности"
                ],
                whenToUse: "Понимание психологии переходов, управление стадией нейтральной зоны, планирование поддержки людей",
                bestFor: "Значительные организационные изменения, реструктуризация"
            },
            {
                name: "Модель Булока и Баттена",
                type: "Действенная",
                developer: "Robert Bullock, Daryl Batten, 1985 год",
                description: "Четырёхэтапная модель запланированного организационного изменения",
                phases: [
                    "1. ИССЛЕДОВАНИЕ - Проверка необходимости, сканирование среды, сбор информации, приобретение ресурсов",
                    "2. ПЛАНИРОВАНИЕ - Вовлечение ключевых лиц, диагностика проблем, разработка решений",
                    "3. ДЕЙСТВИЕ - Завершение работ согласно плану, механизмы обратной связи, мониторинг прогресса",
                    "4. ИНТЕГРАЦИЯ - Выравнивание с другими областями, формализация через политики, встраивание в культуру"
                ],
                whenToUse: "Организации с технической культурой, процессно-ориентированные изменения, системные улучшения",
                bestFor: "Технические трансформации, оптимизация процессов"
            },
            {
                name: "Модель драйверов Burke-Litwin",
                type: "Контекстная",
                developer: "W. Warner Burke, George Litwin, 1992 год",
                description: "Модель девяти взаимосвязанных факторов организационной производительности",
                phases: [
                    "1. ВНЕШНЯЯ СРЕДА - Рынок, технология, конкуренция (наиболее важная)",
                    "2. МИССИЯ И СТРАТЕГИЯ - Определение целей и направления",
                    "3. ЛИДЕРСТВО - Качество руководства, видение и решимость",
                    "4. ОРГАНИЗАЦИОННАЯ КУЛЬТУРА - Ценности, убеждения, нормы",
                    "5. СТРУКТУРА - Организационный дизайн, распределение ответственности",
                    "6. КЛИМАТ - Моральный дух, мотивация, психологическая безопасность",
                    "7. ТРЕБОВАНИЯ К ЗАДАЧАМ И НАВЫКИ - Компетентность",
                    "8. ИНДИВИДУАЛЬНЫЕ ПОТРЕБНОСТИ - Личные стремления",
                    "9. МОТИВАЦИЯ СОТРУДНИКОВ - Энергия и приверженность"
                ],
                whenToUse: "Анализ системных взаимосвязей, определение полного спектра факторов, понимание сложности систем",
                bestFor: "Системный анализ, крупные трансформации"
            },
            {
                name: "Модель Карнала",
                type: "Высокоуровневая",
                developer: "Cary Carnall, 1990 год",
                description: "Три ключевые области мастерства для успешного управления изменениями",
                phases: [
                    "1. ЭФФЕКТИВНОЕ УПРАВЛЕНИЕ ПЕРЕХОДАМИ - Понимание этапов, поддержка людей",
                    "2. РАБОТА С ОРГАНИЗАЦИОННЫМИ КУЛЬТУРАМИ - Понимание текущей культуры, влияние на культурные сдвиги",
                    "3. КОНСТРУКТИВНОЕ УПРАВЛЕНИЕ ОРГАНИЗАЦИОННОЙ ПОЛИТИКОЙ - Динамика власти, коалиции поддержки"
                ],
                whenToUse: "Культурные изменения, организационные трансформации, управление сложными системами",
                bestFor: "Комплексные культурные и организационные изменения"
            },
            {
                name: "Методология CHAMPS2",
                type: "Действенная",
                developer: "ARMOUR, 2000-е годы",
                description: "Восьмифазная методология для трансформационных организационных изменений",
                phases: [
                    "0. ИНИЦИИРОВАНИЕ ТРАНСФОРМАЦИИ - Определение необходимости, формирование видения",
                    "1. ВИДЕНИЕ - Создание четкого видения, артикуляция желаемого состояния",
                    "2. ФОРМИРОВАНИЕ И ПЛАНИРОВАНИЕ - Формирование рабочих групп, детальное планирование",
                    "3. ДИЗАЙН - Проектирование новых процессов, дизайн структуры",
                    "4. СОЗДАНИЕ И РЕАЛИЗАЦИЯ УСЛУГИ - Физическое создание новых систем",
                    "5. ПРЕДОСТАВЛЕНИЕ И ПЕРЕХОД - Переход от старого к новому",
                    "6. СТАБИЛИЗАЦИЯ - Решение проблем, оптимизация, закрепление",
                    "7. РЕАЛИЗАЦИЯ ВЫГОД - Измерение результатов, демонстрация ценности"
                ],
                whenToUse: "Масштабные трансформационные программы, комплексные системные изменения, требуется фазированный подход",
                bestFor: "Масштабные трансформационные программы"
            },
            {
                name: "Дорожная карта лидеров изменений (CLRM)",
                type: "Действенная",
                developer: "ChangeFirst, 2000-е годы",
                description: "Интеграция контентной работы с работой с людьми для управления изменениями",
                phases: [
                    "1. ОЦЕНИТЬ СИТУАЦИЮ - Определить требования дизайна, выявить вызовы",
                    "2. СПРОЕКТИРОВАТЬ ЖЕЛАЕМОЕ СОСТОЯНИЕ - Определить целевые процессы",
                    "3. ПРОВЕСТИ АНАЛИЗ ВЛИЯНИЯ - Определить затронутые группы",
                    "4. СПЛАНИРОВАТЬ И ОРГАНИЗОВАТЬ РЕАЛИЗАЦИЮ - Разработать план",
                    "5. РЕАЛИЗОВАТЬ ИЗМЕНЕНИЕ - Выполнить план, коммуницировать",
                    "6. ОБУЧИТЬСЯ И ОТКОРРЕКТИРОВАТЬ КУРС - Собрать обратную связь",
                    "7. ОТПРАЗДНОВАТЬ И ИНТЕГРИРОВАТЬ - Признать достижения, встроить в культуру"
                ],
                whenToUse: "Комбинированные технические и людские изменения, требуется анализ влияния, высокое потенциальное сопротивление",
                bestFor: "Балансирование процессных и человеческих аспектов"
            },
            {
                name: "Институт управления изменениями (CMI)",
                type: "Вспомогательная",
                developer: "Change Management Institute, 2014 год",
                description: "База знаний и модель зрелости для управления изменениями",
                phases: [
                    "Охватывает 9 областей: теории изменений, управление выгодами, стратегии заинтересованных сторон, коммуникация",
                    "МОДЕЛЬ ЗРЕЛОСТИ (5 уровней): 1-Нулевой опыт, 2-Начальный, 3-Компетентный, 4-Опытный, 5-Лидер мнений",
                    "Оценка компетентности управления в организации",
                    "Определение пути развития и сертификация специалистов"
                ],
                whenToUse: "Развитие компетентности, стандартизация процессов, профессионализм команды",
                bestFor: "Развитие компетентности, стандартизация, сертификация"
            },
            {
                name: "Методология исполнения изменений (CEM)",
                type: "Действенная",
                developer: "Conner Partners, 1990-е годы",
                description: "Четырёхфазная методология для управления людской стороной изменений",
                phases: [
                    "1. РЕШЕНИЕ (Decide) - Принятие решения, определение целей. Фокус: Намерение, Люди, Доставка",
                    "2. ОПРЕДЕЛЕНИЕ (Define) - Определение деталей, анализ влияния. Фокус: Детали, Затронутые, Подход",
                    "3. РЕАЛИЗАЦИЯ (Implement) - Внедрение изменения, поддержка. Фокус: Поддержка людей, Потребности, Ресурсы",
                    "4. УСТОЙЧИВОСТЬ (Sustain) - Поддержание результатов, закрепление. Фокус: Закрепление, Мотивация, Механизмы"
                ],
                whenToUse: "Управление людской стороной, фокус на сопротивлении, поддержка сотрудников",
                bestFor: "Люди-ориентированные изменения"
            },
            {
                name: "Позитивный поиск (Appreciative Inquiry)",
                type: "Контекстная",
                developer: "David Cooperrider, 1980-е годы",
                description: "Подход, основанный на позитивном ядре организации и её способностях. Системы движутся в направлении того, что они изучают и ценят",
                phases: [
                    "1. ОТКРЫТИЕ (Discovery) - Мобилизация исследования позитивного ядра, выявление что работает хорошо",
                    "2. МЕЧТА (Dream) - Создание четкого видения результатов, формулирование амбициозного видения",
                    "3. ДИЗАЙН (Design) - Создание предложений возможности идеальной организации",
                    "4. СУДЬБА (Destiny) - Укрепление аффирмативной способности системы, реализация видения"
                ],
                whenToUse: "Культурные изменения, необходимо вовлечение и энтузиазм, позитивный переход, построение доверия",
                bestFor: "Культурные изменения, вовлечение, позитивные трансформации"
            },
            {
                name: "Модель Каммингса и Ворли",
                type: "Высокоуровневая",
                developer: "Thomas Cummings, Christopher Worley, 1990-е годы",
                description: "Шесть рекомендаций для успешного управления организационными изменениями",
                phases: [
                    "1. ФОРМУЛИРОВАТЬ ЧЕТКОЕ СТРАТЕГИЧЕСКОЕ ВИДЕНИЕ - Определить ясное видение и стратегическое направление",
                    "2. ДЕМОНСТРИРОВАТЬ ПРИВЕРЖЕННОСТЬ ВЫСШЕГО РУКОВОДСТВА - Активное участие, видимая поддержка",
                    "3. МОДЕЛИРОВАТЬ ИЗМЕНЕНИЕ КУЛЬТУРЫ НА ВЫСШЕМ УРОВНЕ - Демонстрация новых поведений",
                    "4. МОДИФИЦИРОВАТЬ ОРГАНИЗАЦИЮ для ПОДДЕРЖКИ ИЗМЕНЕНИЙ - Структурные и системные изменения",
                    "5. ОТБИРАТЬ И СОЦИАЛИЗИРОВАТЬ НОВИЧКОВ - Найм сторонников изменений",
                    "6. РАЗВИВАТЬ ЭТИЧЕСКУЮ И ПРАВОВУЮ ЧУВСТВИТЕЛЬНОСТЬ - Этичный подход к изменениям"
                ],
                whenToUse: "Комплексный подход к изменениям, фокус на культуре, системное выравнивание",
                bestFor: "Системный и культурный подход к изменениям"
            },
            {
                name: "DeltaV (DECIPHER)",
                type: "Действенная",
                developer: "Decipher, 2000-е годы",
                description: "Гибкая, нелинейная модель управления сложными изменениями. Модель не линейна - можно двигаться вперед и назад",
                phases: [
                    "1. ОПРЕДЕЛИТЬ БУДУЩЕЕ - Создать видение желаемого состояния",
                    "2. ВОВЛЕЧЬ ЛИДЕРОВ - Построить коалицию лидеров изменений",
                    "3. ВЫЛОЖИТЬ ДОРОЖНУЮ КАРТУ - Определить фазы реализации",
                    "4. РАССКАЗАТЬ ИСТОРИЮ - Коммуницировать видение через истории",
                    "5. ДЕЙСТВОВАТЬ - Начать реализацию",
                    "6-9. ОЦЕНИТЬ, ОТКОРРЕКТИРОВАТЬ, ПОДТВЕРДИТЬ, ПРЕДУГАДАТЬ следующую волну"
                ],
                whenToUse: "Сложные, непредсказуемые изменения, быстро меняющейся среде, необходима адаптивность",
                bestFor: "Гибкое управление сложными изменениями"
            },
            {
                name: "Реализация запланированного изменения Корнелиуса",
                type: "Высокоуровневая",
                developer: "Edwin Cornelius III, 1990-е годы",
                description: "Четыре ключевых ингредиента для успешного внедрения запланированного изменения (Все четыре необходимы)",
                phases: [
                    "1. ПОНИМАНИЕ - Люди должны понимать необходимость изменения, что это, почему, как затрагивает",
                    "2. НАВЫКИ - Люди должны иметь навыки для успешного изменения, практика и развитие",
                    "3. СРЕДА - Среда должна поддерживать новое поведение, удаление барьеров",
                    "4. МОТИВАЦИЯ - Люди должны быть мотивированы, понимание выгоды, признание и награды"
                ],
                whenToUse: "Диагностика готовности к изменениям, определение пробелов в подходе, обеспечение полноты подхода",
                bestFor: "Диагностика готовности, обеспечение полноты подхода"
            },
            {
                name: "Модель совершенства EFQM (RADAR)",
                type: "Контекстная",
                developer: "European Foundation for Quality Management, 1991 год",
                description: "Модель совершенства с инструментом систематического улучшения организаций",
                phases: [
                    "ФУНДАМЕНТАЛЬНЫЕ КОНЦЕПЦИИ: Ориентация на результаты, Фокус на клиенте, Лидерство",
                    "КРИТЕРИИ (8 областей): Лидерство, Стратегия, Люди, Партнерства, Процессы, Результаты",
                    "ЛОГИКА RADAR: R=Результаты, A=Подходы, D=Развертывание, A=Оценка, R=Совершенствование"
                ],
                whenToUse: "Стандартизация и совершенствование, организационное развитие, комплексная оценка производительности",
                bestFor: "Системный подход к совершенству и улучшению"
            },
            {
                name: "Колесо девяти клиньев Галпина",
                type: "Действенная",
                developer: "Timothy M. Galpin, 1996 год",
                description: "Девятиэтапное колесо управления изменениями с фундаментом культуры",
                phases: [
                    "1. УСТАНОВЛЕНИЕ НЕОБХОДИМОСТИ ИЗМЕНЕНИЙ - Определить почему необходимо",
                    "2. РАЗВИТИЕ И РАСПРОСТРАНЕНИЕ ВИДЕНИЯ - Создать привлекательное видение",
                    "3. ДИАГНОСТИКА И АНАЛИЗ ТЕКУЩЕЙ СИТУАЦИИ - Анализ текущего состояния",
                    "4. ГЕНЕРИРОВАНИЕ РЕКОМЕНДАЦИЙ - Разработка решений",
                    "5. ДЕТАЛИЗАЦИЯ РЕКОМЕНДАЦИЙ - Конкретизация решений",
                    "6. ПИЛОТНОЕ ТЕСТИРОВАНИЕ - Тест в контролируемых условиях",
                    "7. ПОДГОТОВКА К РАЗВЕРТЫВАНИЮ - Обучение людей",
                    "8. РАЗВЕРТЫВАНИЕ РЕКОМЕНДАЦИЙ - Внедрение решений",
                    "9. ИЗМЕРЕНИЕ, ПОДКРЕПЛЕНИЕ И СОВЕРШЕНСТВОВАНИЕ",
                    "ФУНДАМЕНТ: ПОНИМАНИЕ КУЛЬТУРЫ ОРГАНИЗАЦИИ"
                ],
                whenToUse: "Целостный подход к изменениям, необходимо учитывать культуру, комплексные программы трансформации",
                bestFor: "Целостное управление с учетом культуры"
            },
            {
                name: "Процесс ускорения изменений GE (CAP)",
                type: "Действенная",
                developer: "General Electric, 1990-е годы",
                description: "Гибкая, нелинейная методология ускорения организационных изменений. Используется на протяжении ВСЕГО процесса изменений",
                phases: [
                    "1. ВЕДЕНИЕ ИЗМЕНЕНИЙ - Видимая, активная поддержка спонсоров, моделирование нового поведения",
                    "2. СОЗДАНИЕ ОБЩЕЙ НЕОБХОДИМОСТИ - Причина внедряется, широко распространяется понимание",
                    "3. ФОРМИРОВАНИЕ ВИДЕНИЯ - Четкое видение определено, широко понимается",
                    "4. МОБИЛИЗАЦИЯ ПРИВЕРЖЕННОСТИ - Сильная приверженность, инвестирование в изменение",
                    "5. СОЗДАНИЕ ДОЛГОСРОЧНЫХ ИЗМЕНЕНИЙ - Изменения сохраняются, интеграция, ранние победы"
                ],
                whenToUse: "Ускорение организационных изменений, необходимы быстрые результаты, сложные программы трансформации",
                bestFor: "Ускорение изменений, быстрые трансформации"
            },
            {
                name: "Пятиэтапная модель Джадсона",
                type: "Действенная",
                developer: "Arnold S. Judson, 1966 год",
                description: "Пять фаз управления коммуникацией и принятием организационных изменений",
                phases: [
                    "1. АНАЛИЗ И ПЛАНИРОВАНИЕ ИЗМЕНЕНИЙ - Анализ необходимости, определение целей, планирование подхода",
                    "2. КОММУНИКАЦИЯ ИЗМЕНЕНИЙ - Четкое объяснение, преимущества и выгоды, ответы на вопросы",
                    "3. ПОЛУЧЕНИЕ ПРИНЯТИЯ НОВЫХ ПОВЕДЕНИЙ - Преодоление сопротивления, убеждение",
                    "4. ПЕРЕХОД ОТ СТАТУС-КВО К ЖЕЛАЕМОМУ СОСТОЯНИЮ - Фактический переход, поддержка",
                    "5. КОНСОЛИДАЦИЯ И ИНСТИТУЦИОНАЛИЗАЦИЯ - Закрепление, встраивание в процессы"
                ],
                whenToUse: "Управление принятием изменений, фокус на коммуникации, фокус на сопротивлении",
                bestFor: "Управление людской стороной, принятие изменений"
            },
            {
                name: "Восьмиэтапная модель Коттера",
                type: "Действенная",
                developer: "John P. Kotter, 1996 год",
                description: "Классическая восьмиэтапная модель управления организационными изменениями. Процесс изменений требует времени и проходит несколько фаз",
                phases: [
                    "1. ПОВЫШЕНИЕ СРОЧНОСТИ - Создание ощущения необходимости, выявление кризисов или возможностей",
                    "2. ПОСТРОЕНИЕ РУКОВОДЯЩЕЙ КОМАНДЫ - Создание коалиции лидеров, включение влиятельных людей",
                    "3. ПОЛУЧЕНИЕ ПРАВИЛЬНОГО ВИДЕНИЯ - Разработка четкого видения целей, видение вдохновляет",
                    "4. КОММУНИКАЦИЯ ДЛЯ ПОКУПКИ - Эффективное доведение видения, использование разных каналов",
                    "5. РАСШИРЕНИЕ ПРАВ И ВОЗМОЖНОСТЕЙ - Удаление барьеров, упрощение процессов",
                    "6. СОЗДАНИЕ КРАТКОСРОЧНЫХ ПОБЕД - Достижение видимых результатов, признание и награда",
                    "7. НЕ ОТПУСТИТЬ - Предотвращение возврата, усиление успехов, продолжение мотивации",
                    "8. ЗАКРЕПИТЬ ИЗМЕНЕНИЯ - Интеграция в культуру, встраивание в процессы"
                ],
                whenToUse: "Большие стратегические организационные изменения, требуется структурированный подход, необходимо многоэтапное управление",
                bestFor: "Крупные корпоративные трансформации"
            },
            {
                name: "Модель кривой изменений Кюблер-Росс",
                type: "Контекстная",
                developer: "Elisabeth Kübler-Ross, 1960-е годы (Адаптирована для организационных изменений в 1980-х)",
                description: "Модель пяти эмоциональных стадий в ответ на изменения. Первоначально разработана для объяснения процесса горевания",
                phases: [
                    "1. ОТРИЦАНИЕ - Шок, непринятие. Поведение: не верит в необходимость. Задача: Информация и факты",
                    "2. ГНЕВ - Раздражение, возмущение. Поведение: Активное сопротивление. Задача: Признать чувства",
                    "3. ТОРГОВЛЯ - Надежда договориться. Поведение: Попытка найти компромисс. Задача: Слушать предложения",
                    "4. ДЕПРЕССИЯ - Печаль, потеря. Поведение: Снижение производительности. Задача: Психологическая поддержка",
                    "5. ПРИНЯТИЕ - Спокойствие, адаптация. Поведение: Принятие нового состояния. Задача: Постоянное подкрепление"
                ],
                whenToUse: "Значительные, болезненные изменения, изменения связанные с потерей рабочих мест, реструктуризация",
                bestFor: "Управление эмоциональными реакциями, сочувствие, поддержка"
            },
            {
                name: "Методология управления изменениями LaMarsh Global",
                type: "Действенная",
                developer: "LaMarsh Global, 1990-е годы",
                description: "Методология управления изменениями, сосредоточенная на людской стороне для снижения сопротивления. Фокус: идентификация, анализ и смягчение сопротивления сотрудников",
                phases: [
                    "1. ОПРЕДЕЛИТЬ ИЗМЕНЕНИЕ - Четко определить что изменяется, выявить причины, целевое состояние",
                    "2. ПОДГОТОВИТЬ ИЗМЕНЕНИЕ - Подготовить спонсоров, построить команду, разработать коммуникационную стратегию",
                    "3. СПЛАНИРОВАТЬ ИЗМЕНЕНИЕ - Анализ влияния на людей, определение сопротивления",
                    "4. РЕАЛИЗОВАТЬ ИЗМЕНЕНИЕ - Выполнение плана, коммуникация, преодоление сопротивления",
                    "5. ПОДДЕРЖИВАТЬ ИЗМЕНЕНИЕ - Закрепление новых поведений, долгосрочная поддержка"
                ],
                whenToUse: "Ожидается значительное сопротивление, фокус на людской стороне, необходимо управление изменениями",
                bestFor: "Снижение сопротивления, управление людской стороной"
            },
            {
                name: "Трёхэтапная модель изменений Левина",
                type: "Контекстная",
                developer: "Курт Левин, 1951 год",
                description: "Первая научная модель организационного изменения. Описывает три психологических состояния процесса. Две движущие и сдерживающие силы влияют на изменение.",
                phases: [
                    "1️⃣ РАЗМОРАЖИВАНИЕ - Создание мотивации к изменению, осознание необходимости, рассмотрение новых идей, снижение сопротивления",
                    "2️⃣ ИЗМЕНЕНИЕ - Внедрение нового поведения и процессов, обучение новым навыкам, период нестабильности",
                    "3️⃣ ЗАМОРАЖИВАНИЕ - Закрепление новых поведений, встраивание в рутину, интеграция в культуру"
                ],
                whenToUse: "Введение в управление изменениями, маленькие и средние изменения, как основа для понимания других моделей",
                bestFor: "Базовое понимание процесса изменений, начальные инициативы"
            },
            {
                name: "Семиступенчатая модель изменений",
                type: "Действенная",
                developer: "Липпитт, Ватсон, Вестли, 1958 год",
                description: "Расширенная версия модели Левина с фокусом на роль агента изменений (внутреннего или внешнего консультанта).",
                phases: [
                    "1️⃣ Диагностика проблемы - Определение, что нужно изменить",
                    "2️⃣ Оценка мотивации и готовности к изменению",
                    "3️⃣ Оценка ресурсов и компетентности агента изменений",
                    "4️⃣ Отбор прогрессивных объектов и способов действия",
                    "5️⃣ Направление энергии изменения",
                    "6️⃣ Поддержка изменений и управление сопротивлением",
                    "7️⃣ Постепенное завершение отношений помощи"
                ],
                whenToUse: "Проекты с привлечением внешних консультантов, внутренние агенты изменений, организации нуждающиеся в направлении",
                bestFor: "Управление ролью агента изменений, проекты трансформации"
            },
            {
                name: "Управление успешными программами (MSP)",
                type: "Действенная",
                developer: "Office of Government Commerce (Великобритания), 2004 год",
                description: "Комплексная методология для управления портфелями программ трансформации, особенно в государственном секторе.",
                phases: [
                    "1️⃣ ФУНДАМЕНТАЛЬНЫЕ ПРИНЦИПЫ - Видимое спонсорство, полнота и приоритизация",
                    "2️⃣ ТЕМЫ УПРАВЛЕНИЯ - Заинтересованные стороны, преимущества, организационная готовность, управление рисками",
                    "3️⃣ ПОТОК ТРАНСФОРМАЦИИ - Инициирование → Намерение → Трансформирование → Устойчивость"
                ],
                whenToUse: "Крупные программы трансформации, портфельное управление изменениями, государственные и крупные корпоративные проекты",
                bestFor: "Масштабные трансформационные программы, портфельное управление"
            },
            {
                name: "McKinsey Seven-S",
                type: "Контекстная",
                developer: "Том Питерс, Роберт Уотерман (McKinsey), 1980 год",
                description: "Семь взаимосвязанных элементов, определяющих успех организации. Все элементы должны быть в гармонии и поддерживать одна другую.",
                phases: [
                    "ЖЁСТКИЕ: 1️⃣ Стратегия 2️⃣ Структура 3️⃣ Системы",
                    "МЯГКИЕ: 4️⃣ Разделяемые ценности (центр) 5️⃣ Навыки 6️⃣ Персонал 7️⃣ Стиль руководства",
                    "КЛЮЧЕВОЙ ПРИНЦИП: При изменении одного элемента изменяются все остальные"
                ],
                whenToUse: "Комплексная организационная диагностика, планирование трансформации, анализ причин проблем, обеспечение выравнивания",
                bestFor: "Системный анализ, комплексные трансформации, диагностика"
            },
            {
                name: "Модель конгруэнтности Надлера и Тушмана",
                type: "Контекстная",
                developer: "Дэвид Надлер, Майкл Тушман, 1980 год",
                description: "Организация как системный феномен - все части должны быть согласованы и поддерживать одна другую. Производительность зависит от соответствия четырёх компонентов.",
                phases: [
                    "1️⃣ РАБОТА - Что должна делать организация",
                    "2️⃣ ЛЮДИ - Навыки, способности, ценности, установки",
                    "3️⃣ ФОРМАЛЬНАЯ ОРГАНИЗАЦИЯ - Структура, системы, процессы, политики",
                    "4️⃣ НЕФОРМАЛЬНАЯ ОРГАНИЗАЦИЯ - Культура, лидерство, социальные связи"
                ],
                whenToUse: "Анализ причин проблем в организации, диагностика сопротивления, определение что менять в приоритете",
                bestFor: "Системная диагностика, анализ причин, выравнивание организации"
            },
            {
                name: "Человеко-ориентированная Реализация (PCI)",
                type: "Действенная",
                developer: "ChangeFirst, 2000-е годы",
                description: "Комплексная методология, сосредоточенная на людской стороне внедрения изменений. Успех зависит от людей, а не только от технологии.",
                phases: [
                    "1️⃣ ЛИДЕРСТВО - Видимая поддержка руководства",
                    "2️⃣ ВОВЛЕЧЕНИЕ - Участие людей в планировании",
                    "3️⃣ ЛОКАЛЬНОЕ СПОНСОРСТВО - Руководители функций как спонсоры",
                    "4️⃣ ЛИЧНАЯ СВЯЗЬ - Понимание индивидуальных потребностей",
                    "5️⃣ ПОДКРЕПЛЕНИЕ - Системы вознаграждения",
                    "6️⃣ ОБЩАЯ ЦЕЛЬ - Ясная артикуляция цели"
                ],
                whenToUse: "Крупные проекты с множеством людей, консервативная культура, высокое потенциальное сопротивление",
                bestFor: "Люди-ориентированные трансформации, вовлечение сотрудников"
            },
            {
                name: "Управление изменениями PMI",
                type: "Действенная",
                developer: "Project Management Institute, 2010 год",
                description: "Интегрирует управление изменениями в существующую структуру управления проектами PMI.",
                phases: [
                    "1️⃣ ПОРТФЕЛЬНЫЙ УРОВЕНЬ - Управление портфелем изменений, выравнивание со стратегией",
                    "2️⃣ ПРОГРАММНЫЙ УРОВЕНЬ - Управление взаимосвязанными проектами, реализация больших инициатив",
                    "3️⃣ ПРОЕКТНЫЙ УРОВЕНЬ - Управление конкретным проектом изменений, тактическое управление"
                ],
                whenToUse: "Компании с культурой PMI, портфельное управление изменениями, множество взаимосвязанных проектов",
                bestFor: "Организации с PMI культурой, портфельное управление"
            },
            {
                name: "Модель Притчетта",
                type: "Высокоуровневая",
                developer: "Price Pritchett, 1994 год",
                description: "Простой четырёхфазный подход к управлению организационными изменениями. Философия: иногда простота эффективнее сложности.",
                phases: [
                    "1️⃣ ИМПЕРАТИВ - Создание понимания необходимости",
                    "2️⃣ ГОТОВНОСТЬ - Подготовка организации, обучение и развитие",
                    "3️⃣ РЕАЛИЗАЦИЯ - Внедрение изменений, поддержка людей",
                    "4️⃣ ПРЕИМУЩЕСТВА - Демонстрация результатов, измерение успеха"
                ],
                whenToUse: "Срочные изменения, организации предпочитающие простоту, проекты со сжатыми сроками",
                bestFor: "Быстрое внедрение, организации со сжатыми сроками"
            },
            {
                name: "Модель Прохаски и ДиКленте (6 Стадий)",
                type: "Высокоуровневая",
                developer: "Джеймс Прохаска, Карло ДиКлементе, 1982 год (Адаптирована для организаций)",
                description: "Люди проходят через серии психологических и поведенческих стадий при изменении. Первоначально для помощи людям бросить курить.",
                phases: [
                    "1️⃣ ПРЕДРАЗМЫШЛЕНИЕ - Человек не думает об изменении",
                    "2️⃣ РАЗМЫШЛЕНИЕ - Человек рассматривает идею изменения",
                    "3️⃣ ПОДГОТОВКА - Человек решил меняться",
                    "4️⃣ ДЕЙСТВИЕ - Человек активно меняет поведение",
                    "5️⃣ ПОДДЕРЖКА - Человек работает над закреплением",
                    "6️⃣ РЕЦИДИВ - Возврат к старому поведению (это нормально!)"
                ],
                whenToUse: "Поведенческие изменения, персональная трансформация, долгосрочные программы развития, работа с сопротивлением",
                bestFor: "Индивидуальные и групповые поведенческие изменения"
            },
            {
                name: "АДКАР (PROSCI)",
                type: "Действенная",
                developer: "Prosci (Jeff Hiatt), 2003 год",
                description: "Пятиэлементная целевая модель, фокусирующаяся на индивидуальном переходе через изменение. Успех изменений = успех в переходе каждого человека.",
                phases: [
                    "A - ОСОЗНАНИЕ (Awareness) - Люди должны осознавать необходимость изменения",
                    "D - ЖЕЛАНИЕ (Desire) - Люди должны хотеть участвовать и поддерживать",
                    "K - ЗНАНИЕ (Knowledge) - Люди должны иметь знания как делать новое",
                    "A - СПОСОБНОСТЬ (Ability) - Люди должны иметь способность выполнять новое поведение",
                    "R - ПОДКРЕПЛЕНИЕ (Reinforcement) - Люди должны получать подкрепление новых поведений"
                ],
                whenToUse: "Крупные организационные трансформации, проекты требующие индивидуальной поддержки, технологические внедрения",
                bestFor: "Трансформация на уровне сотрудников, индивидуальная поддержка"
            },
            {
                name: "Модель принятия инноваций Роджерса",
                type: "Контекстная",
                developer: "Эверетт М. Роджерс, 1962 год",
                description: "Теория распространения инноваций среди населения. Показывает, как люди с разной скоростью принимают новые идеи и технологии.",
                phases: [
                    "1️⃣ ИННОВАТОРЫ (2,5%) - Первопроходцы, любители рисков",
                    "2️⃣ РАННИЕ ПОСЛЕДОВАТЕЛИ (13,5%) - Мнение-лидеры, советчики",
                    "3️⃣ РАННЕЕ БОЛЬШИНСТВО (34%) - Рассудительные, информированные",
                    "4️⃣ ПОЗДНЕЕ БОЛЬШИНСТВО (34%) - Скептичные, консервативные",
                    "5️⃣ ОТСТАЮЩИЕ (16%) - Традиционалисты, сопротивляющиеся"
                ],
                whenToUse: "Внедрение новых технологий, организационные инновации, ролл-ауты по фазам, планирование коммуникации",
                bestFor: "Технологические изменения, инновационные инициативы"
            },
            {
                name: "Пятая дисциплина (Петер Сенге)",
                type: "Контекстная",
                developer: "Питер Сенге, 1990 год",
                description: "Модель обучающейся организации - организация, способная быстро адаптироваться и развиваться. Пять дисциплин для создания будущего.",
                phases: [
                    "1️⃣ СИСТЕМНОЕ МЫШЛЕНИЕ (центральная дисциплина) - Видение связей и взаимодействий",
                    "2️⃣ ЛИЧНОЕ МАСТЕРСТВО - Непрерывное развитие личных способностей",
                    "3️⃣ МЕНТАЛЬНЫЕ МОДЕЛИ - Глубокие убеждения и образы о мире",
                    "4️⃣ ОБЩЕЕ ВИДЕНИЕ - Совместное видение желаемого будущего",
                    "5️⃣ КОМАНДНОЕ ОБУЧЕНИЕ - Развитие способности команды к совместному обучению"
                ],
                whenToUse: "Формирование культуры постоянного обучения, долгосрочные трансформации, развитие лидеров будущего",
                bestFor: "Культурная трансформация, формирование обучающейся организации"
            },
            {
                name: "Динамические возможности (Дэвид Тиес)",
                type: "Контекстная",
                developer: "Дэвид Тиес (David Teece), 1997 год",
                description: "Способность организации быстро интегрировать, создавать и переконфигурировать компетенции для ответа на вызовы рынка.",
                phases: [
                    "1️⃣ ЧУВСТВОВАНИЕ (Sensing) - Выявление возможностей и угроз",
                    "2️⃣ ИСПОЛЬЗОВАНИЕ (Seizing) - Мобилизация ресурсов для захвата возможностей",
                    "3️⃣ ТРАНСФОРМАЦИЯ (Transforming) - Переконфигурация компетенций для долгосрочного преимущества"
                ],
                whenToUse: "Быстро меняющиеся рынки, технологические преобразования, развитие организационной ловкости",
                bestFor: "Стратегическое развитие, адаптивность организации"
            },
            {
                name: "Сложные адаптивные системы (Stacey & Shaw)",
                type: "Контекстная",
                developer: "Ralph Stacey, Patricia Shaw, 2000 год",
                description: "Организация как сложная адаптивная система, в которой изменения нелинейны и не всегда управляемы традиционными методами.",
                phases: [
                    "1️⃣ СЛОЖНОСТЬ - Множество взаимодействующих элементов, нелинейные отношения",
                    "2️⃣ АДАПТИВНОСТЬ - Система адаптируется к окружающей среде",
                    "3️⃣ САМООРГАНИЗАЦИЯ - Система упорядочивает себя без центрального контроля"
                ],
                whenToUse: "Высокая неопределённость (VUCA), сложные организационные системы, инновационные среды",
                bestFor: "Работа в неопределённости, инновационные организации"
            },
            {
                name: "Вирусные изменения (Leandro Herrero)",
                type: "Действенная",
                developer: "Leandro Herrero, 2004 год",
                description: "Распространение изменений через социальное 'заражение' путём активных сторонников и влиятельных лиц. Изменения как вирус.",
                phases: [
                    "1️⃣ ОТКРЫТИЕ (Discovery) - Выявление инициаторов и культурных вирусов",
                    "2️⃣ РАЗВИТИЕ (Development) - Развитие вируса (идеи) и его носителей",
                    "3️⃣ ВОВЛЕЧЕНИЕ (Engagement) - Вовлечение более широких кругов",
                    "4️⃣ ДИФФУЗИЯ (Diffusion) - Быстрое распространение по организации",
                    "5️⃣ ПОДДЕРЖКА (Support) - Закрепление и долгосрочная поддержка"
                ],
                whenToUse: "Культурные изменения, корпоративные инициативы, инновационные изменения, когда нужна быстрая диффузия",
                bestFor: "Органическое распространение идей, культурные трансформации"
            },
            {
                name: "Шестиблочная модель Вейсборда",
                type: "Контекстная",
                developer: "Marvin Weisboard, 1976 год",
                description: "Диагностический инструмент для анализа шести аспектов эффективной организации. Найти причины проблем в организации.",
                phases: [
                    "1️⃣ ЦЕЛИ (Purpose) - Понимают ли люди цель организации",
                    "2️⃣ СТРУКТУРА (Structure) - Служит ли структура целям",
                    "3️⃣ ОТНОШЕНИЯ (Relationships) - Как люди работают вместе",
                    "4️⃣ ВОЗНАГРАЖДЕНИЕ (Rewards) - Вознаграждаются ли желаемые поведения",
                    "5️⃣ ЛИДЕРСТВО (Leadership) - Какое руководство",
                    "6️⃣ ВСПОМОГАТЕЛЬНЫЕ МЕХАНИЗМЫ (Helpful Mechanisms) - Есть ли системы поддержки"
                ],
                whenToUse: "Диагностика организационных проблем, определение приоритетов для изменений, комплексный анализ эффективности",
                bestFor: "Системный анализ, диагностика проблем, планирование улучшений"
            },
            {
                name: "Управление переходом Уильяма Бриджеса",
                type: "Контекстная",
                developer: "William Bridges, 1991 год",
                description: "Отличие между ИЗМЕНЕНИЕМ и ПЕРЕХОДОМ. Изменение = внешнее. Переход = внутреннее, психологический процесс. Люди могут пережить изменение, но могут не справиться с переходом.",
                phases: [
                    "1️⃣ ЗАВЕРШЕНИЕ (Ending) - Конец старого способа, период потери. Эмоции: печаль, страх, гнев",
                    "2️⃣ НЕЙТРАЛЬНАЯ ЗОНА (Neutral Zone) - Старое отпущено, новое ещё не принято. САМАЯ ВАЖНАЯ ФАЗА",
                    "3️⃣ НОВОЕ НАЧАЛО (New Beginning) - Новые процессы становятся привычкой, новая идентичность"
                ],
                whenToUse: "Значительные, болезненные изменения, реструктуризация, сокращения, изменения идентичности",
                bestFor: "Понимание психологии переходов, сочувственное управление"
            },
            {
                name: "Теория U (Otto Scharmer)",
                type: "Контекстная",
                developer: "Otto Scharmer, 2007 год",
                description: "Глубокая трансформация связана с глубокой трансформацией сознания и внимания. Основной вопрос: 'Из какого места (качества сознания) мы действуем?'",
                phases: [
                    "ДВИЖЕНИЕ ВНИЗ - Открыть: отпустить предыдущие убеждения. Вынырнуть: глубокая рефлексия",
                    "ДВИЖЕНИЕ ПО ДНУ - Присутствие: момент преобразующего осознания. Прорыв: новое качество сознания",
                    "ДВИЖЕНИЕ ВВЕРХ - Прообраз: кристаллизация нового видения. Создать: воплощение нового в действии"
                ],
                whenToUse: "Трансформирующие изменения, развитие лидеров будущего, организационные крупные сдвиги, инновационные инициативы",
                bestFor: "Глубокие трансформации, развитие лидеров, инновация"
            },
            {
                name: "Теории изменений (Theory of Change)",
                type: "Вспомогательная",
                developer: "Инициатива комьюнити (Community Change Inc.), 1995 год",
                description: "Методология планирования, которая связывает конкретные действия с долгосрочными целями. Если мы сделаем X, то произойдет Y, что приведет к Z.",
                phases: [
                    "1️⃣ ВИДЕНИЕ - Описание идеального будущего состояния",
                    "2️⃣ РЕЗУЛЬТАТЫ - Конкретные изменения, необходимые для достижения видения",
                    "3️⃣ ПОКАЗАТЕЛИ УСПЕХА - Как мы узнаем, что результат достигнут",
                    "4️⃣ ДЕЯТЕЛЬНОСТЬ - Конкретные действия для достижения результатов",
                    "5️⃣ ВХОДЫ - Ресурсы, необходимые для деятельности",
                    "6️⃣ ПРЕДПОЛОЖЕНИЯ - Что мы считаем верным, какие риски"
                ],
                whenToUse: "Проектное планирование, социальные инициативы, причинно-следственный анализ, оценка программ",
                bestFor: "Планирование программ, связь действий с результатами"
            },
            {
                name: "Позитивное отклонение (Positive Deviance)",
                type: "Действенная",
                developer: "Джерри Стернин, Моник Стернин, 1990 год",
                description: "Подход, использующий успехи отдельных людей или групп как основу для масштабирования изменений. Решения часто уже существуют в сообществе - нужно их обнаружить и масштабировать.",
                phases: [
                    "1️⃣ ОПРЕДЕЛИТЬ ПРОБЛЕМУ - Четко определить вызов",
                    "2️⃣ НАЙТИ ПОЗИТИВНЫХ ДЕВИАНТОВ - Выявить людей, которые успешны несмотря на условия",
                    "3️⃣ ИЗУЧИТЬ ИХ ПОВЕДЕНИЕ - Глубокое исследование их подхода",
                    "4️⃣ РАЗРАБОТАТЬ РЕШЕНИЯ - На основе позитивных девиантов",
                    "5️⃣ МАСШТАБИРОВАТЬ ИЗМЕНЕНИЯ - Распространить успешные практики на большей группе"
                ],
                whenToUse: "Социальные трансформации, корпоративные программы развития, распространение лучших практик, малобюджетные проекты",
                bestFor: "Органическое распространение успеха, социальные инициативы"
            },
            {
                name: "BPI - Перестройка деловых процессов",
                type: "Действенная",
                developer: "Michael Hammer, James Champy, 1993 год",
                description: "Радикальное переосмысление и переделка бизнес-процессов для достижения выдающихся улучшений. Не просто улучшение существующих процессов (incremental), а полная переделка (radical redesign).",
                phases: [
                    "1️⃣ РАДИКАЛЬНЫЙ - Не небольшие улучшения, полная переделка процесса, переосмысление с нуля",
                    "2️⃣ ПРОЦЕССЫ - Фокус на процессах, не функциях, кросс-функциональные процессы",
                    "3️⃣ ВЫДАЮЩИЕСЯ - Результаты значительные, не частичные, часто 10-кратные улучшения",
                    "ЭТАПЫ: Определить процесс → Установить видение результата → Спроектировать новый процесс → Реализовать → Закрепить и непрерывно улучшать"
                ],
                whenToUse: "Критичные процессы требуют улучшения, конкуренция требует радикальных перемен, появились новые технологии, текущие процессы устарели",
                bestFor: "Операционная трансформация, переделка процессов"
            },
            {
                name: "Звездная модель организации (Galbraith)",
                type: "Контекстная",
                developer: "Jay Galbraith, 1995 год",
                description: "Пять взаимосвязанных элементов успешной организации - вместе они образуют 'звезду'. Все пять элементов должны быть согласованы для эффективности.",
                phases: [
                    "1️⃣ СТРАТЕГИЯ - Направление организации, стратегические приоритеты, позиционирование рынка",
                    "2️⃣ СТРУКТУРА - Организационный дизайн, иерархия подразделений, линии отчетности",
                    "3️⃣ СИСТЕМЫ И ПРОЦЕССЫ - Информационные системы, управленческие процессы, контрольные механизмы",
                    "4️⃣ ЛЮДИ И КОМПЕТЕНЦИИ - Навыки и способности, уровень развития, мотивация",
                    "5️⃣ ВОЗНАГРАЖДЕНИЕ - Система компенсации, мотивации, признание и награды",
                    "ЦЕНТР ЗВЕЗДЫ: Лидерство - объединяет все пять элементов"
                ],
                whenToUse: "Организационный дизайн, диагностика проблем, планирование преобразований, выравнивание организации",
                bestFor: "Системный анализ, организационный дизайн"
            },
            {
                name: "Канвас управления изменениями",
                type: "Действенная",
                developer: "Владимиров Дмитрий, 2020-е годы",
                description: "Визуальный инструмент интегрированного планирования всех элементов управления изменениями. Canvas - живой документ, постоянно обновляется.",
                phases: [
                    "1️⃣ ТЕКУЩЕЕ СОСТОЯНИЕ - Анализ существующей ситуации, текущие проблемы, готовность организации",
                    "2️⃣ ВИДЕНИЕ БУДУЩЕГО - Желаемое состояние, целевые результаты, новые процессы",
                    "3️⃣ ДРАЙВЕРЫ ИЗМЕНЕНИЙ - Внешние причины, внутренние причины, срочность",
                    "4️⃣ ВЛИЯНИЕ НА ОРГАНИЗАЦИЮ - Затронутые подразделения, основные риски, финансовое влияние",
                    "5️⃣ КЛЮЧЕВЫЕ ИНИЦИАТИВЫ - Основные проекты, этапы внедрения, взаимосвязи",
                    "6️⃣ РОЛИ И ОТВЕТСТВЕННОСТЬ - Спонсор изменений, лидер изменений, RACI матрица",
                    "7️⃣ ВРЕМЕННАЯ ШКАЛА - Сроки реализации, ключевые вехи, фазы внедрения",
                    "8️⃣ КОММУНИКАЦИЯ - Стратегия коммуникации, целевые аудитории, каналы и форматы",
                    "9️⃣ ИЗМЕРЕНИЕ УСПЕХА - Ключевые показатели, метрики достижения, критерии успеха",
                    "🔟 ПОДДЕРЖКА И РЕСУРСЫ - Бюджет, человеческие ресурсы, технологические инструменты"
                ],
                whenToUse: "Планирование крупных изменений, выравнивание заинтересованных сторон, документирование программы, мониторинг прогресса",
                bestFor: "Комплексное планирование, выравнивание, документирование"
            }
        ];
        
        // Contemporary & New Models 2025 (Models 48-55)
        const newModels = [
            {
                name: "Модель Сатир",
                type: "Контекстная",
                developer: "Virginia Satir, 1980-е годы (Адаптирована для организаций)",
                description: "Модель эмоционального и психологического пути человека при переходе через изменение. Изменение - это эмоциональное путешествие, не только процесс.",
                phases: [
                    "1️⃣ ПОЗДНИЙ СТАТУС-КВО - Комфорт, привычка, уверенность, контроль. Задача лидера: Создать неудовлетворённость",
                    "2️⃣ СОПРОТИВЛЕНИЕ - Первоначальное потрясение, страх, раздражение, отрицание. ПРОИЗВОДИТЕЛЬНОСТЬ ПАДАЕТ. Задача: Коммуникация и эмпатия",
                    "3️⃣ ХАОС - Максимальная путаница, старое не работает, новое не освоено. ПРОИЗВОДИТЕЛЬНОСТЬ МИНИМАЛЬНА. КРИТИЧНО: Требуется интенсивная поддержка",
                    "4️⃣ ИНТЕГРАЦИЯ - Постепенное признание, начало интуитивных действий. ПРОИЗВОДИТЕЛЬНОСТЬ ВОССТАНАВЛИВАЕТСЯ. Задача: Закрепление и признание",
                    "5️⃣ НОВЫЙ СТАТУС-КВО - Новый комфорт, новое по умолчанию. ПРОИЗВОДИТЕЛЬНОСТЬ ВЫШЕ ИСХОДНОГО. Начало новой спирали изменений"
                ],
                whenToUse: "Значительные, болезненные изменения, реструктуризация, культурные изменения, психологически сложные проекты",
                bestFor: "Управление эмоциональными реакциями, сочувствие"
            },
            {
                name: "Теория подталкивания (Nudge Theory)",
                type: "Вспомогательная",
                developer: "Richard Thaler, Cass Sunstein, 2008 год",
                description: "Дизайн выбора для направления людей к желаемому поведению без ограничения их свободы. Люди имеют предсказуемые смещения в решениях.",
                phases: [
                    "1️⃣ СТАТУС-КВО СМЕЩЕНИЕ - Люди предпочитают текущее состояние. Нужно переделать выбор по умолчанию",
                    "2️⃣ ВЫБОР ПО УМОЛЧАНИЮ - То, что предложено по умолчанию, часто выбирается. Автоматическая запись вместо 'запишитесь'",
                    "3️⃣ СОЦИАЛЬНОЕ ДОКАЗАТЕЛЬСТВО - Люди делают то, что делают другие. '80% коллег уже это делают'",
                    "4️⃣ ОТВРАЩЕНИЕ К ПОТЕРЕ - Люди боятся потерь больше, чем радуются выигрышам. 'Упустив обучение, потеряете преимущество'",
                    "ПРИМЕРЫ: Обучение - автоматическая запись вместо 'запишитесь' (80-90% участия вместо 20-30%)"
                ],
                whenToUse: "Увеличение участия, изменение поведения без конфронтации, большие группы, низкое активное сопротивление",
                bestFor: "Массовые изменения, повышение участия"
            },
            {
                name: "PDCA Цикл (План-Делай-Проверяй-Действуй)",
                type: "Действенная",
                developer: "William Edwards Deming (Walter Shewhart), 1950-е годы (Популярна в 2025)",
                description: "Непрерывный цикл постоянного улучшения, не одноразовая процедура. Изменение = спираль, где каждый цикл выше предыдущего.",
                phases: [
                    "1️⃣ PLAN (Планирование) - Определить цель, проанализировать ситуацию, выработать гипотезу, определить метрики. Пилот на 2 недели",
                    "2️⃣ DO (Тестирование) - Реализовать МАЛЫЙ пилот, собирать данные во время, работать в контролируемых условиях",
                    "3️⃣ CHECK (Проверка) - Оценить результаты, сравнить ожидаемое vs. фактическое, проанализировать почему, документировать обучение",
                    "4️⃣ ACT (Действие) - Если успешно: расширить волну 2. Если неудачно: модифицировать и вернуться к Plan. Начать НОВЫЙ цикл",
                    "КЛЮЧЕВОЕ ОТЛИЧИЕ: НИКОГДА не 'это не сработало' - вместо этого 'что мы узнали?'"
                ],
                whenToUse: "Быстро меняющаяся среда, неопределённость, необходима адаптивность, технологические изменения",
                bestFor: "Быстрые изменения, инновационные организации, стартапы"
            },
            {
                name: "Управление сопротивлением (Маур 3 Уровня)",
                type: "Действенная",
                developer: "Rick Maurer, 1996 год",
                description: "Три различных уровня сопротивления требуют трёх различных подходов. Не все сопротивления одинаковые - нужна диагностика.",
                phases: [
                    "1️⃣ ПЕРВЫЙ УРОВЕНЬ: 'Я не понимаю' - Информационный дефицит. Вопросы: 'Что именно меняется?' РЕШЕНИЕ: Информация и коммуникация",
                    "2️⃣ ВТОРОЙ УРОВЕНЬ: 'Мне это не нравится' - Эмоциональный дефицит. 'Это плохая идея', эмоциональная критика. РЕШЕНИЕ: Вовлечение и поддержка",
                    "3️⃣ ТРЕТИЙ УРОВЕНЬ: 'Я вам не доверяю' - Дефицит доверия. 'Это обман, реальное намерение иное', циничность. РЕШЕНИЕ: Восстановление доверия",
                    "Часто нужны ВСЕ три подхода одновременно с разными группами"
                ],
                whenToUse: "Высокое потенциальное сопротивление, необходимо понимание типов сопротивления, таргетированные подходы к разным группам",
                bestFor: "Управление сопротивлением, диагностика причин"
            },
            {
                name: "МR2P2 (Роль-Причина-Путь-Партнер)",
                type: "Действенная",
                developer: "Различные авторы (интегрирован в современные практики), 2010 год",
                description: "Четыре ключевых элемента, которые каждый человек должен понимать для успешного изменения. Все четыре необходимы.",
                phases: [
                    "1️⃣ РОЛЬ (Role) - Что МНЕ нужно делать? Четко определить новые обязанности, новые навыки, новые способы работы. Результат: Ясность действия",
                    "2️⃣ ПРИЧИНА (Reason) - ПОЧЕМУ мы это делаем? Объяснить контекст, стратегические причины, личную выгоду. Результат: Понимание и мотивация",
                    "3️⃣ ПУТЬ (Path) - КАК я буду это делать и КОГДА? Обучение и развитие, пошаговые инструкции, временная шкала. Результат: Способность действовать",
                    "4️⃣ ПАРТНЕР (Partner) - Кому я могу позвонить, если нужна помощь? Менеджер как спонсор, коуч, система поддержки. Результат: Поддержка и безопасность",
                    "Когда человек может ответить на все четыре вопроса - он готов к изменению"
                ],
                whenToUse: "Персональная поддержка в изменениях, работа с каждым человеком индивидуально, масштабирование поддержки",
                bestFor: "Персональная поддержка, массовые изменения"
            },
            {
                name: "Гибридное управление изменениями",
                type: "Действенная",
                developer: "Современные практики, 2020-е годы",
                description: "Комбинация Waterfall и Agile подходов для больших трансформаций. Не всё можно сделать Agile, не всё нужно планировать на год вперёд.",
                phases: [
                    "СЛОЙ 1: WATERFALL ФУНДАМЕНТ (6-12 месяцев) - Стратегия и видение, дизайн целевого состояния, архитектура и план. Фокус: Правильное определение что менять",
                    "СЛОЙ 2: AGILE РЕАЛИЗАЦИЯ (3-6 месячные волны) - Спринты реализации, итеративное внедрение, частая обратная связь. Фокус: Быстрая реализация с корректировками",
                    "СЛОЙ 3: WATERFALL СТАБИЛИЗАЦИЯ (3-6 месяцев) - Закрепление результатов, интеграция в системы, стандартизация. Фокус: Долгосрочная устойчивость",
                    "ПРЕИМУЩЕСТВА: Стратегический фундамент + Гибкость в реализации + Контролируемый риск + Быстрые результаты + Долгосрочная устойчивость"
                ],
                whenToUse: "Крупные программы трансформации, неопределённость, требующая гибкости, необходимы быстрые результаты, долгосрочные инициативы",
                bestFor: "Крупные программы трансформации, масштабные изменения"
            },
            {
                name: "AI-Усиленное управление изменениями",
                type: "Действенная",
                developer: "Современные практики 2024-2025",
                description: "Использование Искусственного Интеллекта как инструмента для управления изменениями. ИИ - инструмент, не замена человеку.",
                phases: [
                    "1️⃣ АНАЛИЗ НАСТРОЕНИЙ - Мониторинг чатов и коммуникации, выявление областей опасения, раннее предупреждение проблем",
                    "2️⃣ ПРОГНОЗНАЯ АНАЛИТИКА - Предсказание, какие люди будут сопротивляться, выявление рисков на основе данных",
                    "3️⃣ ПЕРСОНАЛИЗИРОВАННЫЕ ПУТИ ОБУЧЕНИЯ - ИИ создаёт индивидуальные пути, адаптация к скорости понимания",
                    "4️⃣ ВИРТУАЛЬНЫЕ КОУЧИ - ИИ-коучи 24/7 поддержка, ответы на вопросы, поддержка на разных языках",
                    "5️⃣ ОПТИМИЗАЦИЯ КОММУНИКАЦИИ - Лучшее время для отправки сообщений, правильный канал для каждого человека",
                    "6️⃣ ИЗМЕРЕНИЕ И ОТЧЁТНОСТЬ - Дашборды готовности в реальном времени, выявление отстающих областей",
                    "⚠️ ОГРАНИЧЕНИЯ: Человеческий контакт остаётся критичным, этика и конфиденциальность важны"
                ],
                whenToUse: "Крупные изменения с множеством людей, необходимость масштабирования, компании с высокой технологичностью, многоязычные организации",
                bestFor: "Масштабируемые трансформации, технологические компании"
            },
            {
                name: "Модель лидерства в условиях неопределённости (VUCA)",
                type: "Контекстная",
                developer: "Современные практики 2024-2025",
                description: "Как лидировать в условиях высокой неопределённости и быстрых изменений. VUCA = Волатильность, Неопределённость, Сложность, Неоднозначность.",
                phases: [
                    "1️⃣ ВИЗИЯ, ЯСНАЯ, НО ГИБКАЯ (Vision) - Ясная долгосрочная направление, НО гибкая в деталях. Люди знают 'зачем', но 'как' адаптируется",
                    "2️⃣ ПОНИМАНИЕ И СЛУШАНИЕ (Understanding) - Глубокое понимание текущей ситуации, слушание 'слабых сигналов'",
                    "3️⃣ ЯСНОСТЬ ЦЕННОСТЕЙ (Clarity) - Ценности как якорь в неопределённости, решения основаны на ценностях",
                    "4️⃣ АДАПТИВНОСТЬ И ГИБКОСТЬ (Agility) - Готовность менять курс, экспериментирование и быстрое обучение, Fail-fast менталитет",
                    "5️⃣ ЛЮДИ И ДОВЕРИЕ - Инвестиции в людей, построение доверия, психологическая безопасность",
                    "НАВЫКИ: Сокращение неопределённости, балансировка плана и адаптации, быстрые решения с неполной информацией"
                ],
                whenToUse: "Быстро меняющаяся среда, высокая неопределённость, развитие лидеров будущего, организационная трансформация",
                bestFor: "Развитие лидеров, управление неопределённостью"
            }
        ];

        // Функция для автоматического расширения данных моделей
        function extendModelData(model) {
            // Определение сложности на основе количества фаз и типа
            let complexity = "Средняя";
            const phaseCount = model.phases ? model.phases.length : 0;

            if (phaseCount <= 3 || model.type === "Вспомогательная") {
                complexity = "Низкая";
            } else if (phaseCount >= 8 || model.type === "Действенная") {
                complexity = "Высокая";
            }

            // Определение масштаба на основе whenToUse и bestFor
            let scale = "Средний";
            const text = (model.whenToUse + " " + model.bestFor).toLowerCase();

            if (text.includes("команда") || text.includes("малый") || text.includes("локальн")) {
                scale = "Малый";
            } else if (text.includes("организаци") || text.includes("корпораци") || text.includes("крупн") || text.includes("трансформаци")) {
                scale = "Крупный";
            }

            // Определение срока на основе сложности и количества фаз
            let duration = "3-6 мес";
            if (complexity === "Низкая" && phaseCount <= 3) {
                duration = "1-3 мес";
            } else if (complexity === "Высокая" || phaseCount >= 8) {
                duration = "6-12 мес";
            } else if (phaseCount >= 5) {
                duration = "3-6 мес";
            }
            if (text.includes("быстр") || text.includes("критичн")) {
                duration = "1-3 мес";
            } else if (text.includes("длительн") || text.includes("комплексн")) {
                duration = "12+ мес";
            }

            // Определение фокуса на основе типа и описания
            let focus = "Процессы";
            if (model.type === "Контекстные") {
                focus = "Стратегия";
            } else if (model.type === "Высокоуровневые") {
                focus = "Люди";
            } else if (text.includes("люд") || text.includes("психолог") || text.includes("эмоциональн") || text.includes("культур")) {
                focus = "Люди";
            } else if (text.includes("стратег") || text.includes("видени") || text.includes("лидерств")) {
                focus = "Стратегия";
            } else if (text.includes("культур") || text.includes("ценност") || text.includes("поведен")) {
                focus = "Культура";
            }

            // Добавляем новые поля к модели
            model.complexity = complexity;
            model.scale = scale;
            model.duration = duration;
            model.focus = focus;

            return model;
        }

        // Расширяем данные всех моделей
        classicalModels.forEach(model => extendModelData(model));
        newModels.forEach(model => extendModelData(model));

        // СЛАЙД 8 - КЛАССИФИКАЦИЯ
        slidesData.push({
            title: "Классификация: Как распределены 56 моделей",
            subtitle: "Четыре основные категории для каждого сценария",
            content: `
                <div class="grid-2">
                    <div class="card classification-card">
                        <div class="classification-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                                <polyline points="2 17 12 22 22 17"></polyline>
                                <polyline points="2 12 12 17 22 12"></polyline>
                            </svg>
                        </div>
                        <div class="classification-card-content">
                            <span class="type-badge type-contextual">КОНТЕКСТНЫЕ МОДЕЛИ</span>
                            <h3>15 Моделей</h3>
                            <p><strong>Стратегические, макро-подходы</strong></p>
                            <ul class="classification-models-list">
                                <li>Модель Левина</li>
                                <li>Коттер 8-этапов</li>
                                <li>Модель Сатир</li>
                                <li>Переход Бриджеса</li>
                            </ul>
                        </div>
                    </div>
                    <div class="card classification-card">
                        <div class="classification-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17.5 19H9a7 7 0 0 1-5-11.5A7 7 0 0 1 15 2"></path>
                                <path d="M22 10a3 3 0 0 0-3-3h-2.207a5.502 5.502 0 0 0-10.702.5"></path>
                            </svg>
                        </div>
                        <div class="classification-card-content">
                            <span class="type-badge type-highlevel">ВЫСОКОУРОВНЕВЫЕ МОДЕЛИ</span>
                            <h3>10 Моделей</h3>
                            <p><strong>Концептуальные Рамки</strong></p>
                            <ul class="classification-models-list">
                                <li>Бекхард и Харрис</li>
                                <li>Модель Pritchett</li>
                                <li>Модель Carnall</li>
                            </ul>
                        </div>
                    </div>
                    <div class="card classification-card">
                        <div class="classification-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                            </svg>
                        </div>
                        <div class="classification-card-content">
                            <span class="type-badge type-actionable">ДЕЙСТВЕННЫЕ МОДЕЛИ</span>
                            <h3>26 Моделей</h3>
                            <p><strong>Пошаговые, подробные методологии</strong></p>
                            <ul class="classification-models-list">
                                <li>АДКАР</li>
                                <li>АИМ</li>
                                <li>ГЕ КАП</li>
                                <li>PDCA</li>
                                <li>Гибридный подход</li>
                            </ul>
                        </div>
                    </div>
                    <div class="card classification-card">
                        <div class="classification-card-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                            </svg>
                        </div>
                        <div class="classification-card-content">
                            <span class="type-badge type-supporting">ВСПОМОГАТЕЛЬНЫЕ МОДЕЛИ</span>
                            <h3>8 Моделей</h3>
                            <p><strong>Инструменты и методологии поддержки</strong></p>
                            <ul class="classification-models-list">
                                <li>Теория подталкивания</li>
                                <li>AI-усиленный</li>
                                <li>Теории изменений</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="classification-highlight-box">
                    <strong>Всего: 56 моделей, охватывающих каждый сценарий организационных изменений</strong>
                </div>
            `
        });

        // Add model slides to slidesData
        classicalModels.forEach((model, index) => {
            slidesData.push({
                title: `${index + 1}. ${model.name}`,
                subtitle: `Тип: ${model.type} | ${model.developer}`,
                content: `
                    <div class="model-slide">
                        <div class="model-info">
                            <span class="type-badge type-${model.type.toLowerCase()}">${model.type.toUpperCase()}</span>
                            <h4>Описание</h4>
                            <p>${model.description}</p>
                            <h4>Ключевые Этапы/Компоненты</h4>
                            <ul>
                                ${model.phases.map(phase => `<li>${phase}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="model-info">
                            <h4>Когда Использовать</h4>
                            <p>${model.whenToUse}</p>
                            <div class="best-for">
                                <strong>Лучше всего для:</strong><br>
                                ${model.bestFor}
                            </div>
                        </div>
                    </div>
                `
            });
        });
        
        newModels.forEach((model, index) => {
            slidesData.push({
                title: `${classicalModels.length + index + 1}. ${model.name}`,
                subtitle: `Тип: ${model.type} | ${model.developer}`,
                content: `
                    <div class="model-slide">
                        <div class="model-info">
                            <span class="type-badge type-${model.type.toLowerCase()}">${model.type.toUpperCase()}</span>
                            <h4>Описание</h4>
                            <p>${model.description}</p>
                            <h4>Ключевые Этапы/Компоненты</h4>
                            <ul>
                                ${model.phases.map(phase => `<li>${phase}</li>`).join('')}
                            </ul>
                        </div>
                        <div class="model-info">
                            <h4>Когда использовать</h4>
                            <p>${model.whenToUse}</p>
                            <div class="best-for">
                                <strong>Лучше всего для:</strong><br>
                                ${model.bestFor}
                            </div>
                        </div>
                    </div>
                `
            });
        });

        // РАЗДЕЛИТЕЛЬ: ПРАКТИЧЕСКИЕ ИНСТРУМЕНТЫ
        slidesData.push({
            title: "Практические инструменты",
            subtitle: "Интерактивные инструменты для оценки и планирования ваших проектов",
            content: `
                <div class="tools-slide-modern">
                    <!-- Сетка карточек 3x2 (5 инструментов + CTA) -->
                    <div class="tools-grid-3x2">
                        <div class="card">
                            <div class="tool-card-content">
                                <div class="tool-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                    </svg>
                                </div>
                                <h3>Квиз профиля</h3>
                                <span class="tool-time">5 мин</span>
                            </div>
                        </div>
                        <div class="card">
                            <div class="tool-card-content">
                                <div class="tool-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="1" x2="12" y2="23"></line>
                                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                    </svg>
                                </div>
                                <h3>Калькулятор ROI</h3>
                                <span class="tool-time">10 мин</span>
                            </div>
                        </div>
                        <div class="card">
                            <div class="tool-card-content">
                                <div class="tool-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="12" cy="12" r="10"></circle>
                                        <circle cx="12" cy="12" r="6"></circle>
                                        <circle cx="12" cy="12" r="2"></circle>
                                    </svg>
                                </div>
                                <h3>Диагностика готовности</h3>
                                <span class="tool-time">15 мин</span>
                            </div>
                        </div>
                        <div class="card">
                            <div class="tool-card-content">
                                <div class="tool-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"></path>
                                    </svg>
                                </div>
                                <h3>Конструктор моделей</h3>
                                <span class="tool-time">20 мин</span>
                            </div>
                        </div>
                        <div class="card">
                            <div class="tool-card-content">
                                <div class="tool-icon">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="12" y1="20" x2="12" y2="10"></line>
                                        <line x1="18" y1="20" x2="18" y2="4"></line>
                                        <line x1="6" y1="20" x2="6" y2="16"></line>
                                    </svg>
                                </div>
                                <h3>PCT оценка</h3>
                                <span class="tool-time">25 мин</span>
                            </div>
                        </div>
                        <div class="card tool-card-cta" onclick="jumpToSlide(63)">
                            <div class="tool-card-content">
                                <div class="tool-icon icon-cta">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                    </svg>
                                </div>
                                <h3>Продолжить</h3>
                            </div>
                        </div>
                    </div>
                </div>
            `
        });

        // ИНТЕРАКТИВНЫЙ КВИЗ
        slidesData.push({
            title: "Интерактивный квиз",
            subtitle: "Определите свой профиль управления изменениями",
            content: `
                <div class="practice-path-indicator">
                    <div class="path-indicator-header">
                        <h4>Путь оценки проекта</h4>
                        <span class="current-step">Шаг 1 из 5</span>
                    </div>
                    <div class="path-indicator">
                        <div class="path-step-indicator active" onclick="jumpToSlide(63)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Квиз</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(64)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path>
                                </svg>
                            </div>
                            <div class="step-label">ROI</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(65)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <circle cx="12" cy="8.5" r="3.5"></circle>
                                    <path d="M6 19c0-3.3 2.7-6 6-6s6 2.7 6 6"></path>
                                </svg>
                            </div>
                            <div class="step-label">Готовность</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(66)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Конструктор</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(67)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                </svg>
                            </div>
                            <div class="step-label">PCT</div>
                        </div>
                    </div>
                    <div class="path-navigation">
                        <button class="path-nav-btn secondary" onclick="const idx = findSlideIndexByKeyword('Выберите то, что полезно'); if (idx >= 0) jumpToSlide(idx);">← Назад</button>
                        <button class="path-nav-btn" onclick="jumpToSlide(64)">Следующий шаг →</button>
                    </div>
                </div>

                <div class="quiz-tool">
                    <div class="quiz-intro">
                        <p><strong>Мини-квиз</strong> поможет определить ваш текущий подход к управлению изменениями и подобрать наиболее подходящие модели.</p>
                        <p>Ответьте на 7 вопросов и получите персонализированные рекомендации.</p>
                    </div>

                    <div class="quiz-progress">
                        <div class="quiz-progress-bar">
                            <div class="quiz-progress-fill" id="quizProgressFill"></div>
                        </div>
                        <span class="quiz-progress-text" id="quizProgressText">Вопрос 1 из 7</span>
                    </div>

                    <div class="quiz-question" id="quizQuestion"></div>

                    <div class="quiz-navigation">
                        <button class="quiz-nav-btn secondary" id="quizPrevBtn" style="display: none;" onclick="prevQuizQuestion()">← Назад</button>
                        <button class="quiz-nav-btn" id="quizNextBtn" onclick="nextQuizQuestion()">Далее →</button>
                    </div>
                </div>

                <div class="quiz-results" id="quizResults" style="display: none;">
                    <h3>Ваш профиль управления изменениями</h3>

                    <div class="quiz-profile" id="quizProfile"></div>

                    <div class="quiz-recommendations" id="quizRecommendations"></div>

                    <div class="quiz-actions">
                        <button class="panel-button" onclick="exportQuizResults()">📄 Скачать результаты</button>
                        <button class="panel-button secondary" onclick="confirmResetQuiz()">🔄 Пройти снова</button>
                    </div>
                </div>
            `
        });

        // КАЛЬКУЛЯТОР ROI
        slidesData.push({
            title: "Калькулятор ROI изменений",
            subtitle: "Оцените финансовую эффективность ваших проектов изменений",
            content: `
                <div class="practice-path-indicator">
                    <div class="path-indicator-header">
                        <h4>Путь оценки проекта</h4>
                        <span class="current-step">Шаг 2 из 5</span>
                    </div>
                    <div class="path-indicator">
                        <div class="path-step-indicator completed" onclick="jumpToSlide(63)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Квиз</div>
                        </div>
                        <div class="path-connector completed"></div>
                        <div class="path-step-indicator active" onclick="jumpToSlide(64)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path>
                                </svg>
                            </div>
                            <div class="step-label">ROI</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(65)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <circle cx="12" cy="8.5" r="3.5"></circle>
                                    <path d="M6 19c0-3.3 2.7-6 6-6s6 2.7 6 6"></path>
                                </svg>
                            </div>
                            <div class="step-label">Готовность</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(66)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Конструктор</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(67)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                </svg>
                            </div>
                            <div class="step-label">PCT</div>
                        </div>
                    </div>
                    <div class="path-navigation">
                        <button class="path-nav-btn secondary" onclick="jumpToSlide(63)">← Предыдущий шаг</button>
                        <button class="path-nav-btn" onclick="jumpToSlide(65)">Следующий шаг →</button>
                    </div>
                </div>

                <div class="roi-calculator">
                    <div class="roi-intro">
                        <p><strong>Калькулятор ROI</strong> поможет оценить экономическую эффективность ваших проектов изменений и обосновать инвестиции в управление изменениями.</p>
                        <p>Введите данные о вашем проекте для расчета возврата на инвестиции.</p>
                    </div>

                    <div class="roi-form">
                        <div class="roi-input-group">
                            <h4>Инвестиции в проект</h4>
                            <div class="roi-input-row">
                                <label for="projectBudget">
                                    Бюджет проекта (руб.):
                                    <span class="roi-tooltip" title="Общий бюджет проекта изменений. Используется для справки, не влияет на расчет ROI.">ℹ️</span>
                                </label>
                                <input type="number" id="projectBudget" placeholder="1000000" step="10000" title="Общий бюджет проекта изменений">
                            </div>
                            <div class="roi-input-row">
                                <label for="changeBudget">
                                    Стоимость управления изменениями (руб.):
                                    <span class="roi-tooltip" title="Обязательное поле. Общая стоимость внедрения управления изменениями (консультанты, обучение, инструменты и т.д.)">*</span>
                                </label>
                                <input type="number" id="changeBudget" placeholder="200000" step="10000" required title="Обязательное поле. Общая стоимость внедрения управления изменениями">
                            </div>
                        </div>

                        <div class="roi-input-group">
                            <h4>Ожидаемые выгоды</h4>
                            <div class="roi-input-row">
                                <label for="turnoverSavings">
                                    Экономия на увольнениях (руб./год):
                                    <span class="roi-tooltip" title="Экономия от снижения текучести кадров. Включает затраты на найм, обучение и потерю продуктивности.">ℹ️</span>
                                </label>
                                <input type="number" id="turnoverSavings" placeholder="500000" step="10000" min="0" title="Экономия от снижения текучести кадров в год">
                            </div>
                            <div class="roi-input-row">
                                <label for="productivityGain">
                                    Повышение производительности (%):
                                    <span class="roi-tooltip" title="Ожидаемый процент повышения производительности сотрудников благодаря управлению изменениями. Обычно 5-25%.">ℹ️</span>
                                </label>
                                <input type="number" id="productivityGain" placeholder="15" step="0.1" min="0" max="100" title="Ожидаемый процент повышения производительности">
                            </div>
                            <div class="roi-input-row">
                                <label for="avgSalary">
                                    Средняя зарплата сотрудника (руб./год):
                                    <span class="roi-tooltip" title="Средняя годовая зарплата сотрудника. Используется для расчета выгод от повышения производительности.">ℹ️</span>
                                </label>
                                <input type="number" id="avgSalary" placeholder="800000" step="10000" min="0" title="Средняя годовая зарплата сотрудника">
                            </div>
                            <div class="roi-input-row">
                                <label for="employeeCount">
                                    Количество сотрудников:
                                    <span class="roi-tooltip" title="Количество сотрудников, затронутых изменениями. Используется для расчета выгод от производительности.">ℹ️</span>
                                </label>
                                <input type="number" id="employeeCount" placeholder="50" step="1" min="0" title="Количество сотрудников, затронутых изменениями">
                            </div>
                        </div>

                        <div class="roi-input-group">
                            <h4>Параметры расчета</h4>
                            <div class="roi-input-row">
                                <label for="evaluationPeriod">
                                    Период оценки (лет):
                                    <span class="roi-tooltip" title="Период времени для оценки ROI. Рекомендуется 3-5 лет.">ℹ️</span>
                                </label>
                                <input type="number" id="evaluationPeriod" value="3" min="1" max="10" title="Период времени для оценки ROI">
                            </div>
                            <div class="roi-input-row">
                                <label for="discountRate">
                                    Ставка дисконтирования (%):
                                    <span class="roi-tooltip" title="Ставка для приведения будущих денежных потоков к текущей стоимости. Обычно 8-12%.">ℹ️</span>
                                </label>
                                <input type="number" id="discountRate" value="10" step="0.5" min="0" max="50" title="Ставка дисконтирования для расчета NPV">
                            </div>
                        </div>

                        <div class="roi-scenario-toggle">
                            <label>
                                <input type="checkbox" id="showComparison" checked>
                                <span>Показать сравнение "Без УИ" vs "С УИ"</span>
                            </label>
                        </div>

                        <button class="panel-button" id="calculateROI" type="button">📊 Рассчитать ROI</button>
                    </div>

                    <div class="roi-results" id="roiResults" style="display: none;">
                        <h3>Результаты расчета</h3>

                        <div class="roi-summary">
                            <div class="roi-metric">
                                <div class="roi-metric-value" id="roiValue">0%</div>
                                <div class="roi-metric-label">ROI проекта</div>
                            </div>
                            <div class="roi-metric">
                                <div class="roi-metric-value" id="npvValue">0 руб.</div>
                                <div class="roi-metric-label">Чистая приведенная стоимость</div>
                            </div>
                            <div class="roi-metric">
                                <div class="roi-metric-value" id="irrValue">0%</div>
                                <div class="roi-metric-label">IRR (внутренняя норма доходности)</div>
                            </div>
                            <div class="roi-metric">
                                <div class="roi-metric-value" id="paybackValue">0 лет</div>
                                <div class="roi-metric-label">Срок окупаемости</div>
                            </div>
                        </div>

                        <div class="roi-comparison" id="roiComparison" style="display: none;">
                            <h4>Сравнение сценариев</h4>
                            <div class="roi-comparison-grid">
                                <div class="roi-comparison-item">
                                    <div class="comparison-label">Без управления изменениями</div>
                                    <div class="comparison-value negative" id="comparisonWithoutUI">-</div>
                                    <div class="comparison-detail" id="comparisonWithoutUIDetail"></div>
                                </div>
                                <div class="roi-comparison-item">
                                    <div class="comparison-label">С управлением изменениями</div>
                                    <div class="comparison-value positive" id="comparisonWithUI">-</div>
                                    <div class="comparison-detail" id="comparisonWithUIDetail"></div>
                                </div>
                                <div class="roi-comparison-item highlight">
                                    <div class="comparison-label">Разница (выгода от УИ)</div>
                                    <div class="comparison-value highlight" id="comparisonDifference">-</div>
                                    <div class="comparison-detail" id="comparisonDifferenceDetail"></div>
                                </div>
                            </div>
                        </div>

                        <div class="roi-breakdown">
                            <h4>Детализация расчетов</h4>
                            <div id="roiBreakdown"></div>
                        </div>

                        <div class="roi-sensitivity" id="roiSensitivity" style="display: none;">
                            <div class="roi-sensitivity-header">
                                <h4>Анализ чувствительности</h4>
                                <button class="roi-sensitivity-toggle" onclick="toggleSensitivity()">▼ Свернуть</button>
                            </div>
                            <div class="roi-sensitivity-content" id="roiSensitivityContent">
                                <p class="roi-sensitivity-intro">Посмотрите, как изменение ключевых параметров влияет на ROI, NPV и срок окупаемости.</p>
                                <div class="roi-sensitivity-controls">
                                    <div class="sensitivity-slider-group">
                                        <label for="sensitivityCost">
                                            Стоимость УИ: <span id="sensitivityCostValue">100%</span>
                                        </label>
                                        <input type="range" id="sensitivityCost" min="70" max="130" value="100" step="5" 
                                               oninput="updateSensitivity('cost', this.value)">
                                    </div>
                                    <div class="sensitivity-slider-group">
                                        <label for="sensitivityProductivity">
                                            Производительность: <span id="sensitivityProductivityValue">100%</span>
                                        </label>
                                        <input type="range" id="sensitivityProductivity" min="80" max="120" value="100" step="5" 
                                               oninput="updateSensitivity('productivity', this.value)">
                                    </div>
                                    <div class="sensitivity-slider-group">
                                        <label for="sensitivityTurnover">
                                            Экономия на текучести: <span id="sensitivityTurnoverValue">100%</span>
                                        </label>
                                        <input type="range" id="sensitivityTurnover" min="70" max="130" value="100" step="5" 
                                               oninput="updateSensitivity('turnover', this.value)">
                                    </div>
                                </div>
                                <div class="roi-sensitivity-results" id="roiSensitivityResults"></div>
                            </div>
                        </div>

                        <div class="roi-chart-container">
                            <canvas id="roiChart" width="400" height="200"></canvas>
                        </div>

                        <div class="roi-actions">
                            <button class="panel-button" onclick="exportROIToPDF()">📄 Сохранить в PDF</button>
                            <button class="panel-button" onclick="exportROIToExcel()">📊 Экспорт в Excel</button>
                            <button class="panel-button secondary" onclick="saveROIScenario()">💾 Сохранить сценарий</button>
                            <button class="panel-button secondary" onclick="toggleScenariosList()">📋 Сценарии</button>
                            <button class="panel-button secondary" onclick="resetROICalculator()">🔄 Пересчитать</button>
                        </div>

                        <div class="roi-scenarios-list" id="roiScenariosList" style="display: none;"></div>
                    </div>
                </div>
            `
        });

        // ДИАГНОСТИКА ГОТОВНОСТИ
        slidesData.push({
            title: "Диагностика готовности к изменениям",
            subtitle: "Оцените текущую готовность вашей организации к успешному внедрению изменений",
            content: `
                <div class="practice-path-indicator">
                    <div class="path-indicator-header">
                        <h4>Путь оценки проекта</h4>
                        <span class="current-step">Шаг 3 из 5</span>
                    </div>
                    <div class="path-indicator">
                        <div class="path-step-indicator completed" onclick="jumpToSlide(63)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Квиз</div>
                        </div>
                        <div class="path-connector completed"></div>
                        <div class="path-step-indicator completed" onclick="jumpToSlide(64)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path>
                                </svg>
                            </div>
                            <div class="step-label">ROI</div>
                        </div>
                        <div class="path-connector completed"></div>
                        <div class="path-step-indicator active" onclick="jumpToSlide(65)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <circle cx="12" cy="8.5" r="3.5"></circle>
                                    <path d="M6 19c0-3.3 2.7-6 6-6s6 2.7 6 6"></path>
                                </svg>
                            </div>
                            <div class="step-label">Готовность</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(66)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Конструктор</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(67)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                </svg>
                            </div>
                            <div class="step-label">PCT</div>
                        </div>
                    </div>
                    <div class="path-navigation">
                        <button class="path-nav-btn secondary" onclick="jumpToSlide(64)">← Предыдущий шаг</button>
                        <button class="path-nav-btn" onclick="jumpToSlide(66)">Следующий шаг →</button>
                    </div>
                </div>

                <div class="readiness-assessment">
                    <!-- Введение -->
                    <div class="readiness-intro">
                        <p><strong>Диагностика готовности к изменениям</strong> помогает определить сильные и слабые стороны организации перед запуском проекта изменений.</p>
                        <p>Ответьте на 10 вопросов по шкале от 1 до 5, где:<br>
                        <strong>1 = Полностью не согласен</strong>, <strong>3 = Затрудняюсь ответить</strong>, <strong>5 = Полностью согласен</strong></p>
                    </div>

                    <!-- Прогресс -->
                    <div class="readiness-progress">
                        <div class="readiness-progress-bar">
                            <div class="readiness-progress-fill" id="readinessProgressFill"></div>
                        </div>
                        <span class="readiness-progress-text" id="readinessProgressText">Вопрос 1 из 10</span>
                    </div>

                    <!-- Вопросы -->
                    <div class="readiness-questions" id="readinessQuestions"></div>

                    <!-- Результаты -->
                    <div class="readiness-results" id="readinessResults" style="display: none;">
                        <h3>Результаты диагностики</h3>

                        <!-- Общий балл -->
                        <div class="readiness-overall">
                            <div class="readiness-overall-score" id="readinessOverallScore">0/50</div>
                            <div class="readiness-overall-level" id="readinessOverallLevel">Низкая готовность</div>
                            <div class="readiness-overall-description" id="readinessOverallDescription"></div>
                        </div>

                        <!-- Радар-чарт -->
                        <div class="readiness-radar-container">
                            <h4>Профиль готовности по категориям</h4>
                            <canvas id="readinessRadarChart" width="400" height="300"></canvas>
                        </div>

                        <!-- Детальные результаты -->
                        <div class="readiness-details">
                            <h4>Детальная оценка по категориям</h4>
                            <div class="readiness-categories" id="readinessCategories"></div>
                        </div>

                        <!-- Рекомендации -->
                        <div class="readiness-recommendations">
                            <h4>Рекомендации по улучшению</h4>
                            <div id="readinessRecommendations"></div>
                        </div>

                        <!-- Действия -->
                        <div class="readiness-actions">
                            <button class="panel-button" onclick="exportReadinessToPDF()">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Сохранить результаты
                            </button>
                            <button class="panel-button secondary" onclick="resetReadinessAssessment()">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="18" height="18">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                    <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                </svg>
                                Пройти снова
                            </button>
                        </div>
                    </div>
                </div>
            `
        });

        // КОНСТРУКТОР ГИБРИДНОЙ МОДЕЛИ
        slidesData.push({
            title: "Конструктор гибридной модели",
            subtitle: "Создайте собственную модель управления изменениями из лучших практик",
            content: `
                <div class="practice-path-indicator">
                    <div class="path-indicator-header">
                        <h4>Путь оценки проекта</h4>
                        <span class="current-step">Шаг 4 из 5</span>
                    </div>
                    <div class="path-indicator">
                        <div class="path-step-indicator completed" onclick="jumpToSlide(63)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Квиз</div>
                        </div>
                        <div class="path-connector completed"></div>
                        <div class="path-step-indicator completed" onclick="jumpToSlide(64)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path>
                                </svg>
                            </div>
                            <div class="step-label">ROI</div>
                        </div>
                        <div class="path-connector completed"></div>
                        <div class="path-step-indicator completed" onclick="jumpToSlide(65)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <circle cx="12" cy="8.5" r="3.5"></circle>
                                    <path d="M6 19c0-3.3 2.7-6 6-6s6 2.7 6 6"></path>
                                </svg>
                            </div>
                            <div class="step-label">Готовность</div>
                        </div>
                        <div class="path-connector completed"></div>
                        <div class="path-step-indicator active" onclick="jumpToSlide(66)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                </svg>
                            </div>
                            <div class="step-label">Конструктор</div>
                        </div>
                        <div class="path-connector"></div>
                        <div class="path-step-indicator" onclick="jumpToSlide(67)" style="cursor: pointer;">
                            <div class="step-icon">
                                <svg viewBox="0 0 24 24" aria-hidden="true">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                </svg>
                            </div>
                            <div class="step-label">PCT</div>
                        </div>
                    </div>
                    <div class="path-navigation">
                        <button class="path-nav-btn secondary" onclick="jumpToSlide(65)">← Предыдущий шаг</button>
                        <button class="path-nav-btn" onclick="jumpToSlide(67)">Следующий шаг →</button>
                    </div>
                </div>

                <div class="hybrid-constructor">
                    <!-- Введение -->
                    <div class="hybrid-intro">
                        <p><strong>Гибридная модель</strong> позволяет комбинировать наиболее эффективные элементы из разных подходов к управлению изменениями для создания решения, идеально подходящего для вашей организации.</p>
                        <p>Выберите базовую модель и добавьте элементы из других подходов для создания уникальной комбинации.</p>
                    </div>

                    <!-- Шаг 1: Выбор базовой модели -->
                    <div class="hybrid-step" id="hybridStep1">
                        <h3>Шаг 1: Выберите базовую модель</h3>
                        <div class="hybrid-base-models" id="hybridBaseModels">
                            <!-- Модели будут загружены динамически -->
                        </div>
                    </div>

                    <!-- Шаг 2: Выбор дополнительных элементов -->
                    <div class="hybrid-step" id="hybridStep2" style="display: none;">
                        <h3>Шаг 2: Добавьте элементы из других моделей</h3>
                        <div class="hybrid-elements" id="hybridElements">
                            <!-- Элементы будут загружены динамически -->
                        </div>
                    </div>

                    <!-- Шаг 3: Предпросмотр и экспорт -->
                    <div class="hybrid-step" id="hybridStep3" style="display: none;">
                        <h3>Шаг 3: Ваша гибридная модель</h3>
                        <div class="hybrid-preview" id="hybridPreview">
                            <!-- Предпросмотр модели -->
                        </div>
                        <div class="hybrid-plan" id="hybridPlan">
                            <!-- План реализации -->
                        </div>
                        <div class="hybrid-actions">
                            <button class="panel-button" onclick="exportConstructorToPDF()">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Сохранить модель
                            </button>
                            <button class="panel-button secondary" onclick="resetHybridConstructor()">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                    <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                </svg>
                                Начать заново
                            </button>
                        </div>
                    </div>

                    <!-- Навигация -->
                    <div class="hybrid-navigation">
                        <button class="panel-button secondary" id="hybridPrevBtn" style="display: none;" onclick="prevHybridStep()">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="15 18 9 12 15 6"></polyline>
                            </svg>
                            Назад
                        </button>
                        <button class="panel-button" id="hybridNextBtn" onclick="nextHybridStep()">
                            Далее
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="9 18 15 12 9 6"></polyline>
                            </svg>
                        </button>
                    </div>
                </div>
            `
        });

        // CLOSING SLIDES
        slidesData.push(
            {
                title: "Оценка Prosci Change Triangle (PCT)",
                subtitle: "Интерактивный инструмент диагностики проекта изменений",
                content: `
                    <div class="practice-path-indicator">
                        <div class="path-indicator-header">
                            <h4>Путь оценки проекта</h4>
                            <span class="current-step">Шаг 5 из 5</span>
                        </div>
                        <div class="path-indicator">
                            <div class="path-step-indicator completed" onclick="jumpToSlide(63)" style="cursor: pointer;">
                                <div class="step-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.1 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path>
                                    </svg>
                                </div>
                                <div class="step-label">Квиз</div>
                            </div>
                            <div class="path-connector completed"></div>
                            <div class="path-step-indicator completed" onclick="jumpToSlide(64)" style="cursor: pointer;">
                                <div class="step-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"></path>
                                    </svg>
                                </div>
                                <div class="step-label">ROI</div>
                            </div>
                            <div class="path-connector completed"></div>
                            <div class="path-step-indicator completed" onclick="jumpToSlide(65)" style="cursor: pointer;">
                                <div class="step-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <circle cx="12" cy="8.5" r="3.5"></circle>
                                        <path d="M6 19c0-3.3 2.7-6 6-6s6 2.7 6 6"></path>
                                    </svg>
                                </div>
                                <div class="step-label">Готовность</div>
                            </div>
                            <div class="path-connector completed"></div>
                            <div class="path-step-indicator completed" onclick="jumpToSlide(66)" style="cursor: pointer;">
                                <div class="step-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path>
                                    </svg>
                                </div>
                                <div class="step-label">Конструктор</div>
                            </div>
                            <div class="path-connector completed"></div>
                            <div class="path-step-indicator active" onclick="jumpToSlide(67)" style="cursor: pointer;">
                                <div class="step-icon">
                                    <svg viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                    </svg>
                                </div>
                                <div class="step-label">PCT</div>
                            </div>
                        </div>
                        <div class="path-navigation">
                            <button class="path-nav-btn secondary" onclick="jumpToSlide(66)">← Предыдущий шаг</button>
                            <button class="path-nav-btn" onclick="jumpToSlide(68)">Завершить →</button>
                        </div>
                    </div>

                    <div class="pct-tool">
                        <!-- Описание методологии -->
                        <div class="pct-intro">
                            <p><strong>Треугольник изменений Prosci (PCT)</strong> — инструмент оценки четырех критических аспектов успешного изменения: Успех, Лидерство/Спонсорство, Управление проектами и Управление изменениями.</p>
                            <p>Оцените каждый из 40 факторов по шкале от 1 до 3, где:<br>
                            <strong>1 = не применимо</strong>, <strong>2 = применимо</strong>, <strong>3 = превосходит ожидания</strong></p>
                        </div>

                        <!-- Прогресс заполнения -->
                        <div class="pct-progress">
                            <span id="pctProgressText">Оценено: 0 из 40 факторов</span>
                            <div class="pct-progress-bar">
                                <div id="pctProgressFill" class="pct-progress-fill"></div>
                            </div>
                        </div>

                        <!-- Табы категорий -->
                        <div class="pct-tabs" id="pctTabs">
                            <button class="pct-tab active" data-category="success" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <circle cx="12" cy="12" r="6"></circle>
                                    <circle cx="12" cy="12" r="2"></circle>
                                </svg>
                                Успех
                            </button>
                            <button class="pct-tab" data-category="leadership" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                </svg>
                                Лидерство
                            </button>
                            <button class="pct-tab" data-category="projectManagement" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <line x1="12" y1="20" x2="12" y2="10"></line>
                                    <line x1="18" y1="20" x2="18" y2="4"></line>
                                    <line x1="6" y1="20" x2="6" y2="16"></line>
                                </svg>
                                Проекты
                            </button>
                            <button class="pct-tab" data-category="changeManagement" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                    <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                </svg>
                                Изменения
                            </button>
                        </div>

                        <!-- Контент категорий -->
                        <div class="pct-content" id="pctContent">
                            <!-- Динамически генерируется JS -->
                        </div>

                        <!-- Панель результатов -->
                        <div class="pct-results" id="pctResults">
                            <h3>Результаты оценки</h3>
                            <div class="pct-scores">
                                <div class="pct-score-item" id="pctScoreSuccess">
                                    <span class="pct-score-label">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="10"></circle>
                                            <circle cx="12" cy="12" r="6"></circle>
                                            <circle cx="12" cy="12" r="2"></circle>
                                        </svg>
                                        Успех
                                    </span>
                                    <span class="pct-score-value">0/30</span>
                                </div>
                                <div class="pct-score-item" id="pctScoreLeadership">
                                    <span class="pct-score-label">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path>
                                        </svg>
                                        Лидерство
                                    </span>
                                    <span class="pct-score-value">0/30</span>
                                </div>
                                <div class="pct-score-item" id="pctScoreProjectManagement">
                                    <span class="pct-score-label">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="12" y1="20" x2="12" y2="10"></line>
                                            <line x1="18" y1="20" x2="18" y2="4"></line>
                                            <line x1="6" y1="20" x2="6" y2="16"></line>
                                        </svg>
                                        Проекты
                                    </span>
                                    <span class="pct-score-value">0/30</span>
                                </div>
                                <div class="pct-score-item" id="pctScoreChangeManagement">
                                    <span class="pct-score-label">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                            <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        </svg>
                                        Изменения
                                    </span>
                                    <span class="pct-score-value">0/30</span>
                                </div>
                            </div>
                            <div class="pct-visualization" id="pctVisualization">
                                <!-- SVG диаграмма -->
                            </div>
                            <div class="pct-recommendations" id="pctRecommendations">
                                <!-- Рекомендации -->
                            </div>
                        </div>

                        <!-- Кнопки действий -->
                        <div class="pct-actions">
                            <button class="panel-button" id="pctActionPlan" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                                    <polyline points="14 2 14 8 20 8"></polyline>
                                    <line x1="16" y1="13" x2="8" y2="13"></line>
                                    <line x1="16" y1="17" x2="8" y2="17"></line>
                                    <polyline points="10 9 9 9 8 9"></polyline>
                                </svg>
                                Сгенерировать план действий
                            </button>
                            <button class="panel-button" id="pctExportPdf" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Экспорт в PDF
                            </button>
                            <button class="panel-button secondary" id="pctReset" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                    <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                </svg>
                                Сбросить оценку
                            </button>
                        </div>
                    </div>
                `
            },
            {
                title: "FAQ: Ключевые вопросы управления изменениями",
                subtitle: "Практические инструменты и ответы на основные вопросы",
                content: `
                    <div class="faq-container" id="faqContainer">
                        <div class="faq-header" id="faqHeader">
                            <div class="faq-breadcrumb" id="faqBreadcrumb">
                                <span class="faq-breadcrumb-item active" onclick="collapseAllFAQTopics()">FAQ</span>
                            </div>
                            <div class="faq-header-controls">
                                <div class="faq-search-wrapper">
                                    <input type="text" class="faq-search-input" id="faqSearchInput" placeholder="Поиск по темам..." oninput="filterFAQTopics(this.value)">
                                    <svg class="faq-search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <circle cx="11" cy="11" r="8"></circle>
                                        <path d="m21 21-4.35-4.35"></path>
                                    </svg>
                                </div>
                                <button class="faq-collapse-all-btn" id="faqCollapseAllBtn" onclick="collapseAllFAQTopics()" style="display: none;">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="18 15 12 9 6 15"></polyline>
                                    </svg>
                                    Свернуть все
                                </button>
                            </div>
                        </div>
                        <div class="faq-topics-grid" id="faqTopicsGrid">
                            <!-- Карточки тем будут сгенерированы через JavaScript -->
                        </div>
                    </div>
                `
            },
            {
                title: "Интерактивный инструмент выбора модели",
                subtitle: "Найдите подходящую модель для вашего проекта",
                content: `
                    <div class="model-selector-tool">
                        <!-- Табы режимов -->
                        <div class="selector-mode-tabs">
                            <button class="mode-tab active" data-mode="table">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 3v18"></path>
                                    <rect x="4" y="7" width="16" height="10" rx="2" ry="2"></rect>
                                </svg>
                                Таблица сравнения
                            </button>
                            <button class="mode-tab" data-mode="matrix">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="3" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="3" width="7" height="7"></rect>
                                    <rect x="14" y="14" width="7" height="7"></rect>
                                    <rect x="3" y="14" width="7" height="7"></rect>
                                </svg>
                                Матрица выбора
                            </button>
                        </div>

                        <!-- Режим 1: Таблица сравнения -->
                        <div class="selector-mode-content" id="tableModeContent">
                            <div class="table-filters">
                                <input type="search" id="modelSearchInput" placeholder="Поиск по названию модели..." aria-label="Поиск моделей">
                                <div class="filter-group">
                                    <button class="filter-btn" data-filter="complexity" data-value="Низкая">Низкая сложность</button>
                                    <button class="filter-btn" data-filter="complexity" data-value="Средняя">Средняя сложность</button>
                                    <button class="filter-btn" data-filter="complexity" data-value="Высокая">Высокая сложность</button>
                                </div>
                                <div class="filter-group">
                                    <button class="filter-btn" data-filter="scale" data-value="Малый">Малый масштаб</button>
                                    <button class="filter-btn" data-filter="scale" data-value="Средний">Средний масштаб</button>
                                    <button class="filter-btn" data-filter="scale" data-value="Крупный">Крупный масштаб</button>
                                </div>
                                <div class="filter-group">
                                    <button class="filter-btn" data-filter="focus" data-value="Люди">Фокус на людях</button>
                                    <button class="filter-btn" data-filter="focus" data-value="Процессы">Фокус на процессах</button>
                                    <button class="filter-btn" data-filter="focus" data-value="Стратегия">Фокус на стратегии</button>
                                    <button class="filter-btn" data-filter="focus" data-value="Культура">Фокус на культуре</button>
                                </div>
                                <button class="reset-filters-btn" id="resetFiltersBtn" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                        <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                    </svg>
                                    Сбросить фильтры
                                </button>
                            </div>
                            <div class="comparison-table-wrapper">
                                <table class="model-comparison-table" id="modelsComparisonTable">
                                    <thead>
                                        <tr>
                                            <th data-sort="name">Название</th>
                                            <th data-sort="type">Тип</th>
                                            <th data-sort="complexity">Сложность</th>
                                            <th data-sort="scale">Масштаб</th>
                                            <th data-sort="duration">Срок</th>
                                            <th data-sort="focus">Фокус</th>
                                            <th>Выбор</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modelsTableBody">
                                        <!-- Динамически генерируется JS -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="selected-models-panel" id="selectedModelsPanel">
                                <div class="selected-models-header">
                                    <h4>Выбранные модели для сравнения (макс. 3)</h4>
                                    <button class="clear-selection-btn" id="clearSelectionBtn" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <line x1="18" y1="6" x2="6" y2="18"></line>
                                            <line x1="6" y1="6" x2="18" y2="18"></line>
                                        </svg>
                                        Очистить
                                    </button>
                                </div>
                                <div id="selectedModelsList"></div>
                                <div class="selected-models-actions">
                                    <button class="compare-models-btn" id="compareModelsBtn" type="button" style="display: none;">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                                        </svg>
                                        Сравнить модели
                                    </button>
                                    <button class="panel-button" onclick="exportSelectedModelsToPDF()">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                            <polyline points="7 10 12 15 17 10"></polyline>
                                            <line x1="12" y1="15" x2="12" y2="3"></line>
                                        </svg>
                                        Экспорт выбранных моделей
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Режим 2: Матрица выбора -->
                        <div class="selector-mode-content" id="matrixModeContent" style="display:none">
                            <div class="selection-matrix">
                                <div class="matrix-step">
                                    <h4>Шаг 0: Ваша роль</h4>
                                    <p class="matrix-step-description">Выберите вашу роль в проекте изменений согласно методологии Prosci</p>
                                    <div class="matrix-parameters">
                                        <div class="matrix-parameter" data-step="0" data-value="TOP">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                                                    <circle cx="9" cy="7" r="4"></circle>
                                                    <path d="M22 21v-2a4 4 0 0 0-3-3.87"></path>
                                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">ТОП (Executive Sponsor)</div>
                                            <div class="matrix-parameter-description">Высшее руководство, спонсор изменений. По данным Prosci, активное спонсорство — ключевой фактор успеха.</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="0" data-value="FunctionalLeader">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                    <circle cx="9" cy="7" r="4"></circle>
                                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Функциональный руководитель</div>
                                            <div class="matrix-parameter-description">Руководитель подразделения, управляющий затронутыми сотрудниками.</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="0" data-value="ChangeAgent">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                                    <line x1="9" y1="3" x2="9" y2="21"></line>
                                                    <line x1="15" y1="3" x2="15" y2="21"></line>
                                                    <line x1="3" y1="9" x2="21" y2="9"></line>
                                                    <line x1="3" y1="15" x2="21" y2="15"></line>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Участник изменений</div>
                                            <div class="matrix-parameter-description">Член команды управления изменениями, реализующий план изменений.</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="matrix-step">
                                    <h4>Шаг 1: Масштаб изменений</h4>
                                    <p class="matrix-step-description">Какой масштаб изменений вы планируете?</p>
                                    <div class="matrix-parameters">
                                        <div class="matrix-parameter" data-step="1" data-value="Малый">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                                                    <circle cx="9" cy="7" r="4"></circle>
                                                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                                                    <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Малый</div>
                                            <div class="matrix-parameter-description">Команда или отдел, локальные процессы</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="1" data-value="Средний">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <rect x="4" y="2" width="16" height="20" rx="2" ry="2"></rect>
                                                    <path d="M9 22v-4h6v4"></path>
                                                    <path d="M8 6h.01"></path>
                                                    <path d="M16 6h.01"></path>
                                                    <path d="M12 6h.01"></path>
                                                    <path d="M12 10h.01"></path>
                                                    <path d="M12 14h.01"></path>
                                                    <path d="M16 10h.01"></path>
                                                    <path d="M16 14h.01"></path>
                                                    <path d="M8 10h.01"></path>
                                                    <path d="M8 14h.01"></path>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Средний</div>
                                            <div class="matrix-parameter-description">Несколько отделов, кросс-функциональные процессы</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="1" data-value="Крупный">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <line x1="2" y1="12" x2="22" y2="12"></line>
                                                    <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Крупный</div>
                                            <div class="matrix-parameter-description">Вся организация или холдинг</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="matrix-step">
                                    <h4>Шаг 2: Скорость внедрения</h4>
                                    <p class="matrix-step-description">Как быстро нужно внедрить изменения?</p>
                                    <div class="matrix-parameters">
                                        <div class="matrix-parameter" data-step="2" data-value="Быстро">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Быстро</div>
                                            <div class="matrix-parameter-description">1-3 месяца, срочные изменения</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="2" data-value="Средне">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <polyline points="12 6 12 12 16 14"></polyline>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Средне</div>
                                            <div class="matrix-parameter-description">3-6 месяцев, сбалансированный подход</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="2" data-value="Долго">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                                                    <line x1="16" y1="2" x2="16" y2="6"></line>
                                                    <line x1="8" y1="2" x2="8" y2="6"></line>
                                                    <line x1="3" y1="10" x2="21" y2="10"></line>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Долго</div>
                                            <div class="matrix-parameter-description">6+ месяцев, фундаментальные изменения</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="matrix-step">
                                    <h4>Шаг 3: Ожидаемый уровень сопротивления</h4>
                                    <p class="matrix-step-description">Насколько сильным вы ожидаете сопротивление изменениям?</p>
                                    <div class="matrix-parameters">
                                        <div class="matrix-parameter" data-step="3" data-value="Низкое">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Низкое</div>
                                            <div class="matrix-parameter-description">Команда готова, изменения ожидаемы, поддержка руководства</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="3" data-value="Среднее">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <line x1="12" y1="2" x2="12" y2="22"></line>
                                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Среднее</div>
                                            <div class="matrix-parameter-description">Смешанные реакции, требуется работа с людьми, частичная поддержка</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="3" data-value="Высокое">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <line x1="15" y1="9" x2="9" y2="15"></line>
                                                    <line x1="9" y1="9" x2="15" y2="15"></line>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Высокое</div>
                                            <div class="matrix-parameter-description">Сильное сопротивление, кризисная ситуация, требуется активная работа</div>
                                        </div>
                                    </div>
                                </div>
                                <div class="matrix-step">
                                    <h4>Шаг 4: Доступные ресурсы</h4>
                                    <p class="matrix-step-description">Какие ресурсы доступны для внедрения изменений?</p>
                                    <div class="matrix-parameters">
                                        <div class="matrix-parameter" data-step="4" data-value="Ограниченные">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <circle cx="12" cy="12" r="10"></circle>
                                                    <line x1="12" y1="8" x2="12" y2="12"></line>
                                                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Ограниченные</div>
                                            <div class="matrix-parameter-description">Минимальный бюджет, 1-2 человека, без внешних консультантов</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="4" data-value="Средние">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                                                    <line x1="9" y1="3" x2="9" y2="21"></line>
                                                    <line x1="3" y1="12" x2="21" y2="12"></line>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Средние</div>
                                            <div class="matrix-parameter-description">Умеренный бюджет, команда 3-5 человек, возможно привлечение консультантов</div>
                                        </div>
                                        <div class="matrix-parameter" data-step="4" data-value="Неограниченные">
                                            <div class="matrix-parameter-icon">
                                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                                                </svg>
                                            </div>
                                            <div class="matrix-parameter-title">Неограниченные</div>
                                            <div class="matrix-parameter-description">Полная поддержка, большая команда, внешние эксперты, сертификация</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="recommendations-panel" id="matrixRecommendations">
                                <div class="recommendations-header">
                                    <h3>Рекомендованные модели</h3>
                                    <p>На основе ваших параметров мы подобрали наиболее подходящие модели</p>
                                </div>
                                <div class="recommended-models" id="recommendedModelsList">
                                    <!-- Рекомендации генерируются JS -->
                                </div>
                                <div class="recommendations-actions">
                                    <button class="restart-matrix-btn" id="restartMatrixBtn" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                            <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                        </svg>
                                        Начать заново
                                    </button>
                                    <button class="panel-button" onclick="jumpToSlide(63)" type="button">
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                                        </svg>
                                        Пройти квиз
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `
            },
            {
                title: "Ключевые рекомендации",
                subtitle: "Инсайты для успешного управления изменениями в современном мире",
                content: `
                    <div class="grid-2">
                        <div class="card">
                            <h3>1. НЕ СУЩЕСТВУЕТ ОДНОЙ "ЛУЧШЕЙ" МОДЕЛИ</h3>
                            <p>Каждая модель подходит для разных ситуаций. Выбор зависит от контекста, культуры, людей. Лучше всего: комбинировать несколько.</p>
                        </div>
                        <div class="card">
                            <h3>2. ЛЮДИ - ВСЕГДА В ЦЕНТРЕ</h3>
                            <p>Технология не вызывает изменения. Люди совершают изменения. Фокус на психологии и эмоциях критичен.</p>
                        </div>
                        <div class="card">
                            <h3>3. ЧЕТЫРЕ КРИТИЧНЫХ ФАКТОРА УСПЕХА</h3>
                            <p>✓ Видимое спонсорство<br>✓ Четкая коммуникация<br>✓ Вовлечение и поддержка<br>✓ Справедливое управление сопротивлением</p>
                        </div>
                        <div class="card">
                            <h3>4. ГИБКОСТЬ И АДАПТАЦИЯ ВАЖНЕЕ ПЛАНА</h3>
                            <p>Планы не выживают при контакте с реальностью. Нужна способность адаптироваться. PDCA циклы, Agile - лучше чем Waterfall.</p>
                        </div>
                        <div class="card">
                            <h3>5. СКОРОСТЬ И КАЧЕСТВО ВАЖНЫ ОДИНАКОВО</h3>
                            <p>Быстрые результаты поддерживают мотивацию. Но долгосрочное качество поддерживает устойчивость. Гибридный подход - лучше всего.</p>
                        </div>
                        <div class="card">
                            <h3>6. ИЗМЕРЕНИЕ И ДАННЫЕ КРИТИЧНЫ</h3>
                            <p>Без метрик нет контроля. Данные показывают, работает или нет. Дашборды готовности и метрики успеха необходимы.</p>
                        </div>
                        <div class="card">
                            <h3>7. КУЛЬТУРА ОРГАНИЗАЦИИ ОПРЕДЕЛЯЕТ МЕТОД</h3>
                            <p>Консервативная организация → более структурированные модели. Инновационная организация → Agile, PDCA, экспериментирование.</p>
                        </div>
                    </div>
                `
            },
            
            // СЛАЙД 65 - PCT ОЦЕНКА (ИНТЕРАКТИВНЫЙ ИНСТРУМЕНТ ДИАГНОСТИКИ)
            
            // СЛАЙД 66 - ПОСЛЕДНИЙ СЛАЙД
            {
                title: "Спасибо за время",
                subtitle: "",
                content: `
                    <div class="final-slide-elegant">
                        <!-- Главное сообщение -->
                        <div class="final-message">
                            <p class="final-main-text">Теперь у вас есть инструменты для управления изменениями</p>
                        </div>

                        <!-- Блок LinkedIn CTA -->
                        <div class="final-linkedin-cta">
                            <p class="final-subtitle">Нужна помощь в изменениях?</p>
                            <a href="https://www.linkedin.com/in/dmitry-vladimirov-cdto"
                               target="_blank"
                               rel="noopener noreferrer"
                               class="linkedin-button-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="20" height="20">
                                    <path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path>
                                    <rect x="2" y="9" width="4" height="12"></rect>
                                    <circle cx="4" cy="4" r="2"></circle>
                                </svg>
                                LinkedIn
                            </a>
                            <p class="final-author">Владимиров Дмитрий</p>
                        </div>

                        <!-- Блок вторичных действий -->
                        <div class="final-actions">
                            <button onclick="location.reload()" class="action-secondary" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                                    <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path>
                                    <path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path>
                                </svg>
                                Повторить
                            </button>
                            <button onclick="exportToPDF()" class="action-secondary" type="button">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" width="16" height="16">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                                    <polyline points="7 10 12 15 17 10"></polyline>
                                    <line x1="12" y1="15" x2="12" y2="3"></line>
                                </svg>
                                Сохранить PDF
                            </button>
                        </div>
                    </div>
                `
            }
        );
        
        // ========== PCT Assessment Data ==========
        const pctAssessment = {
            description: "Модель треугольника изменений Prosci (Prosci Change Triangle – PCT) представляет собой простую, но действенную основу, состоящую из четырех аспектов любого успешного изменения: Успех: точные, ясные цели и результаты инициативы. Лидерство/Спонсорство: стратегия, направление, управление. Управление проектами: техническая сторона изменения, связанная с разработкой и реализацией проектного решения. Управление изменениями: человеческая сторона изменения, направленная на обеспечение принятия и использования проектного решения людьми для достижения результатов и выгод проекта.",
            categories: {
                success: {
                    id: 'success',
                    label: 'Успех',
                    icon: '🎯',
                    color: '#2DB67D',
                    description: 'Точные, ясные цели и результаты инициативы',
                    factors: [
                        { id: 1, text: 'Определены входные данные для процесса управления изменениями (могут включать бизнес-кейс, устав, объем и план проекта).' },
                        { id: 2, text: 'Точно определены выгоды организации (что организация получит в результате изменений).' },
                        { id: 3, text: 'Точно определены цели проекта (что будет результатом проекта).' },
                        { id: 4, text: 'Точно определены целевые показатели принятия и использования.' },
                        { id: 5, text: 'Установлены единицы измерения целей и выгод.' },
                        { id: 6, text: 'Выгоды и цели приоритизированы.' },
                        { id: 7, text: 'Назначены ответственные за достижение целей и выгод.' },
                        { id: 8, text: 'Проведена оценка насколько цели и выгоды проекта зависят от людей.' },
                        { id: 9, text: 'Критерии успеха определены и могут быть коммуницированы сотрудникам.' },
                        { id: 10, text: 'У спонсорской коалиции единое понимание критериев успеха.' }
                    ]
                },
                leadership: {
                    id: 'leadership',
                    label: 'Лидерство/Спонсорство',
                    icon: '👑',
                    color: '#F4A100',
                    description: 'Стратегия, направление, управление',
                    factors: [
                        { id: 1, text: 'У изменений есть спонсор, обладающий властью над людьми, процессами и системами, необходимой для принятия решений по изменениям и их финансированию.' },
                        { id: 2, text: 'Основной спонсор может четко определить суть изменений, причину изменений и выгоды для организации.' },
                        { id: 3, text: 'У организации есть четко определенное видение и стратегия.' },
                        { id: 4, text: 'Изменения согласованы с видением и стратегией организации.' },
                        { id: 5, text: 'Приоритетность этих изменений относительно других инициатив была определена и сообщена всем заинтересованным лицам.' },
                        { id: 6, text: 'Основной спонсор решает проблемы и принимает решения, относящиеся к графику, объему и ресурсам проекта.' },
                        { id: 7, text: 'Основной спонсор принимает активное и видимое участие в проекте совместно с проектной командой на всем его протяжении.' },
                        { id: 8, text: 'Основной спонсор вовлекает других руководителей в изменения и формирует спонсорскую коалицию в поддержку изменений.' },
                        { id: 9, text: 'Основной спонсор формирует понимание необходимости изменений у сотрудников, общаясь с ними напрямую.' },
                        { id: 10, text: 'Основной спонсор публично закрепляет изменения, празднуя успехи и работая с сопротивлением.' }
                    ]
                },
                projectManagement: {
                    id: 'projectManagement',
                    label: 'Управление проектами',
                    icon: '📊',
                    color: '#4A90E2',
                    description: 'Техническая сторона изменения, связанная с разработкой и реализацией проектного решения',
                    factors: [
                        { id: 1, text: 'Изменение четко определено, включая то, на каких людей оно повлияет и каким образом.' },
                        { id: 2, text: 'Проект имеет конкретные цели.' },
                        { id: 3, text: 'Проект имеет четко определенный функциональный и организационный объем.' },
                        { id: 4, text: 'Был назначен руководитель проекта для управления жизненным циклом проекта.' },
                        { id: 5, text: 'Определены ключевые вехи и разработан план-график проекта.' },
                        { id: 6, text: 'Были распределены рабочие задачи и определены их требуемые результаты.' },
                        { id: 7, text: 'Были определены и получены проектные ресурсы в соответствии с распределенными рабочими задачами.' },
                        { id: 8, text: 'Назначены сроки проведения регулярных совещаний проектной команды для фиксации промежуточных результатов и решения возникающих проблем.' },
                        { id: 9, text: 'Руководитель проекта понимает, что управление изменениями поможет обеспечить принятие и использование изменений.' },
                        { id: 10, text: 'План управления изменениями интегрирован в план проекта.' }
                    ]
                },
                changeManagement: {
                    id: 'changeManagement',
                    label: 'Управление изменениями',
                    icon: '🔄',
                    color: '#E01E5A',
                    description: 'Человеческая сторона изменения, направленная на обеспечение принятия и использования проектного решения',
                    factors: [
                        { id: 1, text: 'На проекте применяется структурированный подход к управлению изменениями для получения организацией запланированных выгод.' },
                        { id: 2, text: 'Была проведена оценка параметров изменений и их влияния на сотрудников и организацию.' },
                        { id: 3, text: 'Была проведена оценка уровня риска.' },
                        { id: 4, text: 'У изменений есть конкретные показатели принятия и использования.' },
                        { id: 5, text: 'Была проведена оценка состава спонсорской коалиции.' },
                        { id: 6, text: 'Разработана стратегия по управлению изменениями, отражающая специфику и масштаб проекта, а также необходимую поддержку со стороны спонсоров.' },
                        { id: 7, text: 'Выделены и подготовлены необходимые ресурсы для реализации стратегии по управлению изменениями.' },
                        { id: 8, text: 'Разработаны и реализуются планы управления изменениями для минимизации сопротивления и обеспечения принятия и использования изменений.' },
                        { id: 9, text: 'Эффективность управления изменениями постоянно измеряется и при необходимости принимаются корректирующие меры для обеспечения принятия и использования изменений.' },
                        { id: 10, text: 'Организация готова принять ответственность за изменение и его устойчивое использование.' }
                    ]
                }
            },
            scoring: {
                excellent: { min: 25, max: 30, label: 'Сильная сторона проекта – необходимо поддерживать и использовать', color: '#2DB67D', class: 'excellent' },
                moderate: { min: 20, max: 24, label: 'Есть риски - необходимо провести дополнительный анализ', color: '#F4A100', class: 'moderate' },
                risk: { min: 10, max: 19, label: 'Высокий риск – необходимо немедленно принять меры', color: '#E01E5A', class: 'risk' }
            }
        };

        // ========== Quiz Assessment Data ==========
        const quizData = {
            questions: [
                {
                    id: 1,
                    question: "Какой у вас опыт управления изменениями?",
                    options: [
                        { text: "Я новичок в этой области", value: "beginner" },
                        { text: "У меня есть базовый опыт (1-3 года)", value: "intermediate" },
                        { text: "У меня значительный опыт (3+ лет)", value: "expert" },
                        { text: "Я эксперт в данной области", value: "advanced" }
                    ]
                },
                {
                    id: 2,
                    question: "Какой масштаб изменений вы обычно реализуете?",
                    options: [
                        { text: "Небольшие локальные изменения", value: "small" },
                        { text: "Средние изменения в отделе/подразделении", value: "medium" },
                        { text: "Крупные изменения в организации", value: "large" },
                        { text: "Трансформационные изменения всей организации", value: "enterprise" }
                    ]
                },
                {
                    id: 3,
                    question: "Какой у вас подход к управлению изменениями?",
                    options: [
                        { text: "Строго структурированный и планируемый", value: "structured" },
                        { text: "Гибкий и адаптивный", value: "agile" },
                        { text: "Сочетание структуры и гибкости", value: "hybrid" },
                        { text: "Зависит от конкретной ситуации", value: "situational" }
                    ]
                },
                {
                    id: 4,
                    question: "Какие факторы вы считаете наиболее важными для успеха изменений?",
                    options: [
                        { text: "Сильное лидерство и спонсорство", value: "leadership" },
                        { text: "Четкое планирование и ресурсы", value: "planning" },
                        { text: "Вовлечение и коммуникация с сотрудниками", value: "communication" },
                        { text: "Техническая реализация и инструменты", value: "technical" }
                    ]
                },
                {
                    id: 5,
                    question: "Как вы относитесь к сопротивлению изменениям?",
                    options: [
                        { text: "Это серьезная проблема, требующая активного управления", value: "resistance_management" },
                        { text: "Это нормально, но можно минимизировать", value: "resistance_minimize" },
                        { text: "Сопротивление - это возможность для улучшения", value: "resistance_opportunity" },
                        { text: "Я предпочитаю избегать сопротивления через вовлечение", value: "resistance_prevent" }
                    ]
                },
                {
                    id: 6,
                    question: "Какой тип культуры преобладает в вашей организации?",
                    options: [
                        { text: "Консервативная, сопротивляющаяся изменениям", value: "conservative" },
                        { text: "Сбалансированная, умеренно открытая", value: "balanced" },
                        { text: "Инновационная, приветствующая изменения", value: "innovative" },
                        { text: "Зависит от конкретного подразделения", value: "diverse" }
                    ]
                },
                {
                    id: 7,
                    question: "Какой результат вы ожидаете от внедрения модели управления изменениями?",
                    options: [
                        { text: "Снижение рисков и повышение вероятности успеха", value: "risk_reduction" },
                        { text: "Улучшение коммуникации и вовлеченности", value: "communication_improvement" },
                        { text: "Структурированный подход к изменениям", value: "structured_approach" },
                        { text: "Комплексное решение всех аспектов изменений", value: "comprehensive_solution" }
                    ]
                }
            ],
            profiles: {
                beginner_structured: {
                    name: "Новичок со структурированным подходом",
                    description: "Вы только начинаете свой путь в управлении изменениями и предпочитаете четкие инструкции и пошаговые руководства.",
                    recommendedModels: [
                        { name: "Модель ADKAR", sources: ["базовый уровень", "пошаговый подход"] },
                        { name: "Модель Kübler-Ross", sources: ["эмоциональная сторона", "простота понимания"] },
                        { name: "Стандарт ACMP", sources: ["структурированный подход", "комплексность"] }
                    ]
                },
                intermediate_hybrid: {
                    name: "Опытный практик с гибридным подходом",
                    description: "У вас есть практический опыт, и вы понимаете, что каждый проект уникален, требуя индивидуального подхода.",
                    recommendedModels: [
                        { name: "Модель McKinsey", sources: ["стратегический уровень", "комплексный анализ"] },
                        { name: "Модель Kotter", sources: ["практическая реализация", "пошаговый процесс"] },
                        { name: "Конструктор гибридных моделей", sources: ["индивидуальный подход", "комбинация лучших практик"] }
                    ]
                },
                expert_situational: {
                    name: "Эксперт с ситуационным подходом",
                    description: "Вы имеете глубокий опыт и выбираете инструменты в зависимости от конкретного контекста и требований.",
                    recommendedModels: [
                        { name: "Модель Prosci", sources: ["профессиональный стандарт", "комплексная методология"] },
                        { name: "Модель GE", sources: ["крупные трансформации", "корпоративный опыт"] },
                        { name: "PCT Оценка", sources: ["диагностика проекта", "профессиональный анализ"] }
                    ]
                },
                technical_focused: {
                    name: "Технически ориентированный менеджер",
                    description: "Вы фокусируетесь на технической стороне реализации, но понимаете важность человеческого фактора.",
                    recommendedModels: [
                        { name: "Модель АИМ", sources: ["техническая реализация", "управление рисками"] },
                        { name: "Модель DMAIC (Six Sigma)", sources: ["структурированный процесс", "качество"] },
                        { name: "ROI Калькулятор", sources: ["экономическая оценка", "обоснование инвестиций"] }
                    ]
                }
            }
        };

        // ========== FAQ Data Structure ==========
        const faqData = {
            topics: [
                {
                    id: 'why-important',
                    title: 'Почему важно управлять изменениями?',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="2" x2="12" y2="22"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg>',
                    summary: [
                        'Влияние на рост компании: +35%',
                        'Устойчивость: снижение рисков на 40%',
                        'Результаты: ROI управления изменениями 120%',
                        'Без УИ: 70% проектов терпят неудачу'
                    ],
                    content: `
                        <h4>Влияние управления изменениями на бизнес</h4>
                        <p>Проекты с профессиональным управлением изменениями показывают на 35% больший рост выручки по сравнению с проектами без УИ. Это связано с более быстрой адаптацией сотрудников, снижением сопротивления и эффективным внедрением новых процессов.</p>
                        
                        <h4>Статистика успешности</h4>
                        <ul>
                            <li><strong>С УИ:</strong> 70% проектов достигают целей</li>
                            <li><strong>Без УИ:</strong> Только 30% проектов успешны</li>
                            <li><strong>ROI УИ:</strong> В среднем 120% возврат инвестиций</li>
                            <li><strong>Снижение рисков:</strong> На 40% меньше провалов</li>
                        </ul>
                        
                        <h4>Реальные кейсы</h4>
                        <div class="faq-case-study">
                            <div class="case-success">
                                <strong>Успех:</strong> Компания FMCG внедрила новую ERP-систему с применением модели Коттера. Проект завершен на 2 месяца раньше срока, экономия составила 15 млн руб.
                            </div>
                            <div class="case-failure">
                                <strong>Провал:</strong> IT-компания провела реорганизацию без управления изменениями. Проект провалился, потеря 50 млн руб., увольнение 30% команды.
                            </div>
                        </div>
                        
                        <div class="faq-related">
                            <strong>Связанные инструменты:</strong>
                            <button class="faq-link-btn" onclick="jumpToSlide(64)">Калькулятор ROI</button>
                        </div>
                    `,
                    tools: {
                        checklists: [
                            {
                                id: 'risk-assessment',
                                title: 'Чек-лист оценки рисков проекта',
                                items: [
                                    { id: 'risk1', text: 'Риск провала проекта без УИ', category: 'Критический' },
                                    { id: 'risk2', text: 'Риск потери бюджета (3-5x от первоначального)', category: 'Высокий' },
                                    { id: 'risk3', text: 'Риск увольнения ключевых сотрудников', category: 'Высокий' },
                                    { id: 'risk4', text: 'Риск снижения производительности', category: 'Средний' },
                                    { id: 'risk5', text: 'Риск репутационных потерь', category: 'Средний' }
                                ]
                            }
                        ],
                        templates: []
                    },
                    relatedModels: ['Коттер', 'ADKAR', 'Prosci'],
                    relatedSlides: [65]
                },
                {
                    id: 'roles',
                    title: 'Роли: кто и зачем?',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>',
                    summary: [
                        'Спонсор изменений',
                        'Функциональные руководители',
                        'Лидеры изменений',
                        'Проектная команда'
                    ],
                    content: `
                        <h4>Ключевые роли в проекте изменений</h4>
                        
                        <div class="faq-role">
                            <h5>1. Спонсор изменений</h5>
                            <p><strong>Задачи:</strong> Стратегическое видение, принятие ключевых решений, выделение ресурсов и бюджета, устранение барьеров, видимая поддержка изменений.</p>
                            <p><strong>Ответственность:</strong> Определение сути изменений и причин, коммуникация видения и выгод, приоритизация изменений, решение проблем по графику, объему и ресурсам, активное участие в проекте.</p>
                        </div>
                        
                        <div class="faq-role">
                            <h5>2. Функциональные руководители</h5>
                            <p><strong>Задачи:</strong> Поддержка изменений в своих подразделениях, коммуникация изменений команде, управление сопротивлением на уровне подразделения, адаптация изменений под специфику подразделения.</p>
                            <p><strong>Ответственность:</strong> Вовлечение своих команд в изменения, обеспечение ресурсов подразделения, мониторинг прогресса, обратная связь от команды к спонсору.</p>
                        </div>
                        
                        <div class="faq-role">
                            <h5>3. Лидеры изменений</h5>
                            <p><strong>Задачи:</strong> Планирование и координация изменений, разработка стратегии управления изменениями, работа с сопротивлением, коммуникации и обучение, мониторинг прогресса.</p>
                            <p><strong>Ответственность:</strong> Разработка плана управления изменениями, координация коммуникаций, диагностика готовности и сопротивления, обучение и развитие навыков, отчетность о прогрессе.</p>
                        </div>
                        
                        <div class="faq-role">
                            <h5>4. Проектная команда</h5>
                            <p><strong>Задачи:</strong> Выполнение технических задач проекта, внедрение изменений на операционном уровне, тестирование и отработка новых процессов, сбор обратной связи, поддержка коллег.</p>
                            <p><strong>Ответственность:</strong> Выполнение задач по плану проекта, соблюдение сроков и качества, коммуникация о проблемах и рисках, участие в тестировании и пилотировании.</p>
                        </div>
                    `,
                    tools: {
                        checklists: [
                            {
                                id: 'role-assignment',
                                title: 'Чек-лист распределения ролей в проекте',
                                items: [
                                    { id: 'role1', text: 'Спонсор изменений назначен и имеет достаточную власть', category: 'Критический' },
                                    { id: 'role2', text: 'Функциональные руководители определены и вовлечены', category: 'Высокий' },
                                    { id: 'role3', text: 'Лидеры изменений назначены и имеют компетенции', category: 'Высокий' },
                                    { id: 'role4', text: 'Проектная команда сформирована и обучена', category: 'Высокий' },
                                    { id: 'role5', text: 'Задачи для каждой роли определены', category: 'Средний' },
                                    { id: 'role6', text: 'Ответственность закреплена документально', category: 'Средний' },
                                    { id: 'role7', text: 'Коммуникационные каналы установлены', category: 'Средний' }
                                ]
                            },
                            {
                                id: 'role-effectiveness',
                                title: 'Чек-лист эффективности ролей',
                                items: [
                                    { id: 'eff1', text: 'Спонсор четко определяет суть изменений', category: 'Спонсор' },
                                    { id: 'eff2', text: 'Спонсор активно участвует в проекте', category: 'Спонсор' },
                                    { id: 'eff3', text: 'Функциональные руководители поддерживают изменения', category: 'Руководители' },
                                    { id: 'eff4', text: 'Лидеры изменений имеют план УИ', category: 'Лидеры' },
                                    { id: 'eff5', text: 'Проектная команда выполняет задачи в срок', category: 'Команда' }
                                ]
                            }
                        ],
                        templates: [
                            {
                                id: 'raci-matrix',
                                title: 'Шаблон матрицы RACI',
                                description: 'Матрица распределения ответственности для проекта изменений',
                                structure: 'Этапы проекта × Роли'
                            }
                        ]
                    },
                    relatedModels: ['Коттер', 'ADKAR', 'Prosci'],
                    relatedSlides: []
                },
                {
                    id: 'context',
                    title: 'Среда и контекст изменений',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path></svg>',
                    summary: [
                        'Внутренние факторы: культура, структура, ресурсы',
                        'Внешние факторы: рынок, конкуренты, регуляторы',
                        'Примеры: FMCG, IT, РФ'
                    ],
                    content: `
                        <h4>Факторы среды изменений</h4>
                        
                        <h5>Внутренние факторы:</h5>
                        <ul>
                            <li><strong>Культура организации:</strong> Консервативная требует более структурированных моделей, инновационная - Agile подходов</li>
                            <li><strong>Структура:</strong> Иерархическая, плоская или матричная определяет способ коммуникации</li>
                            <li><strong>Ресурсы:</strong> Бюджет, команда, время влияют на выбор модели</li>
                            <li><strong>Опыт изменений:</strong> Наличие опыта упрощает внедрение</li>
                        </ul>
                        
                        <h5>Внешние факторы:</h5>
                        <ul>
                            <li><strong>Рыночная среда:</strong> Стабильная или турбулентная определяет скорость изменений</li>
                            <li><strong>Конкуренты:</strong> Активные требуют быстрой реакции</li>
                            <li><strong>Регуляторы:</strong> Жесткие требования влияют на процесс</li>
                            <li><strong>Технологии:</strong> Быстрые изменения требуют гибкости</li>
                        </ul>
                        
                        <h4>Примеры по отраслям</h4>
                        <ul>
                            <li><strong>FMCG:</strong> Быстрая смена трендов, высокая конкуренция - требуют быстрых циклов изменений</li>
                            <li><strong>IT:</strong> Инновации, короткие циклы - подходят Agile, PDCA подходы</li>
                            <li><strong>РФ:</strong> Турбулентность, санкции - требуют адаптивности и устойчивости</li>
                        </ul>
                        
                        <div class="faq-related">
                            <strong>Связанные инструменты:</strong>
                            <button class="faq-link-btn" onclick="jumpToSlide(65)">Диагностика готовности</button>
                            <button class="faq-link-btn" onclick="jumpToSlide(69)">Выбор модели</button>
                        </div>
                    `,
                    tools: {
                        checklists: [
                            {
                                id: 'context-assessment',
                                title: 'Чек-лист оценки контекста изменений',
                                items: [
                                    { id: 'ctx1', text: 'Культура организации оценена', category: 'Внутренние' },
                                    { id: 'ctx2', text: 'Структура организации понятна', category: 'Внутренние' },
                                    { id: 'ctx3', text: 'Ресурсы определены и доступны', category: 'Внутренние' },
                                    { id: 'ctx4', text: 'Рыночная среда проанализирована', category: 'Внешние' },
                                    { id: 'ctx5', text: 'Конкурентная ситуация учтена', category: 'Внешние' }
                                ]
                            }
                        ],
                        templates: []
                    },
                    relatedModels: ['PDCA', 'Agile', 'Гибридная'],
                    relatedSlides: [67, 70]
                },
                {
                    id: 'prevention',
                    title: 'Профилактика сопротивления',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>',
                    summary: [
                        'Причины: страх неизвестного, потеря контроля',
                        'Ранние признаки: пассивность, слухи',
                        'Инструменты диагностики'
                    ],
                    content: `
                        <h4>Причины сопротивления</h4>
                        <ul>
                            <li><strong>Страх неизвестного (30%):</strong> Непонимание последствий изменений</li>
                            <li><strong>Потеря контроля (25%):</strong> Ощущение потери влияния на ситуацию</li>
                            <li><strong>Дополнительная нагрузка (20%):</strong> Опасение увеличения работы</li>
                            <li><strong>Непонимание необходимости (15%):</strong> Отсутствие ясности в причинах</li>
                            <li><strong>Предыдущий негативный опыт (10%):</strong> Неудачные изменения в прошлом</li>
                        </ul>
                        
                        <h4>Ранние признаки сопротивления</h4>
                        <ul>
                            <li>Пассивность на встречах и обсуждениях</li>
                            <li>Распространение слухов и неформальных обсуждений</li>
                            <li>Много вопросов "почему?" без конструктивного диалога</li>
                            <li>Снижение активности и вовлеченности</li>
                            <li>Формальное согласие без реальной поддержки</li>
                        </ul>
                        
                        <h4>Инструменты диагностики</h4>
                        <ul>
                            <li>Опросник готовности команды (5 вопросов)</li>
                            <li>Карта сопротивления (визуализация уровней)</li>
                            <li>Анализ коммуникаций (частота и качество)</li>
                            <li>Оценка рисков сопротивления (матрица вероятности × влияния)</li>
                        </ul>
                        
                        <div class="faq-related">
                            <strong>Связанные инструменты:</strong>
                            <button class="faq-link-btn" onclick="jumpToSlide(65)">Диагностика готовности</button>
                        </div>
                    `,
                    tools: {
                        checklists: [
                            {
                                id: 'resistance-prevention',
                                title: 'Чек-лист профилактики сопротивления',
                                items: [
                                    { id: 'prev1', text: 'Коммуникация видения проведена до начала изменений', category: 'Коммуникация' },
                                    { id: 'prev2', text: 'Ранние признаки сопротивления отслеживаются', category: 'Мониторинг' },
                                    { id: 'prev3', text: 'Каналы обратной связи открыты', category: 'Коммуникация' },
                                    { id: 'prev4', text: 'Обучение и поддержка предоставлены', category: 'Поддержка' },
                                    { id: 'prev5', text: 'Участие сотрудников в планировании обеспечено', category: 'Вовлечение' }
                                ]
                            }
                        ],
                        templates: []
                    },
                    relatedModels: ['ADKAR', 'Бриджес', 'Сатир'],
                    relatedSlides: [67]
                },
                {
                    id: 'methods',
                    title: 'Методы работы с сопротивлением',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>',
                    summary: [
                        'ADKAR: индивидуальный подход',
                        'Модель Левина: размораживание',
                        'Обратная связь и вовлечение'
                    ],
                    content: `
                        <h4>Рабочие инструменты</h4>
                        
                        <div class="faq-method">
                            <h5>1. ADKAR (индивидуальный подход)</h5>
                            <p><strong>Этапы:</strong> Осознание → Желание → Знание → Способность → Закрепление</p>
                            <p><strong>Применение:</strong> Работа с каждым сотрудником индивидуально, определение текущего этапа, фокус на переход к следующему.</p>
                            <p><strong>Пример:</strong> Если сотрудник не понимает причин изменений (нет Осознания), фокус на коммуникации "почему" и "что".</p>
                        </div>
                        
                        <div class="faq-method">
                            <h5>2. Модель Левина (размораживание)</h5>
                            <p><strong>Этапы:</strong> Размораживание → Изменение → Замораживание</p>
                            <p><strong>Применение:</strong> Создание дискомфорта с текущим состоянием, внедрение изменений, закрепление нового состояния.</p>
                            <p><strong>Техники:</strong> Показ проблем текущего состояния, демонстрация выгод будущего, создание поддерживающей среды.</p>
                        </div>
                        
                        <div class="faq-method">
                            <h5>3. Обратная связь и вовлечение</h5>
                            <p><strong>Техники:</strong> Активное слушание, вовлечение в решение проблем, регулярная обратная связь, признание вклада.</p>
                            <p><strong>Применение:</strong> Создание форумов для обсуждения, включение сотрудников в рабочие группы, публичное признание поддержки изменений.</p>
                        </div>
                    `,
                    tools: {
                        checklists: [
                            {
                                id: 'resistance-methods',
                                title: 'Чек-лист методов работы с сопротивлением',
                                items: [
                                    { id: 'meth1', text: 'Тип сопротивления определен (активное/пассивное)', category: 'Диагностика' },
                                    { id: 'meth2', text: 'Выбран подходящий метод (ADKAR/Левин/Вовлечение)', category: 'Выбор метода' },
                                    { id: 'meth3', text: 'План работы с сопротивлением разработан', category: 'Планирование' },
                                    { id: 'meth4', text: 'Команда обучена техникам работы', category: 'Обучение' },
                                    { id: 'meth5', text: 'Прогресс отслеживается регулярно', category: 'Мониторинг' }
                                ]
                            }
                        ],
                        templates: [
                            {
                                id: 'resistance-plan',
                                title: 'Шаблон плана работы с сопротивлением',
                                description: 'План действий для работы с конкретным типом сопротивления',
                                structure: 'Тип → Метод → Действия → Сроки'
                            }
                        ]
                    },
                    relatedModels: ['ADKAR', 'Левин', 'Кублер-Росс', 'Бриджес'],
                    relatedSlides: []
                },
                {
                    id: 'information',
                    title: 'Динамика распространения информации',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="2" y1="12" x2="22" y2="12"></line><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"></path><circle cx="12" cy="12" r="3"></circle></svg>',
                    summary: [
                        'Слухи распространяются в 10x быстрее',
                        'Коммуникационные узлы: 20% людей распространяют 80%',
                        'Правило: "Чем быстрее узнать, тем меньше хаоса"'
                    ],
                    content: `
                        <h4>Тренды информирования</h4>
                        <ul>
                            <li><strong>Слухи vs официальные каналы:</strong> Слухи распространяются в 10 раз быстрее официальных сообщений</li>
                            <li><strong>Скорость:</strong> Информация достигает всех за 2-3 дня (неформально) vs 1-2 недели (официально)</li>
                            <li><strong>Коммуникационные узлы:</strong> 20% людей распространяют 80% информации</li>
                        </ul>
                        
                        <h4>Механика слухов</h4>
                        <ul>
                            <li><strong>Искажение при передаче:</strong> Каждый пересказ добавляет неточности</li>
                            <li><strong>Эмоциональная окраска:</strong> Негативные эмоции усиливаются</li>
                            <li><strong>Усиление негатива:</strong> Плохие новости распространяются быстрее хороших</li>
                        </ul>
                        
                        <h4>Коммуникационные узлы</h4>
                        <ul>
                            <li><strong>Неформальные лидеры:</strong> Люди с высоким влиянием в команде</li>
                            <li><strong>Активные коммуникаторы:</strong> Те, кто много общается</li>
                            <li><strong>Влиятельные сотрудники:</strong> Эксперты и авторитеты</li>
                        </ul>
                        
                        <h4>Стратегия работы</h4>
                        <p><strong>Правило:</strong> "Чем быстрее узнать, тем меньше хаоса"</p>
                        <ul>
                            <li>Коммуникация до слухов</li>
                            <li>Работа с коммуникационными узлами</li>
                            <li>Использование неформальных каналов</li>
                            <li>Регулярные обновления</li>
                        </ul>
                    `,
                    tools: {
                        checklists: [
                            {
                                id: 'communication-nodes',
                                title: 'Чек-лист карты коммуникационных узлов',
                                items: [
                                    { id: 'node1', text: 'Ключевые коммуникаторы определены', category: 'Идентификация' },
                                    { id: 'node2', text: 'Влияние каждого узла оценено', category: 'Оценка' },
                                    { id: 'node3', text: 'План работы с узлами разработан', category: 'Планирование' },
                                    { id: 'node4', text: 'Регулярная коммуникация с узлами налажена', category: 'Взаимодействие' }
                                ]
                            }
                        ],
                        templates: [
                            {
                                id: 'information-plan',
                                title: 'Шаблон плана распространения информации',
                                description: 'План коммуникации с учетом узлов и каналов',
                                structure: 'Источник → Каналы → Узлы → Сроки'
                            }
                        ]
                    },
                    relatedModels: ['Теория подталкивания', 'R2P2'],
                    relatedSlides: []
                },
                {
                    id: 'communication',
                    title: 'Правила и инструменты коммуникации',
                    icon: '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>',
                    summary: [
                        '5 принципов прозрачной коммуникации',
                        'Своевременность, прозрачность, многоканальность',
                        'Обратная связь и персонализация'
                    ],
                    content: `
                        <h4>5 принципов прозрачной коммуникации</h4>
                        
                        <div class="faq-principle">
                            <h5>1. Своевременность</h5>
                            <ul>
                                <li>Коммуникация до слухов</li>
                                <li>Регулярные обновления (еженедельно)</li>
                                <li>Срочные сообщения при изменениях</li>
                                <li>Планирование коммуникаций заранее</li>
                            </ul>
                        </div>
                        
                        <div class="faq-principle">
                            <h5>2. Прозрачность</h5>
                            <ul>
                                <li>Честность о причинах изменений</li>
                                <li>Открытость о рисках</li>
                                <li>Ясность о последствиях</li>
                                <li>Прямые ответы на вопросы</li>
                            </ul>
                        </div>
                        
                        <div class="faq-principle">
                            <h5>3. Многоканальность</h5>
                            <ul>
                                <li>Официальные каналы (email, встречи)</li>
                                <li>Неформальные каналы (мессенджеры, кофе-брейки)</li>
                                <li>Визуальные материалы (инфографика, презентации)</li>
                                <li>Личные встречи для ключевых сообщений</li>
                            </ul>
                        </div>
                        
                        <div class="faq-principle">
                            <h5>4. Обратная связь</h5>
                            <ul>
                                <li>Каналы для вопросов (Q&A сессии)</li>
                                <li>Регулярные опросы (раз в 2 недели)</li>
                                <li>Учет обратной связи в планах</li>
                                <li>Публичные ответы на частые вопросы</li>
                            </ul>
                        </div>
                        
                        <div class="faq-principle">
                            <h5>5. Персонализация</h5>
                            <ul>
                                <li>Адаптация под аудиторию</li>
                                <li>Учет потребностей каждой группы</li>
                                <li>Релевантные примеры для ролей</li>
                                <li>Язык, понятный аудитории</li>
                            </ul>
                        </div>
                        
                        <h4>Инструменты</h4>
                        <ul>
                            <li>Корпоративные мессенджеры (Teams, Slack)</li>
                            <li>Встречи (town hall, team meetings)</li>
                            <li>Обратная связь (опросы, Q&A сессии)</li>
                            <li>Визуальные материалы (инфографика, презентации)</li>
                        </ul>
                    `,
                    tools: {
                        checklists: [
                            {
                                id: 'communication-rules',
                                title: 'Чек-лист правил коммуникации',
                                items: [
                                    { id: 'comm1', text: 'Коммуникация до слухов', category: 'Своевременность' },
                                    { id: 'comm2', text: 'Регулярные обновления (еженедельно)', category: 'Своевременность' },
                                    { id: 'comm3', text: 'Срочные сообщения при изменениях', category: 'Своевременность' },
                                    { id: 'comm4', text: 'Планирование коммуникаций заранее', category: 'Своевременность' },
                                    { id: 'comm5', text: 'Честность о причинах изменений', category: 'Прозрачность' },
                                    { id: 'comm6', text: 'Открытость о рисках', category: 'Прозрачность' },
                                    { id: 'comm7', text: 'Ясность о последствиях', category: 'Прозрачность' },
                                    { id: 'comm8', text: 'Прямые ответы на вопросы', category: 'Прозрачность' },
                                    { id: 'comm9', text: 'Официальные каналы используются', category: 'Многоканальность' },
                                    { id: 'comm10', text: 'Неформальные каналы задействованы', category: 'Многоканальность' },
                                    { id: 'comm11', text: 'Визуальные материалы подготовлены', category: 'Многоканальность' },
                                    { id: 'comm12', text: 'Личные встречи для ключевых сообщений', category: 'Многоканальность' },
                                    { id: 'comm13', text: 'Каналы для вопросов открыты', category: 'Обратная связь' },
                                    { id: 'comm14', text: 'Регулярные опросы проводятся', category: 'Обратная связь' },
                                    { id: 'comm15', text: 'Обратная связь учитывается в планах', category: 'Обратная связь' },
                                    { id: 'comm16', text: 'Сообщения адаптированы под аудиторию', category: 'Персонализация' },
                                    { id: 'comm17', text: 'Потребности каждой группы учтены', category: 'Персонализация' },
                                    { id: 'comm18', text: 'Релевантные примеры для ролей', category: 'Персонализация' },
                                    { id: 'comm19', text: 'Язык понятен аудитории', category: 'Персонализация' }
                                ]
                            },
                            {
                                id: 'communication-plan',
                                title: 'Чек-лист плана коммуникаций',
                                items: [
                                    { id: 'plan1', text: 'Определены ключевые аудитории', category: 'Планирование' },
                                    { id: 'plan2', text: 'Подготовлены сообщения для каждой аудитории', category: 'Планирование' },
                                    { id: 'plan3', text: 'Выбраны каналы коммуникации', category: 'Планирование' },
                                    { id: 'plan4', text: 'Определены сроки коммуникаций', category: 'Планирование' },
                                    { id: 'plan5', text: 'Назначены ответственные за коммуникации', category: 'Планирование' }
                                ]
                            }
                        ],
                        templates: [
                            {
                                id: 'announcement',
                                title: 'Шаблон "Объявление об изменениях"',
                                description: 'Структура: Что → Почему → Когда → Как',
                                structure: 'Что → Почему → Когда → Как'
                            },
                            {
                                id: 'status-update',
                                title: 'Шаблон "Обновление статуса"',
                                description: 'Структура: Прогресс → Достижения → Следующие шаги',
                                structure: 'Прогресс → Достижения → Следующие шаги'
                            },
                            {
                                id: 'faq-template',
                                title: 'Шаблон "Ответы на частые вопросы"',
                                description: 'Структура: Вопрос → Ответ → Дополнительная информация',
                                structure: 'Вопрос → Ответ → Дополнительная информация'
                            }
                        ]
                    },
                    relatedModels: ['Коттер', 'ADKAR', 'Prosci'],
                    relatedSlides: []
                }
            ]
        };

        // ========== FAQ State ==========
        let faqState = {
            expandedTopics: [],
            checklistStates: {}
        };

        // ========== Quiz State ==========
        let quizState = {
            currentQuestion: 0,
            answers: [],
            completed: false
        };

        fullSlidesCount = slidesData.length;
        totalSlides = fullSlidesCount;
        classicalStartIndex = baseSlidesCount;
        newModelsStartIndex = classicalStartIndex + classicalModels.length;
        closingSlidesStartIndex = newModelsStartIndex + newModels.length;
        closingSlidesCount = fullSlidesCount - closingSlidesStartIndex;
        visibleSlides = Array.from({ length: fullSlidesCount }, (_, index) => index);
        visibleSlidesSet = new Set(visibleSlides);
        finalSlideIndex = fullSlidesCount - 1;
        modelsChartSlideIndex = findSlideIndexByKeyword('ландшафт');
        
        
        buildLearningPaths();
        visibleSlides = learningPaths.expert.slides.slice();
        visibleSlidesSet = new Set(visibleSlides);
        totalSlides = visibleSlides.length;
        buildSearchIndex();
        
        // ========== FAQ Functions ==========
        function initFAQ() {
            loadFAQState();
            renderFAQTopics();
        }

        function renderFAQTopics() {
            const container = document.getElementById('faqTopicsGrid');
            if (!container || !faqData) return;

            const hasExpanded = faqState.expandedTopics.length > 0;
            const expandedTopicId = hasExpanded ? faqState.expandedTopics[0] : null;
            const expandedTopic = expandedTopicId ? faqData.topics.find(t => t.id === expandedTopicId) : null;
            const expandedIndex = expandedTopic ? faqData.topics.findIndex(t => t.id === expandedTopicId) : -1;

            // Обновляем класс grid для full-width expansion
            if (hasExpanded) {
                container.classList.add('has-expanded');
            } else {
                container.classList.remove('has-expanded');
            }

            // Обновляем breadcrumb
            updateBreadcrumb(expandedTopic);

            // Показываем/скрываем кнопку "Свернуть все"
            const collapseBtn = document.getElementById('faqCollapseAllBtn');
            if (collapseBtn) {
                collapseBtn.style.display = hasExpanded ? 'flex' : 'none';
            }

            container.innerHTML = faqData.topics.map((topic, index) => {
                const isExpanded = topic.id === expandedTopicId;
                const iconHTML = topic.icon && topic.icon.includes('<svg') 
                    ? topic.icon 
                    : `<span style="font-size: 32px;">${topic.icon || ''}</span>`;
                
                // Находим связанные темы (кроме текущей)
                const relatedTopics = faqData.topics.filter(t => {
                    if (t.id === topic.id) return false;
                    // Связь по моделям
                    const hasCommonModels = topic.relatedModels && t.relatedModels && 
                        topic.relatedModels.some(m => t.relatedModels.includes(m));
                    // Связь по слайдам
                    const hasCommonSlides = topic.relatedSlides && t.relatedSlides && 
                        topic.relatedSlides.some(s => t.relatedSlides.includes(s));
                    return hasCommonModels || hasCommonSlides;
                }).slice(0, 3);

                return `
                    <div class="faq-topic-card ${isExpanded ? 'expanded' : ''}" data-topic-id="${topic.id}">
                        <div class="faq-topic-header" onclick="toggleFAQTopic('${topic.id}')">
                            <div class="faq-topic-icon">${iconHTML}</div>
                            <div class="faq-topic-title-wrapper">
                                <h3 class="faq-topic-title">${topic.title}</h3>
                                ${!isExpanded ? `
                                    <div class="faq-topic-summary">
                                        ${topic.summary.map(item => `<div class="faq-summary-item">• ${item}</div>`).join('')}
                                    </div>
                                ` : ''}
                            </div>
                            <div class="faq-topic-toggle">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polyline points="${isExpanded ? '18 15 12 9 6 15' : '6 9 12 15 18 9'}"></polyline>
                                </svg>
                            </div>
                        </div>
                        <div class="faq-topic-content" style="display: ${isExpanded ? 'block' : 'none'}">
                            <div class="faq-topic-details">
                                ${topic.content}
                            </div>
                            ${renderFAQTools(topic)}
                            ${topic.relatedModels.length > 0 ? `
                                <div class="faq-related-models">
                                    <strong>Связанные модели:</strong>
                                    ${topic.relatedModels.map(model => `
                                        <button class="faq-model-btn" onclick="findModelSlide('${model}')">${model}</button>
                                    `).join('')}
                                </div>
                            ` : ''}
                            ${isExpanded ? `
                                <div class="faq-topic-nav">
                                    <div class="faq-topic-nav-left">
                                        <div class="faq-topic-progress">Тема ${expandedIndex + 1} из ${faqData.topics.length}</div>
                                        ${relatedTopics.length > 0 ? `
                                            <div class="faq-topic-related-links">
                                                <span class="faq-topic-related-links-label">Связанные темы:</span>
                                                ${relatedTopics.map(rt => `
                                                    <a href="#" class="faq-topic-related-link" onclick="event.preventDefault(); toggleFAQTopic('${rt.id}'); return false;">
                                                        ${rt.title}
                                                    </a>
                                                `).join('')}
                                            </div>
                                        ` : ''}
                                    </div>
                                    <div class="faq-topic-nav-right">
                                        <button class="faq-back-btn" onclick="collapseAllFAQTopics()">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <path d="M19 12H5M12 19l-7-7 7-7"/>
                                            </svg>
                                            Назад к списку
                                        </button>
                                        <button class="faq-close-btn" onclick="toggleFAQTopic('${topic.id}')">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                                <line x1="6" y1="6" x2="18" y2="18"></line>
                                            </svg>
                                            Закрыть
                                        </button>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');

            // Инициализируем чек-листы после рендеринга
            initFAQChecklists();

            // Плавный скролл к раскрытой карточке
            if (hasExpanded && expandedTopicId) {
                setTimeout(() => {
                    scrollToExpandedTopic(expandedTopicId);
                }, 100);
            }
        }

        function renderFAQTools(topic) {
            if (!topic.tools || (!topic.tools.checklists.length && !topic.tools.templates.length)) {
                return '';
            }

            let html = '<div class="faq-tools">';
            
            if (topic.tools.checklists && topic.tools.checklists.length > 0) {
                html += '<div class="faq-tools-section">';
                html += '<h4>Чек-листы</h4>';
                topic.tools.checklists.forEach(checklist => {
                    html += renderFAQChecklist(checklist, topic.id);
                });
                html += '</div>';
            }

            if (topic.tools.templates && topic.tools.templates.length > 0) {
                html += '<div class="faq-tools-section">';
                html += '<h4>Шаблоны</h4>';
                topic.tools.templates.forEach(template => {
                    html += renderFAQTemplate(template, topic.id);
                });
                html += '</div>';
            }

            html += '</div>';
            return html;
        }

        function renderFAQChecklist(checklist, topicId) {
            const checklistId = `${topicId}-${checklist.id}`;
            const state = faqState.checklistStates[checklistId] || {};
            const checkedCount = Object.values(state).filter(v => v).length;
            const totalCount = checklist.items.length;
            const progress = totalCount > 0 ? Math.round((checkedCount / totalCount) * 100) : 0;

            return `
                <div class="faq-checklist-wrapper">
                    <div class="faq-checklist-header">
                        <h5>${checklist.title}</h5>
                        <div class="faq-checklist-progress">
                            <span>${checkedCount}/${totalCount}</span>
                            <div class="faq-progress-bar">
                                <div class="faq-progress-fill" style="width: ${progress}%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="faq-checklist" id="${checklistId}">
                        ${checklist.items.map(item => {
                            const isChecked = state[item.id] || false;
                            return `
                                <label class="faq-checklist-item">
                                    <input type="checkbox" 
                                           ${isChecked ? 'checked' : ''} 
                                           onchange="updateFAQChecklist('${checklistId}', '${item.id}', this.checked)">
                                    <span class="faq-checkmark"></span>
                                    <div class="faq-item-content">
                                        <div class="faq-item-text">${item.text}</div>
                                        ${item.category ? `<div class="faq-item-category">${item.category}</div>` : ''}
                                    </div>
                                </label>
                            `;
                        }).join('')}
                    </div>
                    <button class="faq-export-btn" onclick="exportFAQChecklist('${checklistId}', '${checklist.title}')">
                        Экспорт в PDF
                    </button>
                </div>
            `;
        }

        function renderFAQTemplate(template, topicId) {
            // Используем data-атрибуты для безопасной передачи данных
            return `
                <div class="faq-template-card">
                    <h5>${template.title}</h5>
                    <p class="faq-template-description">${template.description}</p>
                    <p class="faq-template-structure"><strong>Структура:</strong> ${template.structure}</p>
                    <button class="faq-template-btn" 
                            data-template-id="${template.id}" 
                            data-template-title="${(template.title || '').replace(/"/g, '&quot;')}"
                            onclick="const btn = this; exportFAQTemplate(btn.dataset.templateId, btn.dataset.templateTitle)">
                        Открыть шаблон
                    </button>
                </div>
            `;
        }

        function toggleFAQTopic(topicId) {
            const index = faqState.expandedTopics.indexOf(topicId);
            if (index > -1) {
                // Закрываем тему
                faqState.expandedTopics.splice(index, 1);
            } else {
                // Открываем тему (закрываем остальные - только одна открыта)
                faqState.expandedTopics = [topicId];
            }
            saveFAQState();
            renderFAQTopics();
        }

        function collapseAllFAQTopics() {
            faqState.expandedTopics = [];
            saveFAQState();
            renderFAQTopics();
            // Очищаем поиск
            const searchInput = document.getElementById('faqSearchInput');
            if (searchInput) {
                searchInput.value = '';
                filterFAQTopics('');
            }
        }

        function scrollToExpandedTopic(topicId) {
            const card = document.querySelector(`[data-topic-id="${topicId}"]`);
            if (card) {
                const headerOffset = 80;
                const elementPosition = card.getBoundingClientRect().top;
                const offsetPosition = elementPosition + window.pageYOffset - headerOffset;

                window.scrollTo({
                    top: offsetPosition,
                    behavior: 'smooth'
                });
            }
        }

        function updateBreadcrumb(topic) {
            const breadcrumb = document.getElementById('faqBreadcrumb');
            if (!breadcrumb) return;

            if (topic) {
                breadcrumb.innerHTML = `
                    <span class="faq-breadcrumb-item" onclick="collapseAllFAQTopics()">FAQ</span>
                    <span class="faq-breadcrumb-separator">></span>
                    <span class="faq-breadcrumb-item active">${topic.title}</span>
                `;
            } else {
                breadcrumb.innerHTML = `
                    <span class="faq-breadcrumb-item active" onclick="collapseAllFAQTopics()">FAQ</span>
                `;
            }
        }

        function filterFAQTopics(searchQuery) {
            const container = document.getElementById('faqTopicsGrid');
            if (!container || !faqData) return;

            const query = searchQuery.toLowerCase().trim();
            const cards = container.querySelectorAll('.faq-topic-card');

            if (!query) {
                // Показываем все карточки
                cards.forEach(card => {
                    card.classList.remove('hidden');
                });
                return;
            }

            // Фильтруем карточки
            faqData.topics.forEach((topic, index) => {
                const card = cards[index];
                if (!card) return;

                const searchText = (
                    topic.title.toLowerCase() +
                    ' ' +
                    topic.summary.join(' ').toLowerCase() +
                    ' ' +
                    (topic.content || '').toLowerCase()
                );

                if (searchText.includes(query)) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });
        }

        function initFAQChecklists() {
            // Чек-листы уже инициализированы в renderFAQTopics
        }

        function updateFAQChecklist(checklistId, itemId, checked) {
            if (!faqState.checklistStates[checklistId]) {
                faqState.checklistStates[checklistId] = {};
            }
            faqState.checklistStates[checklistId][itemId] = checked;
            saveFAQState();
            
            // Обновляем прогресс
            const checklistEl = document.getElementById(checklistId);
            if (checklistEl) {
                const checkedItems = checklistEl.querySelectorAll('input[type="checkbox"]:checked').length;
                const totalItems = checklistEl.querySelectorAll('input[type="checkbox"]').length;
                const progress = totalItems > 0 ? Math.round((checkedItems / totalItems) * 100) : 0;
                
                const progressFill = checklistEl.closest('.faq-checklist-wrapper')?.querySelector('.faq-progress-fill');
                const progressText = checklistEl.closest('.faq-checklist-wrapper')?.querySelector('.faq-checklist-progress span');
                
                if (progressFill) {
                    progressFill.style.width = `${progress}%`;
                }
                if (progressText) {
                    progressText.textContent = `${checkedItems}/${totalItems}`;
                }
            }
        }

        function exportFAQChecklist(checklistId, title) {
            const checklistEl = document.getElementById(checklistId);
            if (!checklistEl) return;

            const items = Array.from(checklistEl.querySelectorAll('.faq-checklist-item')).map(item => {
                const checkbox = item.querySelector('input[type="checkbox"]');
                const text = item.querySelector('.faq-item-text')?.textContent || '';
                const category = item.querySelector('.faq-item-category')?.textContent || '';
                return {
                    checked: checkbox?.checked || false,
                    text: text,
                    category: category
                };
            });

            const checkedCount = items.filter(i => i.checked).length;
            const totalCount = items.length;

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>${title} - ${new Date().toLocaleDateString('ru-RU')}</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                        }
                        h1 { color: var(--color-teal-500, #21808d); border-bottom: 3px solid var(--color-teal-500, #21808d); padding-bottom: 10px; }
                        .progress { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 8px; }
                        .checklist-item { margin: 10px 0; padding: 10px; border-left: 4px solid #ddd; }
                        .checklist-item.checked { border-left-color: #2DB67D; background: #f0f8f0; }
                        .category { font-size: 12px; color: #666; margin-top: 5px; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                    
                    <div class="progress">
                        <strong>Прогресс:</strong> ${checkedCount} из ${totalCount} (${Math.round((checkedCount / totalCount) * 100)}%)
                    </div>

                    <h2>Элементы чек-листа</h2>
                    ${items.map((item, index) => `
                        <div class="checklist-item ${item.checked ? 'checked' : ''}">
                            <strong>${item.checked ? '✓' : '○'}</strong> ${item.text}
                            ${item.category ? `<div class="category">Категория: ${item.category}</div>` : ''}
                        </div>
                    `).join('')}

                    <div class="footer">
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>Чек-лист создан с помощью интерактивного FAQ управления изменениями</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();

            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        function exportFAQTemplate(templateId, title) {
            // Декодируем HTML entities в title, если они есть
            if (title) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = title;
                title = tempDiv.textContent || tempDiv.innerText || title;
            }
            
            // Полные шаблоны для экспорта
            const templates = {
                'announcement': {
                    structure: 'Что → Почему → Когда → Как',
                    content: `
                        <h2>Объявление об изменениях</h2>
                        <p><strong>Проект:</strong> [Название проекта изменений]</p>
                        <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        
                        <div class="template-section">
                            <h3>Что меняется?</h3>
                            <p>[Опишите суть изменений: новая система, процесс, структура и т.д.]</p>
                            <p><strong>Пример:</strong> Внедрение новой CRM-системы для улучшения работы с клиентами</p>
                            <p><strong>Что конкретно изменится:</strong></p>
                            <ul>
                                <li>[Изменение 1]</li>
                                <li>[Изменение 2]</li>
                                <li>[Изменение 3]</li>
                            </ul>
                        </div>
                        
                        <div class="template-section">
                            <h3>Почему это важно?</h3>
                            <p>[Объясните причины и выгоды для компании и сотрудников]</p>
                            <p><strong>Выгоды для компании:</strong></p>
                            <ul>
                                <li>[Конкретный бизнес-результат 1]</li>
                                <li>[Конкретный бизнес-результат 2]</li>
                                <li>[Конкретный бизнес-результат 3]</li>
                            </ul>
                            <p><strong>Выгоды для сотрудников:</strong></p>
                            <ul>
                                <li>[Улучшение работы, упрощение процессов]</li>
                                <li>[Новые возможности для развития]</li>
                                <li>[Улучшение условий работы]</li>
                            </ul>
                        </div>
                        
                        <div class="template-section">
                            <h3>Когда это произойдет?</h3>
                            <p>[Укажите сроки и этапы]</p>
                            <ul>
                                <li><strong>Этап 1:</strong> [дата] - [описание этапа]</li>
                                <li><strong>Этап 2:</strong> [дата] - [описание этапа]</li>
                                <li><strong>Этап 3:</strong> [дата] - [описание этапа]</li>
                                <li><strong>Завершение:</strong> [дата]</li>
                            </ul>
                        </div>
                        
                        <div class="template-section">
                            <h3>Как это будет происходить?</h3>
                            <p>[Опишите процесс внедрения, обучение, поддержку]</p>
                            <p><strong>Обучение:</strong></p>
                            <ul>
                                <li>Формат: [онлайн/офлайн, вебинары, тренинги]</li>
                                <li>Сроки: [когда будет проводиться обучение]</li>
                                <li>Ответственные: [кто проводит обучение]</li>
                            </ul>
                            <p><strong>Поддержка:</strong></p>
                            <ul>
                                <li>Каналы помощи: [email, телефон, чат, портал]</li>
                                <li>Часы работы поддержки: [расписание]</li>
                                <li>Контакты: [email, телефон]</li>
                            </ul>
                            <p><strong>Обратная связь:</strong></p>
                            <ul>
                                <li>Как задать вопросы: [каналы для вопросов]</li>
                                <li>Регулярные обновления: [частота коммуникаций]</li>
                                <li>Q&A сессии: [даты и время]</li>
                            </ul>
                        </div>
                        
                        <div class="template-section">
                            <h3>Контакты для вопросов</h3>
                            <p>Если у вас есть вопросы, свяжитесь с нами:</p>
                            <ul>
                                <li>Email: [контактный email]</li>
                                <li>Телефон: [контактный телефон]</li>
                                <li>Встреча Q&A: [дата и время]</li>
                                <li>Канал в Teams/Slack: [ссылка]</li>
                            </ul>
                        </div>
                    `
                },
                'status-update': {
                    structure: 'Прогресс → Достижения → Следующие шаги',
                    content: `
                        <h2>Обновление статуса проекта изменений</h2>
                        <p><strong>Проект:</strong> [Название проекта]</p>
                        <p><strong>Дата обновления:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        
                        <div class="template-section">
                            <h3>Текущий прогресс</h3>
                            <p><strong>Общий прогресс:</strong> [X]% завершено</p>
                            <div class="progress-indicator" style="width: 100%; height: 20px; background: #f0f0f0; border-radius: 10px; margin: 10px 0;">
                                <div style="width: [X]%; height: 100%; background: #21808d; border-radius: 10px;"></div>
                            </div>
                            <p><strong>Текущий этап:</strong> [название этапа]</p>
                            <p><strong>Срок проекта:</strong> [дата начала] - [дата завершения]</p>
                        </div>
                        
                        <div class="template-section">
                            <h3>Достижения</h3>
                            <p>Что уже сделано:</p>
                            <ul>
                                <li>✓ [Конкретный результат 1 - что выполнено]</li>
                                <li>✓ [Конкретный результат 2 - достижения команды]</li>
                                <li>✓ [Конкретный результат 3 - преодоленные препятствия]</li>
                                <li>✓ [Конкретный результат 4]</li>
                            </ul>
                        </div>
                        
                        <div class="template-section">
                            <h3>Следующие шаги</h3>
                            <p><strong>Ближайшие 2 недели:</strong></p>
                            <ul>
                                <li>[Конкретное действие 1] - Срок: [дата]</li>
                                <li>[Конкретное действие 2] - Срок: [дата]</li>
                                <li>[Конкретное действие 3] - Срок: [дата]</li>
                            </ul>
                            <p><strong>В следующем месяце:</strong></p>
                            <ul>
                                <li>[План 1]</li>
                                <li>[План 2]</li>
                                <li>[План 3]</li>
                            </ul>
                            <p><strong>Ключевые вехи:</strong></p>
                            <ul>
                                <li><strong>[Веха 1]:</strong> [дата] - [описание]</li>
                                <li><strong>[Веха 2]:</strong> [дата] - [описание]</li>
                            </ul>
                        </div>
                        
                        <div class="template-section">
                            <h3>Как вы можете помочь?</h3>
                            <p>[Конкретные действия, которые сотрудники могут предпринять]</p>
                            <ul>
                                <li>[Действие 1 - что нужно от сотрудников]</li>
                                <li>[Действие 2 - участие в обучении]</li>
                                <li>[Действие 3 - обратная связь]</li>
                            </ul>
                        </div>
                    `
                },
                'faq-template': {
                    structure: 'Вопрос → Ответ → Дополнительная информация',
                    content: `
                        <h2>Ответы на частые вопросы</h2>
                        <p><strong>Проект:</strong> [Название проекта изменений]</p>
                        <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        
                        <div class="faq-item">
                            <h3>Вопрос 1: [Часто задаваемый вопрос]</h3>
                            <p><strong>Ответ:</strong> [Прямой и понятный ответ на вопрос]</p>
                            <p><strong>Дополнительная информация:</strong> [Ссылки, ресурсы, контакты для получения более детальной информации]</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>Вопрос 2: [Часто задаваемый вопрос]</h3>
                            <p><strong>Ответ:</strong> [Прямой и понятный ответ на вопрос]</p>
                            <p><strong>Дополнительная информация:</strong> [Ссылки, ресурсы, контакты]</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>Вопрос 3: [Часто задаваемый вопрос]</h3>
                            <p><strong>Ответ:</strong> [Прямой и понятный ответ на вопрос]</p>
                            <p><strong>Дополнительная информация:</strong> [Ссылки, ресурсы, контакты]</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>Вопрос 4: [Часто задаваемый вопрос]</h3>
                            <p><strong>Ответ:</strong> [Прямой и понятный ответ на вопрос]</p>
                            <p><strong>Дополнительная информация:</strong> [Ссылки, ресурсы, контакты]</p>
                        </div>
                        
                        <div class="faq-item">
                            <h3>Вопрос 5: [Часто задаваемый вопрос]</h3>
                            <p><strong>Ответ:</strong> [Прямой и понятный ответ на вопрос]</p>
                            <p><strong>Дополнительная информация:</strong> [Ссылки, ресурсы, контакты]</p>
                        </div>
                        
                        <div class="template-section">
                            <h3>Остались вопросы?</h3>
                            <p>Свяжитесь с нами:</p>
                            <ul>
                                <li>Email: [контактный email]</li>
                                <li>Встреча Q&A: [дата и время]</li>
                                <li>Канал в Teams/Slack: [ссылка]</li>
                                <li>Телефон поддержки: [номер]</li>
                            </ul>
                        </div>
                    `
                },
                'raci-matrix': {
                    structure: 'Этапы проекта × Роли',
                    content: `
                        <h2>Матрица RACI для проекта изменений</h2>
                        <p><strong>Проект:</strong> [Название проекта]</p>
                        <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        
                        <div class="template-section">
                            <h3>Инструкция по заполнению</h3>
                            <p>Заполните матрицу, указав для каждого этапа проекта роль каждой группы:</p>
                            <ul>
                                <li><strong>R (Responsible):</strong> Выполняет работу</li>
                                <li><strong>A (Accountable):</strong> Отвечает за результат (только один на этап)</li>
                                <li><strong>C (Consulted):</strong> Консультирует, дает советы</li>
                                <li><strong>I (Informed):</strong> Информируется о прогрессе</li>
                            </ul>
                        </div>
                        
                        <table class="raci-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <thead>
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Этап проекта</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">Спонсор изменений</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">Функциональные руководители</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">Лидеры изменений</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: center;">Проектная команда</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Планирование</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">A</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">C</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">I</td>
                                </tr>
                                <tr style="background: #f9f9f9;">
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Коммуникация</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">A</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">C</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Обучение</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">A</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">C</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                </tr>
                                <tr style="background: #f9f9f9;">
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Внедрение</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">A</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Мониторинг</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">A</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">C</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">C</td>
                                </tr>
                                <tr style="background: #f9f9f9;">
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Закрепление</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">A</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                    <td style="padding: 12px; border: 1px solid #ddd; text-align: center;">R</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="raci-legend" style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
                            <h3>Легенда RACI</h3>
                            <ul>
                                <li><strong>R (Responsible):</strong> Выполняет работу, отвечает за выполнение задачи</li>
                                <li><strong>A (Accountable):</strong> Отвечает за результат, принимает окончательные решения (только один на этап)</li>
                                <li><strong>C (Consulted):</strong> Консультирует, дает советы и рекомендации</li>
                                <li><strong>I (Informed):</strong> Информируется о прогрессе, получает обновления</li>
                            </ul>
                        </div>
                    `
                },
                'resistance-plan': {
                    structure: 'Тип → Метод → Действия → Сроки',
                    content: `
                        <h2>План работы с сопротивлением</h2>
                        <p><strong>Проект:</strong> [Название проекта]</p>
                        <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        
                        <div class="template-section">
                            <h3>Инструкция по использованию</h3>
                            <p>Для каждого типа сопротивления заполните карточку с планом действий. Определите источник, причину, выберите метод работы и составьте конкретный план.</p>
                        </div>
                        
                        <div class="resistance-plan-item" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fff;">
                            <h3>Тип сопротивления: [Активное/Пассивное]</h3>
                            <p><strong>Источник:</strong> [От кого исходит сопротивление - конкретные люди, группы, подразделения]</p>
                            <p><strong>Причина:</strong> [Почему возникает сопротивление - страх, непонимание, предыдущий опыт и т.д.]</p>
                            
                            <h4>Выбранный метод:</h4>
                            <p>[ADKAR / Модель Левина / Вовлечение и обратная связь]</p>
                            <p><strong>Обоснование выбора:</strong> [Почему выбран именно этот метод]</p>
                            
                            <h4>План действий:</h4>
                            <ol>
                                <li>[Конкретное действие 1] - Срок: [дата] - Ответственный: [имя, роль]</li>
                                <li>[Конкретное действие 2] - Срок: [дата] - Ответственный: [имя, роль]</li>
                                <li>[Конкретное действие 3] - Срок: [дата] - Ответственный: [имя, роль]</li>
                                <li>[Конкретное действие 4] - Срок: [дата] - Ответственный: [имя, роль]</li>
                            </ol>
                            
                            <h4>Ответственный за работу с сопротивлением:</h4>
                            <p>[Имя и роль]</p>
                            
                            <h4>Критерии успеха:</h4>
                            <p>[Как измерить, что сопротивление преодолено - конкретные индикаторы]</p>
                            <ul>
                                <li>[Индикатор 1]</li>
                                <li>[Индикатор 2]</li>
                                <li>[Индикатор 3]</li>
                            </ul>
                        </div>
                        
                        <div class="resistance-plan-item" style="margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; background: #fff;">
                            <h3>Тип сопротивления: [Активное/Пассивное]</h3>
                            <p><strong>Источник:</strong> [От кого исходит сопротивление]</p>
                            <p><strong>Причина:</strong> [Почему возникает сопротивление]</p>
                            
                            <h4>Выбранный метод:</h4>
                            <p>[ADKAR / Модель Левина / Вовлечение]</p>
                            
                            <h4>План действий:</h4>
                            <ol>
                                <li>[Конкретное действие 1] - Срок: [дата]</li>
                                <li>[Конкретное действие 2] - Срок: [дата]</li>
                                <li>[Конкретное действие 3] - Срок: [дата]</li>
                            </ol>
                            
                            <h4>Ответственный:</h4>
                            <p>[Имя и роль]</p>
                            
                            <h4>Критерии успеха:</h4>
                            <p>[Как измерить преодоление сопротивления]</p>
                        </div>
                    `
                },
                'information-plan': {
                    structure: 'Источник → Каналы → Узлы → Сроки',
                    content: `
                        <h2>План распространения информации</h2>
                        <p><strong>Проект:</strong> [Название проекта]</p>
                        <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        
                        <div class="template-section">
                            <h3>Инструкция по заполнению</h3>
                            <p>Заполните таблицу для каждого важного сообщения в проекте. Укажите источник информации, каналы коммуникации, ключевых коммуникаторов (узлы) и сроки распространения.</p>
                        </div>
                        
                        <table class="information-plan-table" style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                            <thead>
                                <tr style="background: #f5f5f5;">
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Информация</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Источник</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Каналы</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Коммуникационные узлы</th>
                                    <th style="padding: 12px; border: 1px solid #ddd; text-align: left;">Срок</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Объявление о начале проекта</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Спонсор / Руководитель проекта]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">Email, Town Hall встреча</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Ключевые коммуникаторы]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Дата и время]</td>
                                </tr>
                                <tr style="background: #f9f9f9;">
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Обновление статуса</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Лидер изменений]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">Email, мессенджер</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Коммуникационные узлы]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Дата и время]</td>
                                </tr>
                                <tr>
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Ответы на частые вопросы</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Команда проекта]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">Корпоративный портал, мессенджер</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Коммуникационные узлы]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Дата и время]</td>
                                </tr>
                                <tr style="background: #f9f9f9;">
                                    <td style="padding: 12px; border: 1px solid #ddd;"><strong>Изменения в планах</strong></td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Спонсор / Руководитель проекта]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">Email, личные встречи</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Коммуникационные узлы]</td>
                                    <td style="padding: 12px; border: 1px solid #ddd;">[Дата и время]</td>
                                </tr>
                            </tbody>
                        </table>
                        
                        <div class="template-section">
                            <h3>Рекомендации по работе с коммуникационными узлами</h3>
                            <ul>
                                <li><strong>Идентификация узлов:</strong> Определите 20% людей, которые распространяют 80% информации</li>
                                <li><strong>Работа с узлами:</strong> Информируйте узлы первыми, до официальной коммуникации</li>
                                <li><strong>Вовлечение узлов:</strong> Вовлекайте узлы в процесс коммуникации, делайте их союзниками</li>
                                <li><strong>Регулярная коммуникация:</strong> Поддерживайте постоянный контакт с ключевыми коммуникаторами</li>
                                <li><strong>Мониторинг:</strong> Отслеживайте, как информация распространяется через узлы</li>
                            </ul>
                        </div>
                    `
                }
            };

            const template = templates[templateId];
            if (!template) {
                console.error('Шаблон не найден:', templateId, 'Доступные шаблоны:', Object.keys(templates));
                alert(`Шаблон "${templateId}" не найден. Доступные шаблоны: ${Object.keys(templates).join(', ')}`);
                return;
            }

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>${title}</title>
                    <style>
                        * {
                            margin: 0;
                            padding: 0;
                            box-sizing: border-box;
                        }
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                            line-height: 1.6;
                            color: #333;
                            padding: 40px 20px;
                            max-width: 900px;
                            margin: 0 auto;
                            background: #fff;
                        }
                        h1 {
                            color: #21808d;
                            font-size: 28px;
                            margin-bottom: 10px;
                            padding-bottom: 10px;
                            border-bottom: 3px solid #21808d;
                        }
                        h2 {
                            color: #21808d;
                            font-size: 24px;
                            margin-top: 30px;
                            margin-bottom: 15px;
                            padding-bottom: 8px;
                            border-bottom: 2px solid #e0e0e0;
                        }
                        h3 {
                            color: #21808d;
                            font-size: 20px;
                            margin-top: 25px;
                            margin-bottom: 12px;
                        }
                        h4 {
                            color: #333;
                            font-size: 18px;
                            margin-top: 20px;
                            margin-bottom: 10px;
                        }
                        .template-section {
                            margin: 25px 0;
                            padding: 20px;
                            background: #f9f9f9;
                            border-radius: 8px;
                            border-left: 4px solid #21808d;
                        }
                        .template-structure {
                            background: #f5f5f5;
                            padding: 15px;
                            border-radius: 8px;
                            margin: 20px 0;
                            font-size: 14px;
                            color: #666;
                        }
                        ul, ol {
                            margin: 15px 0;
                            padding-left: 30px;
                        }
                        li {
                            margin: 8px 0;
                        }
                        table {
                            width: 100%;
                            border-collapse: collapse;
                            margin: 20px 0;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        }
                        th {
                            background: #21808d;
                            color: #fff;
                            padding: 12px;
                            text-align: left;
                            font-weight: 600;
                            border: 1px solid #1a6b75;
                        }
                        td {
                            padding: 12px;
                            border: 1px solid #ddd;
                        }
                        tr:nth-child(even) {
                            background: #f9f9f9;
                        }
                        tr:hover {
                            background: #f0f0f0;
                        }
                        .faq-item {
                            margin: 20px 0;
                            padding: 20px;
                            background: #fff;
                            border: 1px solid #e0e0e0;
                            border-radius: 8px;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                        }
                        .resistance-plan-item {
                            margin: 20px 0;
                            padding: 20px;
                            border: 1px solid #ddd;
                            border-radius: 8px;
                            background: #fff;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                        }
                        .raci-legend {
                            margin-top: 30px;
                            padding: 20px;
                            background: #f5f5f5;
                            border-radius: 8px;
                        }
                        .progress-indicator {
                            width: 100%;
                            height: 20px;
                            background: #f0f0f0;
                            border-radius: 10px;
                            margin: 10px 0;
                            overflow: hidden;
                        }
                        .progress-indicator div {
                            height: 100%;
                            background: #21808d;
                            border-radius: 10px;
                            transition: width 0.3s ease;
                        }
                        .footer {
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 2px solid #e0e0e0;
                            text-align: center;
                            color: #666;
                            font-size: 14px;
                        }
                        @media print {
                            body {
                                padding: 20px;
                            }
                            .template-section {
                                page-break-inside: avoid;
                            }
                            table {
                                page-break-inside: avoid;
                            }
                            h2, h3 {
                                page-break-after: avoid;
                            }
                        }
                        @media (max-width: 768px) {
                            body {
                                padding: 20px 10px;
                            }
                            table {
                                font-size: 14px;
                            }
                            th, td {
                                padding: 8px;
                            }
                        }
                    </style>
                </head>
                <body>
                    <h1>${title}</h1>
                    <div class="template-structure">
                        <strong>Структура:</strong> ${template.structure}
                    </div>
                    ${template.content}
                    <div class="footer">
                        <p><strong>Автор:</strong> Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>Шаблон создан с помощью интерактивного FAQ управления изменениями</p>
                        <p style="margin-top: 10px; font-size: 12px; color: #999;">
                            <strong>Инструкция по использованию:</strong> Заполните все поля, помеченные квадратными скобками [ ], и используйте шаблон для коммуникаций в вашем проекте изменений.
                        </p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();
            
            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        function saveFAQState() {
            try {
                localStorage.setItem('faq_state', JSON.stringify(faqState));
            } catch (error) {
                console.warn('Не удалось сохранить состояние FAQ:', error);
            }
        }

        function loadFAQState() {
            try {
                const saved = localStorage.getItem('faq_state');
                if (saved) {
                    faqState = JSON.parse(saved);
                }
            } catch (error) {
                console.warn('Не удалось загрузить состояние FAQ:', error);
            }
        }

        function findModelSlide(modelName) {
            // Поиск слайда с моделью по названию
            const slideIndex = slidesData.findIndex(slide => 
                slide.title && slide.title.toLowerCase().includes(modelName.toLowerCase())
            );
            if (slideIndex >= 0) {
                jumpToSlide(slideIndex);
            } else {
                alert(`Модель "${modelName}" не найдена в презентации`);
            }
        }

        function initPresentation() {
            // Отладочная информация только в режиме разработки
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                console.log('=== initPresentation() вызвана ===');
                console.log('slidesData.length:', slidesData.length);
                console.log('fullSlidesCount:', fullSlidesCount);
                console.log('visibleSlides.length:', visibleSlides.length);
            }

            const container = document.getElementById('slideContainer');

            if (!container) {
                console.error('Критическая ошибка: Контейнер слайдов не найден в DOM. Проверьте структуру HTML.');
                showErrorMessage('Ошибка инициализации: контейнер слайдов не найден');
                return;
            }

            if (!slidesData || slidesData.length === 0) {
                console.error('Критическая ошибка: Данные слайдов отсутствуют или пусты');
                showErrorMessage('Ошибка инициализации: данные презентации не загружены');
                return;
            }

            // Отладочная информация только в режиме разработки
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                console.log('Начинаем создание', slidesData.length, 'слайдов...');
            }
            
            // Generate slides
            slidesData.forEach((slide, index) => {
                const slideDiv = document.createElement('div');
                slideDiv.className = 'slide';
                if (index === 0) slideDiv.classList.add('active');
                slideDiv.innerHTML = `
                    <div class="slide-header">
                        <h1 class="slide-title">${slide.title}</h1>
                        ${slide.subtitle ? `<div class="slide-subtitle">${slide.subtitle}</div>` : ''}
                    </div>
                    ${slide.content}
                `;
                container.appendChild(slideDiv);
                
                // Add to selector
                const option = document.createElement('option');
                option.value = String(index);
                option.dataset.index = String(index);
                option.textContent = `${index + 1}. ${slide.title.substring(0, 50)}${slide.title.length > 50 ? '...' : ''}`;
                modelSelectorEl.appendChild(option);
            });
            
            console.log('Создано слайдов:', container.querySelectorAll('.slide').length);
            console.log('Слайды в селекторе:', modelSelectorEl.options.length - 1); // -1 для placeholder
            
            updateNavigation();
            activateSlide(currentSlide);
        }
        
        function updateCircularProgress(ratio) {
            if (!progressCircleEl || !progressCountEl) return;
            const clamped = Math.min(Math.max(ratio, 0), 1);
            progressCircleEl.style.strokeDashoffset = PROGRESS_CIRCUMFERENCE * (1 - clamped);
            const position = getVisiblePosition(currentSlide);
            const totalVisible = visibleSlides.length || 1;
            progressCountEl.textContent = `${position + 1} / ${totalVisible}`;
        }
        
        function updateBookmarkUI() {
            if (!bookmarkToggleBtn) return;
            const isBookmarked = bookmarks.has(currentSlide);
            bookmarkToggleBtn.classList.toggle('active', isBookmarked);
            bookmarkToggleBtn.textContent = isBookmarked ? '★ В избранном' : '☆ Избранное';
            if (bookmarkPanelToggleBtn) {
                bookmarkPanelToggleBtn.textContent = bookmarks.size
                    ? `Список ⭐ (${bookmarks.size})`
                    : 'Список ⭐';
            }
        }
        
        function renderBookmarkList() {
            if (!bookmarkListEl || !bookmarkEmptyEl) return;
            bookmarkListEl.innerHTML = '';
            const sortedBookmarks = [...bookmarks].sort((a, b) => a - b);
            
            if (!sortedBookmarks.length) {
                bookmarkEmptyEl.style.display = 'block';
                highlightActiveBookmark();
                return;
            }
            
            bookmarkEmptyEl.style.display = 'none';
            sortedBookmarks.forEach((slideIndex) => {
                const listItem = document.createElement('li');
                listItem.className = 'bookmark-item';
                listItem.dataset.slide = slideIndex;
                
                const title = slidesData[slideIndex]?.title ?? `Слайд ${slideIndex + 1}`;
                listItem.innerHTML = `
                    <div>
                        <strong>${slideIndex + 1}</strong>
                        <span>${title}</span>
                    </div>
                    <button class="panel-button secondary" data-remove="${slideIndex}" type="button">Удалить</button>
                `;
                
                bookmarkListEl.appendChild(listItem);
            });
            
            highlightActiveBookmark();
        }
        
        function highlightActiveBookmark() {
            if (!bookmarkListEl) return;
            bookmarkListEl.querySelectorAll('.bookmark-item').forEach((item) => {
                const slideIndex = Number(item.dataset.slide);
                item.classList.toggle('active', slideIndex === currentSlide);
            });
        }
        
        function toggleBookmark() {
            if (bookmarks.has(currentSlide)) {
                bookmarks.delete(currentSlide);
            } else {
                bookmarks.add(currentSlide);
            }
            saveBookmarks();
            renderBookmarkList();
            updateBookmarkUI();
        }
        
        function toggleBookmarkPanel(forceState) {
            if (!bookmarkPanelEl || !bookmarkPanelToggleBtn) return;
            const shouldOpen = typeof forceState === 'boolean'
                ? forceState
                : !bookmarkPanelEl.classList.contains('active');
            bookmarkPanelEl.classList.toggle('active', shouldOpen);
            bookmarkPanelToggleBtn.classList.toggle('active', shouldOpen);
            if (shouldOpen) {
                renderBookmarkList();
                highlightActiveBookmark();
            }
        }
        
        function saveBookmarks() {
            const serialized = JSON.stringify([...bookmarks].sort((a, b) => a - b));
            localStorage.setItem(BOOKMARK_STORAGE_KEY, serialized);
        }
        
        function toggleNotesPanel(forceState) {
            if (!notesPanelEl || !notesToggleBtn) return;
            const shouldOpen = typeof forceState === 'boolean'
                ? forceState
                : !notesPanelEl.classList.contains('active');
            notesPanelEl.classList.toggle('active', shouldOpen);
            notesToggleBtn.classList.toggle('active', shouldOpen);
            if (shouldOpen) {
                syncNotesPanel();
                if (notesTextareaEl) {
                    notesTextareaEl.focus({ preventScroll: false });
                }
            }
        }
        
        function syncNotesPanel() {
            if (!notesTextareaEl) return;
            const noteValue = notesStore[currentSlide] ?? '';
            if (notesTextareaEl.value !== noteValue) {
                notesTextareaEl.value = noteValue;
            }
            updateNotesStatus(noteValue);
        }
        
        function updateNotesStatus(value) {
            if (!notesStatusEl) return;
            notesStatusEl.textContent = value && value.trim().length
                ? 'Сохранено'
                : 'Заметок пока нет';
        }
        
        function handleNotesInput() {
            if (!notesTextareaEl) return;
            if (notesStatusEl) {
                notesStatusEl.textContent = 'Сохраняю...';
            }
            if (notesSaveTimeout) {
                clearTimeout(notesSaveTimeout);
            }
            notesSaveTimeout = setTimeout(() => {
                const value = notesTextareaEl.value;
                if (value && value.trim().length) {
                    notesStore[currentSlide] = value;
                } else {
                    delete notesStore[currentSlide];
                }
                localStorage.setItem(NOTES_STORAGE_KEY, JSON.stringify(notesStore));
                updateNotesStatus(notesStore[currentSlide] ?? '');
            }, 400);
        }
        
        function clearNotes() {
            if (!notesTextareaEl) return;
            notesTextareaEl.value = '';
            delete notesStore[currentSlide];
            localStorage.setItem(NOTES_STORAGE_KEY, JSON.stringify(notesStore));
            updateNotesStatus('');
        }
        
        const achievementQueue = [];
        let achievementVisible = false;
        
        function checkAchievements(slideIndex) {
            const viewedCount = slidesVisited.size;

            for (const threshold of achievementThresholds) {
                // Специальный случай: финальное достижение при просмотре всех слайдов
                if (threshold.slidesCount === null) {
                    if (viewedCount >= fullSlidesCount && !unlockedAchievements.has(threshold.id)) {
                        unlockedAchievements.add(threshold.id);
                        localStorage.setItem(ACHIEVEMENT_STORAGE_KEY, JSON.stringify([...unlockedAchievements]));
                        queueAchievement(threshold);
                        break;
                    }
                    continue;
                }

                // Обычные достижения: проверяем количество просмотренных слайдов
                if (viewedCount >= threshold.slidesCount && !unlockedAchievements.has(threshold.id)) {
                    unlockedAchievements.add(threshold.id);
                    localStorage.setItem(ACHIEVEMENT_STORAGE_KEY, JSON.stringify([...unlockedAchievements]));
                    queueAchievement(threshold);
                    break;
                }
            }
        }
        
        function queueAchievement(threshold) {
            achievementQueue.push(threshold);
            showNextAchievement();
        }
        
        function showNextAchievement() {
            if (achievementVisible) return;
            const nextAchievement = achievementQueue.shift();
            if (!nextAchievement || !achievementModalEl || !achievementTitleEl || !achievementMessageEl) return;
            achievementVisible = true;
            achievementTitleEl.textContent = nextAchievement.title;
            achievementMessageEl.textContent = nextAchievement.message;
            achievementModalEl.classList.add('active');
        }
        
        function hideAchievementModal() {
            if (!achievementModalEl) return;
            achievementModalEl.classList.remove('active');
            achievementVisible = false;
            if (achievementQueue.length) {
                setTimeout(showNextAchievement, 200);
            }
        }
        
        function getVisiblePosition(slideIndex) {
            return visibleSlides.indexOf(slideIndex);
        }
        
        function findNextVisibleSlide(startIndex, direction) {
            if (!visibleSlides.length) return startIndex;
            const currentPos = getVisiblePosition(startIndex);
            if (currentPos === -1) {
                return visibleSlides[0];
            }
            let newPosition = currentPos + direction;
            newPosition = Math.max(0, Math.min(visibleSlides.length - 1, newPosition));
            return visibleSlides[newPosition];
        }
        
        function refreshModelSelector() {
            if (!modelSelectorEl) return;
            Array.from(modelSelectorEl.options).forEach((option) => {
                if (option.value === '') {
                    option.hidden = false;
                    return;
                }
                const slideIndex = Number(option.value);
                option.hidden = !visibleSlidesSet.has(slideIndex);
            });
        }
        
        function setLearningPath(pathId, options = {}) {
            const path = learningPaths[pathId] ?? learningPaths.expert;
            activeLearningPath = path.id;
            visibleSlides = path.slides.length ? path.slides.slice() : Array.from({ length: fullSlidesCount }, (_, index) => index);
            visibleSlidesSet = new Set(visibleSlides);
            totalSlides = visibleSlides.length;
            
            if (!visibleSlidesSet.has(currentSlide)) {
                currentSlide = visibleSlides[0] ?? 0;
            }
            
            if (pathMetaEl) {
                pathMetaEl.textContent = `${path.label} • ${path.description}`;
            }
            if (pathSelectorEl && !options.skipSelectorSync) {
                pathSelectorEl.value = activeLearningPath;
            }
            
            refreshModelSelector();
            
            if (!options.skipNavigationUpdate) {
                updateNavigation();
            }
        }
        
        function formatDuration(milliseconds) {
            const totalSeconds = Math.max(0, Math.floor(milliseconds / 1000));
            const minutes = Math.floor(totalSeconds / 60);
            const seconds = totalSeconds % 60;
            return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }
        
        function updateFinalStats() {
            const slidesValueEl = document.getElementById('ctaSlidesViewed');
            const bookmarksEl = document.getElementById('ctaBookmarksCount');
            const pathEl = document.getElementById('ctaActivePath');
            const timeEl = document.getElementById('ctaTimeSpent');
            const quizStatusEl = document.getElementById('ctaQuizStatus');
            
            if (slidesValueEl) {
                slidesValueEl.textContent = String(slidesVisited.size);
            }
            if (bookmarksEl) {
                bookmarksEl.textContent = String(bookmarks.size);
            }
            if (pathEl) {
                const path = learningPaths[activeLearningPath];
                pathEl.textContent = path ? path.label : 'Экспертный путь';
            }
            if (timeEl) {
                timeEl.textContent = formatDuration(Date.now() - startTime);
            }
            if (quizStatusEl) {
                quizStatusEl.textContent = quizCompleted
                    ? 'Мини-диагностика: пройдена 🎯'
                    : 'Мини-диагностика: ещё можно пройти на слайде 7';
            }
        }
        
        function findSlideIndexByKeyword(keyword) {
            if (!keyword) return -1;
            const lowerKeyword = keyword.toLowerCase();
            return slidesData.findIndex((slide) => {
                const title = (slide.title ?? '').toLowerCase();
                const subtitle = (slide.subtitle ?? '').toLowerCase();
                return title.includes(lowerKeyword) || subtitle.includes(lowerKeyword);
            });
        }

        // Функции-обертки для переходов со слайда 6
        function goToClassification() {
            const idx = findSlideIndexByKeyword('Классификация');
            if (idx >= 0) jumpToSlide(idx);
        }

        function goToPracticalTools() {
            const idx = findSlideIndexByKeyword('Практические инструменты');
            if (idx >= 0) jumpToSlide(idx);
        }

        function goToFAQ() {
            const idx = findSlideIndexByKeyword('FAQ');
            if (idx >= 0) jumpToSlide(idx);
        }

        function goToModelSelector() {
            const idx = findSlideIndexByKeyword('Интерактивный инструмент выбора модели');
            if (idx >= 0) jumpToSlide(idx);
        }
        
        // ========== ЭКСПЕРТНЫЕ ФУНКЦИИ ДЛЯ ИНТЕРПРЕТАЦИИ РЕЗУЛЬТАТОВ ==========
        
        // Экспертная интерпретация профиля квиза
        function generateExpertInsight(profile, models, answers) {
            const scopeInfo = quizScopeMap[answers.scope] ?? quizScopeMap.small;
            const resistanceInfo = quizResistanceMap[answers.resistance] ?? quizResistanceMap.mixed;
            const paceInfo = quizPaceMap[answers.pace] ?? quizPaceMap.iterative;
            const cultureInfo = quizCultureMap[answers.culture] ?? quizCultureMap.hybrid;
            const resourcesInfo = quizResourcesMap[answers.resources] ?? quizResourcesMap.adequate;
            
            // Определяем общий характер профиля
            const isComplex = answers.scope === 'large' || answers.resistance === 'high';
            const isFast = answers.pace === 'rapid';
            const isConservative = answers.culture === 'conservative';
            const hasLimitedResources = answers.resources === 'limited';
            
            let summary = '';
            let detailed = '';
            const strengths = [];
            const risks = [];
            
            // Генерируем экспертную интерпретацию
            if (isComplex && hasLimitedResources) {
                summary = 'Ваш профиль характеризуется высокой сложностью при ограниченных ресурсах — это требует особого внимания к приоритизации и фазовому подходу.';
                detailed = 'Комбинация крупного масштаба изменений и ограниченных ресурсов создает уникальные вызовы. Ключ к успеху — в правильной последовательности действий и фокусе на критических элементах. Рекомендуется начать с пилотных зон и постепенно масштабировать успешные практики.';
                strengths.push('Понимание сложности проекта позволяет планировать реалистично');
                strengths.push('Ограниченные ресурсы заставляют фокусироваться на наиболее важном');
                risks.push('Риск перегрузки команды при попытке сделать все сразу');
                risks.push('Возможность недооценки масштаба работ из-за ограниченных ресурсов');
                risks.push('Высокий риск выгорания команды при неправильном планировании');
            } else if (isComplex && !hasLimitedResources) {
                summary = 'У вас есть все необходимое для успешной реализации крупных изменений — важно использовать ресурсы эффективно и поддерживать баланс.';
                detailed = 'Достаточные ресурсы при крупном масштабе — это сильная позиция. Однако важно не распылять усилия и поддерживать фокус на ключевых приоритетах. Рекомендуется создать структурированную программу управления изменениями с четкими этапами и метриками.';
                strengths.push('Достаточные ресурсы позволяют реализовать комплексный подход');
                strengths.push('Возможность привлечения экспертизы и обучения команды');
                strengths.push('Способность масштабировать успешные практики');
                risks.push('Риск избыточного усложнения из-за доступности ресурсов');
                risks.push('Возможность конфликтов приоритетов между разными направлениями');
            } else if (!isComplex && isFast) {
                summary = 'Ваш профиль оптимален для быстрых, локальных изменений — это позволяет быстро получать результаты и демонстрировать ценность.';
                detailed = 'Сочетание локального масштаба и быстрого темпа создает идеальные условия для agile-подхода к изменениям. Фокус должен быть на быстрых победах и итеративном улучшении. Это позволяет накапливать опыт и создавать позитивную динамику.';
                strengths.push('Быстрый темп позволяет быстро демонстрировать результаты');
                strengths.push('Локальный масштаб упрощает управление и коммуникацию');
                strengths.push('Возможность быстрой адаптации на основе обратной связи');
                risks.push('Риск поспешных решений без достаточного анализа');
                risks.push('Возможность недооценки долгосрочных последствий');
            } else {
                summary = 'Ваш профиль показывает сбалансированный подход к изменениям — это создает хорошие условия для устойчивого успеха.';
                detailed = 'Сбалансированный профиль позволяет использовать проверенные методологии с возможностью адаптации под конкретную ситуацию. Рекомендуется комбинировать структурированные подходы с элементами гибкости для оптимального результата.';
                strengths.push('Сбалансированность снижает риски перекосов в ту или иную сторону');
                strengths.push('Возможность адаптации под меняющиеся условия');
                risks.push('Риск недостаточной фокусировки при попытке учесть все аспекты');
            }
            
            // Добавляем специфические риски и сильные стороны на основе параметров
            if (answers.resistance === 'high') {
                risks.push('Высокое сопротивление требует активной работы с людьми и может замедлить процесс');
                strengths.push('Осознание высокого сопротивления позволяет заранее подготовить план работы с ним');
            }
            
            if (isConservative) {
                risks.push('Консервативная культура может замедлить принятие изменений');
                strengths.push('Консервативная культура ценит структурированные и проверенные подходы');
            }
            
            return { summary, detailed, strengths, risks };
        }
        
        // Анализ соответствия модели профилю
        function analyzeModelFit(model, profile, answers) {
            const scopeInfo = quizScopeMap[answers.scope] ?? quizScopeMap.small;
            const resistanceInfo = quizResistanceMap[answers.resistance] ?? quizResistanceMap.mixed;
            const paceInfo = quizPaceMap[answers.pace] ?? quizPaceMap.iterative;
            
            let reason = '';
            const criteria = [];
            const implementation = [];
            let alternatives = '';
            
            // Генерируем анализ на основе модели и профиля
            if (model.keyword.toLowerCase().includes('адкар') || model.keyword.toLowerCase().includes('adkar')) {
                reason = `${model.label} идеально подходит для вашего профиля, так как обеспечивает структурированный подход к индивидуальным изменениям, что критично при ${resistanceInfo.title.toLowerCase()}.`;
                criteria.push(`Высокое соответствие по работе с сопротивлением (${model.matchPercent}%)`);
                criteria.push(`Подходит для ${scopeInfo.title.toLowerCase()}`);
                criteria.push(`Адаптируется к ${paceInfo.title.toLowerCase()}`);
                implementation.push('Начните с диагностики текущего этапа ADKAR для каждой группы сотрудников');
                implementation.push('Разработайте план коммуникаций для каждого этапа (Осознание → Желание → Знание → Способность → Закрепление)');
                implementation.push('Создайте систему отслеживания прогресса по каждому этапу');
                implementation.push('Организуйте регулярные check-in сессии для оценки прогресса');
                alternatives = 'Альтернативы: Модель Коттера (для более структурированного подхода), Модель Сатир (для работы с эмоциональной стороной)';
            } else if (model.keyword.toLowerCase().includes('коттер') || model.keyword.toLowerCase().includes('kotter')) {
                reason = `${model.label} подходит для вашего профиля, обеспечивая четкую структуру из 8 шагов, что особенно важно при ${scopeInfo.title.toLowerCase()}.`;
                criteria.push(`Структурированный подход для ${scopeInfo.title.toLowerCase()}`);
                criteria.push(`Эффективен при ${resistanceInfo.title.toLowerCase()}`);
                criteria.push(`Поддерживает ${paceInfo.title.toLowerCase()}`);
                implementation.push('Сформируйте коалицию поддержки из ключевых лидеров');
                implementation.push('Создайте и коммуницируйте убедительное видение изменений');
                implementation.push('Обеспечьте краткосрочные победы для поддержания мотивации');
                implementation.push('Закрепите изменения в культуре организации');
                alternatives = 'Альтернативы: ADKAR (для индивидуального подхода), Модель McKinsey (для более комплексного анализа)';
            } else if (model.keyword.toLowerCase().includes('pdca') || model.keyword.toLowerCase().includes('цикл')) {
                reason = `${model.label} оптимален для вашего профиля, обеспечивая быстрые итерации и непрерывное улучшение, что идеально для ${paceInfo.title.toLowerCase()}.`;
                criteria.push(`Итеративный подход для ${paceInfo.title.toLowerCase()}`);
                criteria.push(`Быстрая адаптация под ${scopeInfo.title.toLowerCase()}`);
                criteria.push(`Эффективен при ${resistanceInfo.title.toLowerCase()}`);
                implementation.push('Определите пилотную зону для первого цикла PDCA');
                implementation.push('Установите четкие метрики для измерения результатов');
                implementation.push('Проводите регулярные ретроспективы после каждого цикла');
                implementation.push('Масштабируйте успешные практики на другие области');
                alternatives = 'Альтернативы: R2P2 (для более структурированных итераций), Теория подталкивания (для мягкого влияния)';
            } else {
                reason = `${model.label} рекомендована на основе анализа вашего профиля проекта. Модель хорошо сочетается с вашими параметрами изменений.`;
                criteria.push(`Соответствие по масштабу: ${scopeInfo.title}`);
                criteria.push(`Соответствие по сопротивлению: ${resistanceInfo.title}`);
                criteria.push(`Соответствие по темпу: ${paceInfo.title}`);
                implementation.push('Изучите детальное описание модели для понимания всех этапов');
                implementation.push('Адаптируйте модель под специфику вашей организации');
                implementation.push('Разработайте план внедрения с учетом ваших ресурсов');
                alternatives = 'Рекомендуется также рассмотреть альтернативные модели из топ-3 для сравнения подходов';
            }
            
            return { reason, criteria, implementation, alternatives };
        }
        
        // Генерация плана действий на основе профиля
        function generateActionPlan(models, profile, answers) {
            const scopeInfo = quizScopeMap[answers.scope] ?? quizScopeMap.small;
            const resistanceInfo = quizResistanceMap[answers.resistance] ?? quizResistanceMap.mixed;
            const paceInfo = quizPaceMap[answers.pace] ?? quizPaceMap.iterative;
            
            const phases = [];
            
            // Фаза 1: Подготовка (1-2 недели)
            phases.push({
                name: 'Подготовка и планирование',
                timeframe: '1-2 недели',
                actions: [
                    'Изучите детальное описание рекомендованных моделей',
                    'Проведите встречу с ключевыми стейкхолдерами для обсуждения подхода',
                    'Оцените текущую готовность организации к изменениям (используйте инструмент диагностики готовности)',
                    'Определите пилотную зону для начала внедрения',
                    'Сформируйте команду управления изменениями с четкими ролями',
                    'Разработайте план коммуникаций с учетом уровня сопротивления'
                ]
            });
            
            // Фаза 2: Пилотное внедрение (2-4 недели)
            if (answers.scope === 'small' || answers.pace === 'rapid') {
                phases.push({
                    name: 'Пилотное внедрение',
                    timeframe: '2-4 недели',
                    actions: [
                        'Запустите пилотный проект в выбранной зоне',
                        'Применяйте выбранную модель с адаптацией под специфику',
                        'Собирайте обратную связь от участников каждую неделю',
                        'Документируйте уроки и лучшие практики',
                        'Корректируйте подход на основе полученного опыта',
                        'Демонстрируйте первые результаты для поддержания мотивации'
                    ]
                });
            } else {
                phases.push({
                    name: 'Пилотное внедрение',
                    timeframe: '3-6 недель',
                    actions: [
                        'Запустите пилотный проект в выбранной зоне',
                        'Применяйте выбранную модель с адаптацией под специфику',
                        'Собирайте обратную связь от участников каждые 2 недели',
                        'Проводите регулярные встречи команды управления изменениями',
                        'Документируйте уроки и лучшие практики',
                        'Корректируйте подход на основе полученного опыта',
                        'Демонстрируйте промежуточные результаты'
                    ]
                });
            }
            
            // Фаза 3: Масштабирование (4-8 недель)
            if (answers.scope === 'large') {
                phases.push({
                    name: 'Масштабирование',
                    timeframe: '4-8 недель',
                    actions: [
                        'Проанализируйте результаты пилотного проекта',
                        'Адаптируйте модель для других подразделений',
                        'Обучите команды в новых зонах на основе опыта пилота',
                        'Создайте систему обмена лучшими практиками',
                        'Масштабируйте успешные элементы поэтапно',
                        'Поддерживайте единый подход при адаптации под локальные особенности'
                    ]
                });
            }
            
            // Фаза 4: Закрепление (2-4 недели)
            phases.push({
                name: 'Закрепление и оптимизация',
                timeframe: '2-4 недели',
                actions: [
                    'Проведите оценку эффективности внедренной модели',
                    'Идентифицируйте области для улучшения',
                    'Закрепите успешные практики в процессах организации',
                    'Создайте базу знаний для будущих проектов изменений',
                    'Организуйте ретроспективу с командой для извлечения уроков',
                    'Планируйте следующие шаги развития практики управления изменениями'
                ]
            });
            
            return { phases };
        }
        
        function resolveQuizResult(answers) {
            // Получаем информацию по всем 5 категориям
            const scopeInfo = quizScopeMap[answers.scope] ?? quizScopeMap.small;
            const resistanceInfo = quizResistanceMap[answers.resistance] ?? quizResistanceMap.mixed;
            const paceInfo = quizPaceMap[answers.pace] ?? quizPaceMap.iterative;
            const cultureInfo = quizCultureMap[answers.culture] ?? quizCultureMap.hybrid;
            const resourcesInfo = quizResourcesMap[answers.resources] ?? quizResourcesMap.adequate;

            // Собираем все рекомендации из 5 категорий
            const combinedRecommendations = [
                ...scopeInfo.recommendations,
                ...resistanceInfo.recommendations,
                ...paceInfo.recommendations,
                ...cultureInfo.recommendations,
                ...resourcesInfo.recommendations
            ];

            // Группируем по ключевому слову и рассчитываем средний процент соответствия
            const recommendationsMap = new Map();
            combinedRecommendations.forEach((item) => {
                const key = item.keyword.toLowerCase();
                if (recommendationsMap.has(key)) {
                    const existing = recommendationsMap.get(key);
                    existing.totalMatch += item.baseMatch;
                    existing.count += 1;
                    existing.sources.add(item.label);
                } else {
                    recommendationsMap.set(key, {
                        ...item,
                        totalMatch: item.baseMatch,
                        count: 1,
                        sources: new Set([item.label])
                    });
                }
            });

            // Преобразуем в массив с рассчитанными процентами
            const uniqueRecommendations = Array.from(recommendationsMap.values())
                .map(item => ({
                    ...item,
                    matchPercent: Math.round(item.totalMatch / item.count),
                    sources: Array.from(item.sources)
                }))
                .sort((a, b) => b.matchPercent - a.matchPercent)
                .slice(0, 3); // Берем топ-3 по соответствию

            // Находим слайды для перехода
            const jumpTargets = uniqueRecommendations
                .map((item) => findSlideIndexByKeyword(item.keyword))
                .filter((index) => index >= 0);

            // Собираем описание профиля проекта
            const profileDescription = [
                scopeInfo.title,
                resistanceInfo.title,
                paceInfo.title,
                cultureInfo.title,
                resourcesInfo.title
            ].join(' • ');

            // Сохраняем профиль в localStorage
            const profileData = {
                answers,
                recommendations: uniqueRecommendations,
                profileDescription,
                timestamp: new Date().toISOString(),
                version: '2.0'
            };
            localStorage.setItem('quizProfile', JSON.stringify(profileData));

            return {
                title: 'Персональные рекомендации',
                profile: profileDescription,
                models: uniqueRecommendations,
                jumpTargets,
                profileData
            };
        }
        
        function setupQuiz() {
            const quizRoot = document.getElementById('quizApp');
            const quizProgressEl = document.getElementById('quizProgress');
            if (!quizRoot) return;
            
            const answers = {};
            let stepIndex = 0;
            
            renderStep();
            
            function renderStep() {
                const currentStep = quizSteps[stepIndex];
                if (!currentStep) {
                    renderResult();
                    return;
                }
                
                if (quizProgressEl) {
                    quizProgressEl.textContent = `Вопрос ${stepIndex + 1} из ${quizSteps.length}`;
                }
                
                quizRoot.innerHTML = '';
                
                const stepContainer = document.createElement('div');
                stepContainer.className = 'quiz-step';
                
                const titleEl = document.createElement('div');
                titleEl.className = 'quiz-step-title';
                titleEl.textContent = currentStep.question;
                stepContainer.appendChild(titleEl);
                
                const optionsEl = document.createElement('div');
                optionsEl.className = 'quiz-options';
                
                currentStep.options.forEach((option) => {
                    const optionButton = document.createElement('button');
                    optionButton.type = 'button';
                    optionButton.className = 'quiz-option';
                    optionButton.innerHTML = `
                        <div>
                            <strong>${option.label}</strong>
                            ${option.hint ? `<span>${option.hint}</span>` : ''}
                        </div>
                    `;
                    optionButton.addEventListener('click', () => {
                        answers[currentStep.id] = option.value;
                        stepIndex += 1;
                        if (stepIndex < quizSteps.length) {
                            renderStep();
                        } else {
                            renderResult();
                            quizCompleted = true;
                            // Синхронизируем результаты квиза с инструментом выбора моделей
                            syncQuizWithModelSelector();
                        }
                    });
                    optionsEl.appendChild(optionButton);
                });
                
                stepContainer.appendChild(optionsEl);
                quizRoot.appendChild(stepContainer);
            }
            
            function renderResult() {
                const quizResult = resolveQuizResult(answers);

                if (quizProgressEl) {
                    quizProgressEl.textContent = 'Ваши рекомендации готовы';
                }

                quizRoot.innerHTML = '';

                const resultContainer = document.createElement('div');
                resultContainer.className = 'quiz-result';

                // Заголовок
                const titleEl = document.createElement('h4');
                titleEl.textContent = quizResult.title;
                resultContainer.appendChild(titleEl);

                // Профиль проекта
                const profileEl = document.createElement('div');
                profileEl.className = 'quiz-profile';
                
                // Генерируем экспертную интерпретацию
                const expertInsight = generateExpertInsight(quizResult.profile, quizResult.models, answers);
                
                profileEl.innerHTML = `
                    <div class="quiz-profile-title">Ваш профиль проекта:</div>
                    <div class="quiz-profile-description">${quizResult.profile}</div>
                    
                    <div class="quiz-expert-insight">
                        <h5>Экспертная интерпретация вашего профиля</h5>
                        <p class="quiz-expert-summary"><strong>${expertInsight.summary}</strong></p>
                        <p class="quiz-expert-detailed">${expertInsight.detailed}</p>
                        
                        <div class="quiz-profile-strengths">
                            <h6>Сильные стороны вашего подхода:</h6>
                            <ul>${expertInsight.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
                        </div>
                        
                        <div class="quiz-profile-risks">
                            <h6>Потенциальные риски и рекомендации по их митигации:</h6>
                            <ul>${expertInsight.risks.map(r => `<li>${r}</li>`).join('')}</ul>
                        </div>
                    </div>
                `;
                resultContainer.appendChild(profileEl);

                // Радар-чарт профиля
                const chartEl = document.createElement('div');
                chartEl.className = 'quiz-profile-chart';
                chartEl.id = 'quizProfileChart';
                resultContainer.appendChild(chartEl);

                // Рекомендации с процентами
                const recommendationsEl = document.createElement('div');
                recommendationsEl.className = 'quiz-recommendations';
                recommendationsEl.innerHTML = '<h5>Рекомендованные модели:</h5>';

                quizResult.models.forEach((model, index) => {
                    const modelEl = document.createElement('div');
                    modelEl.className = 'quiz-model-item';
                    
                    // Генерируем экспертный анализ соответствия модели
                    const expertAnalysis = analyzeModelFit(model, quizResult.profile, answers);
                    
                    modelEl.innerHTML = `
                        <div class="quiz-model-header">
                            <span class="quiz-model-number">${index + 1}</span>
                            <span class="quiz-model-name">${model.label}</span>
                            <span class="quiz-model-match">${model.matchPercent}%</span>
                        </div>
                        <div class="quiz-model-sources">
                            Рекомендовано: ${model.sources.join(', ')}
                        </div>
                        
                        <div class="quiz-model-expert-analysis">
                            <h6>Почему ${model.label} подходит для вашего проекта:</h6>
                            <p class="quiz-model-reason">${expertAnalysis.reason}</p>
                            
                            <div class="quiz-model-fit-details">
                                <div class="fit-criteria">
                                    <strong>Критерии соответствия:</strong>
                                    <ul>${expertAnalysis.criteria.map(c => `<li>${c}</li>`).join('')}</ul>
                                </div>
                                
                                <div class="fit-implementation">
                                    <strong>Рекомендации по внедрению:</strong>
                                    <ul>${expertAnalysis.implementation.map(i => `<li>${i}</li>`).join('')}</ul>
                                </div>
                                
                                <div class="fit-alternatives">
                                    <strong>Альтернативные модели для рассмотрения:</strong>
                                    <p>${expertAnalysis.alternatives}</p>
                                </div>
                            </div>
                        </div>
                    `;
                    recommendationsEl.appendChild(modelEl);
                });
                
                // Добавляем план действий
                const actionPlan = generateActionPlan(quizResult.models, quizResult.profile, answers);
                const actionPlanEl = document.createElement('div');
                actionPlanEl.className = 'quiz-action-plan';
                actionPlanEl.innerHTML = `
                    <h5>План действий на основе вашего профиля</h5>
                    <p class="quiz-action-plan-intro">Следующий план поможет вам систематически внедрить рекомендованные модели и достичь успеха в вашем проекте изменений.</p>
                    <div class="action-plan-phases">
                        ${actionPlan.phases.map((phase, index) => `
                            <div class="action-plan-phase">
                                <div class="phase-header">
                                    <h6>Фаза ${index + 1}: ${phase.name}</h6>
                                    <span class="phase-timeframe">${phase.timeframe}</span>
                                </div>
                                <ul class="phase-actions">${phase.actions.map(a => `<li>${a}</li>`).join('')}</ul>
                            </div>
                        `).join('')}
                    </div>
                    <div class="quiz-action-plan-note">
                        <p><strong>Важно:</strong> Этот план является рекомендательным. Адаптируйте его под специфику вашей организации, доступные ресурсы и временные рамки проекта.</p>
                    </div>
                `;
                recommendationsEl.appendChild(actionPlanEl);
                resultContainer.appendChild(recommendationsEl);

                // Действия
                const actionsEl = document.createElement('div');
                actionsEl.className = 'quiz-actions';

                // Экспорт профиля
                const exportButton = document.createElement('button');
                exportButton.type = 'button';
                exportButton.className = 'panel-button';
                exportButton.textContent = '📄 Экспорт профиля в PDF';
                exportButton.addEventListener('click', () => {
                    exportQuizProfileToPDF(quizResult);
                });
                actionsEl.appendChild(exportButton);

                // Переход к модели
                if (quizResult.jumpTargets.length) {
                    const jumpButton = document.createElement('button');
                    jumpButton.type = 'button';
                    jumpButton.className = 'panel-button';
                    jumpButton.textContent = 'Перейти к топ-модели';
                    jumpButton.addEventListener('click', () => {
                        toggleBookmarkPanel(false);
                        toggleNotesPanel(false);
                        jumpToSlide(quizResult.jumpTargets[0]);
                    });
                    actionsEl.appendChild(jumpButton);
                }

                // Перезапуск
                const restartButton = document.createElement('button');
                restartButton.type = 'button';
                restartButton.className = 'panel-button secondary';
                restartButton.textContent = 'Пройти квиз снова';
                restartButton.addEventListener('click', () => {
                    quizCompleted = false;
                    Object.keys(answers).forEach((key) => delete answers[key]);
                    stepIndex = 0;
                    renderStep();
                });
                actionsEl.appendChild(restartButton);

                resultContainer.appendChild(actionsEl);
                quizRoot.appendChild(resultContainer);

                // Рисуем радар-чарт после добавления в DOM
                setTimeout(() => renderQuizProfileChart(answers), 100);
            }
        }

        function renderQuizProfileChart(answers) {
            const chartContainer = document.getElementById('quizProfileChart');
            if (!chartContainer) return;

            // Преобразуем ответы в числовые значения для радара
            const radarValues = {
                scope: answers.scope === 'small' ? 20 : answers.scope === 'medium' ? 60 : 100,
                resistance: answers.resistance === 'low' ? 20 : answers.resistance === 'mixed' ? 60 : 100,
                pace: answers.pace === 'rapid' ? 20 : answers.pace === 'iterative' ? 60 : 100,
                culture: answers.culture === 'conservative' ? 20 : answers.culture === 'hybrid' ? 60 : 100,
                resources: answers.resources === 'limited' ? 20 : answers.resources === 'adequate' ? 60 : 100
            };

            // Координаты для 5-угольника
            const centerX = 150;
            const centerY = 150;
            const radius = 120;

            const angles = [0, 72, 144, 216, 288]; // Углы для 5 точек
            const labels = ['Масштаб', 'Сопротивление', 'Темп', 'Культура', 'Ресурсы'];

            let svg = `<svg width="300" height="300" viewBox="0 0 300 300">`;

            // Фоновая сетка (3 уровня)
            for (let level = 1; level <= 3; level++) {
                const r = (radius * level) / 3;
                let points = '';
                angles.forEach(angle => {
                    const x = centerX + r * Math.cos((angle - 90) * Math.PI / 180);
                    const y = centerY + r * Math.sin((angle - 90) * Math.PI / 180);
                    points += `${x},${y} `;
                });
                svg += `<polygon points="${points}" fill="none" stroke="#e0e0e0" stroke-width="1" opacity="0.5"/>`;
            }

            // Оси
            angles.forEach((angle, index) => {
                const x = centerX + radius * Math.cos((angle - 90) * Math.PI / 180);
                const y = centerY + radius * Math.sin((angle - 90) * Math.PI / 180);
                svg += `<line x1="${centerX}" y1="${centerY}" x2="${x}" y2="${y}" stroke="#ccc" stroke-width="1"/>`;

                // Метки
                const labelX = centerX + (radius + 20) * Math.cos((angle - 90) * Math.PI / 180);
                const labelY = centerY + (radius + 20) * Math.sin((angle - 90) * Math.PI / 180);
                const anchor = angle > 90 && angle < 270 ? 'end' : 'start';
                svg += `<text x="${labelX}" y="${labelY}" text-anchor="${anchor}" font-size="12" fill="#666">${labels[index]}</text>`;
            });

            // Данные пользователя
            let dataPoints = '';
            const values = Object.values(radarValues);
            angles.forEach((angle, index) => {
                const value = values[index] || 50;
                const r = (radius * value) / 100;
                const x = centerX + r * Math.cos((angle - 90) * Math.PI / 180);
                const y = centerY + r * Math.sin((angle - 90) * Math.PI / 180);
                dataPoints += `${x},${y} `;
            });

            svg += `<polygon points="${dataPoints}" fill="rgba(var(--color-teal-500-rgb), 0.3)" stroke="var(--color-primary)" stroke-width="3"/>`;

            // Точки на вершинах
            angles.forEach((angle, index) => {
                const value = values[index] || 50;
                const r = (radius * value) / 100;
                const x = centerX + r * Math.cos((angle - 90) * Math.PI / 180);
                const y = centerY + r * Math.sin((angle - 90) * Math.PI / 180);
                svg += `<circle cx="${x}" cy="${y}" r="5" fill="var(--color-primary)"/>`;
            });

            svg += `</svg>`;
            chartContainer.innerHTML = svg;
        }

        function exportQuizProfileToPDF(quizResult) {
            console.log('Экспорт профиля квиза в PDF...');

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Профиль проекта - ${new Date().toLocaleDateString('ru-RU')}</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                        }
                        h1 { color: #2DB67D; border-bottom: 3px solid #2DB67D; padding-bottom: 10px; }
                        h2 { color: #333; margin-top: 30px; }
                        .profile { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .recommendations { margin: 20px 0; }
                        .model-item { background: white; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #2DB67D; }
                        .match-percent { font-weight: bold; color: #2DB67D; font-size: 18px; }
                        .sources { color: #666; font-size: 14px; margin-top: 5px; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>Профиль проекта управления изменениями</h1>
                    <p><strong>Дата анализа:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>

                    <div class="profile">
                        <h2>Ваш профиль проекта</h2>
                        <p><strong>${quizResult.profile}</strong></p>
                    </div>

                    <h2>Рекомендованные модели</h2>
                    <div class="recommendations">
                        ${quizResult.models.map((model, index) => `
                            <div class="model-item">
                                <h3>${index + 1}. ${model.label}</h3>
                                <div class="match-percent">Соответствие: ${model.matchPercent}%</div>
                                <div class="sources">Рекомендовано: ${model.sources.join(', ')}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="footer">
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>Анализ создан с помощью интерактивного инструмента Prosci Change Triangle</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();

            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        // ========== PCT Action Plan Generator ==========
        function generateActionPlan(pctResults) {
            const scores = {
                success: calculateCategoryScore('success'),
                leadership: calculateCategoryScore('leadership'),
                projectManagement: calculateCategoryScore('projectManagement'),
                changeManagement: calculateCategoryScore('changeManagement')
            };

            // Определяем приоритетные зоны (баллы < 20)
            const priorityAreas = [];
            if (scores.success < 20) priorityAreas.push('success');
            if (scores.leadership < 20) priorityAreas.push('leadership');
            if (scores.projectManagement < 20) priorityAreas.push('projectManagement');
            if (scores.changeManagement < 20) priorityAreas.push('changeManagement');

            // Если нет слабых зон, берем зону с минимальным баллом
            if (priorityAreas.length === 0) {
                const minScore = Math.min(...Object.values(scores));
                const minCategory = Object.keys(scores).find(key => scores[key] === minScore);
                priorityAreas.push(minCategory);
            }

            // Генерируем действия для каждой приоритетной зоны
            const actions = {};
            priorityAreas.forEach(area => {
                actions[area] = generateActionsForArea(area, scores[area]);
            });

            // Генерируем рекомендации по моделям
            const modelRecommendations = generateModelRecommendations(scores);

            return {
                scores,
                priorityAreas,
                actions,
                modelRecommendations,
                timeline: generateTimeline(actions),
                checklist: generateChecklist(actions)
            };
        }

        function generateActionsForArea(area, score) {
            const actionTemplates = {
                success: [
                    {
                        phase: 'Неделя 1-2',
                        title: 'Провести аудит целей и выгод',
                        description: 'Проанализировать бизнес-кейс проекта и четко сформулировать ожидаемые выгоды для всех стейкхолдеров',
                        type: 'analysis',
                        tools: ['Шаблон анализа выгод', 'Матрица стейкхолдеров']
                    },
                    {
                        phase: 'Неделя 3-4',
                        title: 'Установить метрики успеха',
                        description: 'Определить конкретные показатели для измерения достижения целей и выгод проекта',
                        type: 'planning',
                        tools: ['Шаблон метрик', 'Дашборд мониторинга']
                    },
                    {
                        phase: 'Неделя 5-6',
                        title: 'Назначить ответственных',
                        description: 'Четко распределить роли и ответственность за достижение целей между командой проекта',
                        type: 'governance',
                        tools: ['Матрица RACI', 'План коммуникаций']
                    }
                ],
                leadership: [
                    {
                        phase: 'Неделя 1-2',
                        title: 'Оценить текущий спонсорство',
                        description: 'Провести интервью с руководителями для оценки уровня поддержки и понимания целей проекта',
                        type: 'assessment',
                        tools: ['Опросник спонсорства', 'Карта влияния']
                    },
                    {
                        phase: 'Неделя 3-4',
                        title: 'Сформировать спонсорскую коалицию',
                        description: 'Определить ключевых спонсоров и разработать план их вовлечения в проект',
                        type: 'coalition',
                        tools: ['Шаблон коалиции', 'План коммуникаций']
                    },
                    {
                        phase: 'Неделя 5-6',
                        title: 'Организовать регулярные коммуникации',
                        description: 'Установить еженедельные встречи с спонсорами для обсуждения прогресса и решения проблем',
                        type: 'communication',
                        tools: ['Шаблон отчетности', 'Календарь встреч']
                    }
                ],
                projectManagement: [
                    {
                        phase: 'Неделя 1-2',
                        title: 'Определить объем проекта',
                        description: 'Четко документировать что входит и не входит в проект, кто будет затронут изменениями',
                        type: 'scope',
                        tools: ['Шаблон объема проекта', 'Карта заинтересованных сторон']
                    },
                    {
                        phase: 'Неделя 3-4',
                        title: 'Разработать план-график',
                        description: 'Создать детальный план с ключевыми вехами и зависимостями',
                        type: 'planning',
                        tools: ['Шаблон плана', 'Диаграмма Ганта']
                    },
                    {
                        phase: 'Неделя 5-6',
                        title: 'Организовать регулярные совещания',
                        description: 'Установить еженедельные встречи команды для отслеживания прогресса и решения проблем',
                        type: 'monitoring',
                        tools: ['Шаблон повестки', 'Система отслеживания рисков']
                    }
                ],
                changeManagement: [
                    {
                        phase: 'Неделя 1-2',
                        title: 'Провести оценку готовности',
                        description: 'Измерить текущий уровень компетенций команды и сопротивление изменениям',
                        type: 'assessment',
                        tools: ['Опросник готовности', 'Анализ сопротивления']
                    },
                    {
                        phase: 'Неделя 3-4',
                        title: 'Разработать стратегию коммуникаций',
                        description: 'Создать план информирования сотрудников о целях, прогрессе и поддержке изменений',
                        type: 'communication',
                        tools: ['Шаблон плана коммуникаций', 'Календарь мероприятий']
                    },
                    {
                        phase: 'Неделя 5-6',
                        title: 'Организовать обучение и поддержку',
                        description: 'Разработать программу обучения для затронутых сотрудников и систему поддержки',
                        type: 'training',
                        tools: ['План обучения', 'Система менторства']
                    }
                ]
            };

            return actionTemplates[area] || [];
        }

        function generateModelRecommendations(scores) {
            const recommendations = [];

            // Логика рекомендаций на основе баллов
            if (scores.success < 20) {
                recommendations.push({
                    model: 'ADKAR',
                    reason: 'Низкие баллы по успеху - нужна модель для управления индивидуальными переходами',
                    priority: 'high'
                });
            }

            if (scores.leadership < 20) {
                recommendations.push({
                    model: 'Модель Коттера',
                    reason: 'Слабое лидерство - необходима модель с акцентом на спонсорство и коалицию',
                    priority: 'high'
                });
            }

            if (scores.projectManagement < 20) {
                recommendations.push({
                    model: 'PDCA Цикл',
                    reason: 'Проблемы с управлением проектом - нужна итеративная модель',
                    priority: 'high'
                });
            }

            if (scores.changeManagement < 20) {
                recommendations.push({
                    model: 'Маур 3 уровня',
                    reason: 'Слабое управление изменениями - нужна модель для работы с сопротивлением',
                    priority: 'high'
                });
            }

            // Если все баллы хорошие, рекомендуем комплексную модель
            if (Object.values(scores).every(score => score >= 25)) {
                recommendations.push({
                    model: 'Гибридная модель',
                    reason: 'Все аспекты в хорошем состоянии - можно использовать комплексный подход',
                    priority: 'medium'
                });
            }

            return recommendations.slice(0, 3); // Максимум 3 рекомендации
        }

        function generateTimeline(actions) {
            const timeline = [];
            const phases = ['Неделя 1-2', 'Неделя 3-4', 'Неделя 5-6'];

            phases.forEach(phase => {
                const phaseActions = [];
                Object.values(actions).forEach(areaActions => {
                    const phaseAction = areaActions.find(action => action.phase === phase);
                    if (phaseAction) {
                        phaseActions.push(phaseAction);
                    }
                });

                if (phaseActions.length > 0) {
                    timeline.push({
                        phase,
                        actions: phaseActions
                    });
                }
            });

            return timeline;
        }

        function generateChecklist(actions) {
            const checklist = [];

            Object.values(actions).forEach(areaActions => {
                areaActions.forEach(action => {
                    checklist.push({
                        id: `${action.type}_${Date.now()}`,
                        title: action.title,
                        description: action.description,
                        phase: action.phase,
                        completed: false,
                        tools: action.tools
                    });
                });
            });

            return checklist;
        }

        function showActionPlanModal() {
            const pctResults = {
                // Получаем актуальные результаты PCT
            };

            const actionPlan = generateActionPlan(pctResults);

            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content action-plan-modal">
                    <div class="modal-header">
                        <h2>Персональный план действий</h2>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">×</button>
                    </div>
                    <div class="modal-body">
                        ${generateActionPlanHTML(actionPlan)}
                    </div>
                    <div class="modal-footer">
                        <button class="panel-button secondary" onclick="this.closest('.modal-overlay').remove()">Закрыть</button>
                        <button class="panel-button" onclick="exportActionPlanToPDF(${JSON.stringify(actionPlan).replace(/"/g, '&quot;')})">📄 Скачать план (PDF)</button>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);
        }

        function generateActionPlanHTML(plan) {
            return `
                <!-- Анализ текущего состояния -->
                <div class="action-plan-section">
                    <h3>📊 Анализ текущего состояния</h3>
                    <div class="scores-grid">
                        ${Object.entries(plan.scores).map(([area, score]) => `
                            <div class="score-item ${score < 20 ? 'critical' : score < 25 ? 'warning' : 'good'}">
                                <div class="score-label">${getAreaLabel(area)}</div>
                                <div class="score-value">${score}/30</div>
                                <div class="score-status">${getScoreStatus(score)}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Приоритетные действия -->
                <div class="action-plan-section">
                    <h3>🎯 Приоритетные действия на 30 дней</h3>
                    <div class="timeline">
                        ${plan.timeline.map(phase => `
                            <div class="timeline-phase">
                                <h4>${phase.phase}</h4>
                                <div class="phase-actions">
                                    ${phase.actions.map(action => `
                                        <div class="action-item">
                                            <h5>${action.title}</h5>
                                            <p>${action.description}</p>
                                            <div class="action-tools">
                                                <strong>Инструменты:</strong> ${action.tools.join(', ')}
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Рекомендованные модели -->
                <div class="action-plan-section">
                    <h3>📚 Рекомендованные модели для изучения</h3>
                    ${plan.modelRecommendations.map(rec => `
                        <div class="model-recommendation ${rec.priority}">
                            <div class="model-name">${rec.model}</div>
                            <div class="model-reason">${rec.reason}</div>
                        </div>
                    `).join('')}
                </div>

                <!-- Чек-лист -->
                <div class="action-plan-section">
                    <h3>✅ Чек-лист для отслеживания</h3>
                    <div class="checklist">
                        ${plan.checklist.map(item => `
                            <label class="checklist-item">
                                <input type="checkbox" onchange="updateChecklistItem('${item.id}', this.checked)">
                                <span class="checkmark"></span>
                                <div class="item-content">
                                    <div class="item-title">${item.title}</div>
                                    <div class="item-description">${item.description}</div>
                                    <div class="item-phase">${item.phase}</div>
                                </div>
                            </label>
                        `).join('')}
                    </div>
                </div>

                <!-- Напоминание о повторной оценке -->
                <div class="action-plan-section reminder">
                    <h3>🔄 Повторная оценка</h3>
                    <p>Через 30 дней рекомендуем пройти PCT оценку повторно, чтобы отследить прогресс и скорректировать план действий.</p>
                    <button class="panel-button" onclick="scheduleFollowUp()">📅 Напомнить через 30 дней</button>
                </div>
            `;
        }

        function getAreaLabel(area) {
            const labels = {
                success: 'Успех',
                leadership: 'Лидерство',
                projectManagement: 'Управление проектами',
                changeManagement: 'Управление изменениями'
            };
            return labels[area] || area;
        }

        function getScoreStatus(score) {
            if (score >= 25) return 'Сильная сторона';
            if (score >= 20) return 'Есть риски';
            return 'Требует внимания';
        }

        function updateChecklistItem(itemId, completed) {
            // Сохраняем состояние чек-листа в localStorage
            const checklistState = JSON.parse(localStorage.getItem('pct_checklist') || '{}');
            checklistState[itemId] = completed;
            localStorage.setItem('pct_checklist', JSON.stringify(checklistState));
        }

        function scheduleFollowUp() {
            // Создаем напоминание через 30 дней
            const followUpDate = new Date();
            followUpDate.setDate(followUpDate.getDate() + 30);

            // В реальном приложении здесь был бы код для создания напоминания
            // в календаре или отправки email
            alert(`Напоминание запланировано на ${followUpDate.toLocaleDateString('ru-RU')}`);
        }

        function exportActionPlanToPDF(plan) {
            console.log('Экспорт плана действий в PDF...');

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>План действий - PCT ${new Date().toLocaleDateString('ru-RU')}</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                        }
                        h1 { color: #2DB67D; border-bottom: 3px solid #2DB67D; padding-bottom: 10px; }
                        h2, h3 { color: #333; margin-top: 30px; }
                        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
                        .scores-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0; }
                        .score-item { padding: 15px; border-radius: 6px; text-align: center; }
                        .score-item.critical { background: rgba(224, 30, 90, 0.1); border: 2px solid #E01E5A; }
                        .score-item.warning { background: rgba(244, 161, 0, 0.1); border: 2px solid #F4A100; }
                        .score-item.good { background: rgba(45, 182, 125, 0.1); border: 2px solid #2DB67D; }
                        .score-value { font-size: 24px; font-weight: bold; margin: 10px 0; }
                        .timeline-phase { margin: 20px 0; }
                        .action-item { background: #f9f9f9; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #2DB67D; }
                        .model-recommendation { background: #f0f8f0; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #2DB67D; }
                        .reminder { background: #fff3cd; border: 1px solid #f0c674; padding: 20px; border-radius: 8px; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>Персональный план действий</h1>
                    <p><strong>На основе оценки Prosci Change Triangle</strong></p>
                    <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>

                    <div class="section">
                        <h2>📊 Текущий анализ по категориям</h2>
                        <div class="scores-grid">
                            ${Object.entries(plan.scores).map(([area, score]) => `
                                <div class="score-item ${score < 20 ? 'critical' : score < 25 ? 'warning' : 'good'}">
                                    <div class="score-label">${getAreaLabel(area)}</div>
                                    <div class="score-value">${score}/30</div>
                                    <div class="score-status">${getScoreStatus(score)}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="section">
                        <h2>🎯 План действий на 30 дней</h2>
                        ${plan.timeline.map(phase => `
                            <h3>${phase.phase}</h3>
                            ${phase.actions.map(action => `
                                <div class="action-item">
                                    <h4>${action.title}</h4>
                                    <p>${action.description}</p>
                                    <p><strong>Инструменты:</strong> ${action.tools.join(', ')}</p>
                                </div>
                            `).join('')}
                        `).join('')}
                    </div>

                    <div class="section">
                        <h2>📚 Рекомендованные модели</h2>
                        ${plan.modelRecommendations.map(rec => `
                            <div class="model-recommendation">
                                <h4>${rec.model}</h4>
                                <p>${rec.reason}</p>
                            </div>
                        `).join('')}
                    </div>

                    <div class="section reminder">
                        <h2>🔄 Повторная оценка</h2>
                        <p>Через 30 дней рекомендуем пройти PCT оценку повторно, чтобы отследить прогресс и скорректировать план действий.</p>
                    </div>

                    <div class="footer">
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>План создан с помощью интерактивного инструмента Prosci Change Triangle</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();

            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        // ========== ROI CALCULATOR ==========
        function validateROIInputs() {
            const errors = [];
            const warnings = [];

            // Получаем значения из формы
            const projectBudget = parseFloat(document.getElementById('projectBudget').value) || 0;
            const changeBudget = parseFloat(document.getElementById('changeBudget').value) || 0;
            const turnoverSavings = parseFloat(document.getElementById('turnoverSavings').value) || 0;
            const productivityGain = parseFloat(document.getElementById('productivityGain').value) || 0;
            const avgSalary = parseFloat(document.getElementById('avgSalary').value) || 0;
            const employeeCount = parseInt(document.getElementById('employeeCount').value) || 0;
            const evaluationPeriod = parseInt(document.getElementById('evaluationPeriod').value) || 3;
            const discountRate = parseFloat(document.getElementById('discountRate').value) || 10;

            // Проверка обязательных полей
            if (changeBudget <= 0) {
                errors.push('Стоимость управления изменениями должна быть больше нуля');
            }

            // Проверка на отрицательные значения
            if (projectBudget < 0) {
                errors.push('Бюджет проекта не может быть отрицательным');
            }
            if (changeBudget < 0) {
                errors.push('Стоимость управления изменениями не может быть отрицательной');
            }
            if (turnoverSavings < 0) {
                errors.push('Экономия на увольнениях не может быть отрицательной');
            }
            if (productivityGain < 0) {
                errors.push('Повышение производительности не может быть отрицательным');
            }
            if (avgSalary < 0) {
                errors.push('Средняя зарплата не может быть отрицательной');
            }
            if (employeeCount < 0) {
                errors.push('Количество сотрудников не может быть отрицательным');
            }
            if (evaluationPeriod < 0) {
                errors.push('Период оценки не может быть отрицательным');
            }
            if (discountRate < 0) {
                errors.push('Ставка дисконтирования не может быть отрицательной');
            }

            // Проверка на разумные диапазоны
            if (productivityGain > 100) {
                warnings.push('Повышение производительности более 100% выглядит нереалистично. Проверьте значение.');
            }
            if (productivityGain > 50) {
                warnings.push('Повышение производительности более 50% требует обоснования.');
            }
            if (discountRate > 50) {
                warnings.push('Ставка дисконтирования более 50% выглядит необычно высоко. Проверьте значение.');
            }
            if (discountRate < 1) {
                warnings.push('Ставка дисконтирования менее 1% выглядит необычно низко. Проверьте значение.');
            }
            if (employeeCount > 100000) {
                warnings.push('Количество сотрудников более 100,000 выглядит необычно. Проверьте значение.');
            }
            if (evaluationPeriod > 10) {
                warnings.push('Период оценки более 10 лет может дать неточные результаты из-за неопределенности будущего.');
            }
            if (changeBudget > projectBudget && projectBudget > 0) {
                warnings.push('Стоимость управления изменениями превышает бюджет проекта. Проверьте значения.');
            }

            // Проверка на минимальные значения для расчета
            if (turnoverSavings === 0 && productivityGain === 0) {
                warnings.push('Не указаны выгоды (экономия на увольнениях или повышение производительности). ROI может быть отрицательным.');
            }
            if (employeeCount === 0 && productivityGain > 0) {
                warnings.push('Количество сотрудников равно нулю, но указано повышение производительности. Выгоды от производительности не будут рассчитаны.');
            }
            if (avgSalary === 0 && productivityGain > 0 && employeeCount > 0) {
                warnings.push('Средняя зарплата не указана, но указано повышение производительности. Выгоды от производительности не будут рассчитаны.');
            }

            return {
                isValid: errors.length === 0,
                errors: errors,
                warnings: warnings
            };
        }

        // Расчет IRR (Internal Rate of Return)
        function calculateIRR(cashFlows, initialInvestment) {
            // IRR - это ставка дисконтирования, при которой NPV = 0
            // Используем метод Ньютона-Рафсона для поиска корня
            
            if (cashFlows.length === 0 || initialInvestment <= 0) {
                return null;
            }
            
            let irr = 0.1; // Начальное предположение 10%
            const maxIterations = 100;
            const tolerance = 0.0001;
            
            for (let i = 0; i < maxIterations; i++) {
                let npv = -initialInvestment;
                let npvDerivative = 0;
                
                cashFlows.forEach((cf, index) => {
                    const year = index + 1;
                    const discountFactor = Math.pow(1 + irr, year);
                    npv += cf / discountFactor;
                    npvDerivative -= (year * cf) / (discountFactor * (1 + irr));
                });
                
                if (Math.abs(npv) < tolerance) {
                    break;
                }
                
                if (Math.abs(npvDerivative) < 0.0001) {
                    // Избегаем деления на ноль
                    break;
                }
                
                const newIrr = irr - npv / npvDerivative;
                
                // Ограничиваем IRR разумными пределами (-50% до 200%)
                if (newIrr < -0.5 || newIrr > 2.0) {
                    break;
                }
                
                if (Math.abs(newIrr - irr) < tolerance) {
                    irr = newIrr;
                    break;
                }
                
                irr = newIrr;
            }
            
            return irr * 100; // Возвращаем в процентах
        }

        // Расчет сценария "Без УИ"
        function calculateWithoutUI(inputs) {
            // Без управления изменениями теряется 30-40% бюджета проекта
            // Используем среднее значение 35% для консервативной оценки
            const lossRate = 0.35;
            const projectBudget = inputs.projectBudget || 0;
            
            // Потери без УИ
            const lossesWithoutUI = projectBudget > 0 ? projectBudget * lossRate : 0;
            
            // Выгоды без УИ (только базовые, без улучшений)
            const basicBenefits = 0; // Без УИ нет дополнительных выгод
            
            // Денежные потоки без УИ
            const cashFlowsWithoutUI = [];
            let cumulativeWithoutUI = 0;
            
            // Год 0: нет инвестиций в УИ, но есть потери
            cashFlowsWithoutUI.push({
                year: 0,
                cashFlow: -lossesWithoutUI,
                cumulative: -lossesWithoutUI,
                discounted: -lossesWithoutUI
            });
            cumulativeWithoutUI = -lossesWithoutUI;
            
            // Годы 1-N: минимальные выгоды (только базовые)
            for (let year = 1; year <= inputs.evaluationPeriod; year++) {
                const cashFlow = 0; // Без УИ нет дополнительных выгод
                cumulativeWithoutUI += cashFlow;
                
                const discountFactor = Math.pow(1 + inputs.discountRate / 100, year);
                const discountedCashFlow = cashFlow / discountFactor;
                
                cashFlowsWithoutUI.push({
                    year: year,
                    cashFlow: cashFlow,
                    cumulative: cumulativeWithoutUI,
                    discounted: discountedCashFlow
                });
            }
            
            return {
                lossesWithoutUI,
                basicBenefits,
                cashFlowsWithoutUI,
                totalLoss: lossesWithoutUI
            };
        }

        function calculateROI() {
            // Получаем значения из формы
            const projectBudget = parseFloat(document.getElementById('projectBudget').value) || 0;
            const changeBudget = parseFloat(document.getElementById('changeBudget').value) || 0;
            const turnoverSavings = parseFloat(document.getElementById('turnoverSavings').value) || 0;
            const productivityGain = parseFloat(document.getElementById('productivityGain').value) || 0;
            const avgSalary = parseFloat(document.getElementById('avgSalary').value) || 0;
            const employeeCount = parseInt(document.getElementById('employeeCount').value) || 0;
            const evaluationPeriod = parseInt(document.getElementById('evaluationPeriod').value) || 3;
            const discountRate = parseFloat(document.getElementById('discountRate').value) || 10;

            // Входные данные
            const inputs = {
                projectBudget,
                changeBudget,
                turnoverSavings,
                productivityGain,
                avgSalary,
                employeeCount,
                evaluationPeriod,
                discountRate
            };

            // Расчет выгод
            // Экономия на текучести за весь период
            const retentionBenefits = turnoverSavings * evaluationPeriod;
            
            // Выгоды от повышения производительности за весь период
            // Производительность в год: (avgSalary * employeeCount * productivityGain / 100)
            const annualProductivityBenefit = (avgSalary * employeeCount * productivityGain / 100);
            const productivityBenefits = annualProductivityBenefit * evaluationPeriod;
            
            // Общие выгоды за весь период
            const totalBenefits = retentionBenefits + productivityBenefits;
            
            // Годовая выгода (для расчета денежных потоков)
            const annualBenefit = totalBenefits / evaluationPeriod;

            // Затраты
            const totalCosts = changeBudget;

            // Расчет денежных потоков по годам
            const cashFlows = [];
            let cumulativeCashFlow = 0;
            
            // Год 0: инвестиции (отрицательный поток)
            cashFlows.push({
                year: 0,
                cashFlow: -changeBudget,
                cumulative: -changeBudget,
                discounted: -changeBudget
            });
            cumulativeCashFlow = -changeBudget;
            
            // Годы 1-N: положительные потоки (выгоды)
            let npv = -changeBudget; // Начальное значение NPV (год 0)
            
            for (let year = 1; year <= evaluationPeriod; year++) {
                const cashFlow = annualBenefit;
                cumulativeCashFlow += cashFlow;
                
                // Дисконтированный денежный поток: CF / (1 + r)^t
                const discountFactor = Math.pow(1 + discountRate / 100, year);
                const discountedCashFlow = cashFlow / discountFactor;
                npv += discountedCashFlow;
                
                cashFlows.push({
                    year: year,
                    cashFlow: cashFlow,
                    cumulative: cumulativeCashFlow,
                    discounted: discountedCashFlow
                });
            }

            // Расчет ROI: ((Total Benefits - Total Costs) / Total Costs) × 100
            const roi = totalCosts > 0 ? ((totalBenefits - totalCosts) / totalCosts) * 100 : 0;

            // Расчет срока окупаемости (Payback Period)
            // Находим год, когда cumulative cash flow становится положительным
            let paybackPeriod = null;
            for (let i = 0; i < cashFlows.length; i++) {
                if (cashFlows[i].cumulative >= 0) {
                    if (i === 0) {
                        paybackPeriod = 0;
                    } else {
                        // Линейная интерполяция между годами
                        const prevCumulative = cashFlows[i - 1].cumulative;
                        const currentCumulative = cashFlows[i].cumulative;
                        const yearDiff = cashFlows[i].year - cashFlows[i - 1].year;
                        const cumulativeDiff = currentCumulative - prevCumulative;
                        
                        if (cumulativeDiff > 0) {
                            const fraction = Math.abs(prevCumulative) / cumulativeDiff;
                            paybackPeriod = cashFlows[i - 1].year + (fraction * yearDiff);
                        } else {
                            paybackPeriod = cashFlows[i].year;
                        }
                    }
                    break;
                }
            }
            
            // Если окупаемость не достигнута за период оценки
            if (paybackPeriod === null) {
                paybackPeriod = evaluationPeriod + 1; // Больше периода оценки
            }

            // Расчет IRR
            const annualCashFlows = cashFlows.filter(cf => cf.year > 0).map(cf => cf.cashFlow);
            const irr = calculateIRR(annualCashFlows, changeBudget);

            // Расчет сценария "Без УИ"
            const scenarioWithoutUI = calculateWithoutUI(inputs);

            // Расчеты для отображения
            const calculations = {
                retentionBenefits,
                productivityBenefits,
                annualProductivityBenefit,
                totalBenefits,
                totalCosts,
                annualBenefit,
                roi: Math.round(roi * 100) / 100, // Округление до 2 знаков
                npv: Math.round(npv),
                irr: irr !== null ? Math.round(irr * 100) / 100 : null,
                paybackPeriod: paybackPeriod !== null ? Math.round(paybackPeriod * 100) / 100 : null,
                cashFlows,
                scenarioWithoutUI
            };

            // Детализация для отображения
            const breakdown = {
                investments: {
                    changeBudget: changeBudget
                },
                benefits: {
                    retentionBenefits: retentionBenefits,
                    productivityBenefits: productivityBenefits,
                    totalBenefits: totalBenefits
                },
                metrics: {
                    roi: calculations.roi,
                    npv: calculations.npv,
                    paybackPeriod: calculations.paybackPeriod
                }
            };

            return {
                inputs,
                calculations,
                breakdown
            };
        }

        // ========== ЭКСПЕРТНЫЕ ФУНКЦИИ ДЛЯ ROI ==========
        
        // Анализ финансовых результатов
        function analyzeFinancialResults(calc, inputs) {
            const industryROI = 120; // Средний ROI в отрасли
            const typicalDiscountRate = 8; // Типичная ставка дисконтирования
            const typicalPayback = 2.5; // Типичный срок окупаемости (лет)
            
            // ROI интерпретация
            let roiInterpretation = '';
            let roiContext = '';
            let roiBenchmark = '';
            
            if (calc.roi > industryROI * 1.5) {
                roiInterpretation = `Ваш ROI ${calc.roi.toFixed(1)}% значительно превышает отраслевой стандарт. Это указывает на высокую эффективность инвестиций в управление изменениями и сильную финансовую обоснованность проекта.`;
                roiContext = 'Такой высокий ROI обычно достигается при правильной оценке всех выгод (снижение текучести, повышение продуктивности) и эффективном управлении затратами.';
                roiBenchmark = `Ваш результат в ${(calc.roi / industryROI).toFixed(1)} раза выше среднего по отрасли (${industryROI}%). Это исключительный результат, который демонстрирует высокую ценность управления изменениями для вашей организации.`;
            } else if (calc.roi > industryROI) {
                roiInterpretation = `Ваш ROI ${calc.roi.toFixed(1)}% выше отраслевого среднего, что указывает на хорошую финансовую эффективность инвестиций в управление изменениями.`;
                roiContext = 'Этот результат показывает, что проект имеет сильную финансовую обоснованность и должен быть приоритетным для организации.';
                roiBenchmark = `Ваш результат на ${(calc.roi - industryROI).toFixed(1)} процентных пунктов выше среднего по отрасли (${industryROI}%). Это хороший показатель эффективности.`;
            } else if (calc.roi > industryROI * 0.7) {
                roiInterpretation = `Ваш ROI ${calc.roi.toFixed(1)}% близок к отраслевому среднему. Проект имеет положительную финансовую отдачу, но есть возможности для оптимизации.`;
                roiContext = 'Такой ROI указывает на необходимость пересмотра некоторых параметров (возможно, недооценка выгод или переоценка затрат) для улучшения результата.';
                roiBenchmark = `Ваш результат на ${(industryROI - calc.roi).toFixed(1)} процентных пунктов ниже среднего по отрасли (${industryROI}%). Рекомендуется провести дополнительный анализ для улучшения показателей.`;
            } else {
                roiInterpretation = `Ваш ROI ${calc.roi.toFixed(1)}% ниже отраслевого среднего. Необходимо пересмотреть параметры проекта или подход к управлению изменениями.`;
                roiContext = 'Низкий ROI может указывать на недооценку выгод, переоценку затрат, или необходимость более эффективного подхода к управлению изменениями.';
                roiBenchmark = `Ваш результат значительно ниже среднего по отрасли (${industryROI}%). Рекомендуется консультация с экспертами по управлению изменениями для оптимизации проекта.`;
            }
            
            // NPV интерпретация
            let npvInterpretation = '';
            let npvSensitivity = '';
            let npvRecommendation = '';
            
            if (calc.npv > 0) {
                npvInterpretation = `Положительный NPV ${formatCurrency(calc.npv)} означает, что проект создает стоимость для организации с учетом временной стоимости денег. Это сильный индикатор финансовой привлекательности проекта.`;
                npvSensitivity = `При изменении ставки дисконтирования на ±1% NPV изменится примерно на ${formatCurrency(Math.abs(calc.npv * 0.1))}. Это умеренная чувствительность, что указывает на устойчивость проекта к изменениям в стоимости капитала.`;
                npvRecommendation = `Положительный NPV подтверждает финансовую обоснованность проекта. Рекомендуется приступить к реализации с учетом всех рисков и возможностей оптимизации.`;
            } else {
                npvInterpretation = `Отрицательный NPV ${formatCurrency(calc.npv)} указывает, что проект не создает достаточной стоимости с учетом временной стоимости денег при текущих параметрах.`;
                npvSensitivity = `Необходимо пересмотреть параметры проекта: увеличить ожидаемые выгоды, снизить затраты, или продлить период оценки для учета долгосрочных выгод.`;
                npvRecommendation = `Рекомендуется провести дополнительный анализ и оптимизацию проекта. Возможно, некоторые выгоды недооценены (например, долгосрочное влияние на культуру, репутацию, инновационность).`;
            }
            
            // IRR интерпретация
            let irrInterpretation = '';
            let irrRecommendation = '';
            let irrComparison = '';
            
            if (calc.irr !== null && !isNaN(calc.irr) && isFinite(calc.irr)) {
                if (calc.irr > inputs.discountRate * 1.5) {
                    irrInterpretation = `IRR ${calc.irr.toFixed(1)}% значительно превышает ставку дисконтирования (${inputs.discountRate}%), что указывает на высокую внутреннюю доходность проекта.`;
                    irrRecommendation = `Проект имеет исключительную доходность. Рекомендуется приоритизировать его реализацию и рассмотреть возможность увеличения масштаба инвестиций.`;
                    irrComparison = `IRR вашего проекта (${calc.irr.toFixed(1)}%) значительно выше типичной доходности корпоративных проектов (8-12%), что делает его очень привлекательным с точки зрения альтернативных инвестиций.`;
                } else if (calc.irr > inputs.discountRate) {
                    irrInterpretation = `IRR ${calc.irr.toFixed(1)}% превышает ставку дисконтирования (${inputs.discountRate}%), что подтверждает финансовую привлекательность проекта.`;
                    irrRecommendation = `Проект имеет положительную доходность. Рекомендуется реализация с мониторингом ключевых параметров для обеспечения достижения целевых показателей.`;
                    irrComparison = `IRR вашего проекта (${calc.irr.toFixed(1)}%) находится в диапазоне типичной доходности корпоративных проектов, что подтверждает его финансовую обоснованность.`;
                } else {
                    irrInterpretation = `IRR ${calc.irr.toFixed(1)}% ниже или близок к ставке дисконтирования (${inputs.discountRate}%), что указывает на необходимость оптимизации проекта.`;
                    irrRecommendation = `Рекомендуется пересмотреть параметры проекта для улучшения доходности. Возможно, стоит рассмотреть альтернативные подходы к управлению изменениями или увеличить ожидаемые выгоды.`;
                    irrComparison = `IRR вашего проекта (${calc.irr.toFixed(1)}%) ниже типичной доходности корпоративных проектов. Необходим дополнительный анализ для улучшения показателей.`;
                }
            }
            
            // Payback интерпретация
            let paybackInterpretation = '';
            let paybackRecommendation = '';
            
            if (calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod) {
                if (calc.paybackPeriod <= typicalPayback) {
                    paybackInterpretation = `Срок окупаемости ${calc.paybackPeriod.toFixed(2)} лет быстрее типичного для проектов управления изменениями, что указывает на быструю отдачу от инвестиций.`;
                    paybackRecommendation = `Быстрая окупаемость снижает финансовые риски проекта. Рекомендуется приоритизировать реализацию и рассмотреть возможность реинвестирования полученных выгод.`;
                } else if (calc.paybackPeriod <= inputs.evaluationPeriod * 0.6) {
                    paybackInterpretation = `Срок окупаемости ${calc.paybackPeriod.toFixed(2)} лет находится в приемлемом диапазоне и обеспечивает возврат инвестиций в течение периода оценки.`;
                    paybackRecommendation = `Окупаемость в пределах периода оценки подтверждает финансовую обоснованность проекта. Рекомендуется реализация с фокусом на достижение целевых показателей.`;
                } else {
                    paybackInterpretation = `Срок окупаемости ${calc.paybackPeriod.toFixed(2)} лет близок к концу периода оценки, что требует внимательного мониторинга для обеспечения окупаемости.`;
                    paybackRecommendation = `Рекомендуется оптимизировать проект для ускорения окупаемости или продлить период оценки для учета долгосрочных выгод.`;
                }
            } else {
                paybackInterpretation = `Срок окупаемости превышает период оценки (${inputs.evaluationPeriod} лет), что указывает на долгосрочный характер выгод от управления изменениями.`;
                paybackRecommendation = `Хотя окупаемость выходит за рамки периода оценки, это типично для проектов управления изменениями, где значительная часть выгод реализуется в долгосрочной перспективе (улучшение культуры, снижение текучести, повышение инновационности). Рекомендуется расширить период оценки или пересмотреть параметры для учета всех выгод.`;
            }
            
            return {
                roiInterpretation,
                roiContext,
                roiBenchmark,
                npvInterpretation,
                npvSensitivity,
                npvRecommendation,
                irrInterpretation,
                irrRecommendation,
                irrComparison,
                paybackInterpretation,
                paybackRecommendation
            };
        }
        
        // Генерация анализа рисков
        function generateRiskAnalysis(calc, inputs) {
            const optimisticROI = calc.roi * 1.2;
            const pessimisticROI = calc.roi * 0.8;
            
            let optimistic = '';
            let realistic = '';
            let pessimistic = '';
            const mitigation = [];
            
            // Оптимистичный сценарий
            if (optimisticROI > 180) {
                optimistic = `При оптимистичном сценарии ROI достигает ${optimisticROI.toFixed(1)}%, что указывает на исключительную эффективность. Такой результат возможен при успешной реализации всех запланированных мероприятий и достижении целевых показателей по снижению текучести и повышению продуктивности.`;
            } else if (optimisticROI > 120) {
                optimistic = `При оптимистичном сценарии ROI составляет ${optimisticROI.toFixed(1)}%, что значительно выше отраслевого среднего. Это возможно при эффективной реализации проекта и достижении всех целевых показателей.`;
            } else {
                optimistic = `При оптимистичном сценарии ROI достигает ${optimisticROI.toFixed(1)}%, что близко к отраслевому среднему. Это указывает на потенциал для улучшения результатов при правильной реализации.`;
            }
            
            // Реалистичный сценарий
            if (calc.roi > 120) {
                realistic = `Реалистичный сценарий основан на текущих оценках и показывает ROI ${calc.roi.toFixed(1)}%. Этот результат достижим при стандартной реализации проекта управления изменениями с учетом типичных рисков и возможностей.`;
            } else {
                realistic = `Реалистичный сценарий показывает ROI ${calc.roi.toFixed(1)}%. Для улучшения результата рекомендуется пересмотреть параметры проекта, увеличить ожидаемые выгоды или оптимизировать затраты.`;
            }
            
            // Пессимистичный сценарий
            if (pessimisticROI > 0) {
                pessimistic = `При пессимистичном сценарии ROI составляет ${pessimisticROI.toFixed(1)}%, что все еще показывает положительную отдачу, но ниже ожидаемой. Это может произойти при задержках в реализации, недостижении целевых показателей или непредвиденных затратах.`;
            } else {
                pessimistic = `При пессимистичном сценарии ROI становится отрицательным (${pessimisticROI.toFixed(1)}%), что указывает на необходимость тщательного планирования и управления рисками для избежания такого исхода.`;
            }
            
            // Рекомендации по снижению рисков
            mitigation.push('Регулярный мониторинг ключевых показателей (текучесть, продуктивность, вовлеченность) для раннего выявления отклонений');
            mitigation.push('Активное управление сопротивлением изменениям через коммуникацию, обучение и вовлечение сотрудников');
            mitigation.push('Фазовый подход к реализации с пилотными проектами для проверки эффективности перед масштабированием');
            mitigation.push('Создание резервов времени и бюджета (10-15%) для покрытия непредвиденных затрат');
            mitigation.push('Регулярные ретроспективы и корректировка планов на основе полученного опыта');
            mitigation.push('Фокус на быстрых победах для поддержания мотивации и демонстрации ценности');
            
            if (calc.paybackPeriod !== null && calc.paybackPeriod > inputs.evaluationPeriod * 0.7) {
                mitigation.push('Особое внимание к ускорению окупаемости через оптимизацию затрат и увеличение краткосрочных выгод');
            }
            
            if (calc.roi < 100) {
                mitigation.push('Пересмотр параметров проекта: возможно, некоторые выгоды недооценены (долгосрочное влияние на культуру, репутацию, инновационность)');
            }
            
            return { optimistic, realistic, pessimistic, mitigation };
        }
        
        function renderROIResults(results) {
            const calc = results.calculations;
            const breakdown = results.breakdown;
            const inputs = results.inputs;
            const showComparison = document.getElementById('showComparison')?.checked || false;

            // Отображаем основные метрики
            document.getElementById('roiValue').textContent = `${calc.roi.toFixed(1)}%`;
            document.getElementById('npvValue').textContent = formatCurrency(calc.npv);
            
            // IRR
            const irrEl = document.getElementById('irrValue');
            if (calc.irr !== null && !isNaN(calc.irr) && isFinite(calc.irr)) {
                irrEl.textContent = `${calc.irr.toFixed(1)}%`;
                // Цветовая индикация IRR
                if (calc.irr > 15) {
                    irrEl.style.color = '#2DB67D';
                } else if (calc.irr > 10) {
                    irrEl.style.color = '#F4A100';
                } else {
                    irrEl.style.color = '#E01E5A';
                }
            } else {
                irrEl.textContent = 'N/A';
                irrEl.style.color = '#666';
            }
            
            // Срок окупаемости
            const paybackEl = document.getElementById('paybackValue');
            if (calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod) {
                paybackEl.textContent = `${calc.paybackPeriod.toFixed(2)} лет`;
            } else {
                paybackEl.textContent = `> ${inputs.evaluationPeriod} лет`;
            }

            // Сравнение сценариев
            const comparisonEl = document.getElementById('roiComparison');
            if (showComparison && calc.scenarioWithoutUI && inputs.projectBudget > 0) {
                comparisonEl.style.display = 'block';
                
                const withoutUI = calc.scenarioWithoutUI;
                const withUI = {
                    totalBenefits: breakdown.benefits.totalBenefits,
                    npv: calc.npv,
                    roi: calc.roi
                };
                
                const difference = {
                    benefits: withUI.totalBenefits - (withoutUI.totalLoss || 0),
                    npv: withUI.npv - (withoutUI.totalLoss || 0),
                    roi: withUI.roi
                };
                
                // Без УИ
                document.getElementById('comparisonWithoutUI').textContent = 
                    formatCurrency(-(withoutUI.totalLoss || 0));
                document.getElementById('comparisonWithoutUIDetail').textContent = 
                    `Потери: ${formatCurrency(withoutUI.totalLoss || 0)}`;
                
                // С УИ
                document.getElementById('comparisonWithUI').textContent = 
                    formatCurrency(withUI.totalBenefits);
                document.getElementById('comparisonWithUIDetail').textContent = 
                    `Выгоды: ${formatCurrency(withUI.totalBenefits)}, NPV: ${formatCurrency(withUI.npv)}`;
                
                // Разница
                document.getElementById('comparisonDifference').textContent = 
                    formatCurrency(difference.benefits);
                document.getElementById('comparisonDifferenceDetail').textContent = 
                    `ROI: ${withUI.roi.toFixed(1)}%, Экономия: ${formatCurrency(difference.benefits)}`;
            } else {
                comparisonEl.style.display = 'none';
            }

            // Детализация расчетов в roiBreakdown
            const breakdownEl = document.getElementById('roiBreakdown');
            breakdownEl.innerHTML = `
                <div class="roi-breakdown-section">
                    <h5>Инвестиции</h5>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Стоимость управления изменениями:</span>
                        <span class="roi-breakdown-value">${formatCurrency(breakdown.investments.changeBudget)}</span>
                    </div>
                </div>

                <div class="roi-breakdown-section">
                    <h5>Выгоды за период (${inputs.evaluationPeriod} ${inputs.evaluationPeriod === 1 ? 'год' : inputs.evaluationPeriod < 5 ? 'года' : 'лет'})</h5>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Экономия на текучести кадров:</span>
                        <span class="roi-breakdown-value">${formatCurrency(breakdown.benefits.retentionBenefits)}</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Выгоды от повышения производительности:</span>
                        <span class="roi-breakdown-value">${formatCurrency(breakdown.benefits.productivityBenefits)}</span>
                    </div>
                    <div class="roi-breakdown-item roi-breakdown-total">
                        <span class="roi-breakdown-label">Общие выгоды:</span>
                        <span class="roi-breakdown-value">${formatCurrency(breakdown.benefits.totalBenefits)}</span>
                    </div>
                </div>

                <div class="roi-breakdown-section">
                    <h5>HR-метрики</h5>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Экономия на текучести (в год):</span>
                        <span class="roi-breakdown-value">${formatCurrency(inputs.turnoverSavings)}</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Повышение производительности:</span>
                        <span class="roi-breakdown-value">${inputs.productivityGain}%</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Выгода от производительности (в год):</span>
                        <span class="roi-breakdown-value">${formatCurrency(calc.annualProductivityBenefit)}</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Количество сотрудников:</span>
                        <span class="roi-breakdown-value">${inputs.employeeCount}</span>
                    </div>
                    ${inputs.employeeCount > 0 ? `
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">ROI на сотрудника:</span>
                        <span class="roi-breakdown-value">${(calc.roi / inputs.employeeCount).toFixed(1)}%</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Выгода на сотрудника (в год):</span>
                        <span class="roi-breakdown-value">${formatCurrency((calc.annualProductivityBenefit + inputs.turnoverSavings) / inputs.employeeCount)}</span>
                    </div>
                    ${inputs.turnoverSavings > 0 && inputs.employeeCount > 0 ? `
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Экономия на найме (при стоимости найма 150,000 ₽):</span>
                        <span class="roi-breakdown-value">${formatCurrency((inputs.turnoverSavings / 150000) * 150000)}</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Снижение текучести (примерно):</span>
                        <span class="roi-breakdown-value">${((inputs.turnoverSavings / (150000 * inputs.employeeCount)) * 100).toFixed(1)}%</span>
                    </div>
                    ` : ''}
                    ` : ''}
                </div>

                <div class="roi-breakdown-section">
                    <h5>Денежные потоки по годам</h5>
                    <div class="roi-cashflows-table">
                        <table>
                            <thead>
                                <tr>
                                    <th>Год</th>
                                    <th>Денежный поток</th>
                                    <th>Накопительный</th>
                                    <th>Дисконтированный</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${calc.cashFlows.map(cf => `
                                    <tr class="${cf.year === 0 ? 'roi-investment-row' : ''} ${cf.cumulative >= 0 && cf.year > 0 ? 'roi-positive-row' : ''}">
                                        <td>${cf.year === 0 ? '0 (инвестиции)' : cf.year}</td>
                                        <td>${formatCurrency(cf.cashFlow)}</td>
                                        <td>${formatCurrency(cf.cumulative)}</td>
                                        <td>${formatCurrency(cf.discounted)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="roi-breakdown-section">
                    <h5>Итоговые показатели</h5>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">ROI (Return on Investment):</span>
                        <span class="roi-breakdown-value">${calc.roi.toFixed(1)}%</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">NPV (Чистая приведенная стоимость):</span>
                        <span class="roi-breakdown-value">${formatCurrency(calc.npv)}</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">IRR (Внутренняя норма доходности):</span>
                        <span class="roi-breakdown-value">${calc.irr !== null && !isNaN(calc.irr) && isFinite(calc.irr) ? calc.irr.toFixed(1) + '%' : 'N/A'}</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Срок окупаемости:</span>
                        <span class="roi-breakdown-value">${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod ? calc.paybackPeriod.toFixed(2) + ' лет' : '> ' + inputs.evaluationPeriod + ' лет'}</span>
                    </div>
                    <div class="roi-breakdown-item">
                        <span class="roi-breakdown-label">Ставка дисконтирования:</span>
                        <span class="roi-breakdown-value">${inputs.discountRate}%</span>
                    </div>
                </div>
            `;

            // ========== ЭКСПЕРТНАЯ ИНТЕРПРЕТАЦИЯ ФИНАНСОВЫХ ПОКАЗАТЕЛЕЙ ==========
            const expertFinancialAnalysis = analyzeFinancialResults(calc, inputs);
            
            // Добавляем экспертную интерпретацию в breakdown
            breakdownEl.innerHTML += `
                <div class="roi-expert-analysis">
                    <h5>Экспертная интерпретация финансовых показателей</h5>
                    
                    <div class="expert-metric-analysis">
                        <div class="metric-analysis-item">
                            <h6>ROI ${calc.roi.toFixed(1)}% — что это значит:</h6>
                            <p>${expertFinancialAnalysis.roiInterpretation}</p>
                            <p><strong>Контекст:</strong> ${expertFinancialAnalysis.roiContext}</p>
                            <p><strong>Сравнение с бенчмарками:</strong> ${expertFinancialAnalysis.roiBenchmark}</p>
                        </div>
                        
                        <div class="metric-analysis-item">
                            <h6>NPV ${formatCurrency(calc.npv)} — анализ:</h6>
                            <p>${expertFinancialAnalysis.npvInterpretation}</p>
                            <p><strong>Чувствительность:</strong> ${expertFinancialAnalysis.npvSensitivity}</p>
                            <p><strong>Рекомендация:</strong> ${expertFinancialAnalysis.npvRecommendation}</p>
                        </div>
                        
                        ${calc.irr !== null && !isNaN(calc.irr) && isFinite(calc.irr) ? `
                        <div class="metric-analysis-item">
                            <h6>IRR ${calc.irr.toFixed(1)}% — оценка доходности:</h6>
                            <p>${expertFinancialAnalysis.irrInterpretation}</p>
                            <p><strong>Рекомендация:</strong> ${expertFinancialAnalysis.irrRecommendation}</p>
                            <p><strong>Сравнение с альтернативными инвестициями:</strong> ${expertFinancialAnalysis.irrComparison}</p>
                        </div>
                        ` : ''}
                        
                        <div class="metric-analysis-item">
                            <h6>Срок окупаемости ${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod ? calc.paybackPeriod.toFixed(2) + ' лет' : '> ' + inputs.evaluationPeriod + ' лет'} — оценка:</h6>
                            <p>${expertFinancialAnalysis.paybackInterpretation}</p>
                            <p><strong>Рекомендация:</strong> ${expertFinancialAnalysis.paybackRecommendation}</p>
                        </div>
                    </div>
                </div>
            `;
            
            // ========== АНАЛИЗ РИСКОВ И СЦЕНАРИЕВ ==========
            const riskAnalysis = generateRiskAnalysis(calc, inputs);
            breakdownEl.innerHTML += `
                <div class="roi-risk-analysis">
                    <h5>Анализ рисков и сценариев</h5>
                    <p class="risk-analysis-intro">Экспертный анализ различных сценариев развития проекта для понимания диапазона возможных результатов.</p>
                    
                    <div class="risk-scenarios">
                        <div class="risk-scenario optimistic">
                            <h6>Оптимистичный сценарий (+20% выгод):</h6>
                            <div class="scenario-metrics">
                                <div class="scenario-metric">
                                    <span class="metric-label">ROI:</span>
                                    <span class="metric-value">${(calc.roi * 1.2).toFixed(1)}%</span>
                                </div>
                                <div class="scenario-metric">
                                    <span class="metric-label">NPV:</span>
                                    <span class="metric-value">${formatCurrency(calc.npv * 1.2)}</span>
                                </div>
                            </div>
                            <p>${riskAnalysis.optimistic}</p>
                        </div>
                        
                        <div class="risk-scenario realistic">
                            <h6>Реалистичный сценарий (текущие данные):</h6>
                            <div class="scenario-metrics">
                                <div class="scenario-metric">
                                    <span class="metric-label">ROI:</span>
                                    <span class="metric-value">${calc.roi.toFixed(1)}%</span>
                                </div>
                                <div class="scenario-metric">
                                    <span class="metric-label">NPV:</span>
                                    <span class="metric-value">${formatCurrency(calc.npv)}</span>
                                </div>
                            </div>
                            <p>${riskAnalysis.realistic}</p>
                        </div>
                        
                        <div class="risk-scenario pessimistic">
                            <h6>Пессимистичный сценарий (-20% выгод):</h6>
                            <div class="scenario-metrics">
                                <div class="scenario-metric">
                                    <span class="metric-label">ROI:</span>
                                    <span class="metric-value">${(calc.roi * 0.8).toFixed(1)}%</span>
                                </div>
                                <div class="scenario-metric">
                                    <span class="metric-label">NPV:</span>
                                    <span class="metric-value">${formatCurrency(calc.npv * 0.8)}</span>
                                </div>
                            </div>
                            <p>${riskAnalysis.pessimistic}</p>
                        </div>
                    </div>
                    
                    <div class="risk-mitigation">
                        <h6>Рекомендации по снижению рисков:</h6>
                        <ul>${riskAnalysis.mitigation.map(m => `<li>${m}</li>`).join('')}</ul>
                    </div>
                </div>
            `;
            
            // Рекомендации с бенчмарками
            const industryBenchmark = 120; // Средний ROI в отрасли
            let recommendationsHTML = '';
            
            if (calc.roi > industryBenchmark * 1.5) {
                recommendationsHTML = `
                    <div class="roi-recommendation excellent">
                        <h5>Отличный результат!</h5>
                        <p>Ваш ROI (${calc.roi.toFixed(1)}%) значительно выше отраслевого среднего (${industryBenchmark}%). Внедрение управления изменениями принесёт значительную отдачу.</p>
                        <ul>
                            <li>Рекомендуем начать с пилотных проектов для демонстрации ценности</li>
                            <li>Документируйте успех для масштабирования на другие проекты</li>
                            ${calc.irr && calc.irr > 15 ? '<li>IRR выше 15% - отличная доходность инвестиций</li>' : ''}
                        </ul>
                    </div>
                `;
            } else if (calc.roi > industryBenchmark) {
                recommendationsHTML = `
                    <div class="roi-recommendation good">
                        <h5>Хорошая инвестиция</h5>
                        <p>Ваш ROI (${calc.roi.toFixed(1)}%) выше отраслевого среднего (${industryBenchmark}%). Управление изменениями окупится через ${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod ? calc.paybackPeriod.toFixed(1) : '1-2'} ${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod && calc.paybackPeriod < 2 ? 'год' : 'года'}.</p>
                        <ul>
                            <li>Фокус на ключевых рисках и вовлечённости персонала</li>
                            <li>Рассмотрите оптимизацию затрат для улучшения ROI</li>
                            ${calc.irr && calc.irr > 10 ? '<li>IRR выше 10% - приемлемая доходность</li>' : ''}
                        </ul>
                    </div>
                `;
            } else if (calc.roi > industryBenchmark * 0.5) {
                recommendationsHTML = `
                    <div class="roi-recommendation moderate">
                        <h5>Умеренная отдача</h5>
                        <p>Ваш ROI (${calc.roi.toFixed(1)}%) ниже отраслевого среднего (${industryBenchmark}%), но положительный. Требуется оптимизация подходов.</p>
                        <ul>
                            <li>Начните с базовых практик и постепенно расширяйте</li>
                            <li>Пересмотрите ожидаемые выгоды - возможно, они занижены</li>
                            <li>Рассмотрите снижение затрат на управление изменениями</li>
                        </ul>
                    </div>
                `;
            } else if (calc.roi > 0) {
                recommendationsHTML = `
                    <div class="roi-recommendation moderate">
                        <h5>Низкая отдача</h5>
                        <p>ROI положительный (${calc.roi.toFixed(1)}%), но значительно ниже отраслевого среднего (${industryBenchmark}%).</p>
                        <ul>
                            <li>Рассмотрите оптимизацию затрат на управление изменениями</li>
                            <li>Пересмотрите ожидаемые выгоды - возможно, они занижены</li>
                            <li>Начните с минимального набора практик для снижения затрат</li>
                        </ul>
                    </div>
                `;
            } else {
                recommendationsHTML = `
                    <div class="roi-recommendation poor">
                        <h5>Требует анализа</h5>
                        <p>ROI отрицательный или нулевой. Проверьте исходные данные и рассмотрите альтернативные подходы.</p>
                        <ul>
                            <li>Проверьте корректность входных данных</li>
                            <li>Рассмотрите более эффективные методы управления изменениями</li>
                            <li>Пересмотрите параметры проекта - возможно, требуется оптимизация</li>
                        </ul>
                    </div>
                `;
            }

            // Добавляем рекомендации в breakdown, если есть элемент
            const recommendationsEl = document.getElementById('roiRecommendations');
            if (recommendationsEl) {
                recommendationsEl.innerHTML = recommendationsHTML;
            } else {
                // Добавляем рекомендации в breakdown
                breakdownEl.innerHTML += `
                    <div class="roi-breakdown-section">
                        <h5>Рекомендации</h5>
                        ${recommendationsHTML}
                    </div>
                `;
            }

            // Создаём диаграмму
            renderROIChart(results);

            // Инициализируем анализ чувствительности
            initSensitivityAnalysis(results);

            // Показываем результаты
            document.getElementById('roiResults').style.display = 'block';
            document.getElementById('roiResults').scrollIntoView({ behavior: 'smooth' });
        }

        function renderROIChart(results) {
            const ctx = document.getElementById('roiChart').getContext('2d');
            const calc = results.calculations;
            const inputs = results.inputs;
            const showComparison = document.getElementById('showComparison')?.checked || false;

            // Подготовка данных для графика денежных потоков по годам
            const labels = calc.cashFlows.map(cf => cf.year === 0 ? 'Год 0' : `Год ${cf.year}`);
            const cashFlowData = calc.cashFlows.map(cf => cf.cashFlow);
            const cumulativeData = calc.cashFlows.map(cf => cf.cumulative);

            // Данные для сравнения сценариев (если включено)
            let comparisonData = null;
            if (showComparison && calc.scenarioWithoutUI && inputs.projectBudget > 0) {
                const withoutUIData = calc.scenarioWithoutUI.cashFlowsWithoutUI.map(cf => cf.cashFlow);
                comparisonData = {
                    labels: labels,
                    data: withoutUIData
                };
            }

            // Данные для диаграммы
            const datasets = [
                {
                    label: 'Денежный поток',
                    data: cashFlowData,
                    type: 'bar',
                    backgroundColor: cashFlowData.map((val, idx) => 
                        idx === 0 ? 'rgba(224, 30, 90, 0.8)' : 'rgba(45, 182, 125, 0.8)'
                    ),
                    borderColor: cashFlowData.map((val, idx) => 
                        idx === 0 ? '#E01E5A' : '#2DB67D'
                    ),
                    borderWidth: 2,
                    order: 3
                },
                {
                    label: 'Накопительный поток',
                    data: cumulativeData,
                    type: 'line',
                    borderColor: 'rgba(33, 128, 141, 1)',
                    backgroundColor: 'rgba(33, 128, 141, 0.1)',
                    borderWidth: 3,
                    fill: false,
                    tension: 0.4,
                    pointRadius: 5,
                    pointBackgroundColor: 'rgba(33, 128, 141, 1)',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    order: 1
                }
            ];

            // Добавляем данные для сравнения, если включено
            if (comparisonData) {
                datasets.push({
                    label: 'Без УИ',
                    data: comparisonData.data,
                    type: 'bar',
                    backgroundColor: 'rgba(128, 128, 128, 0.5)',
                    borderColor: '#808080',
                    borderWidth: 2,
                    order: 2
                });
            }

            const data = {
                labels: labels,
                datasets: datasets
            };

            const config = {
                type: 'bar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.dataset.label || '';
                                    const value = formatCurrency(context.parsed.y);
                                    return `${label}: ${value}`;
                                }
                            }
                        },
                        title: {
                            display: true,
                            text: 'Денежные потоки по годам',
                            font: {
                                size: 16,
                                weight: 'bold'
                            },
                            padding: {
                                top: 10,
                                bottom: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value, true);
                                },
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                color: 'rgba(0, 0, 0, 0.05)'
                            }
                        },
                        x: {
                            ticks: {
                                font: {
                                    size: 11
                                }
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            };

            // Уничтожаем предыдущий график если существует
            if (window.roiChartInstance) {
                window.roiChartInstance.destroy();
            }

            window.roiChartInstance = new Chart(ctx, config);
        }

        function toggleSensitivity() {
            const contentEl = document.getElementById('roiSensitivityContent');
            const toggleBtn = document.querySelector('.roi-sensitivity-toggle');
            
            if (contentEl && toggleBtn) {
                if (contentEl.style.display === 'none') {
                    contentEl.style.display = 'block';
                    toggleBtn.textContent = '▼ Свернуть';
                } else {
                    contentEl.style.display = 'none';
                    toggleBtn.textContent = '▶ Развернуть';
                }
            }
        }

        function initSensitivityAnalysis(results) {
            const sensitivityEl = document.getElementById('roiSensitivity');
            if (sensitivityEl) {
                sensitivityEl.style.display = 'block';
                updateSensitivity('cost', 100);
            }
        }

        function updateSensitivity(param, value) {
            const results = calculateROI();
            const calc = results.calculations;
            const inputs = results.inputs;
            
            // Обновляем значение слайдера
            const valueEl = document.getElementById(`sensitivity${param.charAt(0).toUpperCase() + param.slice(1)}Value`);
            if (valueEl) {
                valueEl.textContent = `${value}%`;
            }
            
            // Получаем множители для всех параметров
            const costMultiplier = param === 'cost' ? value / 100 : parseFloat(document.getElementById('sensitivityCost')?.value || 100) / 100;
            const productivityMultiplier = param === 'productivity' ? value / 100 : parseFloat(document.getElementById('sensitivityProductivity')?.value || 100) / 100;
            const turnoverMultiplier = param === 'turnover' ? value / 100 : parseFloat(document.getElementById('sensitivityTurnover')?.value || 100) / 100;
            
            // Пересчитываем с учетом множителей
            const adjustedChangeBudget = inputs.changeBudget * costMultiplier;
            const adjustedProductivityGain = inputs.productivityGain * productivityMultiplier;
            const adjustedTurnoverSavings = inputs.turnoverSavings * turnoverMultiplier;
            
            // Пересчитываем выгоды
            const adjustedRetentionBenefits = adjustedTurnoverSavings * inputs.evaluationPeriod;
            const adjustedAnnualProductivityBenefit = (inputs.avgSalary * inputs.employeeCount * adjustedProductivityGain / 100);
            const adjustedProductivityBenefits = adjustedAnnualProductivityBenefit * inputs.evaluationPeriod;
            const adjustedTotalBenefits = adjustedRetentionBenefits + adjustedProductivityBenefits;
            
            // Пересчитываем ROI и NPV
            const adjustedROI = adjustedChangeBudget > 0 ? ((adjustedTotalBenefits - adjustedChangeBudget) / adjustedChangeBudget) * 100 : 0;
            
            // Упрощенный расчет NPV (только для демонстрации)
            let adjustedNPV = -adjustedChangeBudget;
            const adjustedAnnualBenefit = adjustedTotalBenefits / inputs.evaluationPeriod;
            for (let year = 1; year <= inputs.evaluationPeriod; year++) {
                const discountFactor = Math.pow(1 + inputs.discountRate / 100, year);
                adjustedNPV += adjustedAnnualBenefit / discountFactor;
            }
            
            // Отображаем результаты
            const resultsEl = document.getElementById('roiSensitivityResults');
            if (resultsEl) {
                resultsEl.innerHTML = `
                    <div class="sensitivity-results-grid">
                        <div class="sensitivity-result-item">
                            <div class="sensitivity-result-label">ROI</div>
                            <div class="sensitivity-result-value ${adjustedROI > calc.roi ? 'positive' : adjustedROI < calc.roi ? 'negative' : ''}">
                                ${adjustedROI.toFixed(1)}%
                                ${adjustedROI !== calc.roi ? `<span class="sensitivity-delta">(${adjustedROI > calc.roi ? '+' : ''}${(adjustedROI - calc.roi).toFixed(1)}%)</span>` : ''}
                            </div>
                        </div>
                        <div class="sensitivity-result-item">
                            <div class="sensitivity-result-label">NPV</div>
                            <div class="sensitivity-result-value ${adjustedNPV > calc.npv ? 'positive' : adjustedNPV < calc.npv ? 'negative' : ''}">
                                ${formatCurrency(Math.round(adjustedNPV))}
                                ${adjustedNPV !== calc.npv ? `<span class="sensitivity-delta">(${adjustedNPV > calc.npv ? '+' : ''}${formatCurrency(Math.round(adjustedNPV - calc.npv))})</span>` : ''}
                            </div>
                        </div>
                        <div class="sensitivity-result-item">
                            <div class="sensitivity-result-label">Базовые значения</div>
                            <div class="sensitivity-result-value">
                                ROI: ${calc.roi.toFixed(1)}%, NPV: ${formatCurrency(calc.npv)}
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function exportROIToPDF() {
            const results = calculateROI();
            const calc = results.calculations;
            const breakdown = results.breakdown;
            const inputs = results.inputs;

            // Определяем класс рекомендации
            let recommendationClass = 'poor';
            let recommendationHTML = '';
            if (calc.roi > 200) {
                recommendationClass = 'excellent';
                recommendationHTML = '<h3>Отличный результат!</h3><p>Внедрение управления изменениями принесёт значительную отдачу. Рекомендуем начать с пилотных проектов для демонстрации ценности.</p>';
            } else if (calc.roi > 100) {
                recommendationClass = 'good';
                recommendationHTML = `<h3>Хорошая инвестиция</h3><p>Управление изменениями окупится через ${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod ? calc.paybackPeriod.toFixed(1) : '1-2'} ${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod && calc.paybackPeriod < 2 ? 'год' : 'года'}. Фокус на ключевых рисках и вовлечённости персонала.</p>`;
            } else if (calc.roi > 50) {
                recommendationClass = 'moderate';
                recommendationHTML = '<h3>Умеренная отдача</h3><p>ROI положительный, но требует оптимизации подходов. Начните с базовых практик и постепенно расширяйте.</p>';
            } else if (calc.roi > 0) {
                recommendationClass = 'moderate';
                recommendationHTML = '<h3>Низкая отдача</h3><p>ROI положительный, но невысокий. Рассмотрите оптимизацию затрат на управление изменениями или пересмотрите ожидаемые выгоды.</p>';
            } else {
                recommendationHTML = '<h3>Требует анализа</h3><p>Проверьте исходные данные и рассмотрите альтернативные подходы. Возможно, нужны более эффективные методы или пересмотр параметров проекта.</p>';
            }

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>ROI Отчёт - ${new Date().toLocaleDateString('ru-RU')}</title>
                    <style>
                        @media print {
                            body { margin: 0; padding: 20px; }
                            .no-print { display: none !important; }
                            .page-break { page-break-after: always; }
                        }
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                            color: #333;
                        }
                        h1 { color: #2DB67D; border-bottom: 3px solid #2DB67D; padding-bottom: 10px; margin-bottom: 20px; }
                        h2 { color: #333; margin-top: 30px; margin-bottom: 15px; font-size: 1.5em; }
                        h3 { color: #333; margin-top: 20px; margin-bottom: 10px; font-size: 1.2em; }
                        h4 { color: #666; margin-top: 15px; margin-bottom: 10px; font-size: 1.1em; }
                        h5 { color: #666; margin-top: 12px; margin-bottom: 8px; font-size: 1em; font-weight: 600; }
                        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
                        .metrics { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 20px 0; }
                        .metric { text-align: center; padding: 20px; background: #f9f9f9; border-radius: 8px; }
                        .metric-value { font-size: 24px; font-weight: bold; color: #2DB67D; }
                        .metric-label { color: #666; font-size: 14px; margin-top: 5px; }
                        .breakdown { margin: 20px 0; }
                        .breakdown-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #eee; }
                        .breakdown-label { font-weight: 500; }
                        .breakdown-value { font-weight: bold; color: #2DB67D; }
                        .recommendation { padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .excellent { background: rgba(45, 182, 125, 0.1); border: 2px solid #2DB67D; }
                        .good { background: rgba(244, 161, 0, 0.1); border: 2px solid #F4A100; }
                        .moderate { background: rgba(255, 193, 7, 0.1); border: 2px solid #FFC107; }
                        .poor { background: rgba(224, 30, 90, 0.1); border: 2px solid #E01E5A; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; font-size: 12px; }
                        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
                        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
                        th { background-color: #f5f5f5; font-weight: 600; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .cashflow-negative { color: #E01E5A; }
                        .cashflow-positive { color: #2DB67D; }
                    </style>
                </head>
                <body>
                    <h1>Отчёт ROI управления изменениями</h1>
                    <p><strong>Дата расчёта:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>

                    <div class="section">
                        <h2>Ключевые метрики</h2>
                        <div class="metrics">
                            <div class="metric">
                                <div class="metric-value">${calc.roi.toFixed(1)}%</div>
                                <div class="metric-label">ROI проекта</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${formatCurrency(calc.npv)}</div>
                                <div class="metric-label">NPV (Чистая приведенная стоимость)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${calc.irr !== null && !isNaN(calc.irr) && isFinite(calc.irr) ? calc.irr.toFixed(1) + '%' : 'N/A'}</div>
                                <div class="metric-label">IRR (Внутренняя норма доходности)</div>
                            </div>
                            <div class="metric">
                                <div class="metric-value">${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod ? calc.paybackPeriod.toFixed(2) + ' лет' : '> ' + inputs.evaluationPeriod + ' лет'}</div>
                                <div class="metric-label">Срок окупаемости</div>
                            </div>
                        </div>
                    </div>

                    ${calc.scenarioWithoutUI && inputs.projectBudget > 0 ? `
                    <div class="section">
                        <h2>Сравнение сценариев</h2>
                        <div class="breakdown">
                            <div class="breakdown-item">
                                <span class="breakdown-label">Без управления изменениями:</span>
                                <span class="breakdown-value" style="color: #E01E5A;">${formatCurrency(-(calc.scenarioWithoutUI.totalLoss || 0))}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">С управлением изменениями:</span>
                                <span class="breakdown-value" style="color: #2DB67D;">${formatCurrency(breakdown.benefits.totalBenefits)}</span>
                            </div>
                            <div class="breakdown-item" style="border-top: 2px solid #2DB67D; margin-top: 10px; padding-top: 15px;">
                                <span class="breakdown-label" style="font-weight: bold; font-size: 1.1em;">Выгода от УИ:</span>
                                <span class="breakdown-value" style="font-size: 1.2em; color: #2DB67D;">${formatCurrency(breakdown.benefits.totalBenefits - (calc.scenarioWithoutUI.totalLoss || 0))}</span>
                            </div>
                        </div>
                    </div>
                    ` : ''}

                    <div class="section">
                        <h2>Входные данные</h2>
                        <div class="breakdown">
                            <div class="breakdown-item">
                                <span class="breakdown-label">Бюджет проекта:</span>
                                <span class="breakdown-value">${formatCurrency(inputs.projectBudget)}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Стоимость управления изменениями:</span>
                                <span class="breakdown-value">${formatCurrency(inputs.changeBudget)}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Экономия на увольнениях (в год):</span>
                                <span class="breakdown-value">${formatCurrency(inputs.turnoverSavings)}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Повышение производительности:</span>
                                <span class="breakdown-value">${inputs.productivityGain}%</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Средняя зарплата сотрудника:</span>
                                <span class="breakdown-value">${formatCurrency(inputs.avgSalary)}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Количество сотрудников:</span>
                                <span class="breakdown-value">${inputs.employeeCount}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Период оценки:</span>
                                <span class="breakdown-value">${inputs.evaluationPeriod} ${inputs.evaluationPeriod === 1 ? 'год' : inputs.evaluationPeriod < 5 ? 'года' : 'лет'}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Ставка дисконтирования:</span>
                                <span class="breakdown-value">${inputs.discountRate}%</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Расчеты по годам</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>Год</th>
                                    <th>Денежный поток</th>
                                    <th>Накопительный поток</th>
                                    <th>Дисконтированный поток</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${calc.cashFlows.map(cf => `
                                    <tr>
                                        <td>${cf.year === 0 ? '0 (инвестиции)' : cf.year}</td>
                                        <td class="${cf.cashFlow < 0 ? 'cashflow-negative' : 'cashflow-positive'}">${formatCurrency(cf.cashFlow)}</td>
                                        <td class="${cf.cumulative < 0 ? 'cashflow-negative' : 'cashflow-positive'}">${formatCurrency(cf.cumulative)}</td>
                                        <td>${formatCurrency(cf.discounted)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div class="section">
                        <h2>Детализация выгод</h2>
                        <div class="breakdown">
                            <div class="breakdown-item">
                                <span class="breakdown-label">Экономия на текучести кадров (за период):</span>
                                <span class="breakdown-value">${formatCurrency(breakdown.benefits.retentionBenefits)}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Выгоды от повышения производительности (за период):</span>
                                <span class="breakdown-value">${formatCurrency(breakdown.benefits.productivityBenefits)}</span>
                            </div>
                            <div class="breakdown-item" style="border-top: 2px solid #2DB67D; margin-top: 10px; padding-top: 15px;">
                                <span class="breakdown-label" style="font-weight: bold; font-size: 1.1em;">Общие выгоды:</span>
                                <span class="breakdown-value" style="font-size: 1.2em;">${formatCurrency(breakdown.benefits.totalBenefits)}</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Итоговые показатели</h2>
                        <div class="breakdown">
                            <div class="breakdown-item">
                                <span class="breakdown-label">ROI (Return on Investment):</span>
                                <span class="breakdown-value">${calc.roi.toFixed(1)}%</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">NPV (Чистая приведенная стоимость):</span>
                                <span class="breakdown-value">${formatCurrency(calc.npv)}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">IRR (Внутренняя норма доходности):</span>
                                <span class="breakdown-value">${calc.irr !== null && !isNaN(calc.irr) && isFinite(calc.irr) ? calc.irr.toFixed(1) + '%' : 'N/A'}</span>
                            </div>
                            <div class="breakdown-item">
                                <span class="breakdown-label">Срок окупаемости:</span>
                                <span class="breakdown-value">${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod ? calc.paybackPeriod.toFixed(2) + ' лет' : '> ' + inputs.evaluationPeriod + ' лет'}</span>
                            </div>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Рекомендации</h2>
                        <div class="recommendation ${recommendationClass}">
                            ${recommendationHTML}
                        </div>
                    </div>

                    <div class="footer">
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>Расчёт выполнен с помощью интерактивного калькулятора ROI</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();

            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        function resetROICalculator() {
            document.getElementById('roiResults').style.display = 'none';

            // Сбрасываем значения к дефолтным
            document.getElementById('projectBudget').value = '50';
            document.getElementById('employeeCount').value = '500';
            document.getElementById('projectDuration').value = '12';
            document.getElementById('maturityLevel').value = 'medium';

            // Уничтожаем график
            if (window.roiChartInstance) {
                window.roiChartInstance.destroy();
                window.roiChartInstance = null;
            }
        }

        function exportROIToExcel() {
            const results = calculateROI();
            const calc = results.calculations;
            const breakdown = results.breakdown;
            const inputs = results.inputs;

            // Создаем CSV содержимое (совместимо с Excel)
            let csv = 'ROI Отчёт - ' + new Date().toLocaleDateString('ru-RU') + '\n\n';
            
            // Ключевые метрики
            csv += 'Ключевые метрики\n';
            csv += 'Метрика,Значение\n';
            csv += `ROI проекта,${calc.roi.toFixed(1)}%\n`;
            csv += `NPV,${formatCurrency(calc.npv)}\n`;
            csv += `IRR,${calc.irr !== null && !isNaN(calc.irr) && isFinite(calc.irr) ? calc.irr.toFixed(1) + '%' : 'N/A'}\n`;
            csv += `Срок окупаемости,${calc.paybackPeriod !== null && calc.paybackPeriod <= inputs.evaluationPeriod ? calc.paybackPeriod.toFixed(2) + ' лет' : '> ' + inputs.evaluationPeriod + ' лет'}\n\n`;
            
            // Входные данные
            csv += 'Входные данные\n';
            csv += 'Параметр,Значение\n';
            csv += `Бюджет проекта,${formatCurrency(inputs.projectBudget)}\n`;
            csv += `Стоимость управления изменениями,${formatCurrency(inputs.changeBudget)}\n`;
            csv += `Экономия на увольнениях (в год),${formatCurrency(inputs.turnoverSavings)}\n`;
            csv += `Повышение производительности,${inputs.productivityGain}%\n`;
            csv += `Средняя зарплата сотрудника,${formatCurrency(inputs.avgSalary)}\n`;
            csv += `Количество сотрудников,${inputs.employeeCount}\n`;
            csv += `Период оценки,${inputs.evaluationPeriod} ${inputs.evaluationPeriod === 1 ? 'год' : inputs.evaluationPeriod < 5 ? 'года' : 'лет'}\n`;
            csv += `Ставка дисконтирования,${inputs.discountRate}%\n\n`;
            
            // Денежные потоки
            csv += 'Денежные потоки по годам\n';
            csv += 'Год,Денежный поток,Накопительный поток,Дисконтированный поток\n';
            calc.cashFlows.forEach(cf => {
                const year = cf.year === 0 ? '0 (инвестиции)' : cf.year;
                csv += `${year},${cf.cashFlow},${cf.cumulative},${cf.discounted}\n`;
            });
            csv += '\n';
            
            // Детализация выгод
            csv += 'Детализация выгод\n';
            csv += 'Статья,Значение\n';
            csv += `Экономия на текучести кадров (за период),${formatCurrency(breakdown.benefits.retentionBenefits)}\n`;
            csv += `Выгоды от повышения производительности (за период),${formatCurrency(breakdown.benefits.productivityBenefits)}\n`;
            csv += `Общие выгоды,${formatCurrency(breakdown.benefits.totalBenefits)}\n`;
            
            // Создаем blob и скачиваем
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `ROI_Calculation_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function saveROIScenario() {
            const results = calculateROI();
            const scenarioName = prompt('Введите название сценария:', `Сценарий ${new Date().toLocaleDateString('ru-RU')}`);
            
            if (!scenarioName) {
                return;
            }
            
            const scenario = {
                name: scenarioName,
                inputs: results.inputs,
                results: {
                    roi: results.calculations.roi,
                    npv: results.calculations.npv,
                    irr: results.calculations.irr,
                    paybackPeriod: results.calculations.paybackPeriod
                },
                timestamp: new Date().toISOString()
            };
            
            const scenarios = JSON.parse(localStorage.getItem('roi_scenarios') || '[]');
            scenarios.push(scenario);
            localStorage.setItem('roi_scenarios', JSON.stringify(scenarios));
            
            alert(`Сценарий "${scenarioName}" сохранен!`);
            
            // Обновляем список сценариев, если он отображается
            updateScenariosList();
        }

        function loadROIScenarioByIndex(index) {
            const scenarios = JSON.parse(localStorage.getItem('roi_scenarios') || '[]');
            if (index >= 0 && index < scenarios.length) {
                loadROIScenario(scenarios[index]);
            }
        }

        function loadROIScenario(scenario) {
            // Загружаем входные данные из сценария
            document.getElementById('projectBudget').value = scenario.inputs.projectBudget || '';
            document.getElementById('changeBudget').value = scenario.inputs.changeBudget || '';
            document.getElementById('turnoverSavings').value = scenario.inputs.turnoverSavings || '';
            document.getElementById('productivityGain').value = scenario.inputs.productivityGain || '';
            document.getElementById('avgSalary').value = scenario.inputs.avgSalary || '';
            document.getElementById('employeeCount').value = scenario.inputs.employeeCount || '';
            document.getElementById('evaluationPeriod').value = scenario.inputs.evaluationPeriod || 3;
            document.getElementById('discountRate').value = scenario.inputs.discountRate || 10;
            
            // Пересчитываем
            const results = calculateROI();
            renderROIResults(results);
        }

        function updateScenariosList() {
            const scenarios = JSON.parse(localStorage.getItem('roi_scenarios') || '[]');
            const scenariosListEl = document.getElementById('roiScenariosList');
            
            if (scenariosListEl) {
                if (scenarios.length === 0) {
                    scenariosListEl.innerHTML = '<p>Нет сохраненных сценариев</p>';
                } else {
                    scenariosListEl.innerHTML = `
                        <h5>Сохраненные сценарии</h5>
                        <div class="scenarios-list">
                            ${scenarios.map((scenario, index) => `
                                <div class="scenario-item">
                                    <div class="scenario-info">
                                        <div class="scenario-name">${scenario.name}</div>
                                        <div class="scenario-metrics">
                                            ROI: ${scenario.results.roi.toFixed(1)}%, 
                                            NPV: ${formatCurrency(scenario.results.npv)}
                                        </div>
                                        <div class="scenario-date">${new Date(scenario.timestamp).toLocaleDateString('ru-RU')}</div>
                                    </div>
                                    <div class="scenario-actions">
                                        <button class="scenario-btn" onclick="loadROIScenarioByIndex(${index})">Загрузить</button>
                                        <button class="scenario-btn secondary" onclick="deleteROIScenario(${index})">Удалить</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                scenariosListEl.style.display = 'block';
            }
        }

        function deleteROIScenario(index) {
            if (confirm('Удалить этот сценарий?')) {
                const scenarios = JSON.parse(localStorage.getItem('roi_scenarios') || '[]');
                scenarios.splice(index, 1);
                localStorage.setItem('roi_scenarios', JSON.stringify(scenarios));
                updateScenariosList();
            }
        }

        function toggleScenariosList() {
            const scenariosListEl = document.getElementById('roiScenariosList');
            if (scenariosListEl) {
                if (scenariosListEl.style.display === 'none') {
                    updateScenariosList();
                } else {
                    scenariosListEl.style.display = 'none';
                }
            }
        }

        function formatCurrency(amount, short = false) {
            if (short) {
                if (Math.abs(amount) >= 1000000000) {
                    return (amount / 1000000000).toFixed(1) + ' млрд ₽';
                } else if (Math.abs(amount) >= 1000000) {
                    return (amount / 1000000).toFixed(1) + ' млн ₽';
                } else if (Math.abs(amount) >= 1000) {
                    return (amount / 1000).toFixed(0) + ' тыс ₽';
                }
            }

            return new Intl.NumberFormat('ru-RU', {
                style: 'currency',
                currency: 'RUB',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function resetROICalculator() {
            // Очистить все поля ввода
            const inputs = ['projectBudget', 'changeBudget', 'turnoverSavings', 'productivityGain', 'avgSalary', 'employeeCount', 'evaluationPeriod', 'discountRate'];
            inputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    if (id === 'evaluationPeriod') input.value = '3';
                    else if (id === 'discountRate') input.value = '10';
                    else input.value = '';
                }
            });

            // Скрыть результаты
            const resultsDiv = document.getElementById('roiResults');
            if (resultsDiv) {
                resultsDiv.style.display = 'none';
            }

            // Очистить диаграмму
            if (window.roiChartInstance) {
                window.roiChartInstance.destroy();
            }
        }

        function showValidationErrors(validation) {
            // Удаляем предыдущие сообщения об ошибках
            const existingErrors = document.querySelectorAll('.roi-validation-error, .roi-validation-warning');
            existingErrors.forEach(el => el.remove());

            // Показываем ошибки
            if (validation.errors.length > 0) {
                const errorContainer = document.createElement('div');
                errorContainer.className = 'roi-validation-error';
                errorContainer.innerHTML = `
                    <h4>Ошибки ввода:</h4>
                    <ul>
                        ${validation.errors.map(err => `<li>${err}</li>`).join('')}
                    </ul>
                `;
                
                const form = document.querySelector('.roi-form');
                if (form) {
                    form.insertBefore(errorContainer, form.firstChild);
                }
            }

            // Показываем предупреждения
            if (validation.warnings.length > 0) {
                const warningContainer = document.createElement('div');
                warningContainer.className = 'roi-validation-warning';
                warningContainer.innerHTML = `
                    <h4>Предупреждения:</h4>
                    <ul>
                        ${validation.warnings.map(warn => `<li>${warn}</li>`).join('')}
                    </ul>
                `;
                
                const form = document.querySelector('.roi-form');
                if (form) {
                    const errorContainer = document.querySelector('.roi-validation-error');
                    if (errorContainer) {
                        form.insertBefore(warningContainer, errorContainer.nextSibling);
                    } else {
                        form.insertBefore(warningContainer, form.firstChild);
                    }
                }
            }
        }

        function initROICalculator() {
            const calculateBtn = document.getElementById('calculateROI');

            if (calculateBtn) {
                calculateBtn.addEventListener('click', () => {
                    // Валидация входных данных
                    const validation = validateROIInputs();
                    
                    if (!validation.isValid) {
                        showValidationErrors(validation);
                        return;
                    }

                    // Показываем предупреждения, но продолжаем расчет
                    if (validation.warnings.length > 0) {
                        showValidationErrors(validation);
                    } else {
                        // Удаляем предыдущие сообщения, если валидация прошла успешно
                        const existingMessages = document.querySelectorAll('.roi-validation-error, .roi-validation-warning');
                        existingMessages.forEach(el => el.remove());
                    }

                    // Выполняем расчет
                    const results = calculateROI();
                    renderROIResults(results);
                });
            }

            // Добавляем валидацию в реальном времени для ключевых полей
            const criticalFields = ['changeBudget', 'turnoverSavings', 'productivityGain', 'employeeCount', 'avgSalary'];
            criticalFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('blur', () => {
                        const validation = validateROIInputs();
                        // Показываем только ошибки для этого поля
                        const fieldErrors = validation.errors.filter(err => 
                            err.toLowerCase().includes(fieldId === 'changeBudget' ? 'стоимость управления' :
                                                      fieldId === 'turnoverSavings' ? 'увольнениях' :
                                                      fieldId === 'productivityGain' ? 'производительности' :
                                                      fieldId === 'employeeCount' ? 'сотрудников' :
                                                      fieldId === 'avgSalary' ? 'зарплата' : '')
                        );
                        
                        // Удаляем предыдущие сообщения для этого поля
                        const existingError = field.parentElement?.querySelector('.roi-field-error');
                        if (existingError) existingError.remove();
                        
                        if (fieldErrors.length > 0) {
                            const errorMsg = document.createElement('div');
                            errorMsg.className = 'roi-field-error';
                            errorMsg.textContent = fieldErrors[0];
                            field.parentElement?.appendChild(errorMsg);
                            field.style.borderColor = '#E01E5A';
                        } else {
                            field.style.borderColor = '';
                        }
                    });
                }
            });
        }

        // ========== READINESS ASSESSMENT ==========
        const readinessQuestions = [
            {
                id: 1,
                category: 'leadership',
                categoryName: 'Лидерство',
                question: 'Лидеры организации активно поддерживают изменения и демонстрируют приверженность.',
                weight: 1
            },
            {
                id: 2,
                category: 'leadership',
                categoryName: 'Лидерство',
                question: 'У нас есть спонсор изменений на высшем уровне руководства.',
                weight: 1
            },
            {
                id: 3,
                category: 'leadership',
                categoryName: 'Лидерство',
                question: 'Руководители понимают необходимость изменений и могут объяснить их сотрудникам.',
                weight: 1
            },
            {
                id: 4,
                category: 'culture',
                categoryName: 'Культура',
                question: 'Организационная культура поддерживает инновации и готовность к изменениям.',
                weight: 1
            },
            {
                id: 5,
                category: 'culture',
                categoryName: 'Культура',
                question: 'Сотрудники открыты к новым идеям и подходам.',
                weight: 1
            },
            {
                id: 6,
                category: 'culture',
                categoryName: 'Культура',
                question: 'В организации ценится обучение и развитие.',
                weight: 1
            },
            {
                id: 7,
                category: 'resources',
                categoryName: 'Ресурсы',
                question: 'У нас достаточно ресурсов (бюджет, время, персонал) для проведения изменений.',
                weight: 1
            },
            {
                id: 8,
                category: 'resources',
                categoryName: 'Ресурсы',
                question: 'Мы имеем необходимые навыки и компетенции для реализации изменений.',
                weight: 1
            },
            {
                id: 9,
                category: 'communication',
                categoryName: 'Коммуникация',
                question: 'Существуют эффективные каналы коммуникации между руководством и сотрудниками.',
                weight: 1
            },
            {
                id: 10,
                category: 'communication',
                categoryName: 'Коммуникация',
                question: 'Информация о целях и прогрессе изменений регулярно доводится до сотрудников.',
                weight: 1
            }
        ];

        let readinessCurrentQuestion = 0;
        let readinessAnswers = {};

        function initReadinessAssessment() {
            const questionsContainer = document.getElementById('readinessQuestions');
            const resultsContainer = document.getElementById('readinessResults');
            const exportBtn = document.getElementById('exportReadinessReport');

            if (!questionsContainer) return;

            // Скрываем результаты и показываем вопросы
            if (resultsContainer) resultsContainer.style.display = 'none';

            // Инициализируем состояние
            readinessCurrentQuestion = 0;
            readinessAnswers = {};

            // Рендерим первый вопрос
            renderReadinessQuestion();

            // Инициализируем кнопку экспорта
            if (exportBtn) {
                exportBtn.addEventListener('click', exportReadinessToPDF);
            }
        }

        function renderReadinessQuestion() {
            const questionsContainer = document.getElementById('readinessQuestions');
            const progressFill = document.getElementById('readinessProgressFill');
            const progressText = document.getElementById('readinessProgressText');

            if (!questionsContainer) return;

            const question = readinessQuestions[readinessCurrentQuestion];

            // Обновляем прогресс
            const progress = ((readinessCurrentQuestion + 1) / readinessQuestions.length) * 100;
            if (progressFill) progressFill.style.width = `${progress}%`;
            if (progressText) progressText.textContent = `Вопрос ${readinessCurrentQuestion + 1} из ${readinessQuestions.length}`;

            // Рендерим вопрос
            questionsContainer.innerHTML = `
                <div class="readiness-question">
                    <div class="readiness-category">${question.categoryName}</div>
                    <h4 class="readiness-question-text">${question.question}</h4>

                    <div class="readiness-scale">
                        <div class="readiness-scale-labels">
                            <span>1<br>Полностью не согласен</span>
                            <span>2</span>
                            <span>3<br>Затрудняюсь ответить</span>
                            <span>4</span>
                            <span>5<br>Полностью согласен</span>
                        </div>
                        <div class="readiness-scale-inputs">
                            ${[1, 2, 3, 4, 5].map(value => `
                                <label class="readiness-option">
                                    <input type="radio" name="readiness-q-${question.id}" value="${value}"
                                           onchange="selectReadinessAnswer(${question.id}, ${value})">
                                    <span class="readiness-radio">${value}</span>
                                </label>
                            `).join('')}
                        </div>
                    </div>

                    <div class="readiness-navigation">
                        ${readinessCurrentQuestion > 0 ? `<button class="panel-button secondary" onclick="prevReadinessQuestion()">← Назад</button>` : ''}
                        <div></div>
                        ${readinessCurrentQuestion < readinessQuestions.length - 1 ?
                            `<button class="panel-button" onclick="nextReadinessQuestion()" id="readinessNextBtn" disabled>Далее →</button>` :
                            `<button class="panel-button" onclick="showReadinessResults()" id="readinessFinishBtn" disabled>Показать результаты</button>`
                        }
                    </div>
                </div>
            `;
        }

        function selectReadinessAnswer(questionId, value) {
            readinessAnswers[questionId] = parseInt(value);

            // Включаем кнопку "Далее" или "Показать результаты"
            const nextBtn = document.getElementById('readinessNextBtn');
            const finishBtn = document.getElementById('readinessFinishBtn');

            if (nextBtn) nextBtn.disabled = false;
            if (finishBtn) finishBtn.disabled = false;
        }

        function nextReadinessQuestion() {
            readinessCurrentQuestion++;
            renderReadinessQuestion();
        }

        function prevReadinessQuestion() {
            readinessCurrentQuestion--;
            renderReadinessQuestion();
        }

        function showReadinessResults() {
            const results = assessReadiness(readinessAnswers);

            // Скрываем вопросы
            document.getElementById('readinessQuestions').style.display = 'none';

            // Показываем результаты
            const resultsContainer = document.getElementById('readinessResults');
            resultsContainer.style.display = 'block';

            renderReadinessResults(results);
        }

        // Делаем функцию глобально доступной
        window.showReadinessResults = showReadinessResults;

        function assessReadiness(answers) {
            // Группируем ответы по категориям
            const categoryScores = {
                leadership: [],
                culture: [],
                resources: [],
                communication: []
            };

            readinessQuestions.forEach(question => {
                const answer = answers[question.id];
                if (answer !== undefined) {
                    categoryScores[question.category].push(answer);
                }
            });

            // Считаем средние баллы по категориям
            const categoryAverages = {};
            let totalScore = 0;

            Object.keys(categoryScores).forEach(category => {
                const scores = categoryScores[category];
                if (scores.length > 0) {
                    categoryAverages[category] = scores.reduce((sum, score) => sum + score, 0) / scores.length;
                    totalScore += categoryAverages[category];
                } else {
                    categoryAverages[category] = 0;
                }
            });

            // Общий балл (максимум 50, по 5 баллов за категорию)
            const overallScore = totalScore;
            const maxScore = 5 * 4; // 4 категории по 5 баллов

            // Определяем уровень готовности
            let level, description;
            const percentage = (overallScore / maxScore) * 100;

            if (percentage >= 80) {
                level = 'Высокая готовность';
                description = 'Организация хорошо подготовлена к изменениям. Можно приступать к реализации с минимальными рисками.';
            } else if (percentage >= 60) {
                level = 'Средняя готовность';
                description = 'Есть хорошая основа, но требуются улучшения в отдельных областях перед запуском изменений.';
            } else if (percentage >= 40) {
                level = 'Низкая готовность';
                description = 'Необходимы значительные подготовительные работы перед запуском проекта изменений.';
            } else {
                level = 'Критически низкая готовность';
                description = 'Требуется фундаментальная подготовка организации к изменениям.';
            }

            // Генерируем рекомендации
            const recommendations = generateReadinessRecommendations(categoryAverages);

            return {
                overallScore: Math.round(overallScore * 10) / 10,
                maxScore,
                level,
                description,
                categoryScores: categoryAverages,
                percentage: Math.round(percentage),
                recommendations
            };
        }

        function generateReadinessRecommendations(categoryScores) {
            const recommendations = [];

            // Функция для определения уровня готовности
            function getReadinessLevel(score) {
                if (score >= 4) return 'good';
                if (score >= 3) return 'medium';
                if (score >= 2) return 'low';
                return 'critical';
            }

            // ЛИДЕРСТВО
            const leadershipLevel = getReadinessLevel(categoryScores.leadership);
            if (leadershipLevel !== 'good') {
                let rec = {
                    category: 'Лидерство',
                    score: categoryScores.leadership,
                    level: leadershipLevel
                };

                switch (leadershipLevel) {
                    case 'critical':
                        rec.title = 'Критическая нехватка лидерской поддержки';
                        rec.urgency = 'critical';
                        rec.complexity = 'hard';
                        rec.impact = 'high';
                        rec.timeframe = '1-2 недели';
                        rec.actions = [
                            'Срочно провести встречи с топ-менеджментом для получения поддержки',
                            'Назначить исполнительного спонсора изменений из высшего руководства',
                            'Разработать и представить бизнес-кейс изменений руководству',
                            'Создать коалицию поддержки из ключевых лидеров'
                        ];
                        break;
                    case 'low':
                        rec.title = 'Слабая вовлеченность руководства';
                        rec.urgency = 'high';
                        rec.complexity = 'medium';
                        rec.impact = 'high';
                        rec.timeframe = '2-4 недели';
                        rec.actions = [
                            'Организовать обучение руководителей по управлению изменениями',
                            'Создать рабочую группу по изменениям с участием лидеров',
                            'Регулярно информировать руководство о прогрессе',
                            'Назначить ответственных лиц за каждое направление изменений'
                        ];
                        break;
                    case 'medium':
                        rec.title = 'Частичная поддержка лидеров';
                        rec.urgency = 'medium';
                        rec.complexity = 'easy';
                        rec.impact = 'medium';
                        rec.timeframe = '1-2 месяца';
                        rec.actions = [
                            'Усилить видимость лидеров в коммуникациях об изменениях',
                            'Организовать регулярные встречи с сотрудниками для демонстрации поддержки',
                            'Разработать систему обратной связи от лидеров',
                            'Создать примеры успешных изменений под руководством лидеров'
                        ];
                        break;
                }
                recommendations.push(rec);
            }

            // КУЛЬТУРА
            const cultureLevel = getReadinessLevel(categoryScores.culture);
            if (cultureLevel !== 'good') {
                let rec = {
                    category: 'Культура',
                    score: categoryScores.culture,
                    level: cultureLevel
                };

                switch (cultureLevel) {
                    case 'critical':
                        rec.title = 'Сильное сопротивление изменениям';
                        rec.urgency = 'critical';
                        rec.complexity = 'hard';
                        rec.impact = 'high';
                        rec.timeframe = '1-3 месяца';
                        rec.actions = [
                            'Провести культурный аудит организации',
                            'Определить источники сопротивления и разработать план их преодоления',
                            'Создать программу работы с сопротивлением (коммуникация + вовлечение)',
                            'Организовать пилотные изменения в небольшой группе'
                        ];
                        break;
                    case 'low':
                        rec.title = 'Низкая адаптивность к изменениям';
                        rec.urgency = 'high';
                        rec.complexity = 'medium';
                        rec.impact = 'high';
                        rec.timeframe = '2-4 месяца';
                        rec.actions = [
                            'Запустить программу развития культуры изменений',
                            'Организовать обучение по преодолению сопротивления',
                            'Создать площадки для открытого обсуждения изменений',
                            'Внедрить практики непрерывного обучения и развития'
                        ];
                        break;
                    case 'medium':
                        rec.title = 'Умеренная открытость к изменениям';
                        rec.urgency = 'medium';
                        rec.complexity = 'medium';
                        rec.impact = 'medium';
                        rec.timeframe = '3-6 месяцев';
                        rec.actions = [
                            'Укрепить существующие позитивные практики культуры',
                            'Расширить вовлечение сотрудников в процесс изменений',
                            'Создать систему признания за участие в изменениях',
                            'Документировать и делиться уроками успешных изменений'
                        ];
                        break;
                }
                recommendations.push(rec);
            }

            // РЕСУРСЫ
            const resourcesLevel = getReadinessLevel(categoryScores.resources);
            if (resourcesLevel !== 'good') {
                let rec = {
                    category: 'Ресурсы',
                    score: categoryScores.resources,
                    level: resourcesLevel
                };

                switch (resourcesLevel) {
                    case 'critical':
                        rec.title = 'Критическая нехватка ресурсов';
                        rec.urgency = 'critical';
                        rec.complexity = 'hard';
                        rec.impact = 'high';
                        rec.timeframe = '1-2 недели';
                        rec.actions = [
                            'Срочно провести аудит всех доступных ресурсов',
                            'Приоритизировать изменения и выделить минимально необходимые ресурсы',
                            'Найти внешние источники финансирования или поддержки',
                            'Перераспределить ресурсы с менее приоритетных проектов'
                        ];
                        break;
                    case 'low':
                        rec.title = 'Недостаточные ресурсы для изменений';
                        rec.urgency = 'high';
                        rec.complexity = 'medium';
                        rec.impact = 'medium';
                        rec.timeframe = '2-4 недели';
                        rec.actions = [
                            'Разработать детальный план ресурсных потребностей',
                            'Найти внутренние резервы и возможности оптимизации',
                            'Подготовить бизнес-кейс для привлечения дополнительных ресурсов',
                            'Организовать обучение команды для повышения эффективности'
                        ];
                        break;
                    case 'medium':
                        rec.title = 'Достаточные ресурсы для базовых изменений';
                        rec.urgency = 'low';
                        rec.complexity = 'easy';
                        rec.impact = 'low';
                        rec.timeframe = '1-3 месяца';
                        rec.actions = [
                            'Оптимизировать использование существующих ресурсов',
                            'Создать систему мониторинга эффективности ресурсного использования',
                            'Разработать план поэтапного расширения ресурсной базы',
                            'Внедрить инструменты для повышения производительности'
                        ];
                        break;
                }
                recommendations.push(rec);
            }

            // КОММУНИКАЦИЯ
            const communicationLevel = getReadinessLevel(categoryScores.communication);
            if (communicationLevel !== 'good') {
                let rec = {
                    category: 'Коммуникация',
                    score: categoryScores.communication,
                    level: communicationLevel
                };

                switch (communicationLevel) {
                    case 'critical':
                        rec.title = 'Отсутствие системы коммуникаций';
                        rec.urgency = 'critical';
                        rec.complexity = 'medium';
                        rec.impact = 'high';
                        rec.timeframe = '1 неделя';
                        rec.actions = [
                            'Создать базовую систему коммуникаций (email, intranet, собрания)',
                            'Назначить ответственных за коммуникации на каждом уровне',
                            'Разработать ключевые сообщения об изменениях',
                            'Организовать первое информационное собрание для всех сотрудников'
                        ];
                        break;
                    case 'low':
                        rec.title = 'Слабые каналы коммуникации';
                        rec.urgency = 'high';
                        rec.complexity = 'easy';
                        rec.impact = 'medium';
                        rec.timeframe = '2-3 недели';
                        rec.actions = [
                            'Оценить эффективность существующих каналов коммуникации',
                            'Дополнить систему новыми каналами (чат, портал, рассылки)',
                            'Организовать регулярные информационные сессии',
                            'Создать обратную связь для вопросов и предложений'
                        ];
                        break;
                    case 'medium':
                        rec.title = 'Хорошая коммуникация, нужна двусторонность';
                        rec.urgency = 'medium';
                        rec.complexity = 'easy';
                        rec.impact = 'low';
                        rec.timeframe = '1-2 месяца';
                        rec.actions = [
                            'Внедрить систему регулярной обратной связи от сотрудников',
                            'Создать каналы для вопросов и предложений по изменениям',
                            'Организовать фокус-группы и опросы для оценки восприятия',
                            'Разработать план коммуникаций на весь период изменений'
                        ];
                        break;
                }
                recommendations.push(rec);
            }

            // Сортировка рекомендаций по приоритету срочности
            const urgencyOrder = { critical: 0, high: 1, medium: 2, low: 3 };
            recommendations.sort((a, b) => urgencyOrder[a.urgency] - urgencyOrder[b.urgency]);

            return recommendations;
        }

        // ========== ЭКСПЕРТНАЯ ИНТЕРПРЕТАЦИЯ ДИАГНОСТИКИ ГОТОВНОСТИ ==========
        
        function generateReadinessExpertInsight(results) {
            const { overallScore, maxScore, level, percentage, categoryScores, recommendations } = results;
            
            // Общая экспертная интерпретация
            let overallInterpretation = '';
            let strategicContext = '';
            const keyInsights = [];
            const criticalGaps = [];
            const strengths = [];
            
            // Определяем общий уровень готовности
            if (percentage >= 80) {
                overallInterpretation = `Ваша организация демонстрирует высокую готовность к изменениям (${percentage}%). Это указывает на сильную основу для успешной реализации проекта изменений с минимальными рисками.`;
                strategicContext = 'Высокая готовность означает, что организация имеет необходимые элементы (лидерство, культура, ресурсы, коммуникации) для эффективного управления изменениями. Это позволяет приступить к реализации с уверенностью и фокусом на достижении целей.';
                strengths.push('Сильная организационная база для изменений');
                strengths.push('Минимальные риски при реализации проекта');
                strengths.push('Возможность быстрого старта и достижения результатов');
            } else if (percentage >= 60) {
                overallInterpretation = `Ваша организация показывает среднюю готовность к изменениям (${percentage}%). Есть хорошая основа, но требуются улучшения в отдельных областях перед запуском изменений для снижения рисков.`;
                strategicContext = 'Средняя готовность указывает на наличие большинства необходимых элементов, но с некоторыми пробелами. Рекомендуется провести подготовительную работу в слабых областях перед полномасштабной реализацией.';
                keyInsights.push('Необходимо усилить слабые области перед запуском проекта');
                keyInsights.push('Рекомендуется пилотный подход для проверки готовности');
            } else if (percentage >= 40) {
                overallInterpretation = `Ваша организация демонстрирует низкую готовность к изменениям (${percentage}%). Необходимы значительные подготовительные работы перед запуском проекта изменений для обеспечения успеха.`;
                strategicContext = 'Низкая готовность указывает на существенные пробелы в ключевых областях. Без устранения этих пробелов проект изменений имеет высокий риск неудачи. Рекомендуется комплексная программа подготовки.';
                criticalGaps.push('Существенные пробелы требуют немедленного внимания');
                criticalGaps.push('Высокий риск неудачи без подготовки');
                keyInsights.push('Необходима комплексная программа подготовки');
            } else {
                overallInterpretation = `Ваша организация имеет критически низкую готовность к изменениям (${percentage}%). Требуется срочная и комплексная работа по подготовке организации перед любыми попытками реализации изменений.`;
                strategicContext = 'Критически низкая готовность означает, что организация не готова к изменениям в текущем состоянии. Любые попытки реализации без подготовки имеют очень высокий риск провала. Необходима системная работа по развитию организационных возможностей.';
                criticalGaps.push('Критические пробелы во всех ключевых областях');
                criticalGaps.push('Очень высокий риск провала проекта без подготовки');
                criticalGaps.push('Требуется системная трансформация организационных возможностей');
            }
            
            // Анализ по категориям
            const categoryAnalysis = {};
            Object.entries(categoryScores).forEach(([category, score]) => {
                const categoryName = getReadinessCategoryName(category);
                let analysis = '';
                let priority = '';
                let impact = '';
                
                if (score >= 4) {
                    analysis = `${categoryName} показывает высокий уровень готовности (${score.toFixed(1)}/5). Это сильная сторона организации, которую можно использовать как основу для изменений.`;
                    priority = 'Низкий приоритет — область не требует внимания';
                    impact = 'Эта область является опорой для успешной реализации изменений';
                } else if (score >= 3) {
                    analysis = `${categoryName} демонстрирует средний уровень готовности (${score.toFixed(1)}/5). Есть хорошая основа, но требуются улучшения для оптимальной поддержки изменений.`;
                    priority = 'Средний приоритет — рекомендуется улучшение';
                    impact = 'Улучшение этой области повысит общую готовность и снизит риски';
                } else if (score >= 2) {
                    analysis = `${categoryName} показывает низкий уровень готовности (${score.toFixed(1)}/5). Это область требует внимания перед запуском изменений.`;
                    priority = 'Высокий приоритет — требует немедленного внимания';
                    impact = 'Низкая готовность в этой области создает значительные риски для проекта';
                } else {
                    analysis = `${categoryName} демонстрирует критически низкий уровень готовности (${score.toFixed(1)}/5). Это критическая область, требующая срочного вмешательства.`;
                    priority = 'Критический приоритет — требует немедленных действий';
                    impact = 'Критически низкая готовность в этой области может привести к провалу проекта';
                }
                
                categoryAnalysis[category] = { analysis, priority, impact, score };
            });
            
            // Генерация плана действий
            const actionPlan = {
                immediate: [],
                shortTerm: [],
                mediumTerm: []
            };
            
            recommendations.forEach(rec => {
                if (rec.urgency === 'critical') {
                    actionPlan.immediate.push({
                        category: rec.category,
                        title: rec.title,
                        timeframe: rec.timeframe,
                        actions: rec.actions
                    });
                } else if (rec.urgency === 'high') {
                    actionPlan.shortTerm.push({
                        category: rec.category,
                        title: rec.title,
                        timeframe: rec.timeframe,
                        actions: rec.actions
                    });
                } else {
                    actionPlan.mediumTerm.push({
                        category: rec.category,
                        title: rec.title,
                        timeframe: rec.timeframe,
                        actions: rec.actions
                    });
                }
            });
            
            return {
                overallInterpretation,
                strategicContext,
                keyInsights,
                criticalGaps,
                strengths,
                categoryAnalysis,
                actionPlan
            };
        }
        
        function renderReadinessResults(results) {
            // Генерируем экспертную интерпретацию
            const expertInsight = generateReadinessExpertInsight(results);
            
            // Общий балл
            document.getElementById('readinessOverallScore').textContent = `${results.overallScore}/${results.maxScore}`;
            document.getElementById('readinessOverallLevel').textContent = results.level;
            document.getElementById('readinessOverallDescription').textContent = results.description;

            // Радар-чарт
            renderReadinessRadarChart(results.categoryScores);

            // Детальные результаты по категориям
            const categoriesContainer = document.getElementById('readinessCategories');
            categoriesContainer.innerHTML = Object.entries(results.categoryScores).map(([category, score]) => `
                <div class="readiness-category-result">
                    <div class="readiness-category-header">
                        <span class="readiness-category-name">${getReadinessCategoryName(category)}</span>
                        <span class="readiness-category-score">${score.toFixed(1)}/5</span>
                    </div>
                    <div class="readiness-category-bar">
                        <div class="readiness-category-fill" style="width: ${(score / 5) * 100}%"></div>
                    </div>
                </div>
            `).join('');

            // Добавляем экспертную интерпретацию перед рекомендациями
            const expertInsightEl = document.createElement('div');
            expertInsightEl.className = 'readiness-expert-insight';
            expertInsightEl.innerHTML = `
                <h4>Экспертная интерпретация результатов</h4>
                <div class="expert-overall-analysis">
                    <p class="expert-interpretation"><strong>${expertInsight.overallInterpretation}</strong></p>
                    <p class="expert-context">${expertInsight.strategicContext}</p>
                </div>
                
                ${expertInsight.strengths.length > 0 ? `
                <div class="expert-strengths">
                    <h5>Сильные стороны вашей организации:</h5>
                    <ul>${expertInsight.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
                </div>
                ` : ''}
                
                ${expertInsight.keyInsights.length > 0 ? `
                <div class="expert-key-insights">
                    <h5>Ключевые инсайты:</h5>
                    <ul>${expertInsight.keyInsights.map(i => `<li>${i}</li>`).join('')}</ul>
                </div>
                ` : ''}
                
                ${expertInsight.criticalGaps.length > 0 ? `
                <div class="expert-critical-gaps">
                    <h5>Критические пробелы, требующие внимания:</h5>
                    <ul>${expertInsight.criticalGaps.map(g => `<li>${g}</li>`).join('')}</ul>
                </div>
                ` : ''}
                
                <div class="expert-category-analysis">
                    <h5>Детальный анализ по категориям:</h5>
                    ${Object.entries(expertInsight.categoryAnalysis).map(([category, analysis]) => `
                        <div class="category-expert-analysis">
                            <h6>${getReadinessCategoryName(category)} (${analysis.score.toFixed(1)}/5)</h6>
                            <p>${analysis.analysis}</p>
                            <p><strong>Приоритет:</strong> ${analysis.priority}</p>
                            <p><strong>Влияние:</strong> ${analysis.impact}</p>
                        </div>
                    `).join('')}
                </div>
                
                <div class="expert-action-plan">
                    <h5>Стратегический план действий:</h5>
                    ${expertInsight.actionPlan.immediate.length > 0 ? `
                        <div class="action-plan-phase immediate">
                            <h6>Немедленные действия (критический приоритет):</h6>
                            ${expertInsight.actionPlan.immediate.map(item => `
                                <div class="action-plan-item">
                                    <strong>${item.category}: ${item.title}</strong>
                                    <span class="action-timeframe">${item.timeframe}</span>
                                    <ul>${item.actions.map(a => `<li>${a}</li>`).join('')}</ul>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${expertInsight.actionPlan.shortTerm.length > 0 ? `
                        <div class="action-plan-phase short-term">
                            <h6>Краткосрочные действия (высокий приоритет):</h6>
                            ${expertInsight.actionPlan.shortTerm.map(item => `
                                <div class="action-plan-item">
                                    <strong>${item.category}: ${item.title}</strong>
                                    <span class="action-timeframe">${item.timeframe}</span>
                                    <ul>${item.actions.map(a => `<li>${a}</li>`).join('')}</ul>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                    
                    ${expertInsight.actionPlan.mediumTerm.length > 0 ? `
                        <div class="action-plan-phase medium-term">
                            <h6>Среднесрочные действия (средний/низкий приоритет):</h6>
                            ${expertInsight.actionPlan.mediumTerm.map(item => `
                                <div class="action-plan-item">
                                    <strong>${item.category}: ${item.title}</strong>
                                    <span class="action-timeframe">${item.timeframe}</span>
                                    <ul>${item.actions.map(a => `<li>${a}</li>`).join('')}</ul>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `;
            
            // Вставляем экспертную интерпретацию перед рекомендациями
            const recommendationsContainer = document.getElementById('readinessRecommendations');
            recommendationsContainer.parentNode.insertBefore(expertInsightEl, recommendationsContainer);
            
            // Рекомендации
            recommendationsContainer.innerHTML = results.recommendations.map(rec => `
                <div class="readiness-recommendation ${rec.urgency}">
                    <div class="readiness-recommendation-header">
                        <h5>${rec.title}</h5>
                        <div class="readiness-recommendation-meta">
                            <span class="readiness-urgency-badge ${rec.urgency}">${getUrgencyLabel(rec.urgency)}</span>
                            <span class="readiness-timeframe">${rec.timeframe}</span>
                        </div>
                    </div>
                    <div class="readiness-recommendation-content">
                        <p><strong>${rec.category}</strong> • Уровень: ${rec.score.toFixed(1)}/5</p>
                    </div>
                    <div class="readiness-recommendation-actions">
                        <h6>Рекомендуемые действия:</h6>
                        <ul>
                            ${rec.actions.map(action => `<li>${action}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `).join('');
        }

        // Вспомогательные функции для визуализации рекомендаций
        function getUrgencyLabel(urgency) {
            const labels = {
                critical: 'КРИТИЧНО',
                high: 'ВЫСОКИЙ',
                medium: 'СРЕДНИЙ',
                low: 'НИЗКИЙ'
            };
            return labels[urgency] || urgency;
        }

        function getComplexityLabel(complexity) {
            const labels = {
                easy: 'Легко',
                medium: 'Средне',
                hard: 'Сложно'
            };
            return labels[complexity] || complexity;
        }

        function getComplexityIcon(complexity) {
            const icons = {
                easy: '⚡',
                medium: '⚙️',
                hard: '🔧'
            };
            return icons[complexity] || '⚙️';
        }

        function getImpactLabel(impact) {
            const labels = {
                high: 'Высокое',
                medium: 'Среднее',
                low: 'Низкое'
            };
            return labels[impact] || impact;
        }

        function getImpactIcon(impact) {
            const icons = {
                high: '🎯',
                medium: '📊',
                low: '📌'
            };
            return icons[impact] || '📊';
        }

        function renderReadinessRadarChart(categoryScores) {
            const ctx = document.getElementById('readinessRadarChart').getContext('2d');

            const data = {
                labels: ['Лидерство', 'Культура', 'Ресурсы', 'Коммуникация'],
                datasets: [{
                    label: 'Уровень готовности',
                    data: [
                        categoryScores.leadership || 0,
                        categoryScores.culture || 0,
                        categoryScores.resources || 0,
                        categoryScores.communication || 0
                    ],
                    fill: true,
                    backgroundColor: 'rgba(45, 182, 125, 0.2)',
                    borderColor: 'rgba(45, 182, 125, 1)',
                    borderWidth: 2,
                    pointBackgroundColor: 'rgba(45, 182, 125, 1)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgba(45, 182, 125, 1)'
                }]
            };

            const config = {
                type: 'radar',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    aspectRatio: 1.2,
                    elements: {
                        line: {
                            borderWidth: 2
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 5,
                            ticks: {
                                stepSize: 1
                            },
                            pointLabels: {
                                font: {
                                    size: 14
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            };

            // Уничтожаем предыдущий график если существует
            if (window.readinessRadarInstance) {
                window.readinessRadarInstance.destroy();
            }

            window.readinessRadarInstance = new Chart(ctx, config);
        }

        function getReadinessCategoryName(category) {
            const names = {
                leadership: 'Лидерство',
                culture: 'Культура',
                resources: 'Ресурсы',
                communication: 'Коммуникация'
            };
            return names[category] || category;
        }

        function exportReadinessToPDF() {
            const results = assessReadiness(readinessAnswers);

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Диагностика готовности - ${new Date().toLocaleDateString('ru-RU')}</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                        }
                        h1 { color: #2DB67D; border-bottom: 3px solid #2DB67D; padding-bottom: 10px; }
                        h2, h3 { color: #333; margin-top: 30px; }
                        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
                        .overall-score { text-align: center; background: #f9f9f9; padding: 30px; border-radius: 8px; margin: 20px 0; }
                        .score-number { font-size: 48px; font-weight: bold; color: #2DB67D; }
                        .score-level { font-size: 24px; font-weight: bold; margin: 10px 0; }
                        .categories { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
                        .category { padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
                        .category-header { display: flex; justify-content: space-between; margin-bottom: 8px; }
                        .category-name { font-weight: bold; }
                        .category-score { color: #2DB67D; font-weight: bold; }
                        .recommendation { background: #f0f8f0; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #2DB67D; }
                        .recommendation.high { background: rgba(224, 30, 90, 0.05); border-left-color: #E01E5A; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>Отчёт диагностики готовности к изменениям</h1>
                    <p><strong>Дата диагностики:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>

                    <div class="section overall-score">
                        <div class="score-number">${results.overallScore}/${results.maxScore}</div>
                        <div class="score-level">${results.level}</div>
                        <div>${results.description}</div>
                    </div>

                    <div class="section">
                        <h2>Результаты по категориям</h2>
                        <div class="categories">
                            ${Object.entries(results.categoryScores).map(([category, score]) => `
                                <div class="category">
                                    <div class="category-header">
                                        <span class="category-name">${getReadinessCategoryName(category)}</span>
                                        <span class="category-score">${score.toFixed(1)}/5</span>
                                    </div>
                                    <div style="background: #eee; height: 8px; border-radius: 4px; overflow: hidden;">
                                        <div style="background: #2DB67D; height: 100%; width: ${(score / 5) * 100}%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <div class="section">
                        <h2>Рекомендации по улучшению</h2>
                        ${results.recommendations.map(rec => `
                            <div class="recommendation ${rec.priority}">
                                <h3>${rec.title} (${rec.category})</h3>
                                <ul>
                                    ${rec.actions.map(action => `<li>${action}</li>`).join('')}
                                </ul>
                            </div>
                        `).join('')}
                    </div>

                    <div class="footer">
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>Диагностика проведена с помощью интерактивного инструмента оценки готовности</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();

            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        function resetReadinessAssessment() {
            readinessCurrentQuestion = 0;
            readinessAnswers = {};

            // Скрываем результаты
            document.getElementById('readinessResults').style.display = 'none';

            // Уничтожаем график
            if (window.readinessRadarInstance) {
                window.readinessRadarInstance.destroy();
                window.readinessRadarInstance = null;
            }

            // Показываем вопросы
            document.getElementById('readinessQuestions').style.display = 'block';

            // Запускаем заново
            initReadinessAssessment();
        }

        // ========== HYBRID MODEL CONSTRUCTOR ==========
        const hybridBaseModels = [
            {
                id: 'adkar',
                name: 'ADKAR',
                description: 'Фокус на индивидуальных переходах и готовности к изменениям',
                icon: '🎯',
                color: '#2DB67D',
                elements: ['Диагностика готовности', 'Создание видения', 'Обучение'],
                strengths: ['Простота реализации', 'Фокус на людях', 'Быстрые результаты'],
                weaknesses: ['Ограниченный охват', 'Мало внимания к системам']
            },
            {
                id: 'kotter',
                name: 'Модель Коттера',
                description: '8-шаговый процесс создания срочности и коалиции',
                icon: '👑',
                color: '#F4A100',
                elements: ['Создание коалиции', 'Стратегическое видение', 'Коммуникации'],
                strengths: ['Комплексный подход', 'Сильное лидерство', 'Организационные изменения'],
                weaknesses: ['Длительность', 'Сложность координации']
            },
            {
                id: 'satir',
                name: 'Модель Сатир',
                description: 'Работа с сопротивлением и эмоциональными аспектами',
                icon: '💝',
                color: '#E01E5A',
                elements: ['Работа с сопротивлением', 'Эмоциональная поддержка', 'Новый опыт'],
                strengths: ['Глубокая психологическая работа', 'Устранение сопротивления', 'Долгосрочные изменения'],
                weaknesses: ['Требует высокой квалификации', 'Длительность процесса']
            },
            {
                id: 'pdca',
                name: 'PDCA Цикл',
                description: 'Итеративный подход планирования и улучшения',
                icon: '🔄',
                color: '#4A90E2',
                elements: ['Планирование', 'Реализация', 'Проверка', 'Корректировка'],
                strengths: ['Быстрое получение результатов', 'Непрерывное улучшение', 'Адаптивность'],
                weaknesses: ['Требует дисциплины', 'Может быть хаотичным']
            },
            {
                id: 'acmp',
                name: 'ACMP Standard',
                description: 'Структурированный стандарт управления изменениями',
                icon: '📋',
                color: '#9B59B6',
                elements: ['Оценка воздействия', 'Стратегия коммуникаций', 'План обучения'],
                strengths: ['Комплексность', 'Профессионализм', 'Измеримость'],
                weaknesses: ['Сложность внедрения', 'Высокие требования к ресурсам']
            },
            {
                id: 'maur',
                name: 'Маур 3 уровня',
                description: 'Глубокая работа с сопротивлением на разных уровнях',
                icon: '🏔️',
                color: '#E74C3C',
                elements: ['Уровень 1: Я', 'Уровень 2: Мы', 'Уровень 3: Система'],
                strengths: ['Глубина анализа', 'Комплексное решение', 'Профилактика проблем'],
                weaknesses: ['Высокая сложность', 'Длительность', 'Требует экспертизы']
            }
        ];

        const hybridElements = [
            {
                id: 'vision',
                name: 'Создание общего видения',
                description: 'Разработка четкого образа будущего состояния',
                source: 'Коттер',
                category: 'planning'
            },
            {
                id: 'coalition',
                name: 'Формирование коалиции',
                description: 'Создание группы лидеров для поддержки изменений',
                source: 'Коттер',
                category: 'leadership'
            },
            {
                id: 'communication',
                name: 'Многоуровневая коммуникация',
                description: 'Комплексный план информирования заинтересованных сторон',
                source: 'ACMP',
                category: 'communication'
            },
            {
                id: 'training',
                name: 'Системное обучение',
                description: 'Программа подготовки для всех уровней организации',
                source: 'ACMP',
                category: 'training'
            },
            {
                id: 'resistance',
                name: 'Управление сопротивлением',
                description: 'Проактивная работа с барьерами и сомнениями',
                source: 'Сатир',
                category: 'change_management'
            },
            {
                id: 'emotional_support',
                name: 'Эмоциональная поддержка',
                description: 'Сопровождение через период неопределенности',
                source: 'Сатир',
                category: 'support'
            },
            {
                id: 'iteration',
                name: 'Итеративное внедрение',
                description: 'Пошаговое тестирование и корректировка подхода',
                source: 'PDCA',
                category: 'implementation'
            },
            {
                id: 'measurement',
                name: 'Измерение прогресса',
                description: 'Метрики и индикаторы успешности изменений',
                source: 'ADKAR',
                category: 'monitoring'
            },
            {
                id: 'system_analysis',
                name: 'Системный анализ',
                description: 'Понимание взаимосвязей и системных эффектов',
                source: 'Маур',
                category: 'analysis'
            },
            {
                id: 'culture_change',
                name: 'Изменение культуры',
                description: 'Работа с организационной культурой и ценностями',
                source: 'Маур',
                category: 'culture'
            },
            {
                id: 'stakeholder_engagement',
                name: 'Вовлечение стейкхолдеров',
                description: 'Активное участие ключевых заинтересованных сторон',
                source: 'Коттер',
                category: 'engagement'
            },
            {
                id: 'risk_management',
                name: 'Управление рисками',
                description: 'Идентификация и минимизация рисков изменений',
                source: 'ACMP',
                category: 'risk'
            }
        ];

        let hybridCurrentStep = 1;
        let hybridSelectedBase = null;
        let hybridSelectedElements = [];

        function initHybridConstructor() {
            const baseModelsContainer = document.getElementById('hybridBaseModels');
            const elementsContainer = document.getElementById('hybridElements');
            const exportBtn = document.getElementById('exportHybridModel');

            if (!baseModelsContainer) return;

            // Рендерим базовые модели
            renderHybridBaseModels();

            // Инициализируем кнопку экспорта
            if (exportBtn) {
                exportBtn.addEventListener('click', exportConstructorToPDF);
            }

            // Сбрасываем состояние
            resetHybridState();
        }

        function getModelIconSVG(modelId) {
            const icons = {
                'adkar': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>',
                'kotter': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>',
                'satir': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg>',
                'pdca': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path></svg>',
                'acmp': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>',
                'maur': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"></polygon><polyline points="2 17 12 22 22 17"></polyline><polyline points="2 12 12 17 22 12"></polyline></svg>'
            };
            return icons[modelId] || icons['adkar'];
        }

        function renderHybridBaseModels() {
            const container = document.getElementById('hybridBaseModels');
            container.innerHTML = hybridBaseModels.map(model => `
                <div class="hybrid-base-model" onclick="selectHybridBase('${model.id}')">
                    <div class="hybrid-model-header">
                        <span class="hybrid-model-icon">${getModelIconSVG(model.id)}</span>
                        <h4>${model.name}</h4>
                    </div>
                    <p class="hybrid-model-description">${model.description}</p>
                    <div class="hybrid-model-elements">
                        ${model.elements.map(element => `<span class="hybrid-element-tag">${element}</span>`).join('')}
                    </div>
                    <div class="hybrid-model-pros">
                        <strong>Сильные стороны:</strong> ${model.strengths.join(', ')}
                    </div>
                </div>
            `).join('');
        }

        function renderHybridElements() {
            const container = document.getElementById('hybridElements');
            const selectedBase = hybridBaseModels.find(m => m.id === hybridSelectedBase);

            container.innerHTML = `
                <div class="hybrid-selected-base">
                    <h4>Базовая модель: <span class="hybrid-model-icon" style="display: inline-flex; width: 24px; height: 24px; vertical-align: middle; margin: 0 4px;">${getModelIconSVG(selectedBase.id)}</span> ${selectedBase.name}</h4>
                    <p>${selectedBase.description}</p>
                </div>
                <div class="hybrid-elements-grid">
                    ${hybridElements.map(element => `
                        <label class="hybrid-element-option">
                            <input type="checkbox"
                                   onchange="toggleHybridElement('${element.id}')"
                                   ${hybridSelectedElements.includes(element.id) ? 'checked' : ''}>
                            <span class="hybrid-element-card">
                                <h5>${element.name}</h5>
                                <p>${element.description}</p>
                                <span class="hybrid-element-source">Из: ${element.source}</span>
                            </span>
                        </label>
                    `).join('')}
                </div>
            `;
        }

        // ========== ЭКСПЕРТНАЯ ИНТЕРПРЕТАЦИЯ ГИБРИДНОЙ МОДЕЛИ ==========
        
        function generateHybridExpertInsight(baseModel, elements) {
            const totalElements = baseModel.elements.length + elements.length;
            const hasMultipleSources = new Set(elements.map(e => e.source)).size > 1;
            
            let overallAssessment = '';
            let strengths = [];
            const risks = [];
            const recommendations = [];
            
            // Оценка сложности модели
            if (totalElements <= 5) {
                overallAssessment = `Ваша гибридная модель имеет оптимальную сложность (${totalElements} элементов). Это обеспечивает баланс между полнотой подхода и простотой реализации.`;
                strengths.push('Простота внедрения и понимания командой');
                strengths.push('Минимальный риск перегрузки процесса');
                strengths.push('Быстрое достижение результатов');
            } else if (totalElements <= 10) {
                overallAssessment = `Ваша гибридная модель имеет среднюю сложность (${totalElements} элементов). Это позволяет охватить ключевые аспекты изменений, но требует тщательного планирования интеграции.`;
                strengths.push('Комплексный охват различных аспектов изменений');
                strengths.push('Гибкость в адаптации под разные ситуации');
                risks.push('Риск усложнения процесса внедрения');
                risks.push('Необходимость дополнительного обучения команды');
            } else {
                overallAssessment = `Ваша гибридная модель имеет высокую сложность (${totalElements} элементов). Это обеспечивает максимальный охват, но требует значительных ресурсов и опыта для успешной реализации.`;
                strengths.push('Максимальный охват всех аспектов изменений');
                strengths.push('Высокая адаптивность к сложным проектам');
                risks.push('Высокий риск перегрузки команды и процесса');
                risks.push('Требуется значительный опыт и ресурсы');
                risks.push('Необходимость поэтапного внедрения');
            }
            
            // Оценка сочетания базовой модели и элементов
            let combinationAssessment = '';
            if (hasMultipleSources && elements.length > 0) {
                combinationAssessment = `Вы успешно интегрировали элементы из разных источников (${new Set(elements.map(e => e.source)).size} различных моделей), что создает уникальную комбинацию, адаптированную под ваши потребности.`;
                strengths.push('Уникальная комбинация лучших практик');
                strengths.push('Адаптация под специфику проекта');
                recommendations.push('Убедитесь, что элементы логически связаны и не противоречат друг другу');
                recommendations.push('Проведите пилотное тестирование для проверки совместимости элементов');
            } else if (elements.length > 0) {
                combinationAssessment = `Вы дополнили базовую модель ${baseModel.name} элементами из ${elements[0].source}, что создает целостный подход с фокусом на определенной методологии.`;
                strengths.push('Целостный подход с единой методологической основой');
                strengths.push('Простота обучения команды');
            } else {
                combinationAssessment = `Вы используете базовую модель ${baseModel.name} без дополнительных элементов. Это простой и проверенный подход, который хорошо подходит для стандартных проектов изменений.`;
                strengths.push('Простота и проверенность подхода');
                strengths.push('Минимальные требования к обучению');
                recommendations.push('Рассмотрите возможность добавления дополнительных элементов для повышения эффективности');
            }
            
            // Оценка базовой модели
            let baseModelAssessment = '';
            const modelAssessments = {
                'adkar': {
                    assessment: `${baseModel.name} обеспечивает структурированный подход к индивидуальным изменениям. Это сильная основа для гибридной модели, особенно при работе с сопротивлением.`,
                    strengths: ['Фокус на индивидуальном уровне', 'Четкая структура этапов', 'Измеримость прогресса'],
                    recommendations: ['Дополните элементами для работы на организационном уровне', 'Добавьте инструменты коммуникации']
                },
                'kotter': {
                    assessment: `${baseModel.name} предоставляет четкую структуру из 8 шагов для организационных изменений. Это отличная основа для крупных трансформаций.`,
                    strengths: ['Структурированный подход', 'Фокус на лидерстве', 'Проверенная методология'],
                    recommendations: ['Дополните элементами для работы с сопротивлением', 'Добавьте инструменты для индивидуальной поддержки']
                },
                'levin': {
                    assessment: `${baseModel.name} фокусируется на трех этапах изменений. Это гибкая основа, которая хорошо сочетается с дополнительными элементами.`,
                    strengths: ['Простота и ясность', 'Гибкость применения', 'Фокус на психологии изменений'],
                    recommendations: ['Дополните конкретными инструментами для каждого этапа', 'Добавьте элементы для измерения прогресса']
                }
            };
            
            const modelAssessment = modelAssessments[baseModel.id] || {
                assessment: `${baseModel.name} является хорошей основой для гибридной модели. Убедитесь, что дополнительные элементы логически дополняют базовую структуру.`,
                strengths: ['Проверенная методология', 'Адаптивность'],
                recommendations: ['Оцените совместимость дополнительных элементов', 'Проведите тестирование интеграции']
            };
            
            baseModelAssessment = modelAssessment.assessment;
            strengths.push(...modelAssessment.strengths);
            recommendations.push(...modelAssessment.recommendations);
            
            // Рекомендации по внедрению
            if (totalElements > 10) {
                recommendations.push('Рекомендуется поэтапное внедрение: сначала базовая модель, затем постепенное добавление элементов');
                recommendations.push('Создайте детальный план интеграции с четкими этапами и метриками');
            }
            
            if (hasMultipleSources) {
                recommendations.push('Разработайте единый глоссарий терминов для всех элементов модели');
                recommendations.push('Обеспечьте обучение команды по всем используемым методологиям');
            }
            
            return {
                overallAssessment,
                combinationAssessment,
                baseModelAssessment,
                strengths,
                risks,
                recommendations,
                totalElements,
                hasMultipleSources
            };
        }
        
        function renderHybridPreview() {
            const container = document.getElementById('hybridPreview');
            const selectedBase = hybridBaseModels.find(m => m.id === hybridSelectedBase);
            const selectedElements = hybridElements.filter(e => hybridSelectedElements.includes(e.id));
            
            // Генерируем экспертную интерпретацию
            const expertInsight = generateHybridExpertInsight(selectedBase, selectedElements);

            container.innerHTML = `
                <div class="hybrid-preview-header">
                    <h4>Ваша гибридная модель</h4>
                    <div class="hybrid-model-summary">
                        <div class="hybrid-summary-item">
                            <span class="hybrid-summary-label">Базовая модель:</span>
                            <span class="hybrid-summary-value" style="display: flex; align-items: center; gap: 8px;"><span style="display: inline-flex; width: 20px; height: 20px;">${getModelIconSVG(selectedBase.id)}</span> ${selectedBase.name}</span>
                        </div>
                        <div class="hybrid-summary-item">
                            <span class="hybrid-summary-label">Дополнительных элементов:</span>
                            <span class="hybrid-summary-value">${selectedElements.length}</span>
                        </div>
                    </div>
                </div>

                <div class="hybrid-model-visualization" id="hybridVisualization">
                    <!-- Визуализация будет создана функцией -->
                </div>

                <div class="hybrid-model-composition">
                    <h5>Состав модели:</h5>
                    <div class="hybrid-composition-base">
                        <strong>Базовые элементы (${selectedBase.name}):</strong>
                        <ul>
                            ${selectedBase.elements.map(element => `<li>${element}</li>`).join('')}
                        </ul>
                    </div>
                    ${selectedElements.length > 0 ? `
                        <div class="hybrid-composition-added">
                            <strong>Дополнительные элементы:</strong>
                            <ul>
                                ${selectedElements.map(element => `<li>${element.name} (${element.source})</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </div>
                
                <div class="hybrid-expert-insight">
                    <h5>Экспертная оценка вашей гибридной модели</h5>
                    <div class="expert-overall-assessment">
                        <p class="expert-assessment-text"><strong>${expertInsight.overallAssessment}</strong></p>
                        <p class="expert-combination-text">${expertInsight.combinationAssessment}</p>
                        <p class="expert-base-model-text">${expertInsight.baseModelAssessment}</p>
                    </div>
                    
                    ${expertInsight.strengths.length > 0 ? `
                    <div class="expert-strengths">
                        <h6>Сильные стороны вашей модели:</h6>
                        <ul>${expertInsight.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
                    </div>
                    ` : ''}
                    
                    ${expertInsight.risks.length > 0 ? `
                    <div class="expert-risks">
                        <h6>Потенциальные риски и рекомендации по их митигации:</h6>
                        <ul>${expertInsight.risks.map(r => `<li>${r}</li>`).join('')}</ul>
                    </div>
                    ` : ''}
                    
                    ${expertInsight.recommendations.length > 0 ? `
                    <div class="expert-recommendations">
                        <h6>Рекомендации по оптимизации и внедрению:</h6>
                        <ul>${expertInsight.recommendations.map(r => `<li>${r}</li>`).join('')}</ul>
                    </div>
                    ` : ''}
                </div>
            `;

            // Создаем визуализацию
            renderHybridVisualization(selectedBase, selectedElements);
        }

        function renderHybridVisualization(baseModel, elements) {
            const container = document.getElementById('hybridVisualization');

            // Создаем SVG диаграмму
            const svg = `
                <svg width="600" height="400" viewBox="0 0 600 400">
                    <!-- Центральный элемент - базовая модель -->
                    <circle cx="300" cy="200" r="80" fill="${baseModel.color}" opacity="0.8"/>
                    <text x="300" y="195" text-anchor="middle" fill="white" font-weight="bold" font-size="16">${baseModel.name}</text>
                    <text x="300" y="215" text-anchor="middle" fill="white" font-size="12">${baseModel.icon}</text>

                    <!-- Дополнительные элементы вокруг центра -->
                    ${elements.map((element, index) => {
                        const angle = (index * 360) / elements.length;
                        const radius = 150;
                        const x = 300 + radius * Math.cos((angle - 90) * Math.PI / 180);
                        const y = 200 + radius * Math.sin((angle - 90) * Math.PI / 180);

                        return `
                            <circle cx="${x}" cy="${y}" r="50" fill="#4A90E2" opacity="0.7"/>
                            <text x="${x}" y="${y-5}" text-anchor="middle" fill="white" font-size="10" font-weight="bold">${element.name.split(' ')[0]}</text>
                            <text x="${x}" y="${y+10}" text-anchor="middle" fill="white" font-size="12">${element.source}</text>
                        `;
                    }).join('')}

                    <!-- Линии связи -->
                    ${elements.map((element, index) => {
                        const angle = (index * 360) / elements.length;
                        const radius = 150;
                        const x = 300 + radius * Math.cos((angle - 90) * Math.PI / 180);
                        const y = 200 + radius * Math.sin((angle - 90) * Math.PI / 180);

                        return `<line x1="300" y1="200" x2="${x}" y2="${y}" stroke="#666" stroke-width="2" opacity="0.5"/>`;
                    }).join('')}
                </svg>
            `;

            container.innerHTML = svg;
        }

        function renderHybridPlan() {
            const container = document.getElementById('hybridPlan');
            const selectedBase = hybridBaseModels.find(m => m.id === hybridSelectedBase);
            const selectedElements = hybridElements.filter(e => hybridSelectedElements.includes(e.id));

            // Создаем план реализации
            const phases = [
                {
                    name: 'Подготовка (Неделя 1-2)',
                    activities: [
                        'Анализ текущего состояния',
                        'Определение целей гибридной модели',
                        'Оценка ресурсов и рисков'
                    ]
                },
                {
                    name: 'Проектирование (Неделя 3-4)',
                    activities: [
                        'Интеграция элементов базовой модели',
                        'Адаптация дополнительных элементов',
                        'Создание плана коммуникаций'
                    ]
                },
                {
                    name: 'Внедрение (Неделя 5-8)',
                    activities: [
                        'Пилотное тестирование',
                        'Обучение команды',
                        'Запуск основных процессов'
                    ]
                },
                {
                    name: 'Оптимизация (Неделя 9-12)',
                    activities: [
                        'Мониторинг результатов',
                        'Корректировка подхода',
                        'Масштабирование на всю организацию'
                    ]
                }
            ];

            container.innerHTML = `
                <h5>План реализации гибридной модели</h5>
                <div class="hybrid-plan-phases">
                    ${phases.map((phase, index) => `
                        <div class="hybrid-plan-phase">
                            <h6>${phase.name}</h6>
                            <ul>
                                ${phase.activities.map(activity => `<li>${activity}</li>`).join('')}
                            </ul>
                        </div>
                    `).join('')}
                </div>

                <div class="hybrid-plan-notes">
                    <h6>Важные замечания:</h6>
                    <ul>
                        <li>Регулярно оценивайте прогресс и корректируйте подход</li>
                        <li>Обеспечьте участие ключевых стейкхолдеров на всех этапах</li>
                        <li>Документируйте уроки и лучшие практики</li>
                        <li>Будьте готовы к итерациям и адаптации модели</li>
                    </ul>
                </div>
            `;
        }

        function selectHybridBase(baseId) {
            hybridSelectedBase = baseId;

            // Визуально выделяем выбранную модель
            document.querySelectorAll('.hybrid-base-model').forEach(model => {
                model.classList.remove('selected');
            });
            document.querySelector(`[onclick="selectHybridBase('${baseId}')"]`).classList.add('selected');
        }

        function toggleHybridElement(elementId) {
            if (hybridSelectedElements.includes(elementId)) {
                hybridSelectedElements = hybridSelectedElements.filter(id => id !== elementId);
            } else {
                hybridSelectedElements.push(elementId);
            }
        }

        function nextHybridStep() {
            if (hybridCurrentStep === 1) {
                if (!hybridSelectedBase) {
                    alert('Пожалуйста, выберите базовую модель');
                    return;
                }

                // Переходим к шагу 2
                document.getElementById('hybridStep1').style.display = 'none';
                document.getElementById('hybridStep2').style.display = 'block';
                document.getElementById('hybridPrevBtn').style.display = 'inline-block';

                renderHybridElements();
                hybridCurrentStep = 2;

            } else if (hybridCurrentStep === 2) {
                // Переходим к шагу 3
                document.getElementById('hybridStep2').style.display = 'none';
                document.getElementById('hybridStep3').style.display = 'block';
                document.getElementById('hybridNextBtn').style.display = 'none';

                renderHybridPreview();
                renderHybridPlan();
                hybridCurrentStep = 3;
            }
        }

        function prevHybridStep() {
            if (hybridCurrentStep === 2) {
                // Возвращаемся к шагу 1
                document.getElementById('hybridStep2').style.display = 'none';
                document.getElementById('hybridStep1').style.display = 'block';
                document.getElementById('hybridPrevBtn').style.display = 'none';

                hybridCurrentStep = 1;

            } else if (hybridCurrentStep === 3) {
                // Возвращаемся к шагу 2
                document.getElementById('hybridStep3').style.display = 'none';
                document.getElementById('hybridStep2').style.display = 'block';
                document.getElementById('hybridNextBtn').style.display = 'inline-block';

                hybridCurrentStep = 2;
            }
        }

        function resetHybridConstructor() {
            resetHybridState();
            initHybridConstructor();
        }

        function resetHybridState() {
            hybridCurrentStep = 1;
            hybridSelectedBase = null;
            hybridSelectedElements = [];

            // Скрываем все шаги кроме первого
            document.getElementById('hybridStep1').style.display = 'block';
            document.getElementById('hybridStep2').style.display = 'none';
            document.getElementById('hybridStep3').style.display = 'none';

            // Показываем/скрываем кнопки навигации
            document.getElementById('hybridPrevBtn').style.display = 'none';
            document.getElementById('hybridNextBtn').style.display = 'inline-block';
        }

        function exportConstructorToPDF() {
            const selectedBase = hybridBaseModels.find(m => m.id === hybridSelectedBase);
            const selectedElements = hybridElements.filter(e => hybridSelectedElements.includes(e.id));

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Гибридная модель - ${new Date().toLocaleDateString('ru-RU')}</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                            line-height: 1.6;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                        }
                        h1 { color: #2DB67D; border-bottom: 3px solid #2DB67D; padding-bottom: 10px; }
                        h2, h3 { color: #333; margin-top: 30px; }
                        .section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
                        .model-summary { background: #f9f9f9; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .summary-item { display: flex; justify-content: space-between; margin: 10px 0; }
                        .elements-list { background: #f0f8f0; padding: 15px; border-radius: 6px; margin: 10px 0; }
                        .plan-phase { background: #fff3cd; padding: 15px; margin: 10px 0; border-radius: 6px; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>Гибридная модель управления изменениями</h1>
                    <p><strong>Дата создания:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>

                    <div class="section model-summary">
                        <h2>Состав модели</h2>
                        <div class="summary-item">
                            <span><strong>Базовая модель:</strong></span>
                            <span>${selectedBase.icon} ${selectedBase.name}</span>
                        </div>
                        <div class="summary-item">
                            <span><strong>Дополнительных элементов:</strong></span>
                            <span>${selectedElements.length}</span>
                        </div>
                    </div>

                    <div class="section">
                        <h2>Базовые элементы</h2>
                        <div class="elements-list">
                            <ul>
                                ${selectedBase.elements.map(element => `<li>${element}</li>`).join('')}
                            </ul>
                        </div>
                    </div>

                    ${selectedElements.length > 0 ? `
                        <div class="section">
                            <h2>Дополнительные элементы</h2>
                            <div class="elements-list">
                                <ul>
                                    ${selectedElements.map(element => `<li><strong>${element.name}</strong> - ${element.description} (Источник: ${element.source})</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    ` : ''}

                    <div class="section">
                        <h2>План реализации</h2>
                        <div class="plan-phase">
                            <h3>Подготовка (Неделя 1-2)</h3>
                            <ul>
                                <li>Анализ текущего состояния</li>
                                <li>Определение целей гибридной модели</li>
                                <li>Оценка ресурсов и рисков</li>
                            </ul>
                        </div>

                        <div class="plan-phase">
                            <h3>Проектирование (Неделя 3-4)</h3>
                            <ul>
                                <li>Интеграция элементов базовой модели</li>
                                <li>Адаптация дополнительных элементов</li>
                                <li>Создание плана коммуникаций</li>
                            </ul>
                        </div>

                        <div class="plan-phase">
                            <h3>Внедрение (Неделя 5-8)</h3>
                            <ul>
                                <li>Пилотное тестирование</li>
                                <li>Обучение команды</li>
                                <li>Запуск основных процессов</li>
                            </ul>
                        </div>

                        <div class="plan-phase">
                            <h3>Оптимизация (Неделя 9-12)</h3>
                            <ul>
                                <li>Мониторинг результатов</li>
                                <li>Корректировка подхода</li>
                                <li>Масштабирование на всю организацию</li>
                            </ul>
                        </div>
                    </div>

                    <div class="footer">
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>Модель создана с помощью конструктора гибридных моделей</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();

            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        function buildLearningPaths() {
            console.log('=== buildLearningPaths() вызвана ===');
            console.log('baseSlidesCount:', baseSlidesCount);
            console.log('fullSlidesCount:', fullSlidesCount);
            console.log('closingSlidesCount:', closingSlidesCount);
            
            try {
                const introSlides = Array.from({ length: baseSlidesCount }, (_, index) => index);
                const closingSlides = Array.from({ length: closingSlidesCount }, (_, index) => closingSlidesStartIndex + index);
                
                const quickKeywords = ['адкар', 'коттер', 'pdca', 'сатир', 'маур 3 уровня', 'гибридное управление'];
                const quickModels = quickKeywords
                    .map(findSlideIndexByKeyword)
                    .filter(index => index >= 0);
                // Найдем индексы слайдов инструментов
                const quizSlideIndex = slidesData.findIndex(slide =>
                    slide.title && slide.title.includes('Интерактивный квиз')
                );
                const roiSlideIndex = slidesData.findIndex(slide =>
                    slide.title && slide.title.includes('Калькулятор ROI')
                );
                const readinessSlideIndex = slidesData.findIndex(slide =>
                    slide.title && slide.title.includes('Диагностика готовности')
                );
                const constructorSlideIndex = slidesData.findIndex(slide =>
                    slide.title && slide.title.includes('Конструктор гибридной модели')
                );
                const pctSlideIndex = slidesData.findIndex(slide =>
                    slide.title && slide.title.includes('Prosci Change Triangle')
                );

                const quickSlidesSet = new Set([...introSlides, ...quickModels, ...closingSlides]);
                // Явно добавляем слайды инструментов в быстрый путь
                [quizSlideIndex, roiSlideIndex, readinessSlideIndex, constructorSlideIndex, pctSlideIndex]
                    .filter(index => index >= 0)
                    .forEach(index => quickSlidesSet.add(index));
                learningPaths.quick.slides = Array.from(quickSlidesSet).sort((a, b) => a - b);
                
                const standardClassicalCount = Math.min(18, classicalModels.length);
                const standardNewModelsCount = Math.min(6, newModels.length);
                const standardSlidesSet = new Set([
                    ...introSlides,
                    ...Array.from({ length: standardClassicalCount }, (_, index) => classicalStartIndex + index),
                    ...Array.from({ length: standardNewModelsCount }, (_, index) => newModelsStartIndex + index),
                    ...closingSlides
                ]);
                // Явно добавляем слайды инструментов в стандартный путь
                [quizSlideIndex, roiSlideIndex, readinessSlideIndex, constructorSlideIndex, pctSlideIndex]
                    .filter(index => index >= 0)
                    .forEach(index => standardSlidesSet.add(index));
                learningPaths.standard.slides = Array.from(standardSlidesSet).sort((a, b) => a - b);
                
                // Всегда устанавливаем expert путь как запасной вариант
                learningPaths.expert.slides = Array.from({ length: fullSlidesCount }, (_, index) => index);
                
                console.log('Построено путей обучения:');
                console.log('  quick:', learningPaths.quick.slides.length, 'слайдов');
                console.log('  standard:', learningPaths.standard.slides.length, 'слайдов');
                console.log('  expert:', learningPaths.expert.slides.length, 'слайдов');
                
                // Проверка: если какой-то путь остался пустым, копируем из expert
                if (learningPaths.quick.slides.length === 0) {
                    learningPaths.quick.slides = learningPaths.expert.slides.slice(0, 10);
                }
                if (learningPaths.standard.slides.length === 0) {
                    learningPaths.standard.slides = learningPaths.expert.slides.slice();
                }
            } catch (error) {
                console.error('Ошибка при построении путей обучения:', error);
                // Fallback: все пути получают все слайды
                const allSlides = Array.from({ length: fullSlidesCount }, (_, index) => index);
                learningPaths.quick.slides = allSlides;
                learningPaths.standard.slides = allSlides;
                learningPaths.expert.slides = allSlides;
            }
        }
        
        function updatePathSelectorOptions() {
            if (!pathSelectorEl) return;
            Array.from(pathSelectorEl.options).forEach((option) => {
                const path = learningPaths[option.value];
                if (path) {
                    option.textContent = `${path.label} (${path.slides.length})`;
                }
            });
            if (pathMetaEl) {
                const currentPath = learningPaths[activeLearningPath];
                pathMetaEl.textContent = `${currentPath.label} • ${currentPath.description}`;
            }
        }
        
        function initializeTheme() {
            if (!themeOrder.includes(currentTheme)) {
                currentTheme = 'auto';
            }
            applyTheme(currentTheme, { skipUpdateLabel: true });
            updateThemeToggleLabel();
        }
        
        function applyTheme(theme, options = {}) {
            document.body.classList.remove('theme-dark', 'theme-light');
            if (theme === 'dark') {
                document.body.classList.add('theme-dark');
            } else if (theme === 'light') {
                document.body.classList.add('theme-light');
            }
            currentTheme = theme;
            localStorage.setItem(THEME_STORAGE_KEY, theme);
            if (!options.skipUpdateLabel) {
                updateThemeToggleLabel();
            }
        }
        
        function cycleTheme() {
            const currentIndex = themeOrder.indexOf(currentTheme);
            const nextTheme = themeOrder[(currentIndex + 1) % themeOrder.length];
            applyTheme(nextTheme);
        }
        
        function updateThemeToggleLabel() {
            if (!themeToggleBtn) return;
            if (currentTheme === 'auto') {
                themeToggleBtn.textContent = '🌞 Тема';
                themeToggleBtn.title = 'Тема: системная. Нажмите для тёмной темы';
            } else if (currentTheme === 'dark') {
                themeToggleBtn.textContent = '🌚 Тема';
                themeToggleBtn.title = 'Тема: тёмная. Нажмите для светлой темы';
            } else {
                themeToggleBtn.textContent = '🌞 Тема';
                themeToggleBtn.title = 'Тема: светлая. Нажмите для системной темы';
            }
        }
        
        function renderTimeline() {
            const trackEl = document.getElementById('timelineTrack');
            if (!trackEl) return;
            trackEl.innerHTML = '';
            
            timelineData.forEach((item, index) => {
                const node = document.createElement('button');
                node.type = 'button';
                node.className = 'timeline-node';
                node.dataset.index = String(index);
                node.innerHTML = `
                    <span class="timeline-period">${item.period}</span>
                    <span class="timeline-headline">${item.headline}</span>
                `;
                node.addEventListener('click', () => updateTimelineDetails(index));
                trackEl.appendChild(node);
            });
            
            updateTimelineDetails(0);
        }
        
        function updateTimelineDetails(index) {
            const titleEl = document.getElementById('timelineTitle');
            const summaryEl = document.getElementById('timelineSummary');
            const highlightsEl = document.getElementById('timelineHighlights');
            if (!titleEl || !summaryEl || !highlightsEl) return;
            
            const data = timelineData[index] ?? timelineData[0];
            titleEl.textContent = `${data.period}: ${data.headline}`;
            summaryEl.textContent = data.summary;
            highlightsEl.innerHTML = '';
            data.highlights.forEach((point) => {
                const li = document.createElement('li');
                li.textContent = point;
                highlightsEl.appendChild(li);
            });
            
            const nodes = document.querySelectorAll('.timeline-node');
            nodes.forEach((node, nodeIndex) => {
                node.classList.toggle('active', nodeIndex === index);
            });
        }
        
        function renderBubbleLegend() {
            const legendEl = document.getElementById('bubbleChartLegend');
            if (!legendEl) return;
            legendEl.innerHTML = '';
            Object.entries(bubbleChartConfig.categories).forEach(([category, colors]) => {
                const item = document.createElement('div');
                item.className = 'chart-legend-item';
                item.innerHTML = `
                    <span class="chart-legend-swatch" style="background:${colors.backgroundColor}; border-color:${colors.borderColor};"></span>
                    ${category}
                `;
                legendEl.appendChild(item);
            });
        }
        
        function renderModelsBubbleChart() {
            const canvas = document.getElementById('modelsBubbleChart');
            if (!canvas || typeof Chart === 'undefined') return;
            if (modelsChartInstance) {
                modelsChartInstance.resize();
                return;
            }
            const ctx = canvas.getContext('2d');
            const datasets = Object.entries(bubbleChartConfig.categories).map(([category, colors]) => ({
                label: category,
                data: bubbleChartConfig.points
                    .filter(point => point.category === category)
                    .map(point => ({ x: point.x, y: point.y, r: point.r, label: point.label })),
                backgroundColor: colors.backgroundColor,
                borderColor: colors.borderColor,
                borderWidth: 1.5
            }));
            
            modelsChartInstance = new Chart(ctx, {
                type: 'bubble',
                data: { datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(17, 24, 39, 0.85)',
                            padding: 12,
                            callbacks: {
                                label: (context) => {
                                    const { label, x, y } = context.raw;
                                    return `${label}: сложность ${x.toFixed(1)}, время ${y.toFixed(1)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Сложность внедрения' },
                            min: 0,
                            max: 10,
                            ticks: { stepSize: 1 }
                        },
                        y: {
                            title: { display: true, text: 'Время реализации' },
                            min: 0,
                            max: 10,
                            ticks: { stepSize: 1 }
                        }
                    }
                }
            });
            
            renderBubbleLegend();
        }
        
        function updateHistory(slideIndex) {
            const existingIndex = historyItems.indexOf(slideIndex);
            if (existingIndex !== -1) {
                historyItems.splice(existingIndex, 1);
            }
            historyItems.unshift(slideIndex);
            if (historyItems.length > HISTORY_LIMIT) {
                historyItems.pop();
            }
            renderHistoryPanel();
        }
        
        function renderHistoryPanel() {
            if (!historyListEl || !historyEmptyEl) return;
            historyListEl.innerHTML = '';
            if (!historyItems.length) {
                historyEmptyEl.style.display = 'block';
                return;
            }
            historyEmptyEl.style.display = 'none';
            historyItems.forEach((slideIndex) => {
                const li = document.createElement('li');
                li.className = 'history-item';
                if (slideIndex === currentSlide) {
                    li.classList.add('active');
                }
                li.dataset.slide = String(slideIndex);
                const title = slidesData[slideIndex]?.title ?? `Слайд ${slideIndex + 1}`;
                li.innerHTML = `<div><strong>${slideIndex + 1}</strong> <span>${title}</span></div>`;
                historyListEl.appendChild(li);
            });
        }
        
        function toggleHistoryPanel(forceState) {
            if (!historyPanelEl || !historyToggleBtn) return;
            const shouldOpen = typeof forceState === 'boolean'
                ? forceState
                : !historyPanelEl.classList.contains('active');
            if (shouldOpen) {
                toggleBookmarkPanel(false);
                toggleNotesPanel(false);
                historyPanelEl.classList.add('active');
                historyToggleBtn.classList.add('active');
            } else {
                historyPanelEl.classList.remove('active');
                historyToggleBtn.classList.remove('active');
            }
        }
        
        
        function stripHTML(html) {
            const temp = document.createElement('div');
            temp.innerHTML = html;
            return temp.textContent || temp.innerText || '';
        }
        
        // ========== PCT TOOL MANAGEMENT ==========
        const PCT_STORAGE_KEY = 'pct_assessment_scores';
        
        let pctState = {
            scores: {
                success: {},
                leadership: {},
                projectManagement: {},
                changeManagement: {}
            },
            currentCategory: 'success'
        };
        
        function loadPCTScores() {
            try {
                const saved = localStorage.getItem(PCT_STORAGE_KEY);
                if (saved) {
                    pctState.scores = JSON.parse(saved);
                }
            } catch (error) {
                console.warn('Не удалось загрузить оценки PCT:', error);
            }
        }
        
        function savePCTScores() {
            try {
                localStorage.setItem(PCT_STORAGE_KEY, JSON.stringify(pctState.scores));
            } catch (error) {
                console.warn('Не удалось сохранить оценки PCT:', error);
            }
        }
        
        function initPCT() {
            try {
                console.log('Инициализация PCT инструмента...');
                if (!pctAssessment || !pctAssessment.categories) {
                    console.warn('PCT assessment data not available');
                    return;
                }
                loadPCTScores();
                renderPCTCategory('success');
                setupPCTEventListeners();
                updatePCTResults();
                updatePCTTabsProgress();
            } catch (error) {
                console.error('Ошибка при инициализации PCT:', error);
            }
        }
        
        function getPCTCategoryIcon(categoryId) {
            const icons = {
                'success': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>',
                'leadership': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>',
                'projectManagement': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="20" x2="12" y2="10"></line><line x1="18" y1="20" x2="18" y2="4"></line><line x1="6" y1="20" x2="6" y2="16"></line></svg>',
                'changeManagement': '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"></path><path d="M21 3a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"></path></svg>'
            };
            return icons[categoryId] || icons['success'];
        }

        function renderPCTCategory(categoryId) {
            const category = pctAssessment.categories[categoryId];
            const container = document.getElementById('pctContent');
            
            if (!container) {
                console.warn('PCT контейнер не найден');
                return;
            }
            
            let html = `
                <div class="pct-category">
                    <h3 style="display: flex; align-items: center; gap: 12px; justify-content: center;">
                        <span style="display: inline-flex; width: 32px; height: 32px;">${getPCTCategoryIcon(categoryId)}</span>
                        ${category.label}
                    </h3>
                    <p class="pct-category-desc">${category.description}</p>
                    <div class="pct-factors">
            `;
            
            category.factors.forEach(factor => {
                const savedScore = pctState.scores[categoryId][factor.id] || 0;
                const hasSelection = savedScore > 0;
                html += `
                    <div class="pct-factor ${hasSelection ? 'has-selection' : ''}">
                        <div class="pct-factor-text">${factor.id}. ${factor.text}</div>
                        <div class="pct-rating">
                            <label>
                                <input type="radio" name="pct_${categoryId}_${factor.id}" value="1" 
                                       ${savedScore === 1 ? 'checked' : ''}
                                       onchange="handlePCTScore('${categoryId}', ${factor.id}, 1)">
                                <span class="pct-rating-option">1</span>
                                <span class="pct-rating-label-text">Не применимо</span>
                            </label>
                            <label>
                                <input type="radio" name="pct_${categoryId}_${factor.id}" value="2"
                                       ${savedScore === 2 ? 'checked' : ''}
                                       onchange="handlePCTScore('${categoryId}', ${factor.id}, 2)">
                                <span class="pct-rating-option">2</span>
                                <span class="pct-rating-label-text">Применимо</span>
                            </label>
                            <label>
                                <input type="radio" name="pct_${categoryId}_${factor.id}" value="3"
                                       ${savedScore === 3 ? 'checked' : ''}
                                       onchange="handlePCTScore('${categoryId}', ${factor.id}, 3)">
                                <span class="pct-rating-option">3</span>
                                <span class="pct-rating-label-text">Превосходит ожидания</span>
                            </label>
                        </div>
                    </div>
                `;
            });
            
            html += `</div></div>`;
            container.innerHTML = html;
            pctState.currentCategory = categoryId;
            updatePCTTabsProgress();
        }
        
        function handlePCTScore(category, factorId, score) {
            pctState.scores[category][factorId] = score;
            savePCTScores();
            updatePCTProgress();
            updatePCTResults();
            updatePCTTabsProgress();
            
            // Обновляем визуальный индикатор в карточке фактора
            const factorEl = document.querySelector(`input[name="pct_${category}_${factorId}"]`)?.closest('.pct-factor');
            if (factorEl) {
                if (score > 0) {
                    factorEl.classList.add('has-selection');
                } else {
                    factorEl.classList.remove('has-selection');
                }
            }
        }
        
        function updatePCTTabsProgress() {
            const tabs = document.querySelectorAll('.pct-tab');
            tabs.forEach(tab => {
                const categoryId = tab.getAttribute('data-category');
                const category = pctAssessment.categories[categoryId];
                if (!category) return;
                
                const categoryScores = pctState.scores[categoryId] || {};
                // Считаем только факторы с ненулевой оценкой
                const completedFactors = Object.values(categoryScores).filter(score => score > 0).length;
                
                // Удаляем старый индикатор прогресса
                const oldProgress = tab.querySelector('.pct-tab-progress');
                if (oldProgress) {
                    oldProgress.remove();
                }
                
                // Добавляем новый индикатор, если есть заполненные факторы
                if (completedFactors > 0) {
                    const progressBadge = document.createElement('span');
                    progressBadge.className = 'pct-tab-progress';
                    progressBadge.textContent = completedFactors;
                    tab.appendChild(progressBadge);
                }
            });
        }
        
        function calculateCategoryScore(categoryId) {
            if (!pctState || !pctState.scores || !pctState.scores[categoryId]) {
                return 0;
            }
            const scores = pctState.scores[categoryId];
            return Object.values(scores).reduce((sum, val) => sum + (Number(val) || 0), 0);
        }
        
        function updatePCTProgress() {
            const totalFactors = 40;
            let completedFactors = 0;
            
            Object.values(pctState.scores).forEach(categoryScores => {
                // Считаем только факторы с ненулевой оценкой
                completedFactors += Object.values(categoryScores).filter(score => score > 0).length;
            });
            
            const progressPercent = (completedFactors / totalFactors) * 100;
            const progressFill = document.getElementById('pctProgressFill');
            const progressText = document.getElementById('pctProgressText');
            
            if (progressFill) {
                progressFill.style.width = `${progressPercent}%`;
            }
            if (progressText) {
                progressText.textContent = `Оценено: ${completedFactors} из ${totalFactors} факторов`;
            }
        }
        
        // Функция для переключения категории PCT (используется и кнопками, и иконками результатов)
        function switchPCTCategory(categoryId) {
            // Обновляем активную кнопку вверху
            const tabs = document.querySelectorAll('.pct-tab');
            tabs.forEach(tab => {
                if (tab.getAttribute('data-category') === categoryId) {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                }
            });
            
            // Рендерим новую категорию
            renderPCTCategory(categoryId);
            
            // Прокручиваем к началу категории для удобства пользователя
            const contentEl = document.getElementById('pctContent');
            if (contentEl) {
                // Небольшая задержка для завершения рендеринга
                setTimeout(() => {
                    contentEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 100);
            }
        }
        
        function updatePCTResults() {
            if (!pctAssessment || !pctAssessment.categories) {
                return;
            }
            
            const categories = Object.keys(pctAssessment.categories);
            
            categories.forEach(catId => {
                const score = calculateCategoryScore(catId);
                const capitalizedId = catId.charAt(0).toUpperCase() + catId.slice(1);
                const scoreEl = document.getElementById(`pctScore${capitalizedId}`);
                
                if (scoreEl) {
                    const valueEl = scoreEl.querySelector('.pct-score-value');
                    if (valueEl) {
                        valueEl.textContent = `${score}/30`;
                    }
                    
                    // Цветовая индикация
                    scoreEl.className = 'pct-score-item clickable';
                    if (score >= 25) scoreEl.classList.add('excellent');
                    else if (score >= 20) scoreEl.classList.add('moderate');
                    else if (score >= 10) scoreEl.classList.add('risk');
                    
                    // Добавляем обработчик клика для переключения категории
                    // Удаляем старый обработчик через клонирование элемента
                    const newScoreEl = scoreEl.cloneNode(true);
                    scoreEl.parentNode.replaceChild(newScoreEl, scoreEl);
                    
                    // Добавляем обработчик клика на новый элемент
                    newScoreEl.addEventListener('click', function(e) {
                        e.stopPropagation();
                        // Переключаем категорию
                        switchPCTCategory(catId);
                    });
                }
            });
            
            try {
                renderPCTVisualization();
                generatePCTRecommendations();
            } catch (error) {
                console.error('Ошибка при обновлении результатов PCT:', error);
            }
        }
        
        function renderPCTVisualization() {
            const container = document.getElementById('pctVisualization');
            if (!container) return;
            
            const scores = {
                success: calculateCategoryScore('success'),
                leadership: calculateCategoryScore('leadership'),
                projectManagement: calculateCategoryScore('projectManagement'),
                changeManagement: calculateCategoryScore('changeManagement')
            };
            
            // Нормализация для радара (макс 30, конвертируем в радиус от 0 до 150)
            const normalize = (score) => (score / 30) * 150;
            
            const centerX = 200;
            const centerY = 200;
            
            // Координаты для четырех направлений (север, восток, юг, запад)
            const successY = centerY - normalize(scores.success);
            const leadershipX = centerX + normalize(scores.leadership);
            const projectManagementY = centerY + normalize(scores.projectManagement);
            const changeManagementX = centerX - normalize(scores.changeManagement);
            
            const svg = `
                <svg width="400" height="400" viewBox="0 0 400 400">
                    <!-- Фон и сетка -->
                    <circle cx="200" cy="200" r="150" fill="none" stroke="#e0e0e0" stroke-width="1"/>
                    <circle cx="200" cy="200" r="100" fill="none" stroke="#e0e0e0" stroke-width="1"/>
                    <circle cx="200" cy="200" r="50" fill="none" stroke="#e0e0e0" stroke-width="1"/>
                    
                    <!-- Оси для каждой категории -->
                    <line x1="200" y1="200" x2="200" y2="50" stroke="#999" stroke-width="2"/>
                    <text x="200" y="40" text-anchor="middle" font-size="14" fill="#333">Успех</text>
                    
                    <line x1="200" y1="200" x2="350" y2="200" stroke="#999" stroke-width="2"/>
                    <text x="360" y="205" text-anchor="start" font-size="14" fill="#333">Лидерство</text>
                    
                    <line x1="200" y1="200" x2="200" y2="350" stroke="#999" stroke-width="2"/>
                    <text x="200" y="370" text-anchor="middle" font-size="14" fill="#333">Проекты</text>
                    
                    <line x1="200" y1="200" x2="50" y2="200" stroke="#999" stroke-width="2"/>
                    <text x="35" y="205" text-anchor="end" font-size="14" fill="#333">Изменения</text>
                    
                    <!-- Данные пользователя (ромб) -->
                    <polygon 
                        points="${200},${successY} ${leadershipX},${200} ${200},${projectManagementY} ${changeManagementX},${200}"
                        fill="rgba(var(--color-teal-500-rgb), 0.3)"
                        stroke="var(--color-primary)"
                        stroke-width="3"/>
                    
                    <!-- Точки на вершинах -->
                    <circle cx="200" cy="${successY}" r="5" fill="var(--color-primary)"/>
                    <circle cx="${leadershipX}" cy="200" r="5" fill="var(--color-primary)"/>
                    <circle cx="200" cy="${projectManagementY}" r="5" fill="var(--color-primary)"/>
                    <circle cx="${changeManagementX}" cy="200" r="5" fill="var(--color-primary)"/>
                </svg>
            `;
            
            container.innerHTML = svg;
        }
        
        // ========== ЭКСПЕРТНАЯ ИНТЕРПРЕТАЦИЯ PCT ОЦЕНКИ ==========
        
        function generatePCTExpertInsight(scores) {
            // Проверка на существование scores
            if (!scores || typeof scores !== 'object') {
                return {
                    overallAssessment: 'Оценка не завершена',
                    strategicContext: 'Проведите оценку всех факторов для получения интерпретации',
                    balanceAssessment: '',
                    strengths: [],
                    criticalGaps: [],
                    categoryAnalysis: {},
                    priorityActions: { critical: [], high: [], medium: [] },
                    totalScore: 0,
                    percentage: 0,
                    imbalances: []
                };
            }
            
            const totalScore = Object.values(scores).reduce((sum, score) => sum + (Number(score) || 0), 0);
            const maxScore = 120; // 4 категории × 30 баллов
            const percentage = (totalScore / maxScore) * 100;
            
            // Определяем общий уровень готовности проекта
            let overallAssessment = '';
            let strategicContext = '';
            const strengths = [];
            const criticalGaps = [];
            const categoryAnalysis = {};
            
            // Определяем конкретные баллы по категориям для фактической интерпретации
            const categoryScoresDetail = Object.entries(scores).map(([key, score]) => {
                const categoryNames = { success: 'Успех', leadership: 'Лидерство', projectManagement: 'Проекты', changeManagement: 'Изменения' };
                return `${categoryNames[key] || key}: ${Number(score) || 0}/30`;
            }).join(', ');
            
            if (percentage >= 80) {
                overallAssessment = `Ваш проект демонстрирует высокую готовность по модели PCT (${totalScore}/120, ${percentage.toFixed(0)}%). Детализация: ${categoryScoresDetail}. Все четыре измерения находятся на сильном уровне (≥25 баллов каждое), что указывает на высокую вероятность успешной реализации (по данным Prosci, проекты с PCT ≥80% имеют 85%+ вероятность успеха).`;
                strategicContext = `Проект имеет сильную основу во всех критических измерениях PCT. Это означает, что у вас есть: четкие цели и выгоды (Успех), активное спонсорство (Лидерство), организованная техническая реализация (Проекты) и структурированный подход к управлению изменениями (Изменения). Вы можете приступить к реализации с уверенностью, но важно поддерживать этот уровень на протяжении всего проекта.`;
                strengths.push(`Сильная основа во всех четырех измерениях PCT: ${categoryScoresDetail}`);
                strengths.push('Минимальные риски при реализации проекта (вероятность успеха 85%+)');
                strengths.push('Возможность быстрого старта и достижения результатов без дополнительной подготовки');
            } else if (percentage >= 60) {
                const strongCategories = Object.entries(scores).filter(([key, score]) => score >= 25).map(([key]) => {
                    const categoryNames = { success: 'Успех', leadership: 'Лидерство', projectManagement: 'Проекты', changeManagement: 'Изменения' };
                    return categoryNames[key];
                });
                const weakCategories = Object.entries(scores).filter(([key, score]) => score < 20).map(([key]) => {
                    const categoryNames = { success: 'Успех', leadership: 'Лидерство', projectManagement: 'Проекты', changeManagement: 'Изменения' };
                    return categoryNames[key];
                });
                
                overallAssessment = `Ваш проект показывает среднюю готовность по модели PCT (${totalScore}/120, ${percentage.toFixed(0)}%). Детализация: ${categoryScoresDetail}. ${strongCategories.length > 0 ? `Сильные стороны: ${strongCategories.join(', ')}.` : ''} ${weakCategories.length > 0 ? `Требуют внимания: ${weakCategories.join(', ')}.` : ''} Это создает умеренный риск неудачи (вероятность успеха 50-70% по данным Prosci).`;
                strategicContext = `Средняя готовность указывает на наличие большинства необходимых элементов, но с конкретными пробелами в ${weakCategories.length > 0 ? weakCategories.join(' и ') : 'некоторых областях'}. Рекомендуется провести целенаправленную работу в слабых областях перед полномасштабной реализацией. Фокус на улучшении слабых измерений повысит общую готовность до 80%+ и снизит риск неудачи.`;
                if (strongCategories.length > 0) {
                    strengths.push(`Хорошая основа в ${strongCategories.join(' и ')} (≥25 баллов)`);
                }
                criticalGaps.push(`Необходимо усилить ${weakCategories.length > 0 ? weakCategories.join(' и ') : 'слабые измерения'} перед запуском (текущий уровень <20 баллов)`);
            } else if (percentage >= 40) {
                const lowCategories = Object.entries(scores).filter(([key, score]) => score < 15).map(([key]) => {
                    const categoryNames = { success: 'Успех', leadership: 'Лидерство', projectManagement: 'Проекты', changeManagement: 'Изменения' };
                    return `${categoryNames[key]} (${scores[key]}/30)`;
                });
                
                overallAssessment = `Ваш проект демонстрирует низкую готовность по модели PCT (${totalScore}/120, ${percentage.toFixed(0)}%). Детализация: ${categoryScoresDetail}. ${lowCategories.length > 0 ? `Критически слабые области: ${lowCategories.join(', ')}.` : ''} Это создает высокий риск неудачи проекта (вероятность успеха 20-40% по данным Prosci).`;
                strategicContext = `Низкая готовность указывает на существенные пробелы в критических измерениях. ${lowCategories.length > 0 ? `Особенно критичны: ${lowCategories.join(', ')}.` : ''} Без устранения этих пробелов проект имеет высокий риск неудачи. Рекомендуется комплексная программа подготовки с фокусом на критически слабые области перед любыми попытками реализации.`;
                criticalGaps.push(`Существенные пробелы в ${lowCategories.length > 0 ? lowCategories.join(', ') : 'ключевых измерениях'} требуют немедленного внимания`);
                criticalGaps.push(`Высокий риск неудачи без подготовки (вероятность успеха только ${Math.round(percentage * 0.5)}%)`);
            } else {
                const allLowScores = Object.entries(scores).map(([key, score]) => {
                    const categoryNames = { success: 'Успех', leadership: 'Лидерство', projectManagement: 'Проекты', changeManagement: 'Изменения' };
                    return `${categoryNames[key]}: ${score}/30`;
                }).join(', ');
                
                overallAssessment = `Ваш проект имеет критически низкую готовность по модели PCT (${totalScore}/120, ${percentage.toFixed(0)}%). Детализация: ${allLowScores}. Все измерения находятся на критически низком уровне (<15 баллов каждое), что создает очень высокий риск провала (вероятность успеха <20% по данным Prosci).`;
                strategicContext = `Критически низкая готовность означает, что проект не готов к реализации в текущем состоянии. Все четыре измерения PCT требуют срочного развития. Любые попытки реализации без подготовки имеют очень высокий риск провала (вероятность успеха менее 20%). Необходима системная работа по развитию всех измерений PCT, начиная с наиболее критических (Лидерство и Успех, так как они блокируют остальные).`;
                criticalGaps.push(`Критические пробелы во всех измерениях: ${allLowScores}`);
                criticalGaps.push(`Очень высокий риск провала проекта без подготовки (вероятность успеха менее ${Math.round(percentage * 0.3)}%)`);
                criticalGaps.push('Требуется системная трансформация проекта перед запуском');
            }
            
            // Анализ баланса между измерениями
            const scoreValues = Object.values(scores).map(s => Number(s) || 0);
            if (scoreValues.length === 0) {
                return {
                    overallAssessment: 'Оценка не завершена',
                    strategicContext: 'Проведите оценку всех факторов для получения интерпретации',
                    balanceAssessment: '',
                    strengths: [],
                    criticalGaps: [],
                    categoryAnalysis: {},
                    priorityActions: { critical: [], high: [], medium: [] },
                    totalScore: 0,
                    percentage: 0,
                    imbalances: []
                };
            }
            const avgScore = totalScore / 4;
            const imbalances = [];
            const minCategoryScore = Math.min(...scoreValues);
            const maxCategoryScore = Math.max(...scoreValues);
            
            Object.entries(scores).forEach(([key, score]) => {
                const diff = Math.abs(score - avgScore);
                if (diff > 5) {
                    imbalances.push({ category: key, score, diff });
                }
            });
            
            let balanceAssessment = '';
            // Сбалансированность может быть сильной стороной только если общий уровень высокий (>= 60%)
            // Если все измерения низкие, но сбалансированы - это не сильная сторона, а равномерная слабость
            if (imbalances.length === 0) {
                if (percentage >= 60) {
                    balanceAssessment = `Все четыре измерения PCT находятся в хорошем балансе (разброс: ${minCategoryScore}-${maxCategoryScore} баллов), что является сильной стороной вашего проекта. Это означает, что проект развивается равномерно во всех критических направлениях.`;
                    strengths.push('Сбалансированность всех измерений PCT при высоком общем уровне готовности');
                } else if (percentage >= 40) {
                    balanceAssessment = `Все четыре измерения PCT находятся в балансе (разброс: ${minCategoryScore}-${maxCategoryScore} баллов), но общий уровень готовности средний. Это означает равномерное распределение пробелов, что упрощает планирование улучшений.`;
                    // Не добавляем в сильные стороны при среднем/низком общем уровне
                } else {
                    balanceAssessment = `Все четыре измерения PCT находятся в балансе (разброс: ${minCategoryScore}-${maxCategoryScore} баллов), но общий уровень готовности низкий. Это равномерная слабость во всех измерениях, что требует комплексного подхода к улучшению.`;
                    criticalGaps.push('Равномерно низкий уровень во всех измерениях PCT требует системного подхода');
                }
            } else if (imbalances.length <= 2) {
                const imbalanceCategories = imbalances.map(i => {
                    const categoryNames = { success: 'Успех', leadership: 'Лидерство', projectManagement: 'Проекты', changeManagement: 'Изменения' };
                    return `${categoryNames[i.category]} (${i.score}/30)`;
                }).join(', ');
                balanceAssessment = `Обнаружены дисбалансы между измерениями: ${imbalanceCategories}. Разница между максимальным и минимальным баллом составляет ${maxCategoryScore - minCategoryScore} баллов. Это указывает на неравномерное развитие проекта, где сильные измерения не могут компенсировать слабые.`;
                criticalGaps.push(`Дисбаланс между измерениями: разница ${maxCategoryScore - minCategoryScore} баллов между сильнейшим и слабейшим измерением`);
            } else {
                balanceAssessment = `Значительные дисбалансы между измерениями PCT (разброс: ${minCategoryScore}-${maxCategoryScore} баллов, разница ${maxCategoryScore - minCategoryScore} баллов). Это создает критический риск: сильные измерения не смогут компенсировать слабые, что может привести к провалу проекта.`;
                criticalGaps.push(`Критические дисбалансы между измерениями: разница ${maxCategoryScore - minCategoryScore} баллов требует немедленного выравнивания`);
            }
            
            // Детальный анализ по категориям
            const categoryNames = {
                success: 'Успех',
                leadership: 'Лидерство/Спонсорство',
                projectManagement: 'Управление проектами',
                changeManagement: 'Управление изменениями'
            };
            
            Object.entries(scores).forEach(([key, score]) => {
                const name = categoryNames[key] || key;
                const numScore = Number(score) || 0;
                let analysis = '';
                let priority = '';
                let impact = '';
                let recommendations = [];
                
                // Подсчитываем количество факторов с разными оценками для фактической интерпретации
                const categoryScores = (pctState && pctState.scores && pctState.scores[key]) ? pctState.scores[key] : {};
                const factorsCount = {
                    excellent: Object.values(categoryScores).filter(s => Number(s) === 3).length,
                    applicable: Object.values(categoryScores).filter(s => Number(s) === 2).length,
                    notApplicable: Object.values(categoryScores).filter(s => Number(s) === 1).length,
                    notRated: Object.values(categoryScores).filter(s => !s || Number(s) === 0).length
                };
                const totalFactors = (pctAssessment && pctAssessment.categories && pctAssessment.categories[key] && pctAssessment.categories[key].factors) ? pctAssessment.categories[key].factors.length : 10;
                
                if (numScore >= 25) {
                    analysis = `${name} показывает отличный уровень (${numScore}/30). ${factorsCount.excellent > 0 ? `${factorsCount.excellent} из ${totalFactors} факторов оценены как "Превосходит ожидания" (3 балла), ${factorsCount.applicable} факторов как "Применимо" (2 балла).` : `${factorsCount.applicable} из ${totalFactors} факторов оценены как "Применимо" (2 балла).`} Это сильная сторона проекта, которая обеспечивает надежную основу для успешной реализации. По данным Prosci, проекты с сильными измерениями PCT имеют значительно более высокую вероятность успеха.`;
                    priority = 'Низкий приоритет — область не требует немедленного внимания';
                    impact = `Эта область является опорой для успешной реализации проекта. Сильный уровень в ${name.toLowerCase()} означает, что ${key === 'success' ? 'цели и выгоды четко определены' : key === 'leadership' ? 'спонсорство активно и эффективно' : key === 'projectManagement' ? 'техническая реализация хорошо организована' : 'управление изменениями структурировано'}, что критически важно для достижения результатов проекта.`;
                    recommendations.push('Продолжайте поддерживать текущий уровень на протяжении всего проекта');
                    recommendations.push(`Используйте сильную позицию в ${name.toLowerCase()} как основу для усиления других измерений PCT`);
                } else if (numScore >= 20) {
                    analysis = `${name} демонстрирует приемлемый уровень (${numScore}/30). ${factorsCount.applicable > 0 ? `${factorsCount.applicable} факторов оценены как "Применимо" (2 балла), ${factorsCount.notApplicable > 0 ? `${factorsCount.notApplicable} как "Не применимо" (1 балл)` : 'остальные требуют улучшения'}.` : 'Большинство факторов требуют улучшения.'} Есть хорошая основа, но для оптимальной поддержки проекта требуется улучшение слабых факторов.`;
                    priority = 'Средний приоритет — рекомендуется улучшение в ближайшие 2-4 недели';
                    impact = `Улучшение этой области с ${numScore}/30 до 25+/30 повысит общую готовность проекта на ${Math.round((25 - numScore) / 120 * 100)}% и снизит риск неудачи. ${key === 'leadership' ? 'Особенно критично для успеха проекта: слабое спонсорство — причина №1 провалов.' : ''}`;
                    recommendations.push(`Проведите детальный анализ факторов в категории ${name} и определите приоритетные области для улучшения`);
                    recommendations.push(`Разработайте конкретный план улучшения слабых факторов с целевым показателем 25+/30`);
                    recommendations.push(`Назначьте ответственного за реализацию плана улучшения в категории ${name}`);
                } else if (numScore >= 10) {
                    analysis = `${name} показывает низкий уровень (${numScore}/30). ${factorsCount.notApplicable > 0 ? `${factorsCount.notApplicable} факторов оценены как "Не применимо" (1 балл), ${factorsCount.applicable > 0 ? `только ${factorsCount.applicable} как "Применимо" (2 балла)` : 'отсутствуют факторы с оценкой "Применимо"'}.` : 'Большинство факторов не оценены или имеют низкие оценки.'} Это область требует немедленного внимания перед запуском проекта. Низкий уровень создает значительный риск для успеха проекта.`;
                    priority = 'Высокий приоритет — требует немедленного внимания в течение 1-2 недель';
                    impact = `Низкий уровень в ${name.toLowerCase()} (${numScore}/30 вместо целевых 25+/30) создает значительные риски для проекта. ${key === 'leadership' ? 'Слабое спонсорство блокирует все остальные измерения PCT и является причиной более 50% провалов проектов.' : key === 'success' ? 'Неопределенные цели и выгоды делают невозможным эффективную коммуникацию и мотивацию сотрудников.' : key === 'changeManagement' ? 'Отсутствие управления изменениями означает, что 70% выгод проекта могут быть недостигнуты из-за непринятия изменений сотрудниками.' : 'Слабая техническая реализация создает риск срыва сроков и недостижения технических целей.'}`;
                    recommendations.push(`Срочно разработайте комплексный план улучшения факторов в категории ${name} с целевым показателем 20+/30 в течение 2-4 недель`);
                    recommendations.push(`Привлеките дополнительные ресурсы и экспертизу для категории ${name}`);
                    recommendations.push(`Рассмотрите возможность задержки запуска проекта до улучшения ${name.toLowerCase()} до уровня 20+/30`);
                } else if (numScore > 0) {
                    analysis = `${name} демонстрирует критически низкий уровень (${numScore}/30). ${factorsCount.notApplicable > 0 ? `Большинство факторов (${factorsCount.notApplicable}) оценены как "Не применимо" (1 балл)` : 'Почти все факторы имеют низкие оценки или не оценены'}. Это критическая область, требующая срочного вмешательства. Проект не может быть успешным с таким низким уровнем в этом измерении.`;
                    priority = 'КРИТИЧЕСКИЙ приоритет — требует немедленных действий в течение 1 недели';
                    impact = `Критически низкий уровень в ${name.toLowerCase()} (${numScore}/30) может привести к провалу проекта. ${key === 'leadership' ? 'Без сильного спонсора проект обречен на провал — это причина №1 неудач.' : key === 'success' ? 'Без четких целей и выгод невозможно мотивировать сотрудников и достичь результатов.' : key === 'changeManagement' ? 'Без управления изменениями сотрудники не примут изменения, и выгоды проекта не будут достигнуты.' : 'Без организованной технической реализации проект не может быть реализован.'} Необходимо срочное вмешательство.`;
                    recommendations.push(`НЕМЕДЛЕННО остановите планирование запуска проекта до улучшения ${name.toLowerCase()}`);
                    recommendations.push(`Срочно разработайте комплексный план улучшения категории ${name} с целевым показателем 15+/30 в течение 1-2 недель`);
                    recommendations.push(`Привлеките внешнюю экспертизу для категории ${name} — внутренних ресурсов может быть недостаточно`);
                } else {
                    analysis = `${name} не оценена (0/30). Все ${totalFactors} факторов в этой категории не оценены. Необходимо провести полную оценку всех факторов для получения картины готовности проекта. Без оценки невозможно судить о готовности проекта в этом измерении.`;
                    priority = 'КРИТИЧЕСКИЙ приоритет — требуется полная оценка немедленно';
                    impact = `Отсутствие оценки в ${name.toLowerCase()} не позволяет судить о готовности проекта. Это создает неопределенность и риск принятия неправильных решений. Необходимо провести оценку всех факторов перед любыми действиями по проекту.`;
                    recommendations.push(`НЕМЕДЛЕННО проведите оценку всех ${totalFactors} факторов в категории ${name}`);
                    recommendations.push(`Используйте результаты оценки для определения приоритетов улучшения в ${name.toLowerCase()}`);
                }
                
                categoryAnalysis[key] = {
                    name,
                    score: numScore,
                    analysis,
                    priority,
                    impact,
                    recommendations
                };
            });
            
            // Генерация приоритетных действий
            const priorityActions = {
                critical: [],
                high: [],
                medium: []
            };
            
            Object.values(categoryAnalysis).forEach(cat => {
                if (cat.score < 10) {
                    priorityActions.critical.push({
                        category: cat.name,
                        score: cat.score,
                        actions: cat.recommendations
                    });
                } else if (cat.score < 20) {
                    priorityActions.high.push({
                        category: cat.name,
                        score: cat.score,
                        actions: cat.recommendations
                    });
                } else if (cat.score < 25) {
                    priorityActions.medium.push({
                        category: cat.name,
                        score: cat.score,
                        actions: cat.recommendations
                    });
                }
            });
            
            return {
                overallAssessment,
                strategicContext,
                balanceAssessment,
                strengths,
                criticalGaps,
                categoryAnalysis,
                priorityActions,
                totalScore,
                percentage,
                imbalances
            };
        }
        
        // ========== ПРАКТИЧЕСКИЕ ЭКСПЕРТНЫЕ РЕКОМЕНДАЦИИ PCT ==========
        
        function generatePCTPracticalRecommendations() {
            // Проверка на существование необходимых объектов
            if (!pctAssessment || !pctAssessment.categories || !pctState || !pctState.scores) {
                return {
                    criticalActions: [],
                    practicalRecommendations: [],
                    quickWins: [],
                    crossCategoryInsights: []
                };
            }
            
            const scores = {
                success: calculateCategoryScore('success'),
                leadership: calculateCategoryScore('leadership'),
                projectManagement: calculateCategoryScore('projectManagement'),
                changeManagement: calculateCategoryScore('changeManagement')
            };
            
            // Получаем детальные оценки по каждому фактору
            const detailedScores = {};
            Object.keys(pctAssessment.categories).forEach(categoryId => {
                detailedScores[categoryId] = {};
                const categoryScores = (pctState.scores && pctState.scores[categoryId]) ? pctState.scores[categoryId] : {};
                if (pctAssessment.categories[categoryId] && pctAssessment.categories[categoryId].factors) {
                    pctAssessment.categories[categoryId].factors.forEach(factor => {
                        detailedScores[categoryId][factor.id] = categoryScores[factor.id] || 0;
                    });
                }
            });
            
            // Генерируем практические рекомендации на основе конкретных факторов
            const practicalRecommendations = [];
            const criticalActions = [];
            const quickWins = [];
            
            // Анализ категории "Успех"
            if (scores.success < 25) {
                const weakFactors = [];
                Object.entries(detailedScores.success).forEach(([factorId, score]) => {
                    if (score <= 2) {
                        const factor = pctAssessment.categories.success.factors.find(f => f.id == factorId);
                        if (factor) {
                            weakFactors.push({ id: factorId, text: factor.text, score });
                        }
                    }
                });
                
                if (weakFactors.length > 0) {
                    if (scores.success < 15) {
                        criticalActions.push({
                            category: 'Успех',
                            title: 'КРИТИЧНО: Неопределенность целей и выгод проекта',
                            description: `Проект не имеет четко определенных целей, выгод и критериев успеха (${scores.success}/30). Это фундаментальный риск, который блокирует все остальные измерения PCT. Без четких целей невозможно эффективно коммуницировать изменения и мотивировать сотрудников.`,
                            actions: [
                                'Проведите сессию по определению целей проекта с участием спонсора и ключевых стейкхолдеров (рекомендуется использовать методику SMART)',
                                'Создайте документ "Business Case" с четким обоснованием выгод для организации (финансовые, операционные, стратегические)',
                                'Определите конкретные метрики успеха для каждого уровня организации (организационный, групповой, индивидуальный)',
                                'Назначьте ответственных за каждую выгоду проекта (Benefit Owners) и установите регулярный мониторинг',
                                'Проведите оценку зависимости выгод от людей (Prosci Best Practice: 70% выгод зависят от принятия изменений сотрудниками)',
                                'Создайте единое понимание критериев успеха в спонсорской коалиции через сессию выравнивания (Sponsor Alignment Session)'
                            ],
                            timeframe: 'Немедленно (1-2 недели)',
                            priority: 'КРИТИЧЕСКИЙ'
                        });
                    } else {
                        practicalRecommendations.push({
                            category: 'Успех',
                            title: 'Улучшение определения целей и выгод',
                            weakFactors: weakFactors,
                            actions: generateSuccessRecommendations(weakFactors, scores.success),
                            timeframe: '2-4 недели'
                        });
                    }
                } else if (scores.success < 25 && scores.success >= 20) {
                    // Если нет слабых факторов (score <= 2), но общий балл 20-24, все равно даем рекомендации
                    practicalRecommendations.push({
                        category: 'Успех',
                        title: 'Оптимизация определения целей и выгод',
                        weakFactors: [],
                        actions: [
                            'Проведите аудит текущих целей и выгод проекта, убедитесь, что они четко определены и измеримы',
                            'Проверьте, что все выгоды имеют назначенных Benefit Owners и установлен мониторинг',
                            'Убедитесь, что критерии успеха четко коммуницированы всем затронутым сотрудникам',
                            'Проведите сессию выравнивания спонсорской коалиции для единого понимания критериев успеха',
                            'Оцените зависимость выгод от людей и убедитесь, что это учтено в плане управления изменениями'
                        ],
                        timeframe: '2-3 недели'
                    });
                }
            }
            
            // Анализ категории "Лидерство/Спонсорство"
            if (scores.leadership < 25) {
                const weakFactors = [];
                Object.entries(detailedScores.leadership).forEach(([factorId, score]) => {
                    if (score <= 2) {
                        const factor = pctAssessment.categories.leadership.factors.find(f => f.id == factorId);
                        if (factor) {
                            weakFactors.push({ id: factorId, text: factor.text, score });
                        }
                    }
                });
                
                if (weakFactors.length > 0) {
                    if (scores.leadership < 15) {
                        criticalActions.push({
                            category: 'Лидерство/Спонсорство',
                            title: 'КРИТИЧНО: Слабое спонсорство и лидерство',
                            description: `Отсутствие сильного спонсора или недостаточная активность спонсора (${scores.leadership}/30) создает критический риск провала проекта. По данным Prosci, слабое спонсорство — причина №1 неудач проектов изменений (более 50% провалов связаны с этим фактором).`,
                            actions: [
                                'Проведите оценку готовности спонсора (Sponsor Readiness Assessment) и определите пробелы в его активности',
                                'Организуйте встречу один-на-один со спонсором для обсуждения его роли и ожиданий (Sponsor One-on-One)',
                                'Создайте план развития спонсорства (Sponsor Development Plan) с конкретными действиями для спонсора',
                                'Проведите тренинг для спонсора по его роли в управлении изменениями (Prosci рекомендует минимум 2 часа)',
                                'Сформируйте спонсорскую коалицию из руководителей, которые влияют на затронутые группы',
                                'Установите регулярные встречи со спонсором (рекомендуется еженедельно) для обсуждения прогресса и барьеров',
                                'Создайте "Спонсорский план действий" (Sponsor Action Plan) с конкретными сообщениями и действиями для каждой группы',
                                'Обеспечьте видимое участие спонсора в коммуникациях (видео, личные встречи, письма)'
                            ],
                            timeframe: 'Немедленно (1-2 недели)',
                            priority: 'КРИТИЧЕСКИЙ'
                        });
                    } else {
                        practicalRecommendations.push({
                            category: 'Лидерство/Спонсорство',
                            title: 'Усиление спонсорства и лидерства',
                            weakFactors: weakFactors,
                            actions: generateLeadershipRecommendations(weakFactors, scores.leadership),
                            timeframe: '2-4 недели'
                        });
                    }
                } else if (scores.leadership < 25 && scores.leadership >= 20) {
                    // Если нет слабых факторов (score <= 2), но общий балл 20-24, все равно даем рекомендации
                    practicalRecommendations.push({
                        category: 'Лидерство/Спонсорство',
                        title: 'Оптимизация спонсорства и лидерства',
                        weakFactors: [],
                        actions: [
                            'Проведите аудит активности спонсора и убедитесь, что он принимает видимое участие в ключевых мероприятиях проекта',
                            'Убедитесь, что спонсорская коалиция сформирована и все участники активно поддерживают изменения',
                            'Проверьте, что спонсор имеет четкое понимание своей роли и может четко объяснить суть, причину и выгоды изменений',
                            'Установите регулярные встречи со спонсором для обсуждения прогресса и барьеров (еженедельно)',
                            'Создайте план видимого участия спонсора в коммуникациях с затронутыми группами',
                            'Обеспечьте, что спонсор публично поддерживает изменения и работает с сопротивлением'
                        ],
                        timeframe: '2-3 недели'
                    });
                }
            }
            
            // Анализ категории "Управление проектами"
            if (scores.projectManagement < 25) {
                const weakFactors = [];
                Object.entries(detailedScores.projectManagement).forEach(([factorId, score]) => {
                    if (score <= 2) {
                        const factor = pctAssessment.categories.projectManagement.factors.find(f => f.id == factorId);
                        if (factor) {
                            weakFactors.push({ id: factorId, text: factor.text, score });
                        }
                    }
                });
                
                if (weakFactors.length > 0) {
                    if (scores.projectManagement < 15) {
                        criticalActions.push({
                            category: 'Управление проектами',
                            title: 'КРИТИЧНО: Слабая организация технической реализации',
                            description: `Проект имеет критически слабую организацию технической стороны (${scores.projectManagement}/30). Отсутствие четкого плана, ресурсов или процессов создает высокий риск срыва сроков и недостижения технических целей.`,
                            actions: [
                                'Проведите детальное определение изменений: какие люди затронуты, какие процессы изменяются, какие системы затрагиваются',
                                'Назначьте опытного руководителя проекта (Project Manager) с необходимыми полномочиями и ресурсами',
                                'Определите ключевые вехи проекта и создайте детальный план-график с использованием инструментов управления проектами',
                                'Проведите декомпозицию работ (Work Breakdown Structure) и назначьте ответственных за каждую задачу',
                                'Определите и получите все необходимые проектные ресурсы, создайте матрицу ответственности (RACI)',
                                'Установите регулярные совещания проектной команды (еженедельно) с четким процессом эскалации проблем',
                                'Интегрируйте план управления изменениями в план проекта для синхронизации технической и человеческой сторон'
                            ],
                            timeframe: 'Немедленно (1-2 недели)',
                            priority: 'КРИТИЧЕСКИЙ'
                        });
                    } else {
                        practicalRecommendations.push({
                            category: 'Управление проектами',
                            title: 'Улучшение технической реализации',
                            weakFactors: weakFactors,
                            actions: generateProjectManagementRecommendations(weakFactors, scores.projectManagement),
                            timeframe: '2-4 недели'
                        });
                    }
                } else if (scores.projectManagement < 25 && scores.projectManagement >= 20) {
                    // Если нет слабых факторов (score <= 2), но общий балл 20-24, все равно даем рекомендации
                    practicalRecommendations.push({
                        category: 'Управление проектами',
                        title: 'Оптимизация технической реализации',
                        weakFactors: [],
                        actions: [
                            'Проведите аудит текущего плана проекта и убедитесь, что все вехи четко определены и синхронизированы',
                            'Убедитесь, что план управления изменениями полностью интегрирован в план проекта',
                            'Проверьте, что все ресурсы выделены и назначены ответственные за каждую задачу',
                            'Установите регулярный мониторинг прогресса с еженедельными отчетами о статусе',
                            'Проведите тренинг для руководителя проекта по управлению изменениями, если еще не проведен'
                        ],
                        timeframe: '2-3 недели'
                    });
                }
            }
            
            // Анализ категории "Управление изменениями"
            if (scores.changeManagement < 25) {
                const weakFactors = [];
                Object.entries(detailedScores.changeManagement).forEach(([factorId, score]) => {
                    if (score <= 2) {
                        const factor = pctAssessment.categories.changeManagement.factors.find(f => f.id == factorId);
                        if (factor) {
                            weakFactors.push({ id: factorId, text: factor.text, score });
                        }
                    }
                });
                
                if (weakFactors.length > 0) {
                    if (scores.changeManagement < 15) {
                        criticalActions.push({
                            category: 'Управление изменениями',
                            title: 'КРИТИЧНО: Отсутствие структурированного подхода к управлению изменениями',
                            description: `Проект не использует структурированный подход к управлению изменениями (${scores.changeManagement}/30), что создает высокий риск непринятия изменений сотрудниками и недостижения выгод проекта. По данным Prosci, 70% выгод проекта зависят от принятия изменений сотрудниками, поэтому отсутствие управления изменениями критично.`,
                            actions: [
                                'Примените структурированную методологию управления изменениями (Prosci ADKAR, Kotter, или другую проверенную методологию)',
                                'Проведите оценку параметров изменений (Scope, Speed, Scale) и их влияния на сотрудников',
                                'Выполните оценку риска проекта изменений (Change Risk Assessment) для определения приоритетов',
                                'Определите конкретные показатели принятия и использования (Adoption Metrics) для каждой группы',
                                'Проведите оценку состава спонсорской коалиции (Sponsor Coalition Assessment)',
                                'Разработайте стратегию управления изменениями (Change Management Strategy) с учетом специфики проекта',
                                'Выделите ресурсы для управления изменениями (Change Management Resources) — минимум 1 FTE на 100 затронутых сотрудников',
                                'Создайте интегрированный план проекта (Integrated Project Plan), объединяющий технический план и план управления изменениями'
                            ],
                            timeframe: 'Немедленно (1-2 недели)',
                            priority: 'КРИТИЧЕСКИЙ'
                        });
                    } else {
                        practicalRecommendations.push({
                            category: 'Управление изменениями',
                            title: 'Развитие практик управления изменениями',
                            weakFactors: weakFactors,
                            actions: generateChangeManagementRecommendations(weakFactors, scores.changeManagement),
                            timeframe: '2-4 недели'
                        });
                    }
                } else if (scores.changeManagement < 25 && scores.changeManagement >= 20) {
                    // Если нет слабых факторов (score <= 2), но общий балл 20-24, все равно даем рекомендации
                    practicalRecommendations.push({
                        category: 'Управление изменениями',
                        title: 'Оптимизация практик управления изменениями',
                        weakFactors: [],
                        actions: [
                            'Проведите аудит текущей стратегии управления изменениями и убедитесь, что она соответствует масштабу и сложности проекта',
                            'Проверьте, что все планы управления изменениями (коммуникации, обучение, коучинг) интегрированы в план проекта',
                            'Убедитесь, что выделены достаточные ресурсы для управления изменениями (минимум 1 FTE на 100 затронутых сотрудников)',
                            'Установите процесс регулярного измерения эффективности управления изменениями и корректировки подхода',
                            'Проверьте, что определены конкретные показатели принятия и использования для каждой группы',
                            'Оцените готовность организации к принятию ответственности за изменения после завершения проекта'
                        ],
                        timeframe: '2-3 недели'
                    });
                }
            }
            
            // Анализ взаимосвязей между категориями
            const crossCategoryInsights = analyzePCTInterdependencies(scores, detailedScores);
            
            // Генерация Quick Wins (быстрых побед)
            quickWins.push(...generateQuickWins(detailedScores, scores));
            
            return {
                criticalActions,
                practicalRecommendations,
                quickWins,
                crossCategoryInsights
            };
        }
        
        // Генерация рекомендаций для категории "Успех"
        function generateSuccessRecommendations(weakFactors, totalScore) {
            const actions = [];
            
            weakFactors.forEach(factor => {
                switch(factor.id) {
                    case 1:
                        actions.push('Проведите сессию по сбору входных данных проекта: бизнес-кейс, устав проекта, объем работ, план проекта. Создайте единый документ "Project Charter" с этими данными.');
                        break;
                    case 2:
                        actions.push('Проведите воркшоп по определению выгод организации. Используйте методику "Benefit Mapping": определите выгоды на трех уровнях (организационный, групповой, индивидуальный) и свяжите их с бизнес-целями.');
                        break;
                    case 3:
                        actions.push('Определите цели проекта по методологии SMART (Specific, Measurable, Achievable, Relevant, Time-bound). Убедитесь, что цели измеримы и имеют конкретные сроки.');
                        break;
                    case 4:
                        actions.push('Определите целевые показатели принятия и использования для каждой группы сотрудников. Например: "90% сотрудников используют новую систему к концу 3-го месяца" или "85% сотрудников прошли обучение в течение 2 месяцев".');
                        break;
                    case 5:
                        actions.push('Установите единицы измерения для каждой цели и выгоды. Используйте количественные метрики (проценты, количество, время) и качественные индикаторы (опросы, интервью).');
                        break;
                    case 6:
                        actions.push('Проведите приоритизацию выгод и целей с использованием матрицы важность/сложность. Сфокусируйтесь на выгодах с высокой важностью и средней/низкой сложностью достижения.');
                        break;
                    case 7:
                        actions.push('Назначьте Benefit Owners (владельцев выгод) для каждой выгоды проекта. Это должны быть руководители, которые несут ответственность за достижение выгоды в своей области.');
                        break;
                    case 8:
                        actions.push('Проведите оценку зависимости выгод от людей. Используйте шкалу от 0% (выгода не зависит от людей) до 100% (выгода полностью зависит от принятия изменений сотрудниками).');
                        break;
                    case 9:
                        actions.push('Определите критерии успеха проекта и создайте документ "Success Criteria", который можно коммуницировать сотрудникам. Критерии должны быть понятными и измеримыми.');
                        break;
                    case 10:
                        actions.push('Проведите сессию выравнивания спонсорской коалиции (Sponsor Alignment Session). Убедитесь, что все спонсоры имеют единое понимание критериев успеха и могут их четко объяснить.');
                        break;
                }
            });
            
            return actions;
        }
        
        // Генерация рекомендаций для категории "Лидерство/Спонсорство"
        function generateLeadershipRecommendations(weakFactors, totalScore) {
            const actions = [];
            
            weakFactors.forEach(factor => {
                switch(factor.id) {
                    case 1:
                        actions.push('Определите основного спонсора проекта. Спонсор должен иметь власть над людьми, процессами и системами, затронутыми изменениями. Если такого спонсора нет, это критический риск проекта.');
                        break;
                    case 2:
                        actions.push('Проведите тренинг для спонсора по формулированию "Что меняется, почему меняется, что в этом для меня" (What-Why-WIIFM). Спонсор должен уметь четко объяснить суть, причину и выгоды изменений.');
                        break;
                    case 3:
                        actions.push('Проведите сессию по определению видения и стратегии организации. Если видение не определено, создайте видение для проекта изменений, которое будет направлять все решения.');
                        break;
                    case 4:
                        actions.push('Проведите анализ согласованности изменений со стратегией организации. Если изменений нет согласованности, пересмотрите либо изменения, либо стратегию.');
                        break;
                    case 5:
                        actions.push('Определите приоритетность проекта относительно других инициатив. Создайте матрицу приоритетов и коммуницируйте ее всем заинтересованным лицам через спонсора.');
                        break;
                    case 6:
                        actions.push('Установите процесс эскалации для спонсора. Спонсор должен быть доступен для решения проблем по графику, объему и ресурсам проекта в течение 24-48 часов.');
                        break;
                    case 7:
                        actions.push('Создайте план видимого участия спонсора (Sponsor Visibility Plan). Спонсор должен участвовать в ключевых мероприятиях проекта: запуск, важные вехи, завершение.');
                        break;
                    case 8:
                        actions.push('Проведите оценку спонсорской коалиции. Определите, какие руководители должны быть в коалиции, и проведите сессию по их вовлечению в поддержку изменений.');
                        break;
                    case 9:
                        actions.push('Создайте план прямого общения спонсора с сотрудниками (Sponsor Communication Plan). Спонсор должен общаться с затронутыми группами напрямую, не через посредников.');
                        break;
                    case 10:
                        actions.push('Разработайте план работы спонсора с сопротивлением и празднования успехов. Спонсор должен публично поддерживать изменения и работать с теми, кто сопротивляется.');
                        break;
                }
            });
            
            return actions;
        }
        
        // Генерация рекомендаций для категории "Управление проектами"
        function generateProjectManagementRecommendations(weakFactors, totalScore) {
            const actions = [];
            
            weakFactors.forEach(factor => {
                switch(factor.id) {
                    case 1:
                        actions.push('Проведите детальное определение изменений. Определите, какие люди затронуты изменениями, какие процессы изменяются, какие системы затрагиваются. Создайте документ "Change Definition".');
                        break;
                    case 2:
                        actions.push('Определите конкретные цели проекта по методологии SMART. Убедитесь, что цели измеримы и имеют конкретные сроки достижения.');
                        break;
                    case 3:
                        actions.push('Проведите сессию по определению объема проекта (Scope). Определите функциональный объем (что будет делать система/процесс) и организационный объем (какие группы затронуты).');
                        break;
                    case 4:
                        actions.push('Назначьте руководителя проекта (Project Manager), который будет управлять жизненным циклом проекта от начала до завершения. Убедитесь, что у PM есть необходимые полномочия и ресурсы.');
                        break;
                    case 5:
                        actions.push('Определите ключевые вехи проекта и создайте план-график (Project Schedule). Используйте инструменты управления проектами (MS Project, Jira, или аналогичные).');
                        break;
                    case 6:
                        actions.push('Проведите декомпозицию работ (Work Breakdown Structure) и определите требуемые результаты для каждой задачи. Назначьте ответственных за каждую задачу.');
                        break;
                    case 7:
                        actions.push('Определите и получите проектные ресурсы. Создайте матрицу ответственности (RACI) для распределения ресурсов по задачам проекта.');
                        break;
                    case 8:
                        actions.push('Установите регулярные совещания проектной команды (рекомендуется еженедельно). Создайте шаблон отчета о статусе проекта и процесс эскалации проблем.');
                        break;
                    case 9:
                        actions.push('Проведите тренинг для руководителя проекта по управлению изменениями. PM должен понимать, что техническая реализация — это только часть успеха, важна также человеческая сторона.');
                        break;
                    case 10:
                        actions.push('Интегрируйте план управления изменениями в план проекта. Создайте единый интегрированный план, где технические задачи и задачи управления изменениями синхронизированы.');
                        break;
                }
            });
            
            return actions;
        }
        
        // Генерация рекомендаций для категории "Управление изменениями"
        function generateChangeManagementRecommendations(weakFactors, totalScore) {
            const actions = [];
            
            weakFactors.forEach(factor => {
                switch(factor.id) {
                    case 1:
                        actions.push('Примените структурированную методологию управления изменениями (Prosci ADKAR, Kotter 8 Steps, или другую проверенную методологию). Не импровизируйте — используйте проверенные практики.');
                        break;
                    case 2:
                        actions.push('Проведите оценку параметров изменений: Scope (объем), Speed (скорость), Scale (масштаб). Определите, сколько людей затронуто, как быстро происходят изменения, насколько они значимы.');
                        break;
                    case 3:
                        actions.push('Выполните оценку риска проекта изменений (Change Risk Assessment). Оцените факторы риска: размер изменений, история изменений в организации, культура, готовность к изменениям.');
                        break;
                    case 4:
                        actions.push('Определите конкретные показатели принятия и использования для каждой группы. Используйте метрики: процент сотрудников, использующих новое решение, частота использования, качество использования.');
                        break;
                    case 5:
                        actions.push('Проведите оценку состава спонсорской коалиции. Определите, какие руководители должны быть в коалиции, оцените их готовность и активность в поддержке изменений.');
                        break;
                    case 6:
                        actions.push('Разработайте стратегию управления изменениями (Change Management Strategy). Выберите подход: самообслуживание, коучинг, обучение, или комбинированный, в зависимости от масштаба и сложности.');
                        break;
                    case 7:
                        actions.push('Выделите ресурсы для управления изменениями. Рекомендация Prosci: минимум 1 FTE (Full-Time Equivalent) на 100 затронутых сотрудников для проектов среднего/высокого риска.');
                        break;
                    case 8:
                        actions.push('Разработайте планы управления изменениями: план коммуникаций, план обучения, план коучинга менеджеров, план работы с сопротивлением. Интегрируйте их в план проекта.');
                        break;
                    case 9:
                        actions.push('Установите процесс измерения эффективности управления изменениями. Регулярно отслеживайте показатели принятия и использования, проводите опросы, собирайте обратную связь и корректируйте подход.');
                        break;
                    case 10:
                        actions.push('Проведите оценку готовности организации к принятию ответственности за изменения. Определите, кто будет поддерживать изменения после завершения проекта, и создайте план передачи ответственности.');
                        break;
                }
            });
            
            return actions;
        }
        
        // Анализ взаимосвязей между категориями PCT
        function analyzePCTInterdependencies(scores, detailedScores) {
            const insights = [];
            
            // Если слабое лидерство, это влияет на все остальное
            if (scores.leadership < 20 && (scores.success < 20 || scores.projectManagement < 20 || scores.changeManagement < 20)) {
                insights.push({
                    type: 'critical_interdependency',
                    title: 'Критическая взаимосвязь: Слабое лидерство блокирует другие измерения',
                    description: 'Слабое лидерство/спонсорство создает каскадный эффект на все остальные измерения PCT. Без сильного спонсора невозможно эффективно определить цели (Успех), обеспечить ресурсы для проекта (Проекты) и получить поддержку сотрудников (Изменения).',
                    recommendation: 'Приоритет #1: Усиление спонсорства. Все остальные действия будут неэффективны без сильного спонсора. Начните с работы со спонсором, затем переходите к другим измерениям.',
                    actions: [
                        'Проведите срочную встречу со спонсором для обсуждения его роли',
                        'Создайте план развития спонсорства с конкретными действиями',
                        'Обеспечьте видимое участие спонсора в проекте',
                        'Только после улучшения спонсорства переходите к усилению других измерений'
                    ]
                });
            }
            
            // Если слабый "Успех", это влияет на мотивацию и принятие
            if (scores.success < 20 && scores.changeManagement < 20) {
                insights.push({
                    type: 'interdependency',
                    title: 'Взаимосвязь: Неопределенные цели затрудняют управление изменениями',
                    description: 'Если цели и выгоды проекта не определены четко, невозможно эффективно коммуницировать изменения сотрудникам и мотивировать их к принятию. Сотрудники не понимают, зачем нужны изменения.',
                    recommendation: 'Сначала определите четкие цели и выгоды (Успех), затем разработайте коммуникационную стратегию для их донесения (Изменения).',
                    actions: [
                        'Проведите сессию по определению целей и выгод проекта',
                        'Создайте документ "Business Case" с четким обоснованием',
                        'Разработайте ключевые сообщения для коммуникаций на основе определенных выгод',
                        'Используйте выгоды как основу для мотивации сотрудников к принятию изменений'
                    ]
                });
            }
            
            // Если слабое управление проектами, это влияет на реализацию изменений
            if (scores.projectManagement < 20 && scores.changeManagement < 20) {
                insights.push({
                    type: 'interdependency',
                    title: 'Взаимосвязь: Техническая и человеческая стороны должны быть синхронизированы',
                    description: 'Управление проектами (техническая сторона) и управление изменениями (человеческая сторона) должны работать синхронно. Если техническая реализация не организована, невозможно эффективно управлять изменениями.',
                    recommendation: 'Интегрируйте план управления изменениями в план проекта. Создайте единый интегрированный план с синхронизированными вехами.',
                    actions: [
                        'Создайте интегрированный план проекта, объединяющий технические задачи и задачи управления изменениями',
                        'Синхронизируйте вехи технической реализации с вехами управления изменениями',
                        'Установите регулярные совещания проектной команды с участием специалиста по управлению изменениями',
                        'Обеспечьте, чтобы руководитель проекта понимал важность управления изменениями'
                    ]
                });
            }
            
            return insights;
        }
        
        // Генерация Quick Wins (быстрых побед)
        function generateQuickWins(detailedScores, scores) {
            const quickWins = [];
            
            // Quick Win 1: Если есть спонсор, но он не активен
            if (detailedScores.leadership[1] >= 2 && detailedScores.leadership[7] <= 2) {
                quickWins.push({
                    title: 'Быстрая победа: Увеличьте видимое участие спонсора',
                    description: 'У вас есть спонсор с необходимой властью, но он недостаточно активен. Это можно исправить быстро.',
                    action: 'Проведите встречу со спонсором и попросите его записать короткое видео (2-3 минуты) о важности изменений для организации. Опубликуйте видео для всех затронутых сотрудников.',
                    impact: 'Высокий',
                    effort: 'Низкий',
                    timeframe: '1 неделя'
                });
            }
            
            // Quick Win 2: Если цели определены, но не коммуницированы
            if (detailedScores.success[3] >= 2 && detailedScores.success[9] <= 2) {
                quickWins.push({
                    title: 'Быстрая победа: Коммуницируйте критерии успеха сотрудникам',
                    description: 'Критерии успеха определены, но не доведены до сотрудников. Это можно исправить быстро.',
                    action: 'Создайте простой одностраничный документ с критериями успеха проекта в понятном для сотрудников формате. Распространите его через все доступные каналы коммуникации.',
                    impact: 'Средний',
                    effort: 'Низкий',
                    timeframe: '3-5 дней'
                });
            }
            
            // Quick Win 3: Если есть план проекта, но нет интеграции с управлением изменениями
            if (detailedScores.projectManagement[5] >= 2 && detailedScores.projectManagement[10] <= 2) {
                quickWins.push({
                    title: 'Быстрая победа: Интегрируйте план управления изменениями в план проекта',
                    description: 'У вас есть план проекта, но он не интегрирован с планом управления изменениями. Это можно исправить относительно быстро.',
                    action: 'Добавьте задачи управления изменениями в существующий план проекта. Синхронизируйте вехи технической реализации с вехами управления изменениями (коммуникации, обучение, поддержка).',
                    impact: 'Высокий',
                    effort: 'Средний',
                    timeframe: '1-2 недели'
                });
            }
            
            return quickWins;
        }
        
        function generatePCTRecommendations() {
            const container = document.getElementById('pctRecommendations');
            if (!container) return;
            
            const scores = {
                success: calculateCategoryScore('success'),
                leadership: calculateCategoryScore('leadership'),
                projectManagement: calculateCategoryScore('projectManagement'),
                changeManagement: calculateCategoryScore('changeManagement')
            };
            
            // Проверяем, есть ли хотя бы одна оценка
            const hasAnyScore = Object.values(scores).some(score => score > 0);
            
            if (!hasAnyScore) {
                container.innerHTML = '<p>Начните оценку факторов, чтобы получить рекомендации.</p>';
                return;
            }
            
            // Генерируем экспертную интерпретацию
            const expertInsight = generatePCTExpertInsight(scores);
            
            // Генерируем практические рекомендации
            const practicalRecs = generatePCTPracticalRecommendations();
            
            // Формируем HTML с практическими рекомендациями
            let html = `
                <div class="pct-expert-insight">
                    <h4>Экспертная интерпретация результатов PCT</h4>
                    <div class="expert-overall-analysis">
                        <p class="expert-interpretation"><strong>${expertInsight.overallAssessment}</strong></p>
                        <p class="expert-context">${expertInsight.strategicContext}</p>
                        <p class="expert-balance">${expertInsight.balanceAssessment}</p>
                    </div>
                    
                    ${expertInsight.strengths.length > 0 ? `
                    <div class="expert-strengths">
                        <h5>Сильные стороны вашего проекта:</h5>
                        <ul>${expertInsight.strengths.map(s => `<li>${s}</li>`).join('')}</ul>
                    </div>
                    ` : ''}
                    
                    ${expertInsight.criticalGaps.length > 0 ? `
                    <div class="expert-critical-gaps">
                        <h5>Критические пробелы, требующие внимания:</h5>
                        <ul>${expertInsight.criticalGaps.map(g => `<li>${g}</li>`).join('')}</ul>
                    </div>
                    ` : ''}
                </div>
                
                ${practicalRecs.criticalActions.length > 0 ? `
                <div class="pct-critical-actions">
                    <h4>🚨 Критические действия (требуют немедленного внимания)</h4>
                    ${practicalRecs.criticalActions.map(action => `
                        <div class="critical-action-card">
                            <div class="action-header">
                                <h5>${action.title}</h5>
                                <span class="action-priority">${action.priority}</span>
                            </div>
                            <p class="action-description">${action.description}</p>
                            <div class="action-timeframe"><strong>Срок:</strong> ${action.timeframe}</div>
                            <div class="action-steps">
                                <h6>Практические шаги:</h6>
                                <ol>
                                    ${action.actions.map(step => `<li>${step}</li>`).join('')}
                                </ol>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${practicalRecs.practicalRecommendations.length > 0 ? `
                <div class="pct-practical-recommendations">
                    <h4>💡 Практические рекомендации по улучшению</h4>
                    ${practicalRecs.practicalRecommendations.map(rec => `
                        <div class="practical-recommendation-card">
                            <h5>${rec.category}: ${rec.title}</h5>
                            <div class="recommendation-timeframe"><strong>Рекомендуемый срок:</strong> ${rec.timeframe}</div>
                            <div class="recommendation-actions">
                                <h6>Конкретные действия:</h6>
                                <ul>
                                    ${rec.actions.map(action => `<li>${action}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${practicalRecs.quickWins.length > 0 ? `
                <div class="pct-quick-wins">
                    <h4>⚡ Быстрые победы (Quick Wins)</h4>
                    <p class="quick-wins-intro">Эти действия можно реализовать быстро и получить заметный эффект:</p>
                    ${practicalRecs.quickWins.map(win => `
                        <div class="quick-win-card">
                            <h5>${win.title}</h5>
                            <p>${win.description}</p>
                            <div class="quick-win-details">
                                <div><strong>Действие:</strong> ${win.action}</div>
                                <div><strong>Влияние:</strong> ${win.impact} | <strong>Усилия:</strong> ${win.effort} | <strong>Срок:</strong> ${win.timeframe}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                ${practicalRecs.crossCategoryInsights.length > 0 ? `
                <div class="pct-interdependencies">
                    <h4>🔗 Взаимосвязи между измерениями PCT</h4>
                    ${practicalRecs.crossCategoryInsights.map(insight => `
                        <div class="interdependency-card">
                            <h5>${insight.title}</h5>
                            <p>${insight.description}</p>
                            <p class="interdependency-recommendation"><strong>Рекомендация:</strong> ${insight.recommendation}</p>
                            <div class="interdependency-actions">
                                <h6>Действия:</h6>
                                <ul>
                                    ${insight.actions.map(action => `<li>${action}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
            `;
            
            container.innerHTML = html;
        }
        
        function setupPCTEventListeners() {
            // Табы для переключения категорий
            const tabs = document.querySelectorAll('.pct-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    // Используем общую функцию для переключения категории
                    switchPCTCategory(category);
                });
            });
            
            // Кнопка сброса
            const resetBtn = document.getElementById('pctReset');
            if (resetBtn) {
                resetBtn.addEventListener('click', function() {
                    if (confirm('Вы уверены, что хотите сбросить все оценки? Это действие нельзя отменить.')) {
                        pctState.scores = {
                            success: {},
                            leadership: {},
                            projectManagement: {},
                            changeManagement: {}
                        };
                        savePCTScores();
                        renderPCTCategory(pctState.currentCategory);
                        updatePCTProgress();
                        updatePCTResults();
                    }
                });
            }
            
            // Кнопка плана действий
            const actionPlanBtn = document.getElementById('pctActionPlan');
            if (actionPlanBtn) {
                actionPlanBtn.addEventListener('click', function() {
                    // Проверяем, что оценка завершена
                    const totalFactors = 40;
                    const completedFactors = Object.values(pctState.scores).reduce((total, category) =>
                        total + Object.keys(category).length, 0);

                    if (completedFactors < totalFactors) {
                        alert(`Для генерации плана действий необходимо оценить все ${totalFactors} факторов. Сейчас оценено: ${completedFactors}`);
                        return;
                    }

                    showActionPlanModal();
                });
            }

            // Кнопка экспорта в PDF
            const exportBtn = document.getElementById('pctExportPdf');
            if (exportBtn) {
                exportBtn.addEventListener('click', exportPCTToPDF);
            }
        }
        
        function exportPCTToPDF() {
            console.log('Экспорт PCT в PDF...');
            
            // Создаем отчетную страницу
            const scores = {
                success: calculateCategoryScore('success'),
                leadership: calculateCategoryScore('leadership'),
                projectManagement: calculateCategoryScore('projectManagement'),
                changeManagement: calculateCategoryScore('changeManagement')
            };
            
            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Отчёт PCT - ${new Date().toLocaleDateString('ru-RU')}</title>
                    <style>
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
                            line-height: 1.6;
                            padding: 40px;
                            max-width: 900px;
                            margin: 0 auto;
                        }
                        h1 { color: #2DB67D; border-bottom: 3px solid #2DB67D; padding-bottom: 10px; }
                        h2 { color: #333; margin-top: 30px; }
                        .meta { color: #666; margin-bottom: 30px; }
                        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
                        th, td { padding: 12px; text-align: left; border: 1px solid #ddd; }
                        th { background: #f5f5f5; font-weight: 600; }
                        .excellent { background: rgba(45, 182, 125, 0.1); }
                        .moderate { background: rgba(244, 161, 0, 0.1); }
                        .risk { background: rgba(224, 30, 90, 0.1); }
                        .recommendations { background: #f9f9f9; padding: 20px; border-left: 4px solid #2DB67D; margin: 20px 0; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>Отчёт оценки Prosci Change Triangle (PCT)</h1>
                    <div class="meta">
                        <p><strong>Дата оценки:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                        <p><strong>Время:</strong> ${new Date().toLocaleTimeString('ru-RU')}</p>
                    </div>
                    
                    <h2>Результаты по категориям</h2>
                    <table>
                        <thead>
                            <tr>
                                <th>Категория</th>
                                <th>Баллы</th>
                                <th>Максимум</th>
                                <th>Оценка</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="${scores.success >= 25 ? 'excellent' : scores.success >= 20 ? 'moderate' : 'risk'}">
                                <td>🎯 Успех</td>
                                <td>${scores.success}</td>
                                <td>30</td>
                                <td>${scores.success >= 25 ? 'Сильная сторона' : scores.success >= 20 ? 'Есть риски' : 'Высокий риск'}</td>
                            </tr>
                            <tr class="${scores.leadership >= 25 ? 'excellent' : scores.leadership >= 20 ? 'moderate' : 'risk'}">
                                <td>👑 Лидерство/Спонсорство</td>
                                <td>${scores.leadership}</td>
                                <td>30</td>
                                <td>${scores.leadership >= 25 ? 'Сильная сторона' : scores.leadership >= 20 ? 'Есть риски' : 'Высокий риск'}</td>
                            </tr>
                            <tr class="${scores.projectManagement >= 25 ? 'excellent' : scores.projectManagement >= 20 ? 'moderate' : 'risk'}">
                                <td>📊 Управление проектами</td>
                                <td>${scores.projectManagement}</td>
                                <td>30</td>
                                <td>${scores.projectManagement >= 25 ? 'Сильная сторона' : scores.projectManagement >= 20 ? 'Есть риски' : 'Высокий риск'}</td>
                            </tr>
                            <tr class="${scores.changeManagement >= 25 ? 'excellent' : scores.changeManagement >= 20 ? 'moderate' : 'risk'}">
                                <td>🔄 Управление изменениями</td>
                                <td>${scores.changeManagement}</td>
                                <td>30</td>
                                <td>${scores.changeManagement >= 25 ? 'Сильная сторона' : scores.changeManagement >= 20 ? 'Есть риски' : 'Высокий риск'}</td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div class="recommendations">
                        <h2>Рекомендации</h2>
                        ${document.getElementById('pctRecommendations').innerHTML}
                    </div>
                    
                    <div class="footer">
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                        <p>Треугольник изменений Prosci (PCT) © Prosci</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();
            
            // Даем время для загрузки стилей, затем печатаем
            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }
        
        function buildSearchIndex() {
            searchIndex.length = 0;
            slidesData.forEach((slide, index) => {
                const title = slide.title || '';
                const subtitle = slide.subtitle || '';
                const contentText = stripHTML(slide.content || '');
                searchIndex.push({
                    index,
                title,
                    subtitle,
                    content: contentText,
                    titleLower: title.toLowerCase(),
                    subtitleLower: subtitle.toLowerCase(),
                    contentLower: contentText.toLowerCase()
                });
            });
        }
        
        function handleSearchInput(event) {
            const query = (event.target.value || '').trim().toLowerCase();
            if (!query) {
                searchResults = [];
                searchTerms = [];
                currentSearchTerm = '';
                activeSearchResultIndex = -1;
                renderSearchResults();
                clearSearchHighlight();
                return;
            }
            
            searchTerms = query.split(/\s+/).filter(Boolean);
            currentSearchTerm = query;
            const results = [];
            
            searchIndex.forEach((entry) => {
                let score = 0;
                searchTerms.forEach((term) => {
                    if (entry.titleLower.includes(term)) score += 6;
                    if (entry.subtitleLower.includes(term)) score += 4;
                    if (entry.contentLower.includes(term)) score += 1;
                });
                if (score > 0) {
                    results.push({
                        index: entry.index,
                        title: entry.title,
                        snippet: createSnippet(entry.content, searchTerms),
                        score
                    });
                }
            });
            
            results.sort((a, b) => b.score - a.score);
            searchResults = results.slice(0, 8);
            activeSearchResultIndex = searchResults.length ? 0 : -1;
            renderSearchResults();
        }
        
        function renderSearchResults() {
            if (!searchResultsEl) return;
            searchResultsEl.innerHTML = '';
            
            if (!searchResults.length) {
                searchResultsEl.classList.remove('active');
                return;
            }
            
            searchResultsEl.classList.add('active');
            searchResults.forEach((result, index) => {
                const item = document.createElement('li');
                item.className = 'search-result-item';
                item.dataset.slide = String(result.index);
                if (index === activeSearchResultIndex) {
                    item.classList.add('active');
                }
                item.innerHTML = `<strong>${result.index + 1}. ${result.title}</strong><span>${result.snippet}</span>`;
                item.addEventListener('mousedown', (event) => {
                    event.preventDefault();
                    selectSearchResult(index);
                });
                searchResultsEl.appendChild(item);
            });
        }
        
        function closeSearchResults() {
            if (!searchResultsEl) return;
            searchResultsEl.classList.remove('active');
            searchResultsEl.innerHTML = '';
            activeSearchResultIndex = -1;
        }
        
        function selectSearchResult(index) {
            if (index < 0 || index >= searchResults.length) return;
            const result = searchResults[index];
            const query = searchInputEl ? searchInputEl.value.trim() : '';
            if (query) {
                currentSearchTerm = query.toLowerCase();
                searchTerms = currentSearchTerm.split(/\s+/).filter(Boolean);
            } else {
                currentSearchTerm = result.title.toLowerCase();
                searchTerms = currentSearchTerm.split(/\s+/).filter(Boolean);
                if (searchInputEl) {
                    searchInputEl.value = result.title;
                }
            }
            closeSearchResults();
            if (searchInputEl) {
                searchInputEl.blur();
            }
            jumpToSlide(result.index);
        }
        
        function handleSearchKeyDown(event) {
            if (event.key === 'ArrowDown') {
                event.preventDefault();
                if (!searchResults.length) return;
                activeSearchResultIndex = (activeSearchResultIndex + 1) % searchResults.length;
                renderSearchResults();
            } else if (event.key === 'ArrowUp') {
                event.preventDefault();
                if (!searchResults.length) return;
                activeSearchResultIndex = (activeSearchResultIndex - 1 + searchResults.length) % searchResults.length;
                renderSearchResults();
            } else if (event.key === 'Enter') {
                if (activeSearchResultIndex >= 0) {
                    event.preventDefault();
                    selectSearchResult(activeSearchResultIndex);
                }
            } else if (event.key === 'Escape') {
                event.preventDefault();
                clearSearch();
                if (searchInputEl) {
                    searchInputEl.blur();
                }
            }
        }
        
        function clearSearch() {
            if (searchInputEl) {
                searchInputEl.value = '';
            }
            searchResults = [];
            searchTerms = [];
            currentSearchTerm = '';
            activeSearchResultIndex = -1;
            closeSearchResults();
            clearSearchHighlight();
        }
        
        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        function createSnippet(text, terms) {
            const lowerText = text.toLowerCase();
            let firstMatchIndex = -1;
            let matchedTerm = '';
            for (const term of terms) {
                const index = lowerText.indexOf(term);
                if (index !== -1) {
                    if (firstMatchIndex === -1 || index < firstMatchIndex) {
                        firstMatchIndex = index;
                        matchedTerm = term;
                    }
                }
            }
            if (firstMatchIndex === -1) {
                return text.length > 80 ? `${text.slice(0, 80)}…` : text;
            }
            const start = Math.max(0, firstMatchIndex - 30);
            const end = Math.min(text.length, firstMatchIndex + matchedTerm.length + 30);
            let snippet = text.slice(start, end);
            if (start > 0) snippet = `…${snippet}`;
            if (end < text.length) snippet += '…';
            const regex = new RegExp(`(${terms.map(escapeRegExp).join('|')})`, 'gi');
            return snippet.replace(regex, '<mark class="search-highlight">$1</mark>');
        }
        
        function clearSearchHighlight() {
            const activeSlide = document.querySelector('.slide.active');
            if (!activeSlide) return;
            const highlights = activeSlide.querySelectorAll('.search-highlight');
            highlights.forEach((highlight) => {
                const textNode = document.createTextNode(highlight.textContent || '');
                const parent = highlight.parentNode;
                if (!parent) return;
                parent.replaceChild(textNode, highlight);
                parent.normalize();
            });
        }
        
        function applySearchHighlight() {
            if (!currentSearchTerm || !searchTerms.length) return;
            const activeSlide = document.querySelector('.slide.active');
            if (!activeSlide) return;
            const regex = new RegExp(`(${searchTerms.map(escapeRegExp).join('|')})`, 'gi');
            const walker = document.createTreeWalker(activeSlide, NodeFilter.SHOW_TEXT, {
                acceptNode(node) {
                    if (!node.parentElement) return NodeFilter.FILTER_REJECT;
                    if (node.parentElement.closest('.search-highlight')) return NodeFilter.FILTER_REJECT;
                    if (!node.textContent.trim()) return NodeFilter.FILTER_SKIP;
                    return regex.test(node.textContent) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;
                }
            });
            
            const nodesToHighlight = [];
            let currentNode;
            while ((currentNode = walker.nextNode())) {
                nodesToHighlight.push(currentNode);
                regex.lastIndex = 0;
            }
            
            nodesToHighlight.forEach((node) => {
                const text = node.textContent;
                if (!text) return;
                regex.lastIndex = 0;
                const fragment = document.createDocumentFragment();
                let lastIndex = 0;
                let match;
                while ((match = regex.exec(text)) !== null) {
                    if (match.index > lastIndex) {
                        fragment.appendChild(document.createTextNode(text.slice(lastIndex, match.index)));
                    }
                    const mark = document.createElement('span');
                    mark.className = 'search-highlight';
                    mark.textContent = text.slice(match.index, regex.lastIndex);
                    fragment.appendChild(mark);
                    lastIndex = regex.lastIndex;
                }
                if (lastIndex < text.length) {
                    fragment.appendChild(document.createTextNode(text.slice(lastIndex)));
                }
                node.parentNode.replaceChild(fragment, node);
            });
        }
        
        if (bookmarkToggleBtn) {
            bookmarkToggleBtn.addEventListener('click', toggleBookmark);
        }
        if (bookmarkPanelToggleBtn) {
            bookmarkPanelToggleBtn.addEventListener('click', () => toggleBookmarkPanel());
        }
        if (bookmarkPanelCloseBtn) {
            bookmarkPanelCloseBtn.addEventListener('click', () => toggleBookmarkPanel(false));
        }
        if (bookmarkListEl) {
            bookmarkListEl.addEventListener('click', (event) => {
                const removeButton = event.target.closest('[data-remove]');
                if (removeButton) {
                    event.stopPropagation();
                    const slideIndex = Number(removeButton.dataset.remove);
                    bookmarks.delete(slideIndex);
                    saveBookmarks();
                    renderBookmarkList();
                    updateBookmarkUI();
                    return;
                }
                
                const item = event.target.closest('.bookmark-item');
                if (item) {
                    const slideIndex = Number(item.dataset.slide);
                    toggleBookmarkPanel(false);
                    jumpToSlide(slideIndex);
                }
            });
        }
        if (notesToggleBtn) {
            notesToggleBtn.addEventListener('click', () => toggleNotesPanel());
        }
        if (notesCloseBtn) {
            notesCloseBtn.addEventListener('click', () => toggleNotesPanel(false));
        }
        if (notesTextareaEl) {
            notesTextareaEl.addEventListener('input', handleNotesInput);
        }
        if (notesClearBtn) {
            notesClearBtn.addEventListener('click', clearNotes);
        }
        if (achievementCloseBtn) {
            achievementCloseBtn.addEventListener('click', hideAchievementModal);
        }
        if (pathSelectorEl) {
            pathSelectorEl.addEventListener('change', (event) => {
                setLearningPath(event.target.value);
            });
        }
        if (searchInputEl) {
            searchInputEl.addEventListener('input', handleSearchInput);
            searchInputEl.addEventListener('keydown', handleSearchKeyDown);
            searchInputEl.addEventListener('focus', () => {
                if (searchResultsEl && searchResults.length) {
                    searchResultsEl.classList.add('active');
                }
            });
        }
        if (historyToggleBtn) {
            historyToggleBtn.addEventListener('click', () => toggleHistoryPanel());
        }
        if (historyCloseBtn) {
            historyCloseBtn.addEventListener('click', () => toggleHistoryPanel(false));
        }
        if (historyListEl) {
            historyListEl.addEventListener('click', (event) => {
                const targetItem = event.target.closest('.history-item');
                if (!targetItem) return;
                const slideIndex = Number(targetItem.dataset.slide);
                if (Number.isNaN(slideIndex)) return;
                toggleHistoryPanel(false);
                jumpToSlide(slideIndex);
            });
        }
        if (themeToggleBtn) {
            themeToggleBtn.addEventListener('click', cycleTheme);
        }
        // ctaRestart и ctaDownload инициализируются ПОСЛЕ создания слайдов (см. строку после initPresentation())
        
        document.addEventListener('click', (event) => {
            if (searchContainerEl && !searchContainerEl.contains(event.target)) {
                closeSearchResults();
            }
            if (bookmarkPanelEl && bookmarkPanelEl.classList.contains('active')) {
                const toggleContains = bookmarkPanelToggleBtn ? bookmarkPanelToggleBtn.contains(event.target) : false;
                if (!bookmarkPanelEl.contains(event.target) && !toggleContains) {
                    toggleBookmarkPanel(false);
                }
            }
            if (notesPanelEl && notesPanelEl.classList.contains('active')) {
                const toggleContainsNotes = notesToggleBtn ? notesToggleBtn.contains(event.target) : false;
                if (!notesPanelEl.contains(event.target) && !toggleContainsNotes) {
                    toggleNotesPanel(false);
                }
            }
            if (historyPanelEl && historyPanelEl.classList.contains('active')) {
                const toggleContainsHistory = historyToggleBtn ? historyToggleBtn.contains(event.target) : false;
                if (!historyPanelEl.contains(event.target) && !toggleContainsHistory) {
                    toggleHistoryPanel(false);
                }
            }
        });
        
        // Fullscreen toggle с поддержкой мобильных устройств
        window.toggleFullscreen = function toggleFullscreen() {
            const doc = document;
            const docEl = doc.documentElement;
            
            // Проверка на мобильное устройство
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            
            // Определяем, находимся ли мы в полноэкранном режиме
            const isFullscreen = doc.fullscreenElement || 
                                 doc.webkitFullscreenElement || 
                                 doc.mozFullScreenElement || 
                                 doc.msFullscreenElement;
            
            if (!isFullscreen) {
                // Вход в полноэкранный режим
                if (docEl.requestFullscreen) {
                    docEl.requestFullscreen().catch(err => {
                        console.log(`Error attempting to enable fullscreen: ${err.message}`);
                    });
                } else if (docEl.webkitRequestFullscreen) {
                    // Safari и другие WebKit браузеры
                    docEl.webkitRequestFullscreen();
                } else if (docEl.webkitEnterFullscreen) {
                    // iOS Safari (для некоторых элементов)
                    docEl.webkitEnterFullscreen();
                } else if (docEl.mozRequestFullScreen) {
                    // Firefox
                    docEl.mozRequestFullScreen();
                } else if (docEl.msRequestFullscreen) {
                    // IE/Edge
                    docEl.msRequestFullscreen();
                } else if (isMobile) {
                    // Для мобильных устройств, которые не поддерживают полноэкранный режим
                    // Используем альтернативный подход - скрываем UI элементы
                    handleMobileFullscreen(true);
                }
            } else {
                // Выход из полноэкранного режима
                if (doc.exitFullscreen) {
                    doc.exitFullscreen();
                } else if (doc.webkitExitFullscreen) {
                    doc.webkitExitFullscreen();
                } else if (doc.mozCancelFullScreen) {
                    doc.mozCancelFullScreen();
                } else if (doc.msExitFullscreen) {
                    doc.msExitFullscreen();
                } else if (isMobile) {
                    handleMobileFullscreen(false);
                }
            }
        }
        
        // Обработка полноэкранного режима для мобильных устройств (альтернативный подход)
        function handleMobileFullscreen(enter) {
            const body = document.body;
            const html = document.documentElement;
            const presentation = document.querySelector('.presentation');
            
            if (enter) {
                // Добавляем класс для полноэкранного режима
                body.classList.add('mobile-fullscreen');
                html.classList.add('mobile-fullscreen');
                if (presentation) {
                    presentation.classList.add('mobile-fullscreen');
                }
                
                // Скрываем тулбары для более полного экрана
                const topToolbars = document.querySelectorAll('.circular-progress, .export-btn, .fullscreen-btn');
                const bottomToolbar = document.querySelector('.navigation');
                
                topToolbars.forEach(el => {
                    if (el) el.style.display = 'none';
                });
                if (bottomToolbar) {
                    bottomToolbar.style.display = 'none';
                }
                
                // Обновляем viewport для максимального использования экрана
                let viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover');
                }
                
                // Прокручиваем вверх для скрытия адресной строки
                window.scrollTo(0, 1);
                setTimeout(() => {
                    window.scrollTo(0, 0);
                }, 100);
                
                // Показываем уведомление пользователю
                showFullscreenHint();
            } else {
                // Убираем класс
                body.classList.remove('mobile-fullscreen');
                html.classList.remove('mobile-fullscreen');
                if (presentation) {
                    presentation.classList.remove('mobile-fullscreen');
                }
                
                // Показываем тулбары обратно
                const topToolbars = document.querySelectorAll('.circular-progress, .export-btn, .fullscreen-btn');
                const bottomToolbar = document.querySelector('.navigation');
                
                topToolbars.forEach(el => {
                    if (el) el.style.display = '';
                });
                if (bottomToolbar) {
                    bottomToolbar.style.display = '';
                }
                
                // Восстанавливаем viewport
                let viewport = document.querySelector('meta[name="viewport"]');
                if (viewport) {
                    viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes');
                }
            }
        }
        
        // Показ подсказки для мобильных устройств
        function showFullscreenHint() {
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            if (isIOS) {
                // Создаем временное уведомление
                const hint = document.createElement('div');
                hint.className = 'mobile-fullscreen-hint';
                hint.innerHTML = `
                    <div class="hint-content">
                        <p>💡 Для полноэкранного режима на iOS:</p>
                        <p>Нажмите кнопку "Поделиться" → "На экран Домой"</p>
                        <p>или используйте режим чтения Safari</p>
                        <button onclick="this.parentElement.parentElement.remove()">Понятно</button>
                    </div>
                `;
                document.body.appendChild(hint);
                
                // Автоматически скрываем через 5 секунд
                setTimeout(() => {
                    if (hint.parentElement) {
                        hint.remove();
                    }
                }, 5000);
            }
        }
        
        // Обработка событий изменения полноэкранного режима
        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
        document.addEventListener('mozfullscreenchange', updateFullscreenButton);
        document.addEventListener('MSFullscreenChange', updateFullscreenButton);
        
        function updateFullscreenButton() {
            const fullscreenBtn = document.querySelector('.fullscreen-btn');
            if (!fullscreenBtn) return;
            
            const isFullscreen = document.fullscreenElement || 
                                document.webkitFullscreenElement || 
                                document.mozFullScreenElement || 
                                document.msFullscreenElement ||
                                document.body.classList.contains('mobile-fullscreen');
            
            if (isFullscreen) {
                fullscreenBtn.setAttribute('title', 'Выйти из полноэкранного режима');
                fullscreenBtn.textContent = '⛶';
            } else {
                fullscreenBtn.setAttribute('title', 'Полноэкранный режим');
                fullscreenBtn.textContent = '⛶';
            }
        }
        
        // Export to PDF - Print all slides
        function exportToPDF() {
            // Найдем индексы интерактивных слайдов для исключения из печати
            const quizSlideIndex = slidesData.findIndex(slide =>
                slide.title && slide.title.includes('квиз')
            );
            const roiSlideIndex = slidesData.findIndex(slide =>
                slide.title && slide.title.includes('Калькулятор ROI')
            );
            const readinessSlideIndex = slidesData.findIndex(slide =>
                slide.title && slide.title.includes('готовности')
            );
            const constructorSlideIndex = slidesData.findIndex(slide =>
                slide.title && slide.title.includes('Конструктор')
            );
            const pctSlideIndex = slidesData.findIndex(slide =>
                slide.title && slide.title.includes('PCT') || slide.title && slide.title.includes('Prosci')
            );
            const modelSelectorSlideIndex = slidesData.findIndex(slide =>
                slide.title && slide.title.includes('выбора модели')
            );
            const practiceSeparatorIndex = slidesData.findIndex(slide =>
                slide.title && slide.title.includes('Практика: Оцените свой проект')
            );

            // Массив индексов интерактивных слайдов для исключения
            const interactiveSlidesIndices = [quizSlideIndex, roiSlideIndex, readinessSlideIndex, constructorSlideIndex, pctSlideIndex, modelSelectorSlideIndex, practiceSeparatorIndex].filter(index => index >= 0);

            // Рассчитаем количество слайдов для печати (всего - интерактивные)
            const printableSlidesCount = fullSlidesCount - interactiveSlidesIndices.length;

            // Show instruction dialog
            const exportMessage = [
                `📄 ЭКСПОРТ В PDF (ТОЛЬКО ИНФОРМАЦИОННЫЕ СЛАЙДЫ)`,
                '━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━',
                '📋 ИНСТРУКЦИЯ:',
                '1️⃣ Откроется диалог печати браузера',
                '2️⃣ В поле "Принтер" выберите:\n   • "Сохранить как PDF" (Chrome/Edge)\n   • "Microsoft Print to PDF" (Firefox)',
                '3️⃣ Настройки:\n   • Ориентация: АЛЬБОМНАЯ\n   • Страницы: ВСЕ\n   • Масштаб: По умолчанию',
                '4️⃣ Нажмите "Сохранить"',
                `✅ Результат: PDF с ${printableSlidesCount} информационными слайдами`,
                'ℹ️ Интерактивные инструменты (Квиз, ROI, Готовность, Конструктор, PCT) исключены из печати',
                'Продолжить?'
            ].join('\n\n');

            const userConfirmed = confirm(exportMessage);

            if (!userConfirmed) {
                return;
            }

            // Prepare all slides for printing
            const slides = document.querySelectorAll('.slide');
            const navigation = document.querySelector('.navigation');
            const exportBtn = document.querySelector('.export-btn');
            const fullscreenBtn = document.querySelector('.fullscreen-btn');
            const progressBar = document.querySelector('.progress-bar-container');

            // Store original states
            const originalStates = Array.from(slides).map(s => s.style.display);

            // Prepare all slides for printing
            slides.forEach((slide, index) => {
                // Проверяем, является ли слайд интерактивным инструментом
                const isInteractiveSlide = interactiveSlidesIndices.includes(index);

                if (isInteractiveSlide) {
                    // Исключаем интерактивные слайды из печати
                    slide.style.display = 'none';
                } else {
                    // Показываем информационные слайды
                    slide.style.display = 'block';
                    slide.style.opacity = '1';
                    slide.style.position = 'static';
                    slide.style.pageBreakAfter = 'always';
                    slide.style.pageBreakInside = 'auto'; // Изменено
                    slide.style.width = '100%';
                    slide.style.maxWidth = '277mm';
                    slide.style.height = 'auto';
                    slide.style.maxHeight = 'none'; // Убрано ограничение
                    slide.style.padding = '12mm'; // Уменьшен
                    slide.style.margin = '0 auto';
                    slide.style.overflow = 'visible'; // Изменено
                    slide.style.boxSizing = 'border-box';

                    // Remove active class from all
                    slide.classList.remove('active');
                }
            });
            
            // Hide navigation elements
            if (navigation) navigation.style.display = 'none';
            if (exportBtn) exportBtn.style.display = 'none';
            if (fullscreenBtn) fullscreenBtn.style.display = 'none';
            if (progressBar) progressBar.style.display = 'none';
            
            // Make container static for printing
            const container = document.querySelector('.slide-container');
            const presentation = document.querySelector('.presentation');
            const originalContainerPosition = container ? container.style.position : '';
            const originalPresentationHeight = presentation ? presentation.style.height : '';
            
            if (container) {
                container.style.position = 'static';
                container.style.overflow = 'visible';
                container.style.height = 'auto';
            }
            if (presentation) {
                presentation.style.height = 'auto';
            }
            
            // Small delay to ensure rendering
            setTimeout(() => {
                // Trigger print dialog
                window.print();
                
                // Restore original state after print dialog
                setTimeout(() => {
                    // Restore all slides
                    slides.forEach((slide, index) => {
                        slide.style.display = originalStates[index];
                        slide.style.opacity = '';
                        slide.style.position = '';
                        slide.style.pageBreakAfter = '';
                        slide.style.pageBreakInside = '';
                        slide.style.width = '';
                        slide.style.maxWidth = '';
                        slide.style.height = '';
                        slide.style.maxHeight = '';
                        slide.style.padding = '';
                        slide.style.margin = '';
                        slide.style.overflow = '';
                        slide.style.boxSizing = '';
                        
                        // Restore active class to current slide
                        if (index === currentSlide) {
                            slide.classList.add('active');
                        }
                    });
                    
                    // Restore container
                    if (container) {
                        container.style.position = originalContainerPosition;
                        container.style.overflow = '';
                        container.style.height = '';
                    }
                    if (presentation) {
                        presentation.style.height = originalPresentationHeight;
                    }
                    
                    // Restore navigation
                    if (navigation) navigation.style.display = '';
                    if (exportBtn) exportBtn.style.display = '';
                    if (fullscreenBtn) fullscreenBtn.style.display = '';
                    if (progressBar) progressBar.style.display = '';
                }, 500);
            }, 300);
        }
        
        // Fallback: Simple print function
        function printToPDF() {
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => {
                slide.style.display = 'block';
                slide.style.opacity = '1';
            });
            
            window.print();
            
            setTimeout(() => {
                slides.forEach((slide, index) => {
                    if (index !== currentSlide) {
                        slide.style.display = '';
                        slide.style.opacity = '';
                    }
                });
            }, 100);
        }
        
        // Touch/Swipe navigation for mobile
        let touchStartX = 0;
        let touchEndX = 0;
        let touchStartY = 0;
        let touchEndY = 0;
        let touchStartTime = 0;
        let maxVerticalMovement = 0;
        let maxHorizontalMovement = 0;
        let touchTarget = null;
        
        // Проверка, является ли элемент интерактивным (не должен блокировать свайпы)
        function isInteractiveElement(element) {
            if (!element) return false;
            
            const tagName = element.tagName.toLowerCase();
            
            // Строгие интерактивные элементы, которые точно должны блокировать свайпы
            const strictInteractiveTags = ['input', 'button', 'textarea', 'select'];
            if (strictInteractiveTags.includes(tagName)) return true;
            
            // Ссылки блокируют свайпы только если они не в карточках или больших кликабельных областях
            if (tagName === 'a') {
                // Проверяем, не является ли ссылка частью большой кликабельной области (карточки)
                const parentCard = element.closest('.card, .useful-option-card, .faq-topic-card, .practice-tool-card');
                // Если ссылка в большой карточке, не блокируем свайпы (пользователь может свайпать по карточке)
                if (parentCard) return false;
                // Иначе блокируем (это обычная ссылка)
                return true;
            }
            
            // Проверка на scrollable элементы с небольшим контентом (не весь слайд)
            const style = window.getComputedStyle(element);
            const isScrollable = element.scrollHeight > element.clientHeight && 
                                (style.overflowY === 'auto' || style.overflowY === 'scroll' || style.overflowY === 'overlay');
            // Блокируем свайпы только в небольших scrollable элементах (не в основном слайде)
            if (isScrollable && element !== document.querySelector('.slide.active')) {
                // Проверяем, не является ли это основным контейнером слайда
                const isMainSlide = element.classList.contains('slide') || element.closest('.slide.active') === element;
                if (!isMainSlide) return true;
            }
            
            // Проверка на элементы с contenteditable (редактируемые поля)
            if (element.contentEditable === 'true') return true;
            
            // НЕ блокируем свайпы на элементах с onclick, так как они могут быть на карточках
            // Пользователь может свайпать по карточке, даже если она кликабельна
            
            return false;
        }
        
        document.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
            touchStartTime = Date.now();
            maxVerticalMovement = 0;
            maxHorizontalMovement = 0;
            touchTarget = e.target;
            
            // На iPhone свайпы от левого края экрана могут конфликтовать с системным жестом "назад"
            // Но мы не блокируем их, так как пользователь может хотеть свайпать слайды
            // Система iOS сама обработает конфликт, если это системный жест
        }, { passive: true });
        
        document.addEventListener('touchmove', (e) => {
            const currentX = e.changedTouches[0].screenX;
            const currentY = e.changedTouches[0].screenY;
            
            const deltaX = Math.abs(currentX - touchStartX);
            const deltaY = Math.abs(currentY - touchStartY);
            
            // Отслеживаем максимальные движения для более точного определения направления
            maxHorizontalMovement = Math.max(maxHorizontalMovement, deltaX);
            maxVerticalMovement = Math.max(maxVerticalMovement, deltaY);
        }, { passive: true });
        
        document.addEventListener('touchend', (e) => {
            touchEndX = e.changedTouches[0].screenX;
            touchEndY = e.changedTouches[0].screenY;
            
            const touchDuration = Date.now() - touchStartTime;
            const horizontalSwipe = Math.abs(touchEndX - touchStartX);
            const verticalSwipe = Math.abs(touchEndY - touchStartY);
            
            // Проверяем, не находится ли пользователь в интерактивном элементе
            const isInInteractiveElement = isInteractiveElement(touchTarget) || 
                                         isInteractiveElement(touchTarget?.closest('input, button, textarea, select, a, [contenteditable="true"]'));
            
            // Проверяем, не находится ли пользователь в scrollable области
            let scrollableParent = touchTarget;
            let isInScrollableArea = false;
            let scrollableElement = null;
            while (scrollableParent && scrollableParent !== document.body) {
                const style = window.getComputedStyle(scrollableParent);
                const isScrollable = scrollableParent.scrollHeight > scrollableParent.clientHeight && 
                                    (style.overflowY === 'auto' || style.overflowY === 'scroll' || style.overflowY === 'overlay');
                if (isScrollable) {
                    isInScrollableArea = true;
                    scrollableElement = scrollableParent;
                    break;
                }
                scrollableParent = scrollableParent.parentElement;
            }
            
            // Проверяем, действительно ли пользователь скроллил в scrollable области
            let actuallyScrolled = false;
            if (isInScrollableArea && scrollableElement) {
                // Проверяем, изменилась ли позиция скролла
                const scrollTop = scrollableElement.scrollTop;
                // Если элемент был прокручен, значит пользователь скроллил, а не свайпал
                // Но это сложно определить точно, поэтому используем более мягкую проверку
                actuallyScrolled = maxVerticalMovement > 20 && maxVerticalMovement > maxHorizontalMovement * 2;
            }
            
            // Определяем, был ли это явный вертикальный скролл
            // Более мягкая проверка: вертикальное движение должно быть значительно больше горизонтального
            const isVerticalScroll = maxVerticalMovement > 40 && maxVerticalMovement > maxHorizontalMovement * 2;
            
            // Не обрабатываем свайп, если:
            // 1. Пользователь в интерактивном элементе (input, button и т.д.)
            // 2. Пользователь в scrollable области и действительно скроллил вертикально
            // 3. Свайп был слишком долгим (более 800ms) - медленный жест
            // 4. Вертикальное движение значительно больше горизонтального (явный скролл)
            if (!isInInteractiveElement && 
                !(isInScrollableArea && actuallyScrolled) && 
                touchDuration < 800 && 
                !isVerticalScroll) {
                handleSwipe(horizontalSwipe, verticalSwipe, maxHorizontalMovement, maxVerticalMovement);
            }
            
            // Сброс переменных
            maxVerticalMovement = 0;
            maxHorizontalMovement = 0;
            touchTarget = null;
        }, { passive: true });
        
        function handleSwipe(horizontalSwipe, verticalSwipe, maxHorizontal, maxVertical) {
            // Уменьшен порог для более чувствительного распознавания на iPhone
            // Порог 50px оптимален для комфортного использования на мобильных устройствах
            const swipeThreshold = 50;
            
            // Используем максимальные движения для более точного определения направления
            const effectiveHorizontalSwipe = Math.max(horizontalSwipe, maxHorizontal || 0);
            const effectiveVerticalSwipe = Math.max(verticalSwipe, maxVertical || 0);
            
            // Более мягкое условие для распознавания горизонтального свайпа:
            // 1. Горизонтальное движение должно быть больше вертикального (минимум в 1.2 раза)
            // 2. Горизонтальное движение должно превышать порог
            // 3. Если горизонтальное движение очень большое (> 100px), принимаем его даже при небольшом вертикальном движении
            const isHorizontalSwipe = (effectiveHorizontalSwipe > effectiveVerticalSwipe * 1.2 && effectiveHorizontalSwipe > swipeThreshold) ||
                                     (effectiveHorizontalSwipe > 100 && effectiveHorizontalSwipe > effectiveVerticalSwipe);
            
            if (isHorizontalSwipe) {
                // Определяем направление свайпа с небольшим запасом для предотвращения случайных срабатываний
                const swipeDirection = touchEndX - touchStartX;
                const minSwipeDistance = 30; // Минимальное расстояние для уверенного распознавания направления
                
                if (swipeDirection < -minSwipeDistance) {
                    // Swipe left - next slide
                    changeSlide(1);
                } else if (swipeDirection > minSwipeDistance) {
                    // Swipe right - previous slide
                    changeSlide(-1);
                }
            }
        }
        
        // Show swipe hint on mobile devices
        function showSwipeHint() {
            if (window.innerWidth <= 768 && currentSlide === 0) {
                const hint = document.createElement('div');
                hint.className = 'swipe-hint';
                hint.textContent = '← Свайп для навигации →';
                document.body.appendChild(hint);
                
                setTimeout(() => {
                    hint.remove();
                }, 3000);
            }
        }
        
        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'k') {
                e.preventDefault();
                if (searchInputEl) {
                    searchInputEl.focus();
                    searchInputEl.select();
                }
                return;
            }
            if (e.key === 'Escape') {
                toggleBookmarkPanel(false);
                toggleNotesPanel(false);
                toggleHistoryPanel(false);
                clearSearch();
                hideAchievementModal();
            }
            if (e.key === 'ArrowRight') changeSlide(1);
            if (e.key === 'ArrowLeft') changeSlide(-1);
            if (e.key === 'f' || e.key === 'F') toggleFullscreen();
            if (e.key === 'p' || e.key === 'P') {
                e.preventDefault();
                exportToPDF();
            }
            // Ctrl+P for browser print as fallback
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                printToPDF();
            }
        });
        
        // Initialize on load
        console.log('=== Начало инициализации презентации ===');
        console.log('DOM ready state:', document.readyState);
        console.log('Проверка наличия slideContainer:', !!document.getElementById('slideContainer'));
        console.log('Проверка наличия modelSelector:', !!document.getElementById('modelSelector'));
        
        initPresentation();
        renderTimeline();
        renderBookmarkList();
        updateBookmarkUI();
        syncNotesPanel();
        updatePathSelectorOptions();
        setLearningPath(activeLearningPath, { skipNavigationUpdate: true });
        updateNavigation();
        activateSlide(currentSlide);
        console.log('Текущий слайд после инициализации:', currentSlide);
        initializeTheme(); // Инициализация темы ПОСЛЕ объявления всех переменных
        
        // ========== Quiz Functions ==========
        function initQuiz() {
            console.log('Инициализация квиза...');
            renderQuizQuestion();
            setupQuizEventListeners();
        }

        function renderQuizQuestion() {
            const questionContainer = document.getElementById('quizQuestion');
            const progressText = document.getElementById('quizProgressText');
            const progressFill = document.getElementById('quizProgressFill');
            const prevBtn = document.getElementById('quizPrevBtn');
            const nextBtn = document.getElementById('quizNextBtn');

            if (!questionContainer || !progressText || !nextBtn) return;

            const question = quizData.questions[quizState.currentQuestion];
            const progressPercent = ((quizState.currentQuestion + 1) / quizData.questions.length) * 100;

            progressText.textContent = `Вопрос ${quizState.currentQuestion + 1} из ${quizData.questions.length}`;
            if (progressFill) {
                progressFill.style.width = `${progressPercent}%`;
            }

            questionContainer.innerHTML = `
                <div class="question-content">
                    <h3>${question.question}</h3>
                    <div class="question-options">
                        ${question.options.map((option, index) => `
                            <label class="option-item">
                                <input type="radio" name="quizOption" value="${option.value}" ${quizState.answers[quizState.currentQuestion] === option.value ? 'checked' : ''}>
                                <span class="option-number">${String.fromCharCode(65 + index)}</span>
                                <span class="option-text">${option.text}</span>
                            </label>
                        `).join('')}
                    </div>
                </div>
            `;

            // Управление кнопками
            if (prevBtn) {
                prevBtn.style.display = quizState.currentQuestion > 0 ? 'inline-block' : 'none';
            }

            if (nextBtn) {
                const selectedOption = document.querySelector('input[name="quizOption"]:checked');
                nextBtn.disabled = !selectedOption;
                nextBtn.textContent = quizState.currentQuestion === quizData.questions.length - 1 ? 'Завершить квиз' : 'Далее →';
            }
        }

        function setupQuizEventListeners() {
            const nextBtn = document.getElementById('quizNextBtn');
            const prevBtn = document.getElementById('quizPrevBtn');

            if (nextBtn) {
                nextBtn.addEventListener('click', nextQuizQuestion);
            }

            if (prevBtn) {
                prevBtn.addEventListener('click', prevQuizQuestion);
            }

            // Обработчик изменения выбора
            document.addEventListener('change', function(e) {
                if (e.target.name === 'quizOption') {
                    const nextBtn = document.getElementById('quizNextBtn');
                    if (nextBtn) {
                        nextBtn.disabled = false;
                    }
                }
            });
        }

        function nextQuizQuestion() {
            const selectedOption = document.querySelector('input[name="quizOption"]:checked');
            if (!selectedOption) return;

            // Сохраняем ответ
            quizState.answers[quizState.currentQuestion] = selectedOption.value;

            if (quizState.currentQuestion < quizData.questions.length - 1) {
                quizState.currentQuestion++;
                renderQuizQuestion();
            } else {
                showQuizResults();
            }
        }

        function prevQuizQuestion() {
            if (quizState.currentQuestion > 0) {
                quizState.currentQuestion--;
                renderQuizQuestion();
            }
        }

        function showQuizResults() {
            quizState.completed = true;

            const profile = analyzeQuizResults();
            const recommendations = generateQuizRecommendations(profile);

            const resultsContainer = document.getElementById('quizResults');
            const profileContainer = document.getElementById('quizProfile');
            const recommendationsContainer = document.getElementById('quizRecommendations');

            if (profileContainer) {
                profileContainer.innerHTML = `
                    <div class="quiz-profile-card">
                        <h4>${profile.name}</h4>
                        <p>${profile.description}</p>
                    </div>
                `;
            }

            if (recommendationsContainer) {
                recommendationsContainer.innerHTML = `
                    <h4>Рекомендованные модели для вас:</h4>
                    <div class="recommended-models">
                        ${recommendations.map((model, index) => `
                            <div class="model-recommendation">
                                <div class="model-number">${index + 1}</div>
                                <div class="model-info">
                                    <h5>${model.name}</h5>
                                    <p>Рекомендовано: ${model.sources.join(', ')}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            // Скрываем вопросы и показываем результаты
            document.querySelector('.quiz-tool .quiz-question')?.style.setProperty('display', 'none');
            document.querySelector('.quiz-tool .quiz-navigation')?.style.setProperty('display', 'none');

            if (resultsContainer) {
                resultsContainer.style.display = 'block';
            }
        }

        function analyzeQuizResults() {
            const answers = quizState.answers;

            // Простая логика определения профиля на основе ответов
            const experience = answers[0]; // Опыт
            const approach = answers[2]; // Подход
            const focus = answers[3]; // Фокус

            if (experience === 'beginner' || experience === 'intermediate') {
                if (approach === 'structured' || approach === 'hybrid') {
                    return quizData.profiles.beginner_structured;
                } else {
                    return quizData.profiles.intermediate_hybrid;
                }
            } else {
                if (focus === 'technical') {
                    return quizData.profiles.technical_focused;
                } else {
                    return quizData.profiles.expert_situational;
                }
            }
        }

        function generateQuizRecommendations(profile) {
            return profile.recommendedModels.map(model => ({
                name: model.name,
                sources: model.sources
            }));
        }

        function confirmResetQuiz() {
            if (confirm('Вы уверены, что хотите сбросить результаты квиза и пройти его заново? Ваши предыдущие ответы и результаты будут удалены.')) {
                resetQuiz();
            }
        }

        function resetQuiz() {
            // Сбрасываем состояние квиза
            quizState.currentQuestion = 0;
            quizState.answers = [];
            quizState.completed = false;

            // Очищаем сохраненные результаты из localStorage
            localStorage.removeItem('quizProfile');

            // Скрываем результаты и показываем вопросы
            document.querySelector('.quiz-tool .quiz-results')?.style.setProperty('display', 'none');
            document.querySelector('.quiz-tool .quiz-question')?.style.setProperty('display', 'block');
            document.querySelector('.quiz-tool .quiz-navigation')?.style.setProperty('display', 'flex');

            // Очищаем содержимое результатов
            const resultsContainer = document.getElementById('quizResults');
            const profileContainer = document.getElementById('quizProfile');
            const recommendationsContainer = document.getElementById('quizRecommendations');

            if (profileContainer) profileContainer.innerHTML = '';
            if (recommendationsContainer) recommendationsContainer.innerHTML = '';
            if (resultsContainer) resultsContainer.style.display = 'none';

            // Перерисовываем первый вопрос
            renderQuizQuestion();
        }

        function exportQuizResults() {
            const profile = analyzeQuizResults();
            const recommendations = generateQuizRecommendations(profile);

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ru">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Результаты квиза - Профиль управления изменениями</title>
                    <style>
                        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
                        h1 { color: #2DB67D; border-bottom: 3px solid #2DB67D; padding-bottom: 10px; }
                        h2 { color: #333; margin-top: 30px; }
                        .profile { background: #f5f5f5; padding: 20px; border-radius: 8px; margin: 20px 0; }
                        .recommendations { margin: 20px 0; }
                        .model-item { background: white; padding: 15px; margin: 10px 0; border-radius: 6px; border-left: 4px solid #2DB67D; }
                        .sources { color: #666; font-size: 14px; margin-top: 5px; }
                        .footer { margin-top: 40px; padding-top: 20px; border-top: 1px solid #ddd; text-align: center; color: #666; }
                    </style>
                </head>
                <body>
                    <h1>Результаты квиза: Профиль управления изменениями</h1>
                    <p><strong>Дата анализа:</strong> ${new Date().toLocaleDateString('ru-RU', { year: 'numeric', month: 'long', day: 'numeric' })}</p>

                    <div class="profile">
                        <h2>Ваш профиль</h2>
                        <p><strong>${profile.name}</strong></p>
                        <p>${profile.description}</p>
                    </div>

                    <h2>Рекомендованные модели</h2>
                    <div class="recommendations">
                        ${recommendations.map((model, index) => `
                            <div class="model-item">
                                <h3>${index + 1}. ${model.name}</h3>
                                <div class="sources">Рекомендовано: ${model.sources.join(', ')}</div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="footer">
                        <p>Анализ создан с помощью интерактивного квиза</p>
                        <p>Автор: Dmitry Vladimirov | LinkedIn: www.linkedin.com/in/dmitry-vladimirov-cdto</p>
                    </div>
                </body>
                </html>
            `);
            reportWindow.document.close();

            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        // Синхронизация результатов квиза с инструментом выбора моделей
        function syncQuizWithModelSelector() {
            try {
                const savedProfile = localStorage.getItem('quizProfile');
                if (savedProfile) {
                    const profileData = JSON.parse(savedProfile);
                    // Сохраняем рекомендации квиза для инструмента выбора
                    localStorage.setItem('quizRecommendations', JSON.stringify(profileData.recommendedModels || []));

                    console.log('✓ Результаты квиза синхронизированы с инструментом выбора моделей');
                }
            } catch (error) {
                console.warn('Не удалось синхронизировать результаты квиза:', error);
            }
        }

        // Инициализация PCT инструмента
        try {
            if (typeof initPCT === 'function' && typeof pctAssessment !== 'undefined') {
                initPCT();
                console.log('✓ PCT инструмент инициализирован');
            } else {
                console.warn('PCT инструмент не может быть инициализирован: отсутствуют необходимые функции или данные');
            }
        } catch (error) {
            console.error('Ошибка при инициализации PCT инструмента:', error);
        }

        // Инициализация ROI калькулятора
        initROICalculator();
        console.log('✓ ROI калькулятор инициализирован');

        // Инициализация диагностики готовности
        initReadinessAssessment();
        console.log('✓ Диагностика готовности инициализирована');

        // Инициализация конструктора гибридных моделей
        initHybridConstructor();
        console.log('✓ Конструктор гибридных моделей инициализирован');

        // Инициализация квиза
        initQuiz();
        console.log('✓ Квиз инициализирован');

        // ========== Model Selector Tool Functions ==========

        // Переменные состояния model selector
        let allModels = [];
        let filteredModels = [];
        let selectedModels = [];
        let currentSortColumn = 'name';
        let currentSortDirection = 'asc';
        let activeFilters = {};

        // Матрица выбора - состояние
        let matrixSelections = {
            role: null,
            scale: null,
            speed: null,
            resistance: null,
            resources: null
        };

        // Инициализация model selector
        function initModelSelector() {
            console.log('Инициализация Model Selector...');

            // Собираем все модели
            allModels = [...classicalModels, ...newModels];
            filteredModels = [...allModels];

            // Инициализируем UI
            setupModelSelectorEventListeners();
            buildModelsComparisonTable();
            handleResponsiveTableView();

            // Добавляем обработчик изменения размера окна
            window.addEventListener('resize', handleResponsiveTableView);

            console.log('✓ Model Selector инициализирован');
        }

        // Настройка обработчиков событий
        function setupModelSelectorEventListeners() {
            // Табы режимов
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.addEventListener('click', () => switchSelectorMode(tab.dataset.mode));
            });

            // Поиск
            const searchInput = document.getElementById('modelSearchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    searchModels(e.target.value);
                });
            }

            // Фильтры
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => toggleFilter(btn));
            });

            // Сброс фильтров
            const resetBtn = document.getElementById('resetFiltersBtn');
            if (resetBtn) {
                resetBtn.addEventListener('click', resetFilters);
            }

            // Сортировка по заголовкам таблицы
            document.querySelectorAll('.model-comparison-table th[data-sort]').forEach(th => {
                th.addEventListener('click', () => sortModelsTable(th.dataset.sort));
            });

            // Выбор моделей
            document.addEventListener('change', (e) => {
                if (e.target.classList.contains('model-select-checkbox')) {
                    toggleModelSelection(e.target.dataset.modelName, e.target.checked);
                }
            });

            // Управление выбранными моделями
            const clearBtn = document.getElementById('clearSelectionBtn');
            if (clearBtn) {
                clearBtn.addEventListener('click', clearModelSelection);
            }

            const compareBtn = document.getElementById('compareModelsBtn');
            if (compareBtn) {
                compareBtn.addEventListener('click', showDetailedComparison);
            }

            // Матрица выбора
            document.querySelectorAll('.matrix-parameter').forEach(param => {
                param.addEventListener('click', () => selectMatrixParameter(param));
                // Клавиатурная навигация
                param.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectMatrixParameter(param);
                    }
                });
                param.setAttribute('tabindex', '0');
            });

            const restartMatrixBtn = document.getElementById('restartMatrixBtn');
            if (restartMatrixBtn) {
                restartMatrixBtn.addEventListener('click', restartMatrixSelection);
            }

            // Добавляем обработчики для чекбоксов таблицы с клавиатурной поддержкой
            document.addEventListener('keydown', (e) => {
                if (e.target.classList.contains('model-select-checkbox')) {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        e.target.click();
                    }
                }
            });

            // Добавляем обработчики для кнопок фильтров с клавиатурной поддержкой
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        btn.click();
                    }
                });
                btn.setAttribute('tabindex', '0');
            });
        }

        // Переключение режимов (Таблица/Матрица)
        function switchSelectorMode(mode) {
            // Обновляем активный таб
            document.querySelectorAll('.mode-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });

            // Показываем соответствующий контент
            const tableContent = document.getElementById('tableModeContent');
            const matrixContent = document.getElementById('matrixModeContent');

            if (mode === 'table') {
                tableContent.style.display = 'block';
                matrixContent.style.display = 'none';
            } else {
                tableContent.style.display = 'none';
                matrixContent.style.display = 'block';
                // Сбрасываем матрицу при переключении
                restartMatrixSelection();
            }

            // Сохраняем режим
            localStorage.setItem('modelSelectorMode', mode);
        }

        // Построение таблицы сравнения
        function buildModelsComparisonTable() {
            const tbody = document.getElementById('modelsTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';

            filteredModels.forEach(model => {
                const isSelected = selectedModels.includes(model.name);

                const row = document.createElement('tr');
                row.className = isSelected ? 'selected' : '';

                row.innerHTML = `
                    <td>
                        <div class="model-name">${model.name}</div>
                        <div class="model-type ${model.type.replace(/\s+/g, '')}">${model.type}</div>
                    </td>
                    <td>${model.type}</td>
                    <td><span class="complexity-badge ${model.complexity}" title="${getComplexityTooltip(model.complexity)}">${model.complexity}</span></td>
                    <td><span class="scale-badge ${model.scale}" title="${getScaleTooltip(model.scale)}">${model.scale}</span></td>
                    <td><span class="duration-badge" title="Ориентировочный срок внедрения">${model.duration}</span></td>
                    <td><span class="focus-badge ${model.focus}" title="${getFocusTooltip(model.focus)}">${model.focus}</span></td>
                    <td>
                        <input type="checkbox"
                               class="model-select-checkbox"
                               data-model-name="${model.name}"
                               ${isSelected ? 'checked' : ''}
                               ${selectedModels.length >= 3 && !isSelected ? 'disabled' : ''}>
                    </td>
                `;

                tbody.appendChild(row);
            });

            // Обновляем счетчик в заголовке
            updateTableHeader();
        }

        // Обновление заголовка таблицы с информацией о фильтрах
        function updateTableHeader() {
            const header = document.querySelector('.comparison-table-wrapper');
            if (!header) return;

            let filterText = '';
            const activeFilterCount = Object.values(activeFilters).filter(arr => arr.length > 0).length;

            if (activeFilterCount > 0) {
                filterText = ` (применено ${activeFilterCount} фильтр${activeFilterCount === 1 ? '' : activeFilterCount < 5 ? 'а' : 'ов'})`;
            }

            // Можно добавить информационный текст в заголовок таблицы
            const infoText = `Показаны ${filteredModels.length} из ${allModels.length} моделей${filterText}`;
            // Для простоты оставим как есть, но в будущем можно добавить элемент для отображения
        }

        // Функции для генерации подсказок
        function getComplexityTooltip(complexity) {
            const tooltips = {
                'Низкая': 'Простая в реализации, минимум ресурсов, подходит для начинающих',
                'Средняя': 'Умеренная сложность, требует базовой подготовки команды',
                'Высокая': 'Сложная модель, требует экспертизы и значительных ресурсов'
            };
            return tooltips[complexity] || complexity;
        }

        function getScaleTooltip(scale) {
            const tooltips = {
                'Малый': 'Команда или отдел, локальные процессы',
                'Средний': 'Несколько отделов, кросс-функциональные процессы',
                'Крупный': 'Вся организация или холдинг'
            };
            return tooltips[scale] || scale;
        }

        function getFocusTooltip(focus) {
            const tooltips = {
                'Люди': 'Фокус на эмоциональном состоянии, сопротивлении изменениям',
                'Процессы': 'Фокус на оптимизации бизнес-процессов и рабочих процедур',
                'Стратегия': 'Фокус на видении, планировании и организационной структуре',
                'Культура': 'Фокус на ценностях, нормах и организационной культуре'
            };
            return tooltips[focus] || focus;
        }

        // Функция для создания мобильной карточной версии
        function buildMobileModelCards() {
            let container = document.querySelector('.comparison-cards-mobile');
            if (!container) {
                container = document.createElement('div');
                container.className = 'comparison-cards-mobile';
                document.querySelector('.comparison-table-wrapper').parentNode.insertBefore(container, document.querySelector('.comparison-table-wrapper').nextSibling);
            }

            container.innerHTML = '';

            filteredModels.forEach(model => {
                const isSelected = selectedModels.includes(model.name);

                const card = document.createElement('div');
                card.className = `mobile-model-card ${isSelected ? 'selected' : ''}`;

                card.innerHTML = `
                    <h4>${model.name}</h4>
                    <div class="mobile-model-card-row">
                        <span class="mobile-model-card-label">Тип:</span>
                        <span class="mobile-model-card-value">${model.type}</span>
                    </div>
                    <div class="mobile-model-card-row">
                        <span class="mobile-model-card-label">Сложность:</span>
                        <span class="mobile-model-card-value">${model.complexity}</span>
                    </div>
                    <div class="mobile-model-card-row">
                        <span class="mobile-model-card-label">Масштаб:</span>
                        <span class="mobile-model-card-value">${model.scale}</span>
                    </div>
                    <div class="mobile-model-card-row">
                        <span class="mobile-model-card-label">Срок:</span>
                        <span class="mobile-model-card-value">${model.duration}</span>
                    </div>
                    <div class="mobile-model-card-row">
                        <span class="mobile-model-card-label">Фокус:</span>
                        <span class="mobile-model-card-value">${model.focus}</span>
                    </div>
                `;

                card.addEventListener('click', () => {
                    toggleModelSelection(model.name, !selectedModels.includes(model.name));
                    // Обновляем карточку
                    buildMobileModelCards();
                });

                container.appendChild(card);
            });
        }

        // Адаптивное переключение между таблицей и карточками
        function handleResponsiveTableView() {
            const isMobile = window.innerWidth <= 640;
            const tableWrapper = document.querySelector('.comparison-table-wrapper');
            const cardsContainer = document.querySelector('.comparison-cards-mobile');

            if (isMobile) {
                if (tableWrapper) tableWrapper.style.display = 'none';
                if (cardsContainer) cardsContainer.style.display = 'block';
                buildMobileModelCards();
            } else {
                if (tableWrapper) tableWrapper.style.display = 'block';
                if (cardsContainer) cardsContainer.style.display = 'none';
            }
        }

        // Переключение фильтра
        function toggleFilter(button) {
            const filterType = button.dataset.filter;
            const filterValue = button.dataset.value;

            if (!activeFilters[filterType]) {
                activeFilters[filterType] = [];
            }

            const index = activeFilters[filterType].indexOf(filterValue);
            if (index > -1) {
                activeFilters[filterType].splice(index, 1);
            } else {
                activeFilters[filterType].push(filterValue);
            }

            button.classList.toggle('active');

            // Применяем фильтры
            applyFilters();

            // Сохраняем фильтры
            localStorage.setItem('modelSelectorFilters', JSON.stringify(activeFilters));
        }

        // Применение фильтров
        function applyFilters() {
            filteredModels = allModels.filter(model => {
                // Проверяем каждый активный фильтр
                for (const [filterType, values] of Object.entries(activeFilters)) {
                    if (values.length > 0 && !values.includes(model[filterType])) {
                        return false;
                    }
                }
                return true;
            });

            buildModelsComparisonTable();
        }

        // Поиск моделей
        function searchModels(query) {
            if (!query.trim()) {
                applyFilters();
                return;
            }

            const searchTerm = query.toLowerCase();
            filteredModels = allModels.filter(model =>
                model.name.toLowerCase().includes(searchTerm) ||
                model.type.toLowerCase().includes(searchTerm) ||
                model.description.toLowerCase().includes(searchTerm)
            );

            buildModelsComparisonTable();
        }

        // Сброс всех фильтров
        function resetFilters() {
            activeFilters = {};
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));

            const searchInput = document.getElementById('modelSearchInput');
            if (searchInput) searchInput.value = '';

            filteredModels = [...allModels];
            buildModelsComparisonTable();
        }

        // Сортировка таблицы
        function sortModelsTable(column) {
            if (currentSortColumn === column) {
                currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';
            } else {
                currentSortColumn = column;
                currentSortDirection = 'asc';
            }

            // Обновляем индикаторы сортировки
            document.querySelectorAll('.model-comparison-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });

            const currentTh = document.querySelector(`.model-comparison-table th[data-sort="${column}"]`);
            if (currentTh) {
                currentTh.classList.add(`sort-${currentSortDirection}`);
            }

            // Сортируем модели
            filteredModels.sort((a, b) => {
                let aVal = a[column] || '';
                let bVal = b[column] || '';

                // Для некоторых колонок нужна специальная логика
                if (column === 'complexity') {
                    const order = { 'Низкая': 1, 'Средняя': 2, 'Высокая': 3 };
                    aVal = order[aVal] || 0;
                    bVal = order[bVal] || 0;
                } else if (column === 'scale') {
                    const order = { 'Малый': 1, 'Средний': 2, 'Крупный': 3 };
                    aVal = order[aVal] || 0;
                    bVal = order[bVal] || 0;
                }

                if (currentSortDirection === 'asc') {
                    return aVal > bVal ? 1 : aVal < bVal ? -1 : 0;
                } else {
                    return aVal < bVal ? 1 : aVal > bVal ? -1 : 0;
                }
            });

            buildModelsComparisonTable();
        }

        // Переключение выбора модели
        function toggleModelSelection(modelName, isSelected) {
            if (isSelected && selectedModels.length < 3) {
                selectedModels.push(modelName);
            } else if (!isSelected) {
                selectedModels = selectedModels.filter(name => name !== modelName);
            }

            // Обновляем чекбоксы (блокируем лишние)
            document.querySelectorAll('.model-select-checkbox').forEach(checkbox => {
                const isChecked = selectedModels.includes(checkbox.dataset.modelName);
                checkbox.checked = isChecked;
                checkbox.disabled = selectedModels.length >= 3 && !isChecked;
            });

            // Обновляем UI выбранных моделей
            updateSelectedModelsUI();

            // Сохраняем выбор
            localStorage.setItem('selectedModels', JSON.stringify(selectedModels));
        }

        // Обновление UI выбранных моделей
        function updateSelectedModelsUI() {
            const panel = document.getElementById('selectedModelsPanel');
            const list = document.getElementById('selectedModelsList');
            const compareBtn = document.getElementById('compareModelsBtn');

            if (selectedModels.length > 0) {
                panel.classList.add('show');

                list.innerHTML = selectedModels.map(modelName => {
                    const model = allModels.find(m => m.name === modelName);
                    return `
                        <div class="selected-model-item">
                            <div class="selected-model-name">${modelName}</div>
                            <button class="remove-model-btn" onclick="removeModelFromSelection('${modelName}')">×</button>
                        </div>
                    `;
                }).join('');

                if (selectedModels.length >= 2) {
                    compareBtn.style.display = 'block';
                } else {
                    compareBtn.style.display = 'none';
                }
            } else {
                panel.classList.remove('show');
                compareBtn.style.display = 'none';
            }
        }

        // Удаление модели из выбора
        function removeModelFromSelection(modelName) {
            selectedModels = selectedModels.filter(name => name !== modelName);
            updateSelectedModelsUI();

            // Обновляем чекбоксы
            const checkbox = document.querySelector(`.model-select-checkbox[data-model-name="${modelName}"]`);
            if (checkbox) {
                checkbox.checked = false;
                checkbox.disabled = false;
            }

            // Обновляем таблицу
            buildModelsComparisonTable();
        }

        // Очистка всего выбора
        function clearModelSelection() {
            selectedModels = [];
            updateSelectedModelsUI();

            // Снимаем все чекбоксы
            document.querySelectorAll('.model-select-checkbox').forEach(checkbox => {
                checkbox.checked = false;
                checkbox.disabled = false;
            });

            // Перестраиваем таблицу
            buildModelsComparisonTable();
        }

        // Показ детального сравнения выбранных моделей
        function showDetailedComparison() {
            if (selectedModels.length < 2) return;

            const models = selectedModels.map(name => allModels.find(m => m.name === name)).filter(Boolean);

            // Создаем модальное окно с детальным сравнением
            const modal = document.createElement('div');
            modal.className = 'modal-overlay';
            modal.innerHTML = `
                <div class="modal-content detailed-comparison-modal">
                    <div class="modal-header">
                        <h3>Детальное сравнение моделей</h3>
                        <button class="modal-close" onclick="this.closest('.modal-overlay').remove()">×</button>
                    </div>
                    <div class="modal-body">
                        <div class="comparison-grid">
                            ${models.map(model => `
                                <div class="comparison-card">
                                    <h4>${model.name}</h4>
                                    <div class="model-meta">
                                        <span class="model-type ${model.type.replace(/\s+/g, '')}">${model.type}</span>
                                        <span class="complexity-badge ${model.complexity}">${model.complexity}</span>
                                    </div>
                                    <div class="model-details">
                                        <p><strong>Масштаб:</strong> <span class="scale-badge ${model.scale}">${model.scale}</span></p>
                                        <p><strong>Срок:</strong> <span class="duration-badge">${model.duration}</span></p>
                                        <p><strong>Фокус:</strong> <span class="focus-badge ${model.focus}">${model.focus}</span></p>
                                        <p><strong>Разработчик:</strong> ${model.developer}</p>
                                        <p><strong>Применение:</strong> ${model.whenToUse}</p>
                                        <p><strong>Подходит для:</strong> ${model.bestFor}</p>
                                    </div>
                                    <button class="goto-model-btn" onclick="jumpToSlide(${findSlideIndexByKeyword(model.name.split(' ')[0].toLowerCase())}); this.closest('.modal-overlay').remove();">Перейти к модели</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;

            document.body.appendChild(modal);

            // Стили для модального окна (добавим в CSS выше)
            modal.addEventListener('click', (e) => {
                if (e.target === modal) modal.remove();
            });
        }

        // Выбор параметра в матрице
        function selectMatrixParameter(param) {
            const step = parseInt(param.dataset.step);
            const value = param.dataset.value;

            // Снимаем выделение с других параметров в этом шаге
            document.querySelectorAll(`.matrix-parameter[data-step="${step}"]`).forEach(p => {
                p.classList.remove('selected');
            });

            // Выделяем выбранный параметр
            param.classList.add('selected');

            // Сохраняем выбор
            if (step === 0) {
                matrixSelections.role = value;
            } else if (step === 1) {
                matrixSelections.scale = value;
            } else if (step === 2) {
                matrixSelections.speed = value;
            } else if (step === 3) {
                matrixSelections.resistance = value;
            } else if (step === 4) {
                matrixSelections.resources = value;
            }

            // Если выбраны все параметры, показываем рекомендации
            if (matrixSelections.role && matrixSelections.scale && matrixSelections.speed && 
                matrixSelections.resistance && matrixSelections.resources) {
                const recommendations = calculateRecommendations(
                    matrixSelections.role,
                    matrixSelections.scale, 
                    matrixSelections.speed,
                    matrixSelections.resistance,
                    matrixSelections.resources
                );
                showMatrixRecommendations(recommendations);
            }

            // Сохраняем состояние матрицы
            localStorage.setItem('matrixSelections', JSON.stringify(matrixSelections));
        }

        // Расчет рекомендаций на основе выбранных параметров
        function calculateRecommendations(role, scale, speed, resistance, resources) {
            // Базовые рекомендации по масштабу и скорости
            const baseRecommendationsMap = {
                // Малый масштаб
                'Малый-быстро': [
                    { name: 'PDCA Цикл', keyword: 'pdca', reason: 'Простой итеративный подход для быстрого тестирования идей', complexity: 'Низкая', focus: 'Процессы' },
                    { name: 'Теория подталкивания', keyword: 'подталкивания', reason: 'Эффективные поведенческие изменения без сложных процессов', complexity: 'Низкая', focus: 'Люди' },
                    { name: 'R2P2', keyword: 'r2p2', reason: 'Быстрое вовлечение людей и получение результатов', complexity: 'Низкая', focus: 'Люди' }
                ],
                'Малый-средне': [
                    { name: 'ADKAR', keyword: 'адкар', reason: 'Структурированный подход к индивидуальным изменениям', complexity: 'Средняя', focus: 'Люди' },
                    { name: 'Модель Сатир', keyword: 'сатир', reason: 'Фокус на эмоциональном пути человека при изменениях', complexity: 'Средняя', focus: 'Люди' },
                    { name: 'Позитивное отклонение', keyword: 'отклонение', reason: 'Эксперименты с позитивными изменениями', complexity: 'Низкая', focus: 'Культура' }
                ],
                'Малый-долго': [
                    { name: 'Теория подталкивания', keyword: 'подталкивания', reason: 'Долгосрочные поведенческие изменения', complexity: 'Низкая', focus: 'Люди' },
                    { name: 'PDCA Цикл', keyword: 'pdca', reason: 'Постоянное улучшение с течением времени', complexity: 'Низкая', focus: 'Процессы' },
                    { name: 'R2P2', keyword: 'r2p2', reason: 'Устойчивое вовлечение для долгосрочных изменений', complexity: 'Низкая', focus: 'Люди' }
                ],

                // Средний масштаб
                'Средний-быстро': [
                    { name: 'Модель Коттера', keyword: 'коттер', reason: 'Быстрое создание коалиции и видения изменений', complexity: 'Средняя', focus: 'Стратегия' },
                    { name: 'ADKAR', keyword: 'адкар', reason: 'Структурированная поддержка для команды среднего размера', complexity: 'Средняя', focus: 'Люди' },
                    { name: 'Переход Бриджеса', keyword: 'бриджес', reason: 'Помощь в эмоциональном переходе группы людей', complexity: 'Средняя', focus: 'Люди' }
                ],
                'Средний-средне': [
                    { name: 'Модель Коттера', keyword: 'коттер', reason: 'Комплексный подход к организационным изменениям', complexity: 'Средняя', focus: 'Стратегия' },
                    { name: 'ADKAR', keyword: 'адкар', reason: 'Индивидуальная готовность + организационная поддержка', complexity: 'Средняя', focus: 'Люди' },
                    { name: 'Переход Бриджеса', keyword: 'бриджес', reason: 'Эмоциональная поддержка в переходный период', complexity: 'Средняя', focus: 'Люди' }
                ],
                'Средний-долго': [
                    { name: 'Стандарт ACMP', keyword: 'acmp', reason: 'Профессиональный стандарт для комплексных изменений', complexity: 'Высокая', focus: 'Стратегия' },
                    { name: 'Гибридная модель', keyword: 'гибридная', reason: 'Комбинация подходов для устойчивых результатов', complexity: 'Высокая', focus: 'Стратегия' },
                    { name: 'Маур 3 уровня', keyword: 'маур', reason: 'Глубокие изменения в культуре и процессах', complexity: 'Высокая', focus: 'Культура' }
                ],

                // Крупный масштаб
                'Крупный-быстро': [
                    { name: 'Гибридная модель', keyword: 'гибридная', reason: 'Быстрая адаптация проверенных подходов', complexity: 'Высокая', focus: 'Стратегия' },
                    { name: 'Модель Коттера', keyword: 'коттер', reason: 'Создание мощной коалиции для быстрого старта', complexity: 'Средняя', focus: 'Стратегия' },
                    { name: 'Change Delta', keyword: 'delta', reason: 'Фокус на ключевых элементах для ускорения', complexity: 'Высокая', focus: 'Стратегия' }
                ],
                'Крупный-средне': [
                    { name: 'Стандарт ACMP', keyword: 'acmp', reason: 'Профессиональный подход к крупным изменениям', complexity: 'Высокая', focus: 'Стратегия' },
                    { name: 'Гибридная модель', keyword: 'гибридная', reason: 'Комбинированный подход для комплексности', complexity: 'Высокая', focus: 'Стратегия' },
                    { name: 'Маур 3 уровня', keyword: 'маур', reason: 'Системные изменения на всех уровнях организации', complexity: 'Высокая', focus: 'Культура' }
                ],
                'Крупный-долго': [
                    { name: 'Маур 3 уровня', keyword: 'маур', reason: 'Фундаментальные изменения в культуре и системах', complexity: 'Высокая', focus: 'Культура' },
                    { name: 'Гибридная модель', keyword: 'гибридная', reason: 'Долгосрочная трансформация с множеством элементов', complexity: 'Высокая', focus: 'Стратегия' },
                    { name: 'Стандарт ACMP', keyword: 'acmp', reason: 'Профессиональное управление комплексными изменениями', complexity: 'Высокая', focus: 'Стратегия' }
                ]
            };

            const baseKey = `${scale}-${speed.charAt(0).toLowerCase()}${speed.slice(1).toLowerCase()}`;
            let recommendations = baseRecommendationsMap[baseKey] || [
                { name: 'Модель Коттера', keyword: 'коттер', reason: 'Универсальный подход для большинства ситуаций', complexity: 'Средняя', focus: 'Стратегия' },
                { name: 'ADKAR', keyword: 'адкар', reason: 'Фокус на индивидуальной готовности к изменениям', complexity: 'Средняя', focus: 'Люди' },
                { name: 'Стандарт ACMP', keyword: 'acmp', reason: 'Профессиональный стандарт управления изменениями', complexity: 'Высокая', focus: 'Стратегия' }
            ];

            // Фильтрация и приоритизация на основе роли (согласно методологии Prosci)
            if (role === 'TOP') {
                // ТОП (Executive Sponsor) предпочитает: быстрые результаты, стратегический фокус, бизнес-метрики
                // Согласно Prosci, спонсор фокусируется на видении, ресурсах и стратегических решениях
                recommendations = recommendations
                    .filter(r => r.complexity !== 'Высокая' || resources === 'Неограниченные')
                    .sort((a, b) => {
                        if (a.focus === 'Стратегия' && b.focus !== 'Стратегия') return -1;
                        if (a.focus !== 'Стратегия' && b.focus === 'Стратегия') return 1;
                        if (a.complexity === 'Низкая' && b.complexity !== 'Низкая') return -1;
                        if (a.complexity !== 'Низкая' && b.complexity === 'Низкая') return 1;
                        return 0;
                    });
            } else if (role === 'FunctionalLeader') {
                // Функциональный руководитель предпочитает: фокус на людях, вовлечение команды, работа с сопротивлением
                // Согласно Prosci, функциональные руководители отвечают за вовлечение своих команд и коммуникацию изменений
                recommendations = recommendations
                    .filter(r => r.focus === 'Люди' || r.focus === 'Культура')
                    .sort((a, b) => {
                        if (a.focus === 'Люди' && b.focus !== 'Люди') return -1;
                        if (a.focus !== 'Люди' && b.focus === 'Люди') return 1;
                        return 0;
                    });
            } else if (role === 'ChangeAgent') {
                // Участник изменений предпочитает: детальные модели, комплексный подход, инструменты
                // Согласно Prosci, команда управления изменениями реализует план и обеспечивает поддержку сотрудников
                recommendations = recommendations
                    .sort((a, b) => {
                        if (a.complexity === 'Высокая' && b.complexity !== 'Высокая') return -1;
                        if (a.complexity !== 'Высокая' && b.complexity === 'Высокая') return 1;
                        return 0;
                    });
            }

            // Фильтрация по сопротивлению
            if (resistance === 'Высокое') {
                // При высоком сопротивлении приоритет моделям с фокусом на людей
                recommendations = recommendations
                    .sort((a, b) => {
                        if (a.focus === 'Люди' && b.focus !== 'Люди') return -1;
                        if (a.focus !== 'Люди' && b.focus === 'Люди') return 1;
                        return 0;
                    });
            }

            // Фильтрация по ресурсам
            if (resources === 'Ограниченные') {
                // При ограниченных ресурсах исключаем сложные модели
                recommendations = recommendations
                    .filter(r => r.complexity === 'Низкая' || r.complexity === 'Средняя')
                    .sort((a, b) => {
                        if (a.complexity === 'Низкая' && b.complexity !== 'Низкая') return -1;
                        if (a.complexity !== 'Низкая' && b.complexity === 'Низкая') return 1;
                        return 0;
                    });
            } else if (resources === 'Неограниченные') {
                // При неограниченных ресурсах можем использовать сложные модели
                recommendations = recommendations
                    .sort((a, b) => {
                        if (a.complexity === 'Высокая' && b.complexity !== 'Высокая') return -1;
                        if (a.complexity !== 'Высокая' && b.complexity === 'Высокая') return 1;
                        return 0;
                    });
            }

            // Добавляем контекстные причины на основе всех параметров
            recommendations = recommendations.slice(0, 3).map(rec => {
                let enhancedReason = rec.reason;
                
                if (role === 'TOP') {
                    enhancedReason += '. Оптимально для ТОП-менеджмента: быстрые результаты и стратегический фокус';
                } else if (role === 'FunctionalLeader') {
                    enhancedReason += '. Эффективна для функциональных руководителей: работа с людьми и вовлечение команды';
                } else if (role === 'ChangeAgent') {
                    enhancedReason += '. Подходит для команды управления изменениями: детальный план и комплексный подход';
                }

                if (resistance === 'Высокое') {
                    enhancedReason += '. Специально для работы с высоким сопротивлением';
                }

                if (resources === 'Ограниченные') {
                    enhancedReason += '. Эффективна при ограниченных ресурсах';
                }

                return { ...rec, reason: enhancedReason };
            });

            return recommendations;
        }

        // Отображение рекомендаций матрицы
        function showMatrixRecommendations(recommendations) {
            const container = document.getElementById('recommendedModelsList');
            if (!container) return;

            container.innerHTML = recommendations.map(rec => {
                const model = allModels.find(m => m.name.toLowerCase().includes(rec.keyword.toLowerCase()));
                const slideIndex = model ? findSlideIndexByKeyword(rec.keyword) : 65;

                return `
                    <div class="recommended-model">
                        <h5>${rec.name}</h5>
                        <p>${rec.reason}</p>
                        <span class="model-type ${model ? model.type.replace(/\s+/g, '') : 'Действенная'}">${model ? model.type : 'Рекомендованная'}</span>
                        <button class="goto-model-btn" onclick="jumpToSlide(${slideIndex})">Перейти к модели</button>
                    </div>
                `;
            }).join('');

            // Показываем панель рекомендаций
            const recommendationsPanel = document.getElementById('matrixRecommendations');
            if (recommendationsPanel) {
                recommendationsPanel.style.display = 'block';
                recommendationsPanel.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Сброс выбора в матрице
        function restartMatrixSelection() {
            // Снимаем выделение со всех параметров
            document.querySelectorAll('.matrix-parameter').forEach(param => {
                param.classList.remove('selected');
            });

            // Сбрасываем состояние
            matrixSelections = {
                role: null,
                scale: null,
                speed: null,
                resistance: null,
                resources: null
            };

            // Скрываем панель рекомендаций
            const recommendationsPanel = document.getElementById('matrixRecommendations');
            if (recommendationsPanel) {
                recommendationsPanel.style.display = 'none';
            }

            // Очищаем список рекомендаций
            const container = document.getElementById('recommendedModelsList');
            if (container) {
                container.innerHTML = '';
            }

            // Сохраняем пустое состояние
            localStorage.removeItem('matrixSelections');
        }

        // Восстановление состояния матрицы из localStorage
        function restoreMatrixState() {
            try {
                const saved = localStorage.getItem('matrixSelections');
                if (saved) {
                    matrixSelections = JSON.parse(saved);

                    // Восстанавливаем выделение параметров
                    if (matrixSelections.role) {
                        const roleParam = document.querySelector(`.matrix-parameter[data-step="0"][data-value="${matrixSelections.role}"]`);
                        if (roleParam) roleParam.classList.add('selected');
                    }
                    if (matrixSelections.scale) {
                        const scaleParam = document.querySelector(`.matrix-parameter[data-step="1"][data-value="${matrixSelections.scale}"]`);
                        if (scaleParam) scaleParam.classList.add('selected');
                    }
                    if (matrixSelections.speed) {
                        const speedParam = document.querySelector(`.matrix-parameter[data-step="2"][data-value="${matrixSelections.speed}"]`);
                        if (speedParam) speedParam.classList.add('selected');
                    }
                    if (matrixSelections.resistance) {
                        const resistanceParam = document.querySelector(`.matrix-parameter[data-step="3"][data-value="${matrixSelections.resistance}"]`);
                        if (resistanceParam) resistanceParam.classList.add('selected');
                    }
                    if (matrixSelections.resources) {
                        const resourcesParam = document.querySelector(`.matrix-parameter[data-step="4"][data-value="${matrixSelections.resources}"]`);
                        if (resourcesParam) resourcesParam.classList.add('selected');
                    }

                    // Если выбраны все параметры, показываем рекомендации
                    if (matrixSelections.role && matrixSelections.scale && matrixSelections.speed && 
                        matrixSelections.resistance && matrixSelections.resources) {
                        const recommendations = calculateRecommendations(
                            matrixSelections.role,
                            matrixSelections.scale,
                            matrixSelections.speed,
                            matrixSelections.resistance,
                            matrixSelections.resources
                        );
                        showMatrixRecommendations(recommendations);
                    }
                }
            } catch (error) {
                console.warn('Не удалось восстановить состояние матрицы:', error);
            }
        }

        // Экспорт выбранных моделей в PDF
        function exportSelectedModelsToPDF() {
            const selected = selectedModelsForComparison;
            if (selected.length === 0) {
                alert('Выберите модели для экспорта');
                return;
            }

            const models = selected.map(name => allModels.find(m => m.name === name)).filter(Boolean);
            if (models.length === 0) {
                alert('Не удалось найти выбранные модели');
                return;
            }

            const reportWindow = window.open('', '_blank');
            reportWindow.document.write(`
                <!DOCTYPE html>
                <html lang="ru">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Сравнение моделей управления изменениями</title>
                    <style>
                        body {
                            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            margin: 0;
                            padding: 20px;
                            background: white;
                            color: #333;
                        }
                        .header {
                            text-align: center;
                            margin-bottom: 30px;
                            border-bottom: 2px solid #e0e0e0;
                            padding-bottom: 20px;
                        }
                        .header h1 {
                            color: #2563eb;
                            margin: 0 0 10px 0;
                            font-size: 24px;
                        }
                        .header p {
                            margin: 0;
                            color: #666;
                            font-size: 14px;
                        }
                        .models-grid {
                            display: grid;
                            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                            gap: 20px;
                            margin-bottom: 30px;
                        }
                        .model-card {
                            border: 1px solid #e0e0e0;
                            border-radius: 8px;
                            padding: 20px;
                            background: white;
                            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                        }
                        .model-name {
                            font-size: 18px;
                            font-weight: bold;
                            color: #2563eb;
                            margin-bottom: 10px;
                        }
                        .model-type {
                            background: #f0f9ff;
                            color: #0369a1;
                            padding: 4px 8px;
                            border-radius: 4px;
                            font-size: 12px;
                            display: inline-block;
                            margin-bottom: 15px;
                        }
                        .model-property {
                            margin-bottom: 8px;
                            font-size: 14px;
                        }
                        .property-label {
                            font-weight: bold;
                            color: #374151;
                        }
                        .footer {
                            text-align: center;
                            margin-top: 30px;
                            padding-top: 20px;
                            border-top: 1px solid #e0e0e0;
                            font-size: 12px;
                            color: #666;
                        }
                        @media print {
                            body { margin: 0; }
                            .model-card { break-inside: avoid; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>Сравнение моделей управления изменениями</h1>
                        <p>Экспортировано из презентации "56 Моделей Управления Изменениями"</p>
                        <p>Дата: ${new Date().toLocaleDateString('ru-RU')}</p>
                    </div>

                    <div class="models-grid">
                        ${models.map(model => `
                            <div class="model-card">
                                <div class="model-name">${model.name}</div>
                                <div class="model-type">${model.type}</div>
                                <div class="model-property">
                                    <span class="property-label">Сложность:</span> ${model.complexity}
                                </div>
                                <div class="model-property">
                                    <span class="property-label">Масштаб:</span> ${model.scale}
                                </div>
                                <div class="model-property">
                                    <span class="property-label">Срок применения:</span> ${model.duration}
                                </div>
                                <div class="model-property">
                                    <span class="property-label">Фокус:</span> ${model.focus}
                                </div>
                                <div class="model-property">
                                    <span class="property-label">Когда использовать:</span> ${model.whenToUse}
                                </div>
                                <div class="model-property">
                                    <span class="property-label">Лучше всего для:</span> ${model.bestFor}
                                </div>
                            </div>
                        `).join('')}
                    </div>

                    <div class="footer">
                        <p>Создано с помощью интерактивного инструмента выбора моделей</p>
                        <p>Дмитрий Владимиров | Change Management Expert</p>
                    </div>
                </body>
                </html>
            `);

            reportWindow.document.close();

            // Автоматический запуск печати
            setTimeout(() => {
                reportWindow.print();
            }, 500);
        }

        // Восстановление состояния таблицы из localStorage
        function restoreTableState() {
            try {
                // Восстанавливаем фильтры
                const savedFilters = localStorage.getItem('modelSelectorFilters');
                if (savedFilters) {
                    activeFilters = JSON.parse(savedFilters);

                    // Применяем сохраненные фильтры к UI
                    Object.entries(activeFilters).forEach(([filterType, values]) => {
                        values.forEach(value => {
                            const btn = document.querySelector(`.filter-btn[data-filter="${filterType}"][data-value="${value}"]`);
                            if (btn) btn.classList.add('active');
                        });
                    });
                }

                // Восстанавливаем выбранные модели
                const savedModels = localStorage.getItem('selectedModels');
                if (savedModels) {
                    selectedModels = JSON.parse(savedModels);
                    updateSelectedModelsUI();
                }

                // Восстанавливаем режим
                const savedMode = localStorage.getItem('modelSelectorMode');
                if (savedMode && savedMode !== 'table') {
                    switchSelectorMode(savedMode);
                }
            } catch (error) {
                console.warn('Не удалось восстановить состояние таблицы:', error);
            }
        }

        // Показ рекомендаций из квиза
        function showQuizRecommendations() {
            try {
                const savedRecommendations = localStorage.getItem('quizRecommendations');
                if (savedRecommendations) {
                    const recommendations = JSON.parse(savedRecommendations);
                    if (recommendations.length > 0) {
                        // Создаем баннер с рекомендациями квиза
                        const banner = document.createElement('div');
                        banner.className = 'quiz-recommendations-banner';
                        banner.innerHTML = `
                            <div class="banner-header">
                                <h4>🎯 Рекомендации из вашего квиза</h4>
                                <button class="banner-close" onclick="this.closest('.quiz-recommendations-banner').remove()">×</button>
                            </div>
                            <div class="banner-content">
                                <p>На основе ваших ответов в квизе рекомендуем следующие модели:</p>
                                <div class="quiz-recommended-models">
                                    ${recommendations.slice(0, 3).map(model => `
                                        <div class="quiz-recommended-model" onclick="jumpToSlide(${findSlideIndexByKeyword(model.name.split(' ')[0].toLowerCase())})">
                                            <span class="model-name">${model.name}</span>
                                            <span class="model-sources">${model.sources.join(', ')}</span>
                                        </div>
                                    `).join('')}
                                </div>
                                <button class="panel-button" onclick="jumpToSlide(65)" style="margin-top: var(--space-12);">Пройти квиз заново →</button>
                            </div>
                        `;

                        // Добавляем баннер в начало инструмента
                        const toolContainer = document.querySelector('.model-selector-tool');
                        if (toolContainer) {
                            toolContainer.insertBefore(banner, toolContainer.firstChild);
                        }
                    }
                }
            } catch (error) {
                console.warn('Не удалось показать рекомендации квиза:', error);
            }
        }

        // Обновляем функцию initModelSelector для восстановления состояния
        function initModelSelector() {
            console.log('Инициализация Model Selector...');

            // Собираем все модели
            allModels = [...classicalModels, ...newModels];
            filteredModels = [...allModels];

            // Инициализируем UI
            setupModelSelectorEventListeners();
            buildModelsComparisonTable();

            // Восстанавливаем состояние
            restoreTableState();
            restoreMatrixState();

            // Показываем рекомендации из квиза
            showQuizRecommendations();

            console.log('✓ Model Selector инициализирован');
        }

        // Инициализация model selector
        initModelSelector();
        console.log('✓ Model Selector инструмент инициализирован');

        // Инициализация кнопок на последнем слайде (CTA) - ПОСЛЕ создания слайдов
        const ctaRestartBtn = document.getElementById('ctaRestart');
        if (ctaRestartBtn) {
            ctaRestartBtn.addEventListener('click', () => {
                console.log('Перезапуск презентации...');
                const slides = document.querySelectorAll('.slide');
                if (slides[currentSlide]) {
                    slides[currentSlide].classList.remove('active');
                }
                currentSlide = visibleSlides[0] ?? 0;
                if (slides[currentSlide]) {
                    slides[currentSlide].classList.add('active');
                    slides[currentSlide].scrollTop = 0;
                }
                toggleBookmarkPanel(false);
                toggleNotesPanel(false);
                toggleHistoryPanel(false);
                window.scrollTo({ top: 0, behavior: 'smooth' });
                updateNavigation();
            });
            console.log('✓ Кнопка "Перезапустить" инициализирована');
        } else {
            console.warn('⚠ Кнопка ctaRestart не найдена');
        }
        
        const ctaDownloadBtn = document.getElementById('ctaDownload');
        if (ctaDownloadBtn) {
            ctaDownloadBtn.addEventListener('click', () => {
                console.log('Запуск экспорта в PDF...');
                exportToPDF();
            });
            console.log('✓ Кнопка "Скачать PDF" инициализирована');
        } else {
            console.warn('⚠ Кнопка ctaDownload не найдена');
        }
        
        console.log('=== Инициализация завершена ===');
        
        // Динамический расчет отступа для тулбара
        function updateNavigationPadding() {
            const navigationEl = document.querySelector('.navigation');
            const slideContainerEl = document.querySelector('.slide-container');
            
            if (navigationEl && slideContainerEl) {
                const navHeight = navigationEl.offsetHeight;
                const isMobile = window.innerWidth <= 768;
                
                // Получаем safe-area-inset-bottom через CSS переменную или напрямую
                let safeAreaBottom = 0;
                let safeAreaTop = 0;
                
                if (CSS.supports('padding', 'env(safe-area-inset-bottom)')) {
                    // Пытаемся получить значение через getComputedStyle
                    const testEl = document.createElement('div');
                    testEl.style.paddingBottom = 'env(safe-area-inset-bottom)';
                    testEl.style.paddingTop = 'env(safe-area-inset-top)';
                    document.body.appendChild(testEl);
                    const computed = window.getComputedStyle(testEl);
                    const paddingBottomValue = computed.paddingBottom;
                    const paddingTopValue = computed.paddingTop;
                    document.body.removeChild(testEl);
                    
                    // Если значение в px, извлекаем число
                    if (paddingBottomValue && paddingBottomValue !== '0px') {
                        safeAreaBottom = parseInt(paddingBottomValue) || 0;
                    }
                    if (paddingTopValue && paddingTopValue !== '0px') {
                        safeAreaTop = parseInt(paddingTopValue) || 0;
                    }
                }
                
                // Используем max() для учета safe-area (минимум 80px + высота тулбара + отступ)
                const paddingBottom = Math.max(80, navHeight + 20 + safeAreaBottom);
                slideContainerEl.style.paddingBottom = `${paddingBottom}px`;
                
                // На мобильных также устанавливаем padding-top для верхнего тулбара
                if (isMobile) {
                    // Вычисляем высоту верхнего тулбара (circular-progress + кнопки)
                    const circularProgress = document.querySelector('.circular-progress');
                    const exportBtn = document.querySelector('.export-btn');
                    const topToolbarHeight = circularProgress ? 
                        (circularProgress.offsetHeight + 24) : // высота + отступы
                        (exportBtn ? exportBtn.offsetHeight + 24 : 60);
                    
                    const paddingTop = Math.max(60, topToolbarHeight + safeAreaTop);
                    slideContainerEl.style.paddingTop = `${paddingTop}px`;
                } else {
                    // На десктопе убираем padding-top
                    slideContainerEl.style.paddingTop = '0px';
                }
            }
        }
        
        // Обновляем отступ при загрузке и изменении размера окна
        updateNavigationPadding();
        window.addEventListener('resize', updateNavigationPadding);
        
        // Обновляем отступ после изменения содержимого тулбара
        const resizeObserver = new ResizeObserver(() => {
            updateNavigationPadding();
        });
        
        const navigationEl = document.querySelector('.navigation');
        if (navigationEl) {
            resizeObserver.observe(navigationEl);
        }
        
        // Автоскрытие тулбаров при прокрутке (только на мобильных)
        let toolbarAutoHideInitialized = false;
        let scrollTimeout = null;
        let lastScrollTop = {};
        
        function initToolbarAutoHide() {
            // Проверяем, что мы на мобильном устройстве
            const isMobile = window.innerWidth <= 768;
            if (!isMobile) {
                // Удаляем классы скрытия при переходе на десктоп
                document.querySelectorAll('.toolbar-hidden').forEach(el => {
                    el.classList.remove('toolbar-hidden');
                });
                return;
            }
            
            const topToolbarElements = [
                document.querySelector('.circular-progress'),
                document.querySelector('.export-btn'),
                document.querySelector('.fullscreen-btn')
            ].filter(el => el !== null);
            
            const bottomToolbar = document.querySelector('.navigation');
            
            if (topToolbarElements.length === 0 && !bottomToolbar) return;
            
            // Функция для обработки прокрутки
            function handleScroll() {
                // Получаем текущий активный слайд
                const activeSlide = document.querySelector('.slide.active');
                if (!activeSlide) return;
                
                // Используем прокрутку активного слайда
                const currentScrollTop = activeSlide.scrollTop || 0;
                const scrollHeight = activeSlide.scrollHeight || 0;
                const clientHeight = activeSlide.clientHeight || window.innerHeight;
                const isAtBottom = scrollHeight > 0 && currentScrollTop + clientHeight >= scrollHeight - 20; // 20px допуск
                const isAtTop = currentScrollTop <= 20; // 20px допуск
                
                // Получаем последнюю позицию прокрутки для этого слайда
                const slideId = activeSlide.id || activeSlide.getAttribute('data-slide-index') || 'default';
                const prevScrollTop = lastScrollTop[slideId] || 0;
                
                // Более точное определение направления прокрутки (минимум 5px разница)
                const scrollDelta = currentScrollTop - prevScrollTop;
                const scrollingDown = scrollDelta > 5;
                const scrollingUp = scrollDelta < -5;
                
                lastScrollTop[slideId] = currentScrollTop;
                
                // Скрываем верхний тулбар при прокрутке вниз (кроме начала)
                if (scrollingDown && currentScrollTop > 30) {
                    topToolbarElements.forEach(el => {
                        if (el && !el.classList.contains('toolbar-hidden')) {
                            el.classList.add('toolbar-hidden');
                        }
                    });
                } else if (scrollingUp || isAtTop) {
                    // Показываем верхний тулбар при прокрутке вверх или в начале
                    topToolbarElements.forEach(el => {
                        if (el && el.classList.contains('toolbar-hidden')) {
                            el.classList.remove('toolbar-hidden');
                        }
                    });
                }
                
                // Более агрессивное скрытие нижнего тулбара при прокрутке вниз
                if (bottomToolbar) {
                    // Скрываем если:
                    // 1. Прокрутка вниз И не в самом начале (больше 30px) И не в самом конце
                    // 2. Или просто прокрутили достаточно далеко от верха (больше 100px)
                    const shouldHideBottom = (scrollingDown && currentScrollTop > 30 && !isAtBottom) || 
                                           (currentScrollTop > 100 && !isAtBottom && !scrollingUp);
                    
                    if (shouldHideBottom) {
                        if (!bottomToolbar.classList.contains('toolbar-hidden')) {
                            bottomToolbar.classList.add('toolbar-hidden');
                        }
                    } else if (scrollingUp || isAtBottom || isAtTop) {
                        // Показываем нижний тулбар при прокрутке вверх, в конце или в начале
                        if (bottomToolbar.classList.contains('toolbar-hidden')) {
                            bottomToolbar.classList.remove('toolbar-hidden');
                        }
                    }
                }
                
                // Сбрасываем таймер
                if (scrollTimeout) {
                    clearTimeout(scrollTimeout);
                }
                
                // Показываем тулбары через 3 секунды после остановки прокрутки (только если не прокручиваем)
                scrollTimeout = setTimeout(() => {
                    // Проверяем, что прокрутка действительно остановилась
                    const finalScrollTop = activeSlide.scrollTop || 0;
                    if (Math.abs(finalScrollTop - currentScrollTop) < 5) {
                        // Показываем только если не в середине длинного контента
                        const finalScrollHeight = activeSlide.scrollHeight || 0;
                        const finalClientHeight = activeSlide.clientHeight || window.innerHeight;
                        const finalIsAtBottom = finalScrollHeight > 0 && finalScrollTop + finalClientHeight >= finalScrollHeight - 20;
                        
                        if (finalIsAtBottom || finalScrollTop <= 30) {
                            topToolbarElements.forEach(el => {
                                if (el && el.classList.contains('toolbar-hidden')) {
                                    el.classList.remove('toolbar-hidden');
                                }
                            });
                            if (bottomToolbar && bottomToolbar.classList.contains('toolbar-hidden')) {
                                bottomToolbar.classList.remove('toolbar-hidden');
                            }
                        }
                    }
                }, 3000);
            }
            
            // Хранилище для touch-данных каждого слайда
            const touchData = new Map();
            
            // Добавляем обработчики прокрутки ко всем слайдам (если еще не добавлены)
            const slides = document.querySelectorAll('.slide');
            slides.forEach(slide => {
                // Проверяем, не добавлен ли уже обработчик
                if (!slide.hasAttribute('data-scroll-handler-added')) {
                    // Основной обработчик прокрутки
                    slide.addEventListener('scroll', handleScroll, { passive: true });
                    
                    // Дополнительный обработчик для touch-устройств (iOS)
                    const slideId = slide.id || slide.getAttribute('data-slide-index') || `slide-${Math.random()}`;
                    
                    slide.addEventListener('touchstart', (e) => {
                        touchData.set(slideId, {
                            startY: e.touches[0].clientY,
                            startScrollTop: slide.scrollTop || 0
                        });
                    }, { passive: true });
                    
                    slide.addEventListener('touchmove', (e) => {
                        const data = touchData.get(slideId);
                        if (!data) return;
                        
                        const touchCurrentY = e.touches[0].clientY;
                        const touchDeltaY = touchCurrentY - data.startY;
                        const currentScrollTop = slide.scrollTop || 0;
                        
                        // Если прокрутка вниз (палец движется вверх) и прокрутили больше 30px
                        if (touchDeltaY < -30 && currentScrollTop > data.startScrollTop + 20) {
                            // Принудительно скрываем нижний тулбар
                            if (bottomToolbar && !bottomToolbar.classList.contains('toolbar-hidden')) {
                                bottomToolbar.classList.add('toolbar-hidden');
                            }
                        }
                        
                        // Вызываем основной обработчик для обновления состояния
                        handleScroll();
                    }, { passive: true });
                    
                    slide.addEventListener('touchend', () => {
                        // Очищаем данные после окончания касания
                        touchData.delete(slideId);
                    }, { passive: true });
                    
                    slide.setAttribute('data-scroll-handler-added', 'true');
                }
            });
            
            // Обновляем обработчики при смене слайда
            if (!toolbarAutoHideInitialized) {
                const originalChangeSlide = window.changeSlide;
                if (originalChangeSlide) {
                    window.changeSlide = function(direction) {
                        const result = originalChangeSlide(direction);
                        
                        // Сбрасываем состояние и показываем тулбары при смене слайда
                        setTimeout(() => {
                            const newActiveSlide = document.querySelector('.slide.active');
                            if (newActiveSlide) {
                                topToolbarElements.forEach(el => {
                                    if (el) el.classList.remove('toolbar-hidden');
                                });
                                if (bottomToolbar) {
                                    bottomToolbar.classList.remove('toolbar-hidden');
                                }
                                // Сбрасываем позицию прокрутки для нового слайда
                                const slideId = newActiveSlide.id || 'default';
                                lastScrollTop[slideId] = newActiveSlide.scrollTop || 0;
                            }
                        }, 100);
                        
                        return result;
                    };
                }
                toolbarAutoHideInitialized = true;
            }
        }
        
        // Инициализируем автоскрытие тулбаров после загрузки DOM
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(initToolbarAutoHide, 500);
            });
        } else {
            setTimeout(initToolbarAutoHide, 500);
        }
        
        // Переинициализируем при изменении размера окна (для переключения между мобильным и десктопом)
        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                initToolbarAutoHide();
            }, 250);
        });
        
        // Show swipe hint after a short delay
        setTimeout(showSwipeHint, 1000);
    </script>
</body>
</html>
</html>